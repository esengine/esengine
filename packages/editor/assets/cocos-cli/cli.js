#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const sentry_1 = require("./core/base/sentry");
(0, sentry_1.initSentry)();
const commander_1 = require("commander");
const commands_1 = require("./commands");
const config_1 = require("./display/config");
const program = new commander_1.Command();
// 全局配置
program
    .name('cocos')
    .description('Cocos CLI tool for project management and building')
    .version('1.0.0')
    .option('--debug', 'Enable debug mode')
    .option('--no-interactive', 'Disable interactive mode (for CI)')
    .option('--config <path>', 'Specify config file path');
// 全局错误处理
program.exitOverride();
// 注册命令
const commandRegistry = new commands_1.CommandRegistry();
commandRegistry.register(new commands_1.CreateCommand(program));
commandRegistry.register(new commands_1.BuildCommand(program));
commandRegistry.register(new commands_1.McpServerCommand(program));
commandRegistry.register(new commands_1.MakeCommand(program));
commandRegistry.register(new commands_1.RunCommand(program));
// 注册所有命令
commandRegistry.registerAll();
// 错误处理
program.configureHelp({
    sortSubcommands: true,
    subcommandTerm: (cmd) => cmd.name()
});
// 解析命令行参数
try {
    program.parse();
    // 设置交互模式
    const interactiveMode = !program.getOptionValue('noInteractive');
    config_1.config.setInteractiveMode(interactiveMode);
}
catch (error) {
    // 如果是帮助显示或版本显示错误，正常退出
    if (error.code === 'commander.helpDisplayed' || error.code === 'commander.version') {
        process.exit(0);
    }
    // Commander.js 参数错误（如缺少 requiredOption）
    if (error.code === 'commander.missingMandatoryOptionValue' ||
        error.code === 'commander.missingArgument' ||
        error.exitCode) {
        console.error(error.message);
        process.exit(error.exitCode || 1);
    }
    // 其他错误
    console.error('Error:', error.message || error);
    process.exit(1);
}
// 如果没有提供命令，显示帮助
if (!process.argv.slice(2).length) {
    program.outputHelp();
    process.exit(0);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NsaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSwrQ0FBZ0Q7QUFDaEQsSUFBQSxtQkFBVSxHQUFFLENBQUM7QUFFYix5Q0FBb0M7QUFDcEMseUNBQXFIO0FBQ3JILDZDQUEwQztBQUUxQyxNQUFNLE9BQU8sR0FBRyxJQUFJLG1CQUFPLEVBQUUsQ0FBQztBQUU5QixPQUFPO0FBQ1AsT0FBTztLQUNGLElBQUksQ0FBQyxPQUFPLENBQUM7S0FDYixXQUFXLENBQUMsb0RBQW9ELENBQUM7S0FDakUsT0FBTyxDQUFDLE9BQU8sQ0FBQztLQUNoQixNQUFNLENBQUMsU0FBUyxFQUFFLG1CQUFtQixDQUFDO0tBQ3RDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxtQ0FBbUMsQ0FBQztLQUMvRCxNQUFNLENBQUMsaUJBQWlCLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztBQUUzRCxTQUFTO0FBQ1QsT0FBTyxDQUFDLFlBQVksRUFBRSxDQUFDO0FBRXZCLE9BQU87QUFDUCxNQUFNLGVBQWUsR0FBRyxJQUFJLDBCQUFlLEVBQUUsQ0FBQztBQUM5QyxlQUFlLENBQUMsUUFBUSxDQUFDLElBQUksd0JBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0FBQ3JELGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSx1QkFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDcEQsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLDJCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDeEQsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLHNCQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztBQUNuRCxlQUFlLENBQUMsUUFBUSxDQUFDLElBQUkscUJBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0FBRWxELFNBQVM7QUFDVCxlQUFlLENBQUMsV0FBVyxFQUFFLENBQUM7QUFFOUIsT0FBTztBQUNQLE9BQU8sQ0FBQyxhQUFhLENBQUM7SUFDbEIsZUFBZSxFQUFFLElBQUk7SUFDckIsY0FBYyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFO0NBQ3RDLENBQUMsQ0FBQztBQUVILFVBQVU7QUFDVixJQUFJLENBQUM7SUFDRCxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7SUFFaEIsU0FBUztJQUNULE1BQU0sZUFBZSxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNqRSxlQUFNLENBQUMsa0JBQWtCLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFL0MsQ0FBQztBQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7SUFDbEIsc0JBQXNCO0lBQ3RCLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyx5QkFBeUIsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLG1CQUFtQixFQUFFLENBQUM7UUFDakYsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBRUQsd0NBQXdDO0lBQ3hDLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyx1Q0FBdUM7UUFDdEQsS0FBSyxDQUFDLElBQUksS0FBSywyQkFBMkI7UUFDMUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2pCLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsT0FBTztJQUNQLE9BQU8sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLENBQUM7SUFDaEQsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNwQixDQUFDO0FBRUQsZ0JBQWdCO0FBQ2hCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNoQyxPQUFPLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDckIsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNwQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiIyEvdXNyL2Jpbi9lbnYgbm9kZVxyXG5pbXBvcnQgeyBpbml0U2VudHJ5IH0gZnJvbSAnLi9jb3JlL2Jhc2Uvc2VudHJ5JztcclxuaW5pdFNlbnRyeSgpO1xyXG5cclxuaW1wb3J0IHsgQ29tbWFuZCB9IGZyb20gJ2NvbW1hbmRlcic7XHJcbmltcG9ydCB7IEJ1aWxkQ29tbWFuZCwgTWNwU2VydmVyQ29tbWFuZCwgQ29tbWFuZFJlZ2lzdHJ5LCBDcmVhdGVDb21tYW5kLCBNYWtlQ29tbWFuZCwgUnVuQ29tbWFuZCB9IGZyb20gJy4vY29tbWFuZHMnO1xyXG5pbXBvcnQgeyBjb25maWcgfSBmcm9tICcuL2Rpc3BsYXkvY29uZmlnJztcclxuXHJcbmNvbnN0IHByb2dyYW0gPSBuZXcgQ29tbWFuZCgpO1xyXG5cclxuLy8g5YWo5bGA6YWN572uXHJcbnByb2dyYW1cclxuICAgIC5uYW1lKCdjb2NvcycpXHJcbiAgICAuZGVzY3JpcHRpb24oJ0NvY29zIENMSSB0b29sIGZvciBwcm9qZWN0IG1hbmFnZW1lbnQgYW5kIGJ1aWxkaW5nJylcclxuICAgIC52ZXJzaW9uKCcxLjAuMCcpXHJcbiAgICAub3B0aW9uKCctLWRlYnVnJywgJ0VuYWJsZSBkZWJ1ZyBtb2RlJylcclxuICAgIC5vcHRpb24oJy0tbm8taW50ZXJhY3RpdmUnLCAnRGlzYWJsZSBpbnRlcmFjdGl2ZSBtb2RlIChmb3IgQ0kpJylcclxuICAgIC5vcHRpb24oJy0tY29uZmlnIDxwYXRoPicsICdTcGVjaWZ5IGNvbmZpZyBmaWxlIHBhdGgnKTtcclxuXHJcbi8vIOWFqOWxgOmUmeivr+WkhOeQhlxyXG5wcm9ncmFtLmV4aXRPdmVycmlkZSgpO1xyXG5cclxuLy8g5rOo5YaM5ZG95LukXHJcbmNvbnN0IGNvbW1hbmRSZWdpc3RyeSA9IG5ldyBDb21tYW5kUmVnaXN0cnkoKTtcclxuY29tbWFuZFJlZ2lzdHJ5LnJlZ2lzdGVyKG5ldyBDcmVhdGVDb21tYW5kKHByb2dyYW0pKTtcclxuY29tbWFuZFJlZ2lzdHJ5LnJlZ2lzdGVyKG5ldyBCdWlsZENvbW1hbmQocHJvZ3JhbSkpO1xyXG5jb21tYW5kUmVnaXN0cnkucmVnaXN0ZXIobmV3IE1jcFNlcnZlckNvbW1hbmQocHJvZ3JhbSkpO1xyXG5jb21tYW5kUmVnaXN0cnkucmVnaXN0ZXIobmV3IE1ha2VDb21tYW5kKHByb2dyYW0pKTtcclxuY29tbWFuZFJlZ2lzdHJ5LnJlZ2lzdGVyKG5ldyBSdW5Db21tYW5kKHByb2dyYW0pKTtcclxuXHJcbi8vIOazqOWGjOaJgOacieWRveS7pFxyXG5jb21tYW5kUmVnaXN0cnkucmVnaXN0ZXJBbGwoKTtcclxuXHJcbi8vIOmUmeivr+WkhOeQhlxyXG5wcm9ncmFtLmNvbmZpZ3VyZUhlbHAoe1xyXG4gICAgc29ydFN1YmNvbW1hbmRzOiB0cnVlLFxyXG4gICAgc3ViY29tbWFuZFRlcm06IChjbWQpID0+IGNtZC5uYW1lKClcclxufSk7XHJcblxyXG4vLyDop6PmnpDlkb3ku6TooYzlj4LmlbBcclxudHJ5IHtcclxuICAgIHByb2dyYW0ucGFyc2UoKTtcclxuXHJcbiAgICAvLyDorr7nva7kuqTkupLmqKHlvI9cclxuICAgIGNvbnN0IGludGVyYWN0aXZlTW9kZSA9ICFwcm9ncmFtLmdldE9wdGlvblZhbHVlKCdub0ludGVyYWN0aXZlJyk7XHJcbiAgICBjb25maWcuc2V0SW50ZXJhY3RpdmVNb2RlKGludGVyYWN0aXZlTW9kZSk7XHJcblxyXG59IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAvLyDlpoLmnpzmmK/luK7liqnmmL7npLrmiJbniYjmnKzmmL7npLrplJnor6/vvIzmraPluLjpgIDlh7pcclxuICAgIGlmIChlcnJvci5jb2RlID09PSAnY29tbWFuZGVyLmhlbHBEaXNwbGF5ZWQnIHx8IGVycm9yLmNvZGUgPT09ICdjb21tYW5kZXIudmVyc2lvbicpIHtcclxuICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29tbWFuZGVyLmpzIOWPguaVsOmUmeivr++8iOWmgue8uuWwkSByZXF1aXJlZE9wdGlvbu+8iVxyXG4gICAgaWYgKGVycm9yLmNvZGUgPT09ICdjb21tYW5kZXIubWlzc2luZ01hbmRhdG9yeU9wdGlvblZhbHVlJyB8fFxyXG4gICAgICAgIGVycm9yLmNvZGUgPT09ICdjb21tYW5kZXIubWlzc2luZ0FyZ3VtZW50JyB8fFxyXG4gICAgICAgIGVycm9yLmV4aXRDb2RlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvci5tZXNzYWdlKTtcclxuICAgICAgICBwcm9jZXNzLmV4aXQoZXJyb3IuZXhpdENvZGUgfHwgMSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5YW25LuW6ZSZ6K+vXHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvcjonLCBlcnJvci5tZXNzYWdlIHx8IGVycm9yKTtcclxuICAgIHByb2Nlc3MuZXhpdCgxKTtcclxufVxyXG5cclxuLy8g5aaC5p6c5rKh5pyJ5o+Q5L6b5ZG95Luk77yM5pi+56S65biu5YqpXHJcbmlmICghcHJvY2Vzcy5hcmd2LnNsaWNlKDIpLmxlbmd0aCkge1xyXG4gICAgcHJvZ3JhbS5vdXRwdXRIZWxwKCk7XHJcbiAgICBwcm9jZXNzLmV4aXQoMCk7XHJcbn1cclxuIl19