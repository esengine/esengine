"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SceneEditor = void 0;
const cc_1 = require("cc");
const rpc_1 = require("../../rpc");
const utils_1 = require("../scene/utils");
const base_editor_1 = require("./base-editor");
const prefab_editor_utils_1 = require("../prefab/prefab-editor-utils");
/**
 * SceneEditor - 场景编辑器
 * 继承 BaseEditor，实现场景相关的具体操作
 */
class SceneEditor extends base_editor_1.BaseEditor {
    async encode(entity) {
        entity = entity ?? this.entity;
        if (!entity) {
            throw new Error('encode 失败，没有打开场景');
        }
        return {
            ...entity.identifier,
            name: entity.instance.name,
            prefab: utils_1.sceneUtils.generatePrefabInfo(entity.instance['_prefab']),
            children: entity.instance.children
                .map((node) => {
                return utils_1.sceneUtils.generateNodeInfo(node, true);
            })
                .filter(child => child !== null),
            components: entity.instance.components
                .map((component) => {
                return utils_1.sceneUtils.generateComponentInfo(component);
            })
        };
    }
    async open(asset) {
        const identifier = this.getIdentifier(asset);
        if (this.entity?.identifier.assetUuid === identifier.assetUuid) {
            return await this.encode();
        }
        const sceneAsset = await utils_1.sceneUtils.loadAny(identifier.assetUuid);
        const instance = await utils_1.sceneUtils.runScene(sceneAsset);
        this.setCurrentOpen({
            instance,
            identifier,
        });
        return this.encode();
    }
    async close() {
        if (!this.entity) {
            throw new Error('[close] 没有打开场景');
        }
        await this.save();
        await utils_1.sceneUtils.runScene(new cc_1.Scene(''));
        this.setCurrentOpen(null);
        return true;
    }
    async save() {
        if (!this.entity) {
            throw new Error('[save] 没有打开场景');
        }
        const serializedData = utils_1.sceneUtils.serialize(this.entity.instance);
        return await rpc_1.Rpc.getInstance().request('assetManager', 'saveAsset', [this.entity.identifier.assetUuid, serializedData]);
    }
    async _doReload() {
        if (!this.entity) {
            throw new Error('[reload] 没有打开场景');
        }
        const scene = this.entity.instance;
        const prefabUUIDMap = prefab_editor_utils_1.editorPrefabUtils.storePrefabUUID(scene);
        const serializeJSON = utils_1.sceneUtils.serialize(scene);
        const sceneAfterLoad = await utils_1.sceneUtils.runSceneImmediateByJson(serializeJSON);
        prefab_editor_utils_1.editorPrefabUtils.restorePrefabUUID(sceneAfterLoad, prefabUUIDMap);
        this.entity.instance = sceneAfterLoad;
        return this.encode();
    }
    async create(params) {
        const { baseName, targetDirectory, templateType = '2d' } = params;
        try {
            // 创建场景资源
            const assetInfo = await rpc_1.Rpc.getInstance().request('assetManager', 'createAssetByType', [
                'scene',
                targetDirectory,
                baseName,
                { templateName: templateType }
            ]);
            if (!assetInfo) {
                throw new Error('创建场景资源失败');
            }
            return this.getIdentifier(assetInfo);
        }
        catch (error) {
            console.error('创建场景失败:', error);
            throw error;
        }
    }
}
exports.SceneEditor = SceneEditor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtZWRpdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvcmUvc2NlbmUvc2NlbmUtcHJvY2Vzcy9zZXJ2aWNlL2VkaXRvcnMvc2NlbmUtZWRpdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDJCQUF3RDtBQUV4RCxtQ0FBZ0M7QUFDaEMsMENBQTRDO0FBQzVDLCtDQUEyQztBQUczQyx1RUFBa0U7QUFFbEU7OztHQUdHO0FBQ0gsTUFBYSxXQUFZLFNBQVEsd0JBQVU7SUFFdkMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUE2QjtRQUN0QyxNQUFNLEdBQUcsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDL0IsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ1YsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3hDLENBQUM7UUFDRCxPQUFPO1lBQ0gsR0FBRyxNQUFNLENBQUMsVUFBVTtZQUNwQixJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJO1lBQzFCLE1BQU0sRUFBRSxrQkFBVSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDakUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUTtpQkFDN0IsR0FBRyxDQUFDLENBQUMsSUFBVSxFQUFFLEVBQUU7Z0JBQ2hCLE9BQU8sa0JBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDbkQsQ0FBQyxDQUFDO2lCQUNELE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQVk7WUFDL0MsVUFBVSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsVUFBVTtpQkFDakMsR0FBRyxDQUFDLENBQUMsU0FBb0IsRUFBRSxFQUFFO2dCQUMxQixPQUFPLGtCQUFVLENBQUMs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VyxFQUFFLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxtQkFBbUIsRUFBRTtnQkFDbkYsT0FBTztnQkFDUCxlQUFlO2dCQUNmLFFBQVE7Z0JBQ1IsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFO2FBQ2pDLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDYixNQUFNLElBQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2hDLENBQUM7WUFFRCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFvQixDQUFDO1FBQzVELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDaEMsTUFBTSxLQUFLLENBQUM7UUFDaEIsQ0FBQztJQUNMLENBQUM7Q0FDSjtBQTlGRCxrQ0E4RkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTY2VuZSwgU2NlbmVBc3NldCwgQ29tcG9uZW50LCBOb2RlIH0gZnJvbSAnY2MnO1xyXG5pbXBvcnQgeyB0eXBlIElCYXNlSWRlbnRpZmllciwgSUNyZWF0ZU9wdGlvbnMsIElFZGl0b3JUYXJnZXQsIElOb2RlLCBJU2NlbmUgfSBmcm9tICcuLi8uLi8uLi9jb21tb24nO1xyXG5pbXBvcnQgeyBScGMgfSBmcm9tICcuLi8uLi9ycGMnO1xyXG5pbXBvcnQgeyBzY2VuZVV0aWxzIH0gZnJvbSAnLi4vc2NlbmUvdXRpbHMnO1xyXG5pbXBvcnQgeyBCYXNlRWRpdG9yIH0gZnJvbSAnLi9iYXNlLWVkaXRvcic7XHJcblxyXG5pbXBvcnQgdHlwZSB7IElBc3NldEluZm8gfSBmcm9tICcuLi8uLi8uLi8uLi9hc3NldHMvQHR5cGVzL3B1YmxpYyc7XHJcbmltcG9ydCB7IGVkaXRvclByZWZhYlV0aWxzIH0gZnJvbSAnLi4vcHJlZmFiL3ByZWZhYi1lZGl0b3ItdXRpbHMnO1xyXG5cclxuLyoqXHJcbiAqIFNjZW5lRWRpdG9yIC0g5Zy65pmv57yW6L6R5ZmoXHJcbiAqIOe7p+aJvyBCYXNlRWRpdG9y77yM5a6e546w5Zy65pmv55u45YWz55qE5YW35L2T5pON5L2cXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU2NlbmVFZGl0b3IgZXh0ZW5kcyBCYXNlRWRpdG9yIHtcclxuXHJcbiAgICBhc3luYyBlbmNvZGUoZW50aXR5PzogSUVkaXRvclRhcmdldCB8IG51bGwpOiBQcm9taXNlPElTY2VuZT4ge1xyXG4gICAgICAgIGVudGl0eSA9IGVudGl0eSA/PyB0aGlzLmVudGl0eTtcclxuICAgICAgICBpZiAoIWVudGl0eSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2VuY29kZSDlpLHotKXvvIzmsqHmnInmiZPlvIDlnLrmma8nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLi4uZW50aXR5LmlkZW50aWZpZXIsXHJcbiAgICAgICAgICAgIG5hbWU6IGVudGl0eS5pbnN0YW5jZS5uYW1lLFxyXG4gICAgICAgICAgICBwcmVmYWI6IHNjZW5lVXRpbHMuZ2VuZXJhdGVQcmVmYWJJbmZvKGVudGl0eS5pbnN0YW5jZVsnX3ByZWZhYiddKSxcclxuICAgICAgICAgICAgY2hpbGRyZW46IGVudGl0eS5pbnN0YW5jZS5jaGlsZHJlblxyXG4gICAgICAgICAgICAgICAgLm1hcCgobm9kZTogTm9kZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzY2VuZVV0aWxzLmdlbmVyYXRlTm9kZUluZm8obm9kZSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmZpbHRlcihjaGlsZCA9PiBjaGlsZCAhPT0gbnVsbCkgYXMgSU5vZGVbXSxcclxuICAgICAgICAgICAgY29tcG9uZW50czogZW50aXR5Lmluc3RhbmNlLmNvbXBvbmVudHNcclxuICAgICAgICAgICAgICAgIC5tYXAoKGNvbXBvbmVudDogQ29tcG9uZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjZW5lVXRpbHMuZ2VuZXJhdGVDb21wb25lbnRJbmZvKGNvbXBvbmVudCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgb3Blbihhc3NldDogSUFzc2V0SW5mbyk6IFByb21pc2U8SVNjZW5lPiB7XHJcbiAgICAgICAgY29uc3QgaWRlbnRpZmllciA9IHRoaXMuZ2V0SWRlbnRpZmllcihhc3NldCk7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmVudGl0eT8uaWRlbnRpZmllci5hc3NldFV1aWQgPT09IGlkZW50aWZpZXIuYXNzZXRVdWlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmVuY29kZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3Qgc2NlbmVBc3NldCA9IGF3YWl0IHNjZW5lVXRpbHMubG9hZEFueTxTY2VuZUFzc2V0PihpZGVudGlmaWVyLmFzc2V0VXVpZCk7XHJcbiAgICAgICAgY29uc3QgaW5zdGFuY2UgPSBhd2FpdCBzY2VuZVV0aWxzLnJ1blNjZW5lKHNjZW5lQXNzZXQpO1xyXG5cclxuICAgICAgICB0aGlzLnNldEN1cnJlbnRPcGVuKHtcclxuICAgICAgICAgICAgaW5zdGFuY2UsXHJcbiAgICAgICAgICAgIGlkZW50aWZpZXIsXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLmVuY29kZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGNsb3NlKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgICAgIGlmICghdGhpcy5lbnRpdHkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbY2xvc2VdIOayoeacieaJk+W8gOWcuuaZrycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhd2FpdCB0aGlzLnNhdmUoKTtcclxuICAgICAgICBhd2FpdCBzY2VuZVV0aWxzLnJ1blNjZW5lKG5ldyBTY2VuZSgnJykpO1xyXG4gICAgICAgIHRoaXMuc2V0Q3VycmVudE9wZW4obnVsbCk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgc2F2ZSgpOiBQcm9taXNlPElBc3NldEluZm8+IHtcclxuICAgICAgICBpZiAoIXRoaXMuZW50aXR5KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW3NhdmVdIOayoeacieaJk+W8gOWcuuaZrycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzZXJpYWxpemVkRGF0YSA9IHNjZW5lVXRpbHMuc2VyaWFsaXplKHRoaXMuZW50aXR5Lmluc3RhbmNlIGFzIFNjZW5lKTtcclxuICAgICAgICByZXR1cm4gYXdhaXQgUnBjLmdldEluc3RhbmNlKCkucmVxdWVzdCgnYXNzZXRNYW5hZ2VyJywgJ3NhdmVBc3NldCcsIFt0aGlzLmVudGl0eS5pZGVudGlmaWVyLmFzc2V0VXVpZCwgc2VyaWFsaXplZERhdGFdKTtcclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgYXN5bmMgX2RvUmVsb2FkKCk6IFByb21pc2U8SVNjZW5lPiB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVudGl0eSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tyZWxvYWRdIOayoeacieaJk+W8gOWcuuaZrycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBzY2VuZSA9IHRoaXMuZW50aXR5Lmluc3RhbmNlIGFzIFNjZW5lO1xyXG4gICAgICAgIGNvbnN0IHByZWZhYlVVSURNYXAgPSBlZGl0b3JQcmVmYWJVdGlscy5zdG9yZVByZWZhYlVVSUQoc2NlbmUpO1xyXG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZUpTT04gPSBzY2VuZVV0aWxzLnNlcmlhbGl6ZShzY2VuZSk7XHJcbiAgICAgICAgY29uc3Qgc2NlbmVBZnRlckxvYWQgPSBhd2FpdCBzY2VuZVV0aWxzLnJ1blNjZW5lSW1tZWRpYXRlQnlKc29uKHNlcmlhbGl6ZUpTT04pO1xyXG4gICAgICAgIGVkaXRvclByZWZhYlV0aWxzLnJlc3RvcmVQcmVmYWJVVUlEKHNjZW5lQWZ0ZXJMb2FkLCBwcmVmYWJVVUlETWFwKTtcclxuICAgICAgICB0aGlzLmVudGl0eS5pbnN0YW5jZSA9IHNjZW5lQWZ0ZXJMb2FkO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVuY29kZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGNyZWF0ZShwYXJhbXM6IElDcmVhdGVPcHRpb25zKTogUHJvbWlzZTxJQmFzZUlkZW50aWZpZXI+IHtcclxuICAgICAgICBjb25zdCB7IGJhc2VOYW1lLCB0YXJnZXREaXJlY3RvcnksIHRlbXBsYXRlVHlwZSA9ICcyZCcgfSA9IHBhcmFtcztcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8g5Yib5bu65Zy65pmv6LWE5rqQXHJcbiAgICAgICAgICAgIGNvbnN0IGFzc2V0SW5mbyA9IGF3YWl0IFJwYy5nZXRJbnN0YW5jZSgpLnJlcXVlc3QoJ2Fzc2V0TWFuYWdlcicsICdjcmVhdGVBc3NldEJ5VHlwZScsIFtcclxuICAgICAgICAgICAgICAgICdzY2VuZScsXHJcbiAgICAgICAgICAgICAgICB0YXJnZXREaXJlY3RvcnksXHJcbiAgICAgICAgICAgICAgICBiYXNlTmFtZSxcclxuICAgICAgICAgICAgICAgIHsgdGVtcGxhdGVOYW1lOiB0ZW1wbGF0ZVR5cGUgfVxyXG4gICAgICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghYXNzZXRJbmZvKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+WIm+W7uuWcuuaZr+i1hOa6kOWksei0pScpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJZGVudGlmaWVyKGFzc2V0SW5mbykgYXMgSUJhc2VJZGVudGlmaWVyO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIm+W7uuWcuuaZr+Wksei0pTonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==