"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.nodeDump = void 0;
const NodeMgr = EditorExtends.Node;
// valueType直接使用引擎序列化
class NodeDump {
    encode(object, data, opts) {
        data.value = {
            uuid: object ? object.uuid || '' : '',
        };
        // // 当 default 为 Node 的时候，无法生成虚假的 Node，所以 default 重置为 null
        // if (data.default) {
        //     data.default = null;
        // }
    }
    decode(data, info, dump, opts) {
        if (!dump.value || !dump.value.uuid) {
            data[info.key] = null;
        }
        else {
            const node = NodeMgr.getNode(dump.value.uuid);
            if (info.key === 'parent') {
                const keepWorldTransform = 'keepWorldTransform' in dump ? dump.keepWorldTransform : true;
                data.setParent(node, keepWorldTransform);
            }
            else {
                data[info.key] = node;
            }
        }
    }
}
exports.nodeDump = new NodeDump();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS1kdW1wLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvcmUvc2NlbmUvc2NlbmUtcHJvY2Vzcy9zZXJ2aWNlL2R1bXAvdHlwZXMvbm9kZS1kdW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUtBLE1BQU0sT0FBTyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUM7QUFDbkMscUJBQXFCO0FBQ3JCLE1BQU0sUUFBUTtJQUNILE1BQU0sQ0FBQyxNQUFXLEVBQUUsSUFBZSxFQUFFLElBQVU7UUFDbEQsSUFBSSxDQUFDLEtBQUssR0FBRztZQUNULElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFO1NBQ3hDLENBQUM7UUFFRiwyREFBMkQ7UUFDM0Qsc0JBQXNCO1FBQ3RCLDJCQUEyQjtRQUMzQixJQUFJO0lBQ1IsQ0FBQztJQUVNLE1BQU0sQ0FBQyxJQUFTLEVBQUUsSUFBUyxFQUFFLElBQVMsRUFBRSxJQUFVO1FBQ3JELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUMxQixDQUFDO2FBQU0sQ0FBQztZQUNKLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QyxJQUFJLElBQUksQ0FBQyxHQUFHLEtBQUssUUFBUSxFQUFFLENBQUM7Z0JBQ3hCLE1BQU0sa0JBQWtCLEdBQUcsb0JBQW9CLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDekYsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztZQUM3QyxDQUFDO2lCQUFNLENBQUM7Z0JBQ0osSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDMUIsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDO0NBQ0o7QUFFWSxRQUFBLFFBQVEsR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIElQcm9wZXJ0eSxcclxufSBmcm9tICcuLi8uLi8uLi8uLi9AdHlwZXMvcHVibGljJztcclxuXHJcbmltcG9ydCB7IER1bXBJbnRlcmZhY2UgfSBmcm9tICcuL2R1bXAtaW50ZXJmYWNlJztcclxuY29uc3QgTm9kZU1nciA9IEVkaXRvckV4dGVuZHMuTm9kZTtcclxuLy8gdmFsdWVUeXBl55u05o6l5L2/55So5byV5pOO5bqP5YiX5YyWXHJcbmNsYXNzIE5vZGVEdW1wIGltcGxlbWVudHMgRHVtcEludGVyZmFjZSB7XHJcbiAgICBwdWJsaWMgZW5jb2RlKG9iamVjdDogYW55LCBkYXRhOiBJUHJvcGVydHksIG9wdHM/OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBkYXRhLnZhbHVlID0ge1xyXG4gICAgICAgICAgICB1dWlkOiBvYmplY3QgPyBvYmplY3QudXVpZCB8fCAnJyA6ICcnLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIC8vIOW9kyBkZWZhdWx0IOS4uiBOb2RlIOeahOaXtuWAme+8jOaXoOazleeUn+aIkOiZmuWBh+eahCBOb2Rl77yM5omA5LulIGRlZmF1bHQg6YeN572u5Li6IG51bGxcclxuICAgICAgICAvLyBpZiAoZGF0YS5kZWZhdWx0KSB7XHJcbiAgICAgICAgLy8gICAgIGRhdGEuZGVmYXVsdCA9IG51bGw7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkZWNvZGUoZGF0YTogYW55LCBpbmZvOiBhbnksIGR1bXA6IGFueSwgb3B0cz86IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGlmICghZHVtcC52YWx1ZSB8fCAhZHVtcC52YWx1ZS51dWlkKSB7XHJcbiAgICAgICAgICAgIGRhdGFbaW5mby5rZXldID0gbnVsbDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBub2RlID0gTm9kZU1nci5nZXROb2RlKGR1bXAudmFsdWUudXVpZCk7XHJcbiAgICAgICAgICAgIGlmIChpbmZvLmtleSA9PT0gJ3BhcmVudCcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGtlZXBXb3JsZFRyYW5zZm9ybSA9ICdrZWVwV29ybGRUcmFuc2Zvcm0nIGluIGR1bXAgPyBkdW1wLmtlZXBXb3JsZFRyYW5zZm9ybSA6IHRydWU7XHJcbiAgICAgICAgICAgICAgICBkYXRhLnNldFBhcmVudChub2RlLCBrZWVwV29ybGRUcmFuc2Zvcm0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGF0YVtpbmZvLmtleV0gPSBub2RlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgbm9kZUR1bXAgPSBuZXcgTm9kZUR1bXAoKTtcclxuIl19