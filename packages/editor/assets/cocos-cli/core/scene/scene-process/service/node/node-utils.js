"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getUICanvasNode = getUICanvasNode;
exports.getUITransformParentNode = getUITransformParentNode;
exports.hasOneKindOfComponent = hasOneKindOfComponent;
exports.setLayer = setLayer;
exports.isEditorNode = isEditorNode;
exports.isPartOfNode = isPartOfNode;
const cc_1 = require("cc");
/**
 * 获取有效的 ui Canvas 的节点，向上和向下找
 * @param node 节点
 * @param prefabLimitRoot
 */
function getUICanvasNode(node, prefabLimitRoot = true) {
    if (!node) {
        return null;
    }
    if (hasOneKindOfComponent(node, cc_1.Canvas)) {
        return node;
    }
    const stopAtRootNode = cc_1.director.getScene();
    if (node !== stopAtRootNode) {
        // 先检查该节点所在的祖父节点是否满足
        let parentNode = node.parent;
        while (parentNode) {
            if (hasOneKindOfComponent(parentNode, cc_1.Canvas)) {
                // 祖父级有满足的，返回自身
                return node;
            }
            if (parentNode === stopAtRootNode) {
                break;
            }
            parentNode = parentNode.parent;
        }
    }
    // 检查子节点是否有满足
    const list = node.children.slice();
    // 返回最后一个有 cc.Canvas 组件的节点
    for (let i = list.length - 1; i >= 0; i--) {
        const child = list[i];
        if (hasOneKindOfComponent(child, cc_1.Canvas)) {
            return child;
        }
    }
    return null;
}
/**
 * 获取有效的有 UITransform 组件的父节点，只向上找
 * @param node 节点
 */
function getUITransformParentNode(node) {
    if (!node) {
        return null;
    }
    if (hasOneKindOfComponent(node, cc_1.UITransformComponent)) {
        return node;
    }
    const stopAtRootNode = cc_1.director.getScene();
    if (node === stopAtRootNode) {
        return null;
    }
    // 先检查该节点所在的祖父节点是否满足
    let parentNode = node.parent;
    while (parentNode) {
        if (hasOneKindOfComponent(parentNode, cc_1.UITransformComponent)) {
            // 祖父级有满足的，返回自身
            return parentNode;
        }
        if (parentNode === stopAtRootNode) {
            break;
        }
        parentNode = parentNode.parent;
    }
    return null;
}
function hasOneKindOfComponent(node, kind) {
    if (node && node.components) {
        for (let j = 0; j < node.components.length; j++) {
            if (node.components[j] instanceof kind) {
                return true;
            }
        }
    }
    return false;
}
/**
 * 设置节点层级
 * @param node - 当前节点
 * @param layer - 层级
 * @param deep - 是否递归同步子节点
 */
function setLayer(node, layer, deep) {
    node.layer = layer;
    for (const child of node.children) {
        setLayer(child, layer, deep);
    }
}
/**
 * 是否是编辑节点
 * @param node
 */
function isEditorNode(node) {
    if (node.layer & cc_1.Layers.Enum.GIZMOS) {
        return true;
    }
    let iterNode = node;
    while (iterNode) {
        if (iterNode.objFlags & cc_1.CCObject.Flags.HideInHierarchy) {
            return true;
        }
        iterNode = iterNode.parent;
    }
    return false;
}
/**
 * 检测一个节点是否是某个节点的一部分
 * @param testNode 测试节点
 * @param rootNode 根节点
 */
function isPartOfNode(testNode, rootNode) {
    let checkNode = testNode;
    while (checkNode) {
        if (checkNode === rootNode) {
            return true;
        }
        checkNode = checkNode.parent;
    }
    return false;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS11dGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb3JlL3NjZW5lL3NjZW5lLXByb2Nlc3Mvc2VydmljZS9ub2RlL25vZGUtdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFRQSwwQ0FzQ0M7QUFNRCw0REE4QkM7QUFFRCxzREFVQztBQVNELDRCQUtDO0FBTUQsb0NBZUM7QUFPRCxvQ0FZQztBQXBKRCwyQkFBMkY7QUFHM0Y7Ozs7R0FJRztBQUNILFNBQWdCLGVBQWUsQ0FBQyxJQUFpQixFQUFFLGVBQWUsR0FBRyxJQUFJO0lBQ3JFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNSLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxJQUFJLHFCQUFxQixDQUFDLElBQUksRUFBRSxXQUFNLENBQUMsRUFBRSxDQUFDO1FBQ3RDLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFFRCxNQUFNLGNBQWMsR0FBd0IsYUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2hFLElBQUksSUFBSSxLQUFLLGNBQWMsRUFBRSxDQUFDO1FBQzFCLG9CQUFvQjtRQUNwQixJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzdCLE9BQU8sVUFBVSxFQUFFLENBQUM7WUFDaEIsSUFBSSxxQkFBcUIsQ0FBQyxVQUFVLEVBQUUsV0FBTSxDQUFDLEVBQUUsQ0FBQztnQkFDNUMsZUFBZTtnQkFDZixPQUFPLElBQUksQ0FBQztZQUNoQixDQUFDO1lBRUQsSUFBSSxVQUFVLEtBQUssY0FBYyxFQUFFLENBQUM7Z0JBQ2hDLE1BQU07WUFDVixDQUFDO1lBRUQsVUFBVSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUM7UUFDbkMsQ0FBQztJQUNMLENBQUM7SUFFRCxhQUFhO0lBQ2IsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNuQywwQkFB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Ozs7R0FJRztBQUNILFNBQWdCLFlBQVksQ0FBQyxRQUFjLEVBQUUsUUFBYztJQUN2RCxJQUFJLFNBQVMsR0FBZ0IsUUFBUSxDQUFDO0lBRXRDLE9BQU8sU0FBUyxFQUFFLENBQUM7UUFDZixJQUFJLFNBQVMsS0FBSyxRQUFRLEVBQUUsQ0FBQztZQUN6QixPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO1FBRUQsU0FBUyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7SUFDakMsQ0FBQztJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2pCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOb2RlLCBDYW52YXMsIFVJVHJhbnNmb3JtQ29tcG9uZW50LCBTY2VuZSwgZGlyZWN0b3IsIExheWVycywgQ0NPYmplY3QgfSBmcm9tICdjYyc7XHJcblxyXG5cclxuLyoqXHJcbiAqIOiOt+WPluacieaViOeahCB1aSBDYW52YXMg55qE6IqC54K577yM5ZCR5LiK5ZKM5ZCR5LiL5om+XHJcbiAqIEBwYXJhbSBub2RlIOiKgueCuVxyXG4gKiBAcGFyYW0gcHJlZmFiTGltaXRSb290XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VUlDYW52YXNOb2RlKG5vZGU6IE5vZGUgfCBudWxsLCBwcmVmYWJMaW1pdFJvb3QgPSB0cnVlKTogTm9kZSB8IG51bGwge1xyXG4gICAgaWYgKCFub2RlKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGhhc09uZUtpbmRPZkNvbXBvbmVudChub2RlLCBDYW52YXMpKSB7XHJcbiAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RvcEF0Um9vdE5vZGU6IE5vZGUgfCBTY2VuZSB8IG51bGwgPSBkaXJlY3Rvci5nZXRTY2VuZSgpO1xyXG4gICAgaWYgKG5vZGUgIT09IHN0b3BBdFJvb3ROb2RlKSB7XHJcbiAgICAgICAgLy8g5YWI5qOA5p+l6K+l6IqC54K55omA5Zyo55qE56WW54i26IqC54K55piv5ZCm5ruh6LazXHJcbiAgICAgICAgbGV0IHBhcmVudE5vZGUgPSBub2RlLnBhcmVudDtcclxuICAgICAgICB3aGlsZSAocGFyZW50Tm9kZSkge1xyXG4gICAgICAgICAgICBpZiAoaGFzT25lS2luZE9mQ29tcG9uZW50KHBhcmVudE5vZGUsIENhbnZhcykpIHtcclxuICAgICAgICAgICAgICAgIC8vIOellueItue6p+aciea7oei2s+eahO+8jOi/lOWbnuiHqui6q1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwYXJlbnROb2RlID09PSBzdG9wQXRSb290Tm9kZSkge1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHBhcmVudE5vZGUgPSBwYXJlbnROb2RlLnBhcmVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8g5qOA5p+l5a2Q6IqC54K55piv5ZCm5pyJ5ruh6LazXHJcbiAgICBjb25zdCBsaXN0ID0gbm9kZS5jaGlsZHJlbi5zbGljZSgpO1xyXG4gICAgLy8g6L+U5Zue5pyA5ZCO5LiA5Liq5pyJIGNjLkNhbnZhcyDnu4Tku7bnmoToioLngrlcclxuICAgIGZvciAobGV0IGkgPSBsaXN0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgY29uc3QgY2hpbGQgPSBsaXN0W2ldIGFzIE5vZGU7XHJcbiAgICAgICAgaWYgKGhhc09uZUtpbmRPZkNvbXBvbmVudChjaGlsZCwgQ2FudmFzKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59XHJcblxyXG4vKipcclxuICog6I635Y+W5pyJ5pWI55qE5pyJIFVJVHJhbnNmb3JtIOe7hOS7tueahOeItuiKgueCue+8jOWPquWQkeS4iuaJvlxyXG4gKiBAcGFyYW0gbm9kZSDoioLngrlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVSVRyYW5zZm9ybVBhcmVudE5vZGUobm9kZTogTm9kZSB8IG51bGwpOiBOb2RlIHwgbnVsbCB7XHJcbiAgICBpZiAoIW5vZGUpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaGFzT25lS2luZE9mQ29tcG9uZW50KG5vZGUsIFVJVHJhbnNmb3JtQ29tcG9uZW50KSkge1xyXG4gICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0b3BBdFJvb3ROb2RlOiBOb2RlIHwgU2NlbmUgfCBudWxsID0gZGlyZWN0b3IuZ2V0U2NlbmUoKTtcclxuICAgIGlmIChub2RlID09PSBzdG9wQXRSb290Tm9kZSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWFiOajgOafpeivpeiKgueCueaJgOWcqOeahOellueItuiKgueCueaYr+WQpua7oei2s1xyXG4gICAgbGV0IHBhcmVudE5vZGUgPSBub2RlLnBhcmVudDtcclxuICAgIHdoaWxlIChwYXJlbnROb2RlKSB7XHJcbiAgICAgICAgaWYgKGhhc09uZUtpbmRPZkNvbXBvbmVudChwYXJlbnROb2RlLCBVSVRyYW5zZm9ybUNvbXBvbmVudCkpIHtcclxuICAgICAgICAgICAgLy8g56WW54i257qn5pyJ5ruh6Laz55qE77yM6L+U5Zue6Ieq6LqrXHJcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnROb2RlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHBhcmVudE5vZGUgPT09IHN0b3BBdFJvb3ROb2RlKSB7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGUucGFyZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGFzT25lS2luZE9mQ29tcG9uZW50KG5vZGU6IE5vZGUgfCBTY2VuZSwga2luZDogYW55KSB7XHJcbiAgICBpZiAobm9kZSAmJiBub2RlLmNvbXBvbmVudHMpIHtcclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG5vZGUuY29tcG9uZW50cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICBpZiAobm9kZS5jb21wb25lbnRzW2pdIGluc3RhbmNlb2Yga2luZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIOiuvue9ruiKgueCueWxgue6p1xyXG4gKiBAcGFyYW0gbm9kZSAtIOW9k+WJjeiKgueCuVxyXG4gKiBAcGFyYW0gbGF5ZXIgLSDlsYLnuqdcclxuICogQHBhcmFtIGRlZXAgLSDmmK/lkKbpgJLlvZLlkIzmraXlrZDoioLngrlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBzZXRMYXllcihub2RlOiBOb2RlLCBsYXllcjogbnVtYmVyLCBkZWVwOiBib29sZWFuKSB7XHJcbiAgICBub2RlLmxheWVyID0gbGF5ZXI7XHJcbiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGUuY2hpbGRyZW4pIHtcclxuICAgICAgICBzZXRMYXllcihjaGlsZCwgbGF5ZXIsIGRlZXApO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICog5piv5ZCm5piv57yW6L6R6IqC54K5XHJcbiAqIEBwYXJhbSBub2RlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNFZGl0b3JOb2RlKG5vZGU6IE5vZGUpIHtcclxuICAgIGlmIChub2RlLmxheWVyICYgTGF5ZXJzLkVudW0uR0laTU9TKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGl0ZXJOb2RlOiBOb2RlIHwgbnVsbCA9IG5vZGU7XHJcbiAgICB3aGlsZSAoaXRlck5vZGUpIHtcclxuICAgICAgICBpZiAoaXRlck5vZGUub2JqRmxhZ3MgJiBDQ09iamVjdC5GbGFncy5IaWRlSW5IaWVyYXJjaHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpdGVyTm9kZSA9IGl0ZXJOb2RlLnBhcmVudDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDmo4DmtYvkuIDkuKroioLngrnmmK/lkKbmmK/mn5DkuKroioLngrnnmoTkuIDpg6jliIZcclxuICogQHBhcmFtIHRlc3ROb2RlIOa1i+ivleiKgueCuVxyXG4gKiBAcGFyYW0gcm9vdE5vZGUg5qC56IqC54K5XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaXNQYXJ0T2ZOb2RlKHRlc3ROb2RlOiBOb2RlLCByb290Tm9kZTogTm9kZSkge1xyXG4gICAgbGV0IGNoZWNrTm9kZTogTm9kZSB8IG51bGwgPSB0ZXN0Tm9kZTtcclxuXHJcbiAgICB3aGlsZSAoY2hlY2tOb2RlKSB7XHJcbiAgICAgICAgaWYgKGNoZWNrTm9kZSA9PT0gcm9vdE5vZGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjaGVja05vZGUgPSBjaGVja05vZGUucGFyZW50O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxufSJdfQ==