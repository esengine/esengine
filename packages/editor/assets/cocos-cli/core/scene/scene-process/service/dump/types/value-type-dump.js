"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.valueTypeDump = void 0;
// valueType直接使用引擎序列化
class ValueTypeDump {
    encode(object, data, opts) {
        try {
            const dump = EditorExtends.serialize(object, { stringify: false, forceInline: true });
            delete dump.__type__;
            data.value = dump;
        }
        catch (error) {
            console.warn('Value dump failed.');
            console.warn(error);
            const ctor = opts.ctor;
            const dump = EditorExtends.serialize(new ctor(), { stringify: false, forceInline: true });
            delete dump.__type__;
            data.value = dump;
        }
    }
    decode(data, info, dump, opts) {
        const ccType = opts.ccType;
        const value = new ccType();
        ccType.__props__.forEach((key) => {
            if (dump.value[key] === undefined) {
                value[key] = data[info.key][key];
                return;
            }
            value[key] = dump.value[key];
        });
        data[info.key] = value;
    }
}
exports.valueTypeDump = new ValueTypeDump();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsdWUtdHlwZS1kdW1wLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvcmUvc2NlbmUvc2NlbmUtcHJvY2Vzcy9zZXJ2aWNlL2R1bXAvdHlwZXMvdmFsdWUtdHlwZS1kdW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQU1BLHFCQUFxQjtBQUNyQixNQUFNLGFBQWE7SUFDUixNQUFNLENBQUMsTUFBVyxFQUFFLElBQWUsRUFBRSxJQUFVO1FBQ2xELElBQUksQ0FBQztZQUNELE1BQU0sSUFBSSxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQVEsQ0FBQztZQUM3RixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDdEIsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDYixPQUFPLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDbkMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVwQixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ3ZCLE1BQU0sSUFBSSxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxDQUFRLENBQUM7WUFDakcsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLENBQUM7SUFDTCxDQUFDO0lBRU0sTUFBTSxDQUFDLElBQVMsRUFBRSxJQUFTLEVBQUUsSUFBUyxFQUFFLElBQVU7UUFDckQsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMzQixNQUFNLEtBQUssR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO1FBQzNCLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUU7WUFDckMsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLFNBQVMsRUFBRSxDQUFDO2dCQUNoQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDakMsT0FBTztZQUNYLENBQUM7WUFDRCxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQzNCLENBQUM7Q0FDSjtBQUVZLFFBQUEsYUFBYSxHQUFHLElBQUksYUFBYSxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgSVByb3BlcnR5LFxyXG59IGZyb20gJy4uLy4uLy4uLy4uL0B0eXBlcy9wdWJsaWMnO1xyXG5cclxuaW1wb3J0IHsgRHVtcEludGVyZmFjZSB9IGZyb20gJy4vZHVtcC1pbnRlcmZhY2UnO1xyXG5cclxuLy8gdmFsdWVUeXBl55u05o6l5L2/55So5byV5pOO5bqP5YiX5YyWXHJcbmNsYXNzIFZhbHVlVHlwZUR1bXAgaW1wbGVtZW50cyBEdW1wSW50ZXJmYWNlIHtcclxuICAgIHB1YmxpYyBlbmNvZGUob2JqZWN0OiBhbnksIGRhdGE6IElQcm9wZXJ0eSwgb3B0cz86IGFueSk6IHZvaWQge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGR1bXAgPSBFZGl0b3JFeHRlbmRzLnNlcmlhbGl6ZShvYmplY3QsIHsgc3RyaW5naWZ5OiBmYWxzZSwgZm9yY2VJbmxpbmU6IHRydWUgfSkgYXMgYW55O1xyXG4gICAgICAgICAgICBkZWxldGUgZHVtcC5fX3R5cGVfXztcclxuICAgICAgICAgICAgZGF0YS52YWx1ZSA9IGR1bXA7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdWYWx1ZSBkdW1wIGZhaWxlZC4nKTtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGN0b3IgPSBvcHRzLmN0b3I7XHJcbiAgICAgICAgICAgIGNvbnN0IGR1bXAgPSBFZGl0b3JFeHRlbmRzLnNlcmlhbGl6ZShuZXcgY3RvcigpLCB7IHN0cmluZ2lmeTogZmFsc2UsIGZvcmNlSW5saW5lOiB0cnVlIH0pIGFzIGFueTtcclxuICAgICAgICAgICAgZGVsZXRlIGR1bXAuX190eXBlX187XHJcbiAgICAgICAgICAgIGRhdGEudmFsdWUgPSBkdW1wO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGVjb2RlKGRhdGE6IGFueSwgaW5mbzogYW55LCBkdW1wOiBhbnksIG9wdHM/OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBjY1R5cGUgPSBvcHRzLmNjVHlwZTtcclxuICAgICAgICBjb25zdCB2YWx1ZSA9IG5ldyBjY1R5cGUoKTtcclxuICAgICAgICBjY1R5cGUuX19wcm9wc19fLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkdW1wLnZhbHVlW2tleV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgdmFsdWVba2V5XSA9IGRhdGFbaW5mby5rZXldW2tleV07XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFsdWVba2V5XSA9IGR1bXAudmFsdWVba2V5XTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBkYXRhW2luZm8ua2V5XSA9IHZhbHVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgdmFsdWVUeXBlRHVtcCA9IG5ldyBWYWx1ZVR5cGVEdW1wKCk7XHJcbiJdfQ==