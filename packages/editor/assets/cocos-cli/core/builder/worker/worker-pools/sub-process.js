'use strict';
process.on('uncaughtException', (err) => {
    console.error(err);
});
process.on('message', async function (msgInfo) {
    if (msgInfo.type === 'execute-script' && process.send) {
        const res = await executeScript(msgInfo.path, msgInfo.method, msgInfo.args);
        process.send({
            data: (res instanceof Error) ? null : res,
            code: (res instanceof Error) ? -1 : 0,
            type: 'execute-script-end',
        });
    }
});
// 子进程警告输出 HACK 1/2
const RawWarning = console.warn;
console.warn = function warning(...args) {
    try {
        if (typeof args[0] === 'string') {
            args[0] = '[warning]' + args[0];
        }
        else if (args[0] && args[0].name) {
            args[0].name = '[warning]' + args[0].name;
        }
    }
    catch (error) {
        console.debug(error);
    }
    RawWarning(...args);
};
console.log(`enter sub process ${process.pid}, ${process.debugPort}, see: chrome://inspect/#devices`);
async function executeScript(path, method = 'handler', args = []) {
    try {
        const module = require(path);
        return await module[method](...args);
    }
    catch (error) {
        console.error(error);
        return error;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ViLXByb2Nlc3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY29yZS9idWlsZGVyL3dvcmtlci93b3JrZXItcG9vbHMvc3ViLXByb2Nlc3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBU2IsT0FBTyxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFO0lBQ3BDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxLQUFLLFdBQVcsT0FBcUI7SUFDdkQsSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLGdCQUFnQixJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNwRCxNQUFNLEdBQUcsR0FBRyxNQUFNLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVFLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDVCxJQUFJLEVBQUUsQ0FBQyxHQUFHLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRztZQUN6QyxJQUFJLEVBQUUsQ0FBQyxHQUFHLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLElBQUksRUFBRSxvQkFBb0I7U0FDN0IsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsbUJBQW1CO0FBQ25CLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7QUFDaEMsT0FBTyxDQUFDLElBQUksR0FBRyxTQUFTLE9BQU8sQ0FBQyxHQUFHLElBQVc7SUFDMUMsSUFBSSxDQUFDO1FBQ0QsSUFBSSxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxRQUFRLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxDQUFDO2FBQU0sSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQ2pDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsV0FBVyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDOUMsQ0FBQztJQUNMLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2IsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBQ0QsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDeEIsQ0FBQyxDQUFDO0FBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsT0FBTyxDQUFDLEdBQUcsS0FBSyxPQUFPLENBQUMsU0FBUyxrQ0FBa0MsQ0FBQyxDQUFDO0FBRXRHLEtBQUssVUFBVSxhQUFhLENBQUMsSUFBWSxFQUFFLE1BQU0sR0FBRyxTQUFTLEVBQUUsT0FBYyxFQUFFO0lBQzNFLElBQUksQ0FBQztRQUNELE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QixPQUFPLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JCLE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW50ZXJmYWNlIElNZXNzYWdlSW5mbyB7XHJcbiAgICB0eXBlOiBzdHJpbmc7XHJcbiAgICBwYXRoOiBzdHJpbmc7XHJcbiAgICBtZXRob2Q/OiBzdHJpbmc7XHJcbiAgICBhcmdzPzogYW55W107XHJcbn1cclxuXHJcbnByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycikgPT4ge1xyXG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG59KTtcclxuXHJcbnByb2Nlc3Mub24oJ21lc3NhZ2UnLCBhc3luYyBmdW5jdGlvbiAobXNnSW5mbzogSU1lc3NhZ2VJbmZvKSB7XHJcbiAgICBpZiAobXNnSW5mby50eXBlID09PSAnZXhlY3V0ZS1zY3JpcHQnICYmIHByb2Nlc3Muc2VuZCkge1xyXG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGV4ZWN1dGVTY3JpcHQobXNnSW5mby5wYXRoLCBtc2dJbmZvLm1ldGhvZCwgbXNnSW5mby5hcmdzKTtcclxuICAgICAgICBwcm9jZXNzLnNlbmQoe1xyXG4gICAgICAgICAgICBkYXRhOiAocmVzIGluc3RhbmNlb2YgRXJyb3IpID8gbnVsbCA6IHJlcyxcclxuICAgICAgICAgICAgY29kZTogKHJlcyBpbnN0YW5jZW9mIEVycm9yKSA/IC0xIDogMCxcclxuICAgICAgICAgICAgdHlwZTogJ2V4ZWN1dGUtc2NyaXB0LWVuZCcsXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLy8g5a2Q6L+b56iL6K2m5ZGK6L6T5Ye6IEhBQ0sgMS8yXHJcbmNvbnN0IFJhd1dhcm5pbmcgPSBjb25zb2xlLndhcm47XHJcbmNvbnNvbGUud2FybiA9IGZ1bmN0aW9uIHdhcm5pbmcoLi4uYXJnczogYW55W10pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBhcmdzWzBdID0gJ1t3YXJuaW5nXScgKyBhcmdzWzBdO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoYXJnc1swXSAmJiBhcmdzWzBdLm5hbWUpIHtcclxuICAgICAgICAgICAgYXJnc1swXS5uYW1lID0gJ1t3YXJuaW5nXScgKyBhcmdzWzBdLm5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmRlYnVnKGVycm9yKTtcclxuICAgIH1cclxuICAgIFJhd1dhcm5pbmcoLi4uYXJncyk7XHJcbn07XHJcblxyXG5jb25zb2xlLmxvZyhgZW50ZXIgc3ViIHByb2Nlc3MgJHtwcm9jZXNzLnBpZH0sICR7cHJvY2Vzcy5kZWJ1Z1BvcnR9LCBzZWU6IGNocm9tZTovL2luc3BlY3QvI2RldmljZXNgKTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVTY3JpcHQocGF0aDogc3RyaW5nLCBtZXRob2QgPSAnaGFuZGxlcicsIGFyZ3M6IGFueVtdID0gW10pOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBtb2R1bGUgPSByZXF1aXJlKHBhdGgpO1xyXG4gICAgICAgIHJldHVybiBhd2FpdCBtb2R1bGVbbWV0aG9kXSguLi5hcmdzKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuIGVycm9yO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==