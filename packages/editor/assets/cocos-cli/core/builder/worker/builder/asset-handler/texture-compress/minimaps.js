'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.isPowerOfTwo = isPowerOfTwo;
exports.getMipLevel = getMipLevel;
exports.genMipmapFiles = genMipmapFiles;
exports.checkHasMipMaps = checkHasMipMaps;
exports.compressMipmapFiles = compressMipmapFiles;
/**
 * 工具函数，不可引用一些特殊进程的全局变量或者特殊模块
 */
const path_1 = require("path");
const fs_extra_1 = require("fs-extra");
const i18n_1 = __importDefault(require("../../../../../base/i18n"));
const Sharp = require('sharp');
function isPowerOfTwo(num) {
    return num > 0 && (num & (num - 1)) == 0;
}
// TODO 此方法从引擎处拷贝，如有修改需要同步，否则相关功能会有异常
function getMipLevel(width, height) {
    let size = Math.max(width, height);
    let level = 0;
    while (size) {
        size >>= 1;
        level++;
    }
    return level;
}
async function genMipmapFiles(file, destDir, forceChangeToPowerOfTwo) {
    const sharpResult = Sharp(file);
    const metaData = await sharpResult.metadata();
    if (!isPowerOfTwo(metaData.width) || !isPowerOfTwo(metaData.height)) {
        throw new Error(i18n_1.default.t('builder.project.texture_compress.mipmap.no_power_of_two'));
        // TODO forceChangeToPowerOfTwo
    }
    let width = metaData.width;
    let height = metaData.height;
    destDir = destDir || (0, path_1.dirname)(file);
    const extName = (0, path_1.extname)(file);
    const name = (0, path_1.basename)(file, extName);
    const fileRes = [];
    const mipLevel = getMipLevel(width, height);
    for (let i = mipLevel; i > 0; i--) {
        // 最小一像素
        if (width === 1 && height === 1) {
            break;
        }
        width = Math.max(width / 2, 1);
        height = Math.max(height / 2, 1);
        const dest = (0, path_1.join)(destDir, 'mipmaps', `${name}@mipmap_${i - 1}${extName}`);
        fileRes.push(dest);
        if ((0, fs_extra_1.existsSync)(dest)) {
            continue;
        }
        (0, fs_extra_1.ensureDirSync)((0, path_1.dirname)(dest));
        await sharpResult.resize(width, height).toFile(dest);
    }
    // 降序写入
    return fileRes;
}
function checkHasMipMaps(meta) {
    let mipfilter;
    if (meta.subMetas['6c48a']) {
        mipfilter = meta.subMetas['6c48a'].userData.mipfilter;
    }
    else if (meta.userData.textureSetting) {
        mipfilter = meta.userData.textureSetting.mipfilter;
    }
    if (['nearest', 'linear'].includes(mipfilter)) {
        return true;
    }
    return false;
}
async function compressMipmapFiles(optionItem, compressFunc) {
    if (!optionItem.mipmapFiles || !optionItem.mipmapFiles.length || ['png', 'jpg', 'webp'].includes(optionItem.format)) {
        return [];
    }
    console.debug(`Start merge mipmaps file of asset ${optionItem.uuid}`);
    const res = [];
    for (let i = 0; i < optionItem.mipmapFiles.length; i++) {
        const file = optionItem.mipmapFiles[i];
        const dest = (0, path_1.join)((0, path_1.dirname)(optionItem.dest), 'mipmaps', (0, path_1.basename)(file, (0, path_1.extname)(file)) + (0, path_1.extname)(optionItem.dest));
        await compressFunc({
            ...optionItem,
            src: file,
            dest,
        });
        res.push((0, fs_extra_1.readFileSync)(dest));
    }
    console.debug(`Merge mipmaps file of asset ${optionItem.uuid} success`);
    return res;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWluaW1hcHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvY29yZS9idWlsZGVyL3dvcmtlci9idWlsZGVyL2Fzc2V0LWhhbmRsZXIvdGV4dHVyZS1jb21wcmVzcy9taW5pbWFwcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7O0FBV2Isb0NBRUM7QUFHRCxrQ0FLQztBQUVELHdDQStCQztBQUVELDBDQVdDO0FBRUQsa0RBa0JDO0FBdEZEOztHQUVHO0FBQ0gsK0JBQXdEO0FBQ3hELHVDQUFtRTtBQUNuRSxvRUFBNEM7QUFHNUMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBRS9CLFNBQWdCLFlBQVksQ0FBQyxHQUFXO0lBQ3BDLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM3QyxDQUFDO0FBRUQscUNBQXFDO0FBQ3JDLFNBQWdCLFdBQVcsQ0FBQyxLQUFhLEVBQUUsTUFBYztJQUNyRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNuQyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDZCxPQUFPLElBQUksRUFBRSxDQUFDO1FBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQztRQUFDLEtBQUssRUFBRSxDQUFDO0lBQUMsQ0FBQztJQUNyQyxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDO0FBRU0sS0FBSyxVQUFVLGNBQWMsQ0FBQyxJQUFZLEVBQUUsT0FBZ0IsRUFBRSx1QkFBaUM7SUFDbEcsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLE1BQU0sUUFBUSxHQUFHLE1BQU0sV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzlDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ2xFLE1BQU0sSUFBSSxLQUFLLENBQUMsY0FBSSxDQUFDLENBQUMsQ0FBQyx5REFBeUQsQ0FBQyxDQUFDLENBQUM7UUFDbkYsK0JBQStCO0lBQ25DLENBQUM7SUFDRCxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO0lBQzNCLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7SUFDN0IsT0FBTyxHQUFHLE9BQU8sSUFBSSxJQUFBLGNBQU8sRUFBQyxJQUFJLENBQUMsQ0FBQztJQUNuQyxNQUFNLE9BQU8sR0FBRyxJQUFBLGNBQU8sRUFBQyxJQUFJLENBQUMsQ0FBQztJQUM5QixNQUFNLElBQUksR0FBRyxJQUFBLGVBQVEsRUFBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDckMsTUFBTSxPQUFPLEdBQWEsRUFBRSxDQUFDO0lBQzdCLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDNUMsS0FBSyxJQUFJLENBQUMsR0FBRyxRQUFRLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ2hDLFFBQVE7UUFDUixJQUFJLEtBQUssS0FBSyxDQUFDLElBQUksTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQzlCLE1BQU07UUFDVixDQUFDO1FBQ0QsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMvQixNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sSUFBSSxHQUFHLElBQUEsV0FBSSxFQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxJQUFJLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQzNFLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkIsSUFBSSxJQUFBLHFCQUFVLEVBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNuQixTQUFTO1FBQ2IsQ0FBQztRQUNELElBQUEsd0JBQWEsRUFBQyxJQUFBLGNBQU8sRUFBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE1BQU0sV0FBVyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFDRCxPQUFPO0lBQ1AsT0FBTyxPQUFPLENBQUM7QUFDbkIsQ0FBQztBQUVELFNBQWdCLGVBQWUsQ0FBQyxJQUFTO0lBQ3JDLElBQUksU0FBUyxDQUFDO0lBQ2QsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDekIsU0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztJQUMxRCxDQUFDO1NBQU0sSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RDLFNBQVMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUM7SUFDdkQsQ0FBQztJQUNELElBQUksQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7UUFDNUMsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2pCLENBQUM7QUFFTSxLQUFLLFVBQVUsbUJBQW1CLENBQUMsVUFBMkIsRUFBRSxZQUFzQjtJQUN6RixJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsTUFBTSxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDbEgsT0FBTyxFQUFFLENBQUM7SUFDZCxDQUFDO0lBQ0QsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFDdEUsTUFBTSxHQUFHLEdBQWEsRUFBRSxDQUFDO0lBQ3pCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ3JELE1BQU0sSUFBSSxHQUFHLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkMsTUFBTSxJQUFJLEdBQUcsSUFBQSxXQUFJLEVBQUMsSUFBQSxjQUFPLEVBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVMsRUFBRSxJQUFBLGVBQVEsRUFBQyxJQUFJLEVBQUUsSUFBQSxjQUFPLEVBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFBLGNBQU8sRUFBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqSCxNQUFNLFlBQWEsQ0FBQztZQUNoQixHQUFHLFVBQVU7WUFDYixHQUFHLEVBQUUsSUFBSTtZQUNULElBQUk7U0FDUCxDQUFDLENBQUM7UUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUEsdUJBQVksRUFBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFDRCxPQUFPLENBQUMsS0FBSyxDQUFDLCtCQUErQixVQUFVLENBQUMsSUFBSSxVQUFVLENBQUMsQ0FBQztJQUN4RSxPQUFPLEdBQUcsQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcbi8qKlxyXG4gKiDlt6Xlhbflh73mlbDvvIzkuI3lj6/lvJXnlKjkuIDkupvnibnmrorov5vnqIvnmoTlhajlsYDlj5jph4/miJbogIXnibnmrormqKHlnZdcclxuICovXHJcbmltcG9ydCB7IGJhc2VuYW1lLCBkaXJuYW1lLCBleHRuYW1lLCBqb2luIH0gZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7IGV4aXN0c1N5bmMsIGVuc3VyZURpclN5bmMsIHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcclxuaW1wb3J0IGkxOG4gZnJvbSAnLi4vLi4vLi4vLi4vLi4vYmFzZS9pMThuJztcclxuaW1wb3J0IHsgSUNvbXByZXNzQ29uZmlnIH0gZnJvbSAnLi4vLi4vLi4vLi4vQHR5cGVzJztcclxuXHJcbmNvbnN0IFNoYXJwID0gcmVxdWlyZSgnc2hhcnAnKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1Bvd2VyT2ZUd28obnVtOiBudW1iZXIpIHtcclxuICAgIHJldHVybiBudW0gPiAwICYmIChudW0gJiAobnVtIC0gMSkpID09IDA7XHJcbn1cclxuXHJcbi8vIFRPRE8g5q2k5pa55rOV5LuO5byV5pOO5aSE5ou36LSd77yM5aaC5pyJ5L+u5pS56ZyA6KaB5ZCM5q2l77yM5ZCm5YiZ55u45YWz5Yqf6IO95Lya5pyJ5byC5bi4XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRNaXBMZXZlbCh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xyXG4gICAgbGV0IHNpemUgPSBNYXRoLm1heCh3aWR0aCwgaGVpZ2h0KTtcclxuICAgIGxldCBsZXZlbCA9IDA7XHJcbiAgICB3aGlsZSAoc2l6ZSkgeyBzaXplID4+PSAxOyBsZXZlbCsrOyB9XHJcbiAgICByZXR1cm4gbGV2ZWw7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5NaXBtYXBGaWxlcyhmaWxlOiBzdHJpbmcsIGRlc3REaXI/OiBzdHJpbmcsIGZvcmNlQ2hhbmdlVG9Qb3dlck9mVHdvPzogYm9vbGVhbikge1xyXG4gICAgY29uc3Qgc2hhcnBSZXN1bHQgPSBTaGFycChmaWxlKTtcclxuICAgIGNvbnN0IG1ldGFEYXRhID0gYXdhaXQgc2hhcnBSZXN1bHQubWV0YWRhdGEoKTtcclxuICAgIGlmICghaXNQb3dlck9mVHdvKG1ldGFEYXRhLndpZHRoKSB8fCAhaXNQb3dlck9mVHdvKG1ldGFEYXRhLmhlaWdodCkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoaTE4bi50KCdidWlsZGVyLnByb2plY3QudGV4dHVyZV9jb21wcmVzcy5taXBtYXAubm9fcG93ZXJfb2ZfdHdvJykpO1xyXG4gICAgICAgIC8vIFRPRE8gZm9yY2VDaGFuZ2VUb1Bvd2VyT2ZUd29cclxuICAgIH1cclxuICAgIGxldCB3aWR0aCA9IG1ldGFEYXRhLndpZHRoO1xyXG4gICAgbGV0IGhlaWdodCA9IG1ldGFEYXRhLmhlaWdodDtcclxuICAgIGRlc3REaXIgPSBkZXN0RGlyIHx8IGRpcm5hbWUoZmlsZSk7XHJcbiAgICBjb25zdCBleHROYW1lID0gZXh0bmFtZShmaWxlKTtcclxuICAgIGNvbnN0IG5hbWUgPSBiYXNlbmFtZShmaWxlLCBleHROYW1lKTtcclxuICAgIGNvbnN0IGZpbGVSZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCBtaXBMZXZlbCA9IGdldE1pcExldmVsKHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgZm9yIChsZXQgaSA9IG1pcExldmVsOyBpID4gMDsgaS0tKSB7XHJcbiAgICAgICAgLy8g5pyA5bCP5LiA5YOP57SgXHJcbiAgICAgICAgaWYgKHdpZHRoID09PSAxICYmIGhlaWdodCA9PT0gMSkge1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCAvIDIsIDEpO1xyXG4gICAgICAgIGhlaWdodCA9IE1hdGgubWF4KGhlaWdodCAvIDIsIDEpO1xyXG4gICAgICAgIGNvbnN0IGRlc3QgPSBqb2luKGRlc3REaXIsICdtaXBtYXBzJywgYCR7bmFtZX1AbWlwbWFwXyR7aSAtIDF9JHtleHROYW1lfWApO1xyXG4gICAgICAgIGZpbGVSZXMucHVzaChkZXN0KTtcclxuICAgICAgICBpZiAoZXhpc3RzU3luYyhkZXN0KSkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZW5zdXJlRGlyU3luYyhkaXJuYW1lKGRlc3QpKTtcclxuICAgICAgICBhd2FpdCBzaGFycFJlc3VsdC5yZXNpemUod2lkdGgsIGhlaWdodCkudG9GaWxlKGRlc3QpO1xyXG4gICAgfVxyXG4gICAgLy8g6ZmN5bqP5YaZ5YWlXHJcbiAgICByZXR1cm4gZmlsZVJlcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrSGFzTWlwTWFwcyhtZXRhOiBhbnkpOiBib29sZWFuIHtcclxuICAgIGxldCBtaXBmaWx0ZXI7XHJcbiAgICBpZiAobWV0YS5zdWJNZXRhc1snNmM0OGEnXSkge1xyXG4gICAgICAgIG1pcGZpbHRlciA9IG1ldGEuc3ViTWV0YXNbJzZjNDhhJ10udXNlckRhdGEubWlwZmlsdGVyO1xyXG4gICAgfSBlbHNlIGlmIChtZXRhLnVzZXJEYXRhLnRleHR1cmVTZXR0aW5nKSB7XHJcbiAgICAgICAgbWlwZmlsdGVyID0gbWV0YS51c2VyRGF0YS50ZXh0dXJlU2V0dGluZy5taXBmaWx0ZXI7XHJcbiAgICB9XHJcbiAgICBpZiAoWyduZWFyZXN0JywgJ2xpbmVhciddLmluY2x1ZGVzKG1pcGZpbHRlcikpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvbXByZXNzTWlwbWFwRmlsZXMob3B0aW9uSXRlbTogSUNvbXByZXNzQ29uZmlnLCBjb21wcmVzc0Z1bmM6IEZ1bmN0aW9uKTogUHJvbWlzZTxCdWZmZXJbXT4ge1xyXG4gICAgaWYgKCFvcHRpb25JdGVtLm1pcG1hcEZpbGVzIHx8ICFvcHRpb25JdGVtLm1pcG1hcEZpbGVzLmxlbmd0aCB8fCBbJ3BuZycsICdqcGcnLCAnd2VicCddLmluY2x1ZGVzKG9wdGlvbkl0ZW0uZm9ybWF0KSkge1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGNvbnNvbGUuZGVidWcoYFN0YXJ0IG1lcmdlIG1pcG1hcHMgZmlsZSBvZiBhc3NldCAke29wdGlvbkl0ZW0udXVpZH1gKTtcclxuICAgIGNvbnN0IHJlczogQnVmZmVyW10gPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9uSXRlbS5taXBtYXBGaWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IGZpbGUgPSBvcHRpb25JdGVtLm1pcG1hcEZpbGVzW2ldO1xyXG4gICAgICAgIGNvbnN0IGRlc3QgPSBqb2luKGRpcm5hbWUob3B0aW9uSXRlbS5kZXN0KSwgJ21pcG1hcHMnLCBiYXNlbmFtZShmaWxlLCBleHRuYW1lKGZpbGUpKSArIGV4dG5hbWUob3B0aW9uSXRlbS5kZXN0KSk7XHJcbiAgICAgICAgYXdhaXQgY29tcHJlc3NGdW5jISh7XHJcbiAgICAgICAgICAgIC4uLm9wdGlvbkl0ZW0sXHJcbiAgICAgICAgICAgIHNyYzogZmlsZSxcclxuICAgICAgICAgICAgZGVzdCxcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXMucHVzaChyZWFkRmlsZVN5bmMoZGVzdCkpO1xyXG4gICAgfVxyXG4gICAgY29uc29sZS5kZWJ1ZyhgTWVyZ2UgbWlwbWFwcyBmaWxlIG9mIGFzc2V0ICR7b3B0aW9uSXRlbS51dWlkfSBzdWNjZXNzYCk7XHJcbiAgICByZXR1cm4gcmVzO1xyXG59XHJcbiJdfQ==