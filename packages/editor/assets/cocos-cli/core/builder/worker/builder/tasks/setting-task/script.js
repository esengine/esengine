'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.title = void 0;
exports.handle = handle;
const path_1 = require("path");
const utils_1 = require("../../utils");
exports.title = 'i18n:builder.tasks.settings.script';
/**
 * 填充脚本数据
 * @param options
 * @param settings
 */
async function handle(options, result, cache) {
    const settings = result.settings;
    settings.scripting.scriptPackages = result.scriptPackages.map((path) => (0, utils_1.relativeUrl)(result.paths.engineDir, path));
    settings.plugins.jsList = result.pluginScripts.map((script) => {
        let fileDbUrlNoProtocolHeader = (0, utils_1.removeDbHeader)(script.url);
        if (options.md5Cache && result.paths.plugins[script.uuid]) {
            fileDbUrlNoProtocolHeader = fileDbUrlNoProtocolHeader.replace(/[^\/]*$/, () => (0, path_1.basename)(result.paths.plugins[script.uuid]));
        }
        return fileDbUrlNoProtocolHeader;
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvcmUvYnVpbGRlci93b3JrZXIvYnVpbGRlci90YXNrcy9zZXR0aW5nLXRhc2svc2NyaXB0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7O0FBZWIsd0JBVUM7QUF2QkQsK0JBQWdDO0FBR2hDLHVDQUEwRDtBQUc3QyxRQUFBLEtBQUssR0FBRyxvQ0FBb0MsQ0FBQztBQUUxRDs7OztHQUlHO0FBQ0ksS0FBSyxVQUFVLE1BQU0sQ0FBaUIsT0FBOEIsRUFBRSxNQUEyQixFQUFFLEtBQXdCO0lBQzlILE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUM7SUFDakMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUEsbUJBQVcsRUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3BILFFBQVEsQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7UUFDMUQsSUFBSSx5QkFBeUIsR0FBRyxJQUFBLHNCQUFjLEVBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNELElBQUksT0FBTyxDQUFDLFFBQVEsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN4RCx5QkFBeUIsR0FBRyx5QkFBeUIsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUEsZUFBUSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEksQ0FBQztRQUNELE9BQU8seUJBQXlCLENBQUM7SUFDckMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IHsgYmFzZW5hbWUgfSBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgQnVpbGRlckFzc2V0Q2FjaGUgfSBmcm9tICcuLi8uLi9tYW5hZ2VyL2Fzc2V0JztcclxuaW1wb3J0IHsgSW50ZXJuYWxCdWlsZFJlc3VsdCB9IGZyb20gJy4uLy4uL21hbmFnZXIvYnVpbGQtcmVzdWx0JztcclxuaW1wb3J0IHsgcmVsYXRpdmVVcmwsIHJlbW92ZURiSGVhZGVyIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xyXG5pbXBvcnQgeyBJQnVpbGRlciwgSUludGVybmFsQnVpbGRPcHRpb25zIH0gZnJvbSAnLi4vLi4vLi4vLi4vQHR5cGVzL3Byb3RlY3RlZCc7XHJcblxyXG5leHBvcnQgY29uc3QgdGl0bGUgPSAnaTE4bjpidWlsZGVyLnRhc2tzLnNldHRpbmdzLnNjcmlwdCc7XHJcblxyXG4vKipcclxuICog5aGr5YWF6ISa5pys5pWw5o2uXHJcbiAqIEBwYXJhbSBvcHRpb25zXHJcbiAqIEBwYXJhbSBzZXR0aW5nc1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZSh0aGlzOiBJQnVpbGRlciwgb3B0aW9uczogSUludGVybmFsQnVpbGRPcHRpb25zLCByZXN1bHQ6IEludGVybmFsQnVpbGRSZXN1bHQsIGNhY2hlOiBCdWlsZGVyQXNzZXRDYWNoZSkge1xyXG4gICAgY29uc3Qgc2V0dGluZ3MgPSByZXN1bHQuc2V0dGluZ3M7XHJcbiAgICBzZXR0aW5ncy5zY3JpcHRpbmcuc2NyaXB0UGFja2FnZXMgPSByZXN1bHQuc2NyaXB0UGFja2FnZXMubWFwKChwYXRoKSA9PiByZWxhdGl2ZVVybChyZXN1bHQucGF0aHMuZW5naW5lRGlyISwgcGF0aCkpO1xyXG4gICAgc2V0dGluZ3MucGx1Z2lucy5qc0xpc3QgPSByZXN1bHQucGx1Z2luU2NyaXB0cy5tYXAoKHNjcmlwdCkgPT4ge1xyXG4gICAgICAgIGxldCBmaWxlRGJVcmxOb1Byb3RvY29sSGVhZGVyID0gcmVtb3ZlRGJIZWFkZXIoc2NyaXB0LnVybCk7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMubWQ1Q2FjaGUgJiYgcmVzdWx0LnBhdGhzLnBsdWdpbnNbc2NyaXB0LnV1aWRdKSB7XHJcbiAgICAgICAgICAgIGZpbGVEYlVybE5vUHJvdG9jb2xIZWFkZXIgPSBmaWxlRGJVcmxOb1Byb3RvY29sSGVhZGVyLnJlcGxhY2UoL1teXFwvXSokLywgKCkgPT4gYmFzZW5hbWUocmVzdWx0LnBhdGhzLnBsdWdpbnNbc2NyaXB0LnV1aWRdKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmaWxlRGJVcmxOb1Byb3RvY29sSGVhZGVyO1xyXG4gICAgfSk7XHJcbn1cclxuIl19