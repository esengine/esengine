{"version":3,"file":"gfx-webgl.js","sources":["../../../cocos/gfx/webgl/webgl-descriptor-set.ts","../../../cocos/gfx/webgl/webgl-define.ts","../../../cocos/gfx/webgl/webgl-commands.ts","../../../cocos/gfx/webgl/webgl-gpu-objects.ts","../../../cocos/gfx/webgl/webgl-buffer.ts","../../../cocos/gfx/webgl/webgl-command-buffer.ts","../../../cocos/gfx/webgl/webgl-framebuffer.ts","../../../cocos/gfx/webgl/webgl-input-assembler.ts","../../../cocos/gfx/webgl/webgl-descriptor-set-layout.ts","../../../cocos/gfx/webgl/webgl-pipeline-layout.ts","../../../cocos/gfx/webgl/webgl-pipeline-state.ts","../../../cocos/gfx/webgl/webgl-primary-command-buffer.ts","../../../cocos/gfx/webgl/webgl-queue.ts","../../../cocos/gfx/webgl/webgl-render-pass.ts","../../../cocos/gfx/webgl/states/webgl-sampler.ts","../../../cocos/gfx/webgl/webgl-shader.ts","../../../cocos/gfx/webgl/webgl-state-cache.ts","../../../cocos/gfx/webgl/webgl-texture.ts","../../../cocos/gfx/webgl/webgl-swapchain.ts","../../../cocos/gfx/webgl/webgl-device.ts","../../../exports/gfx-webgl.ts"],"sourcesContent":["/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { DescriptorSet } from '../base/descriptor-set';\r\nimport { WebGLBuffer } from './webgl-buffer';\r\nimport { IWebGLGPUDescriptorSet, IWebGLGPUDescriptor } from './webgl-gpu-objects';\r\nimport { WebGLSampler } from './states/webgl-sampler';\r\nimport { WebGLTexture } from './webgl-texture';\r\nimport { WebGLDescriptorSetLayout } from './webgl-descriptor-set-layout';\r\nimport { DescriptorSetInfo, DESCRIPTOR_SAMPLER_TYPE, DESCRIPTOR_BUFFER_TYPE } from '../base/define';\r\n\r\n/** @mangle */\r\nexport class WebGLDescriptorSet extends DescriptorSet {\r\n    get gpuDescriptorSet (): IWebGLGPUDescriptorSet {\r\n        return this._gpuDescriptorSet as IWebGLGPUDescriptorSet;\r\n    }\r\n\r\n    private _gpuDescriptorSet: IWebGLGPUDescriptorSet | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<DescriptorSetInfo>): void {\r\n        this._layout = info.layout;\r\n        const { bindings, descriptorIndices, descriptorCount } = (info.layout as WebGLDescriptorSetLayout).gpuDescriptorSetLayout;\r\n\r\n        this._buffers = Array(descriptorCount).fill(null);\r\n        this._textures = Array(descriptorCount).fill(null);\r\n        this._samplers = Array(descriptorCount).fill(null);\r\n\r\n        const gpuDescriptors: IWebGLGPUDescriptor[] = [];\r\n        this._gpuDescriptorSet = { gpuDescriptors, descriptorIndices };\r\n\r\n        for (let i = 0; i < bindings.length; ++i) {\r\n            const binding = bindings[i];\r\n            for (let j = 0; j < binding.count; j++) {\r\n                const gpuDescriptor: IWebGLGPUDescriptor = {\r\n                    type: binding.descriptorType,\r\n                    gpuBuffer: null,\r\n                    gpuTexture: null,\r\n                    gpuSampler: null,\r\n                };\r\n                gpuDescriptors.push(gpuDescriptor);\r\n            }\r\n        }\r\n    }\r\n\r\n    public destroy (): void {\r\n        this._layout = null;\r\n        this._gpuDescriptorSet = null;\r\n    }\r\n\r\n    public update (): void {\r\n        if (this._isDirty && this._gpuDescriptorSet) {\r\n            const descriptors = this._gpuDescriptorSet.gpuDescriptors;\r\n            for (let i = 0; i < descriptors.length; ++i) {\r\n                if (descriptors[i].type & DESCRIPTOR_BUFFER_TYPE) {\r\n                    const buffer = this._buffers[i] as WebGLBuffer | null;\r\n                    if (buffer) {\r\n                        descriptors[i].gpuBuffer = buffer.gpuBuffer || buffer.gpuBufferView;\r\n                    }\r\n                } else if (descriptors[i].type & DESCRIPTOR_SAMPLER_TYPE) {\r\n                    if (this._textures[i]) {\r\n                        descriptors[i].gpuTexture = (this._textures[i] as WebGLTexture).gpuTexture;\r\n                    }\r\n                    if (this._samplers[i]) {\r\n                        descriptors[i].gpuSampler = (this._samplers[i] as WebGLSampler).gpuSampler;\r\n                    }\r\n                }\r\n            }\r\n            this._isDirty = false;\r\n        }\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { WebGLDevice } from './webgl-device';\r\n\r\n// Extensions\r\nexport enum WebGLEXT {\r\n    RGBA16F_EXT = 0x881A,\r\n    RGB16F_EXT = 0x881B,\r\n    RGBA32F_EXT = 0x8814,\r\n    FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT = 0x8211,\r\n    UNSIGNED_NORMALIZED_EXT = 0x8C17,\r\n    UNSIGNED_INT_24_8_WEBGL = 0x84FA,\r\n    HALF_FLOAT_OES = 0x8D61,\r\n\r\n    SRGB_EXT = 0x8C40,\r\n    SRGB_ALPHA_EXT = 0x8C42,\r\n    SRGB8_ALPHA8_EXT = 0x8C43,\r\n\r\n    COMPRESSED_RGB_S3TC_DXT1_EXT = 0x83F0,\r\n    COMPRESSED_RGBA_S3TC_DXT1_EXT = 0x83F1,\r\n    COMPRESSED_RGBA_S3TC_DXT3_EXT = 0x83F2,\r\n    COMPRESSED_RGBA_S3TC_DXT5_EXT = 0x83F3,\r\n\r\n    COMPRESSED_SRGB_S3TC_DXT1_EXT = 0x8C4C,\r\n    COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT = 0x8C4D,\r\n    COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT = 0x8C4E,\r\n    COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT = 0x8C4F,\r\n\r\n    COMPRESSED_RGB_PVRTC_4BPPV1_IMG = 0x8C00,\r\n    COMPRESSED_RGB_PVRTC_2BPPV1_IMG = 0x8C01,\r\n    COMPRESSED_RGBA_PVRTC_4BPPV1_IMG = 0x8C02,\r\n    COMPRESSED_RGBA_PVRTC_2BPPV1_IMG = 0x8C03,\r\n\r\n    COMPRESSED_RGB_ETC1_WEBGL = 0x8D64,\r\n\r\n    COMPRESSED_R11_EAC = 0x9270,\r\n    COMPRESSED_SIGNED_R11_EAC = 0x9271,\r\n    COMPRESSED_RG11_EAC = 0x9272,\r\n    COMPRESSED_SIGNED_RG11_EAC = 0x9273,\r\n    COMPRESSED_RGB8_ETC2 = 0x9274,\r\n    COMPRESSED_SRGB8_ETC2 = 0x9275,\r\n    COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2 = 0x9276,\r\n    COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2 = 0x9277,\r\n    COMPRESSED_RGBA8_ETC2_EAC = 0x9278,\r\n    COMPRESSED_SRGB8_ALPHA8_ETC2_EAC = 0x9279,\r\n\r\n    COMPRESSED_RGBA_ASTC_4x4_KHR = 0x93B0,\r\n    COMPRESSED_RGBA_ASTC_5x4_KHR = 0x93B1,\r\n    COMPRESSED_RGBA_ASTC_5x5_KHR = 0x93B2,\r\n    COMPRESSED_RGBA_ASTC_6x5_KHR = 0x93B3,\r\n    COMPRESSED_RGBA_ASTC_6x6_KHR = 0x93B4,\r\n    COMPRESSED_RGBA_ASTC_8x5_KHR = 0x93B5,\r\n    COMPRESSED_RGBA_ASTC_8x6_KHR = 0x93B6,\r\n    COMPRESSED_RGBA_ASTC_8x8_KHR = 0x93B7,\r\n    COMPRESSED_RGBA_ASTC_10x5_KHR = 0x93B8,\r\n    COMPRESSED_RGBA_ASTC_10x6_KHR = 0x93B9,\r\n    COMPRESSED_RGBA_ASTC_10x8_KHR = 0x93BA,\r\n    COMPRESSED_RGBA_ASTC_10x10_KHR = 0x93BB,\r\n    COMPRESSED_RGBA_ASTC_12x10_KHR = 0x93BC,\r\n    COMPRESSED_RGBA_ASTC_12x12_KHR = 0x93BD,\r\n\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR = 0x93D0,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR = 0x93D1,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR = 0x93D2,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR = 0x93D3,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR = 0x93D4,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR = 0x93D5,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR = 0x93D6,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR = 0x93D7,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR = 0x93D8,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR = 0x93D9,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR = 0x93DA,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR = 0x93DB,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR = 0x93DC,\r\n    COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR = 0x93DD,\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLExtensions {\r\n    EXT_texture_filter_anisotropic: EXT_texture_filter_anisotropic | null;\r\n    EXT_blend_minmax: EXT_blend_minmax | null;\r\n    EXT_frag_depth: EXT_frag_depth | null;\r\n    EXT_shader_texture_lod: EXT_shader_texture_lod | null;\r\n    EXT_sRGB: EXT_sRGB | null;\r\n    OES_vertex_array_object: OES_vertex_array_object | null;\r\n    EXT_color_buffer_half_float: EXT_color_buffer_half_float | null;\r\n    WEBGL_multi_draw: WEBGL_multi_draw | null;\r\n    WEBGL_color_buffer_float: WEBGL_color_buffer_float | null;\r\n    WEBGL_compressed_texture_etc1: WEBGL_compressed_texture_etc1 | null;\r\n    WEBGL_compressed_texture_etc: WEBGL_compressed_texture_etc | null;\r\n    WEBGL_compressed_texture_pvrtc: WEBGL_compressed_texture_pvrtc | null;\r\n    WEBGL_compressed_texture_astc: WEBGL_compressed_texture_astc | null;\r\n    WEBGL_compressed_texture_s3tc: WEBGL_compressed_texture_s3tc | null;\r\n    WEBGL_compressed_texture_s3tc_srgb: WEBGL_compressed_texture_s3tc_srgb | null;\r\n    WEBGL_debug_shaders: WEBGL_debug_shaders | null;\r\n    WEBGL_draw_buffers: WEBGL_draw_buffers | null;\r\n    WEBGL_lose_context: WEBGL_lose_context | null;\r\n    WEBGL_depth_texture: WEBGL_depth_texture | null;\r\n    WEBGL_debug_renderer_info: WEBGL_debug_renderer_info | null;\r\n    OES_texture_half_float: OES_texture_half_float | null;\r\n    OES_texture_half_float_linear: OES_texture_half_float_linear | null;\r\n    OES_texture_float: OES_texture_float | null;\r\n    OES_texture_float_linear: OES_texture_float_linear | null;\r\n    OES_standard_derivatives: OES_standard_derivatives | null;\r\n    OES_element_index_uint: OES_element_index_uint | null;\r\n    ANGLE_instanced_arrays: ANGLE_instanced_arrays | null;\r\n    destroyShadersImmediately: boolean;\r\n    noCompressedTexSubImage2D: boolean;\r\n    isLocationActive: (glLoc: unknown) => glLoc is WebGLUniformLocation;\r\n    useVAO: boolean;\r\n}\r\n\r\n// put the global instance here so that we won't have circular dependencies\r\nexport class WebGLDeviceManager {\r\n    static get instance (): WebGLDevice {\r\n        return WebGLDeviceManager._instance!;\r\n    }\r\n    static setInstance (instance: WebGLDevice): void {\r\n        WebGLDeviceManager._instance = instance;\r\n    }\r\n    private static _instance: WebGLDevice | null = null;\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { BYTEDANCE } from 'internal:constants';\r\nimport { systemInfo } from 'pal/system-info';\r\nimport { WebGLEXT } from './webgl-define';\r\nimport { WebGLDevice } from './webgl-device';\r\nimport {\r\n    IWebGLGPUInputAssembler, IWebGLGPUUniform, IWebGLAttrib, IWebGLGPUDescriptorSet, IWebGLGPUBuffer, IWebGLGPUFramebuffer, IWebGLGPUInput,\r\n    IWebGLGPUPipelineState, IWebGLGPUShader, IWebGLGPUTexture, IWebGLGPUUniformBlock, IWebGLGPUUniformSamplerTexture, IWebGLGPURenderPass,\r\n} from './webgl-gpu-objects';\r\nimport {\r\n    BufferUsageBit, ColorMask, CullMode, Format, BufferTextureCopy, Color, Rect,\r\n    FormatInfos, FormatSize, LoadOp, MemoryUsageBit, ShaderStageFlagBit, UniformSamplerTexture,\r\n    TextureFlagBit, TextureType, Type, FormatInfo, DynamicStateFlagBit, BufferSource, DrawInfo,\r\n    IndirectBuffer, DynamicStates, Extent, getTypedArrayConstructor, formatAlignment, Offset, alignTo,\r\n    TextureBlit, Filter,\r\n} from '../base/define';\r\n\r\nimport { WebGLConstants } from '../gl-constants';\r\nimport { assertID, debugID, error, errorID } from '../../core/platform/debug';\r\nimport { cclegacy } from '../../core/global-exports';\r\nimport { OS } from '../../../pal/system-info/enum-type';\r\n\r\nconst max = Math.max;\r\nconst min = Math.min;\r\n\r\nexport function GFXFormatToWebGLType (format: Format, gl: WebGLRenderingContext): GLenum {\r\n    switch (format) {\r\n    case Format.R8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.R8SN: return WebGLConstants.BYTE;\r\n    case Format.R8UI: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.R8I: return WebGLConstants.BYTE;\r\n    case Format.R16F: return WebGLEXT.HALF_FLOAT_OES;\r\n    case Format.R16UI: return WebGLConstants.UNSIGNED_SHORT;\r\n    case Format.R16I: return WebGLConstants.SHORT;\r\n    case Format.R32F: return WebGLConstants.FLOAT;\r\n    case Format.R32UI: return WebGLConstants.UNSIGNED_INT;\r\n    case Format.R32I: return WebGLConstants.INT;\r\n\r\n    case Format.RG8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RG8SN: return WebGLConstants.BYTE;\r\n    case Format.RG8UI: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RG8I: return WebGLConstants.BYTE;\r\n    case Format.RG16F: return WebGLEXT.HALF_FLOAT_OES;\r\n    case Format.RG16UI: return WebGLConstants.UNSIGNED_SHORT;\r\n    case Format.RG16I: return WebGLConstants.SHORT;\r\n    case Format.RG32F: return WebGLConstants.FLOAT;\r\n    case Format.RG32UI: return WebGLConstants.UNSIGNED_INT;\r\n    case Format.RG32I: return WebGLConstants.INT;\r\n\r\n    case Format.RGB8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.SRGB8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RGB8SN: return WebGLConstants.BYTE;\r\n    case Format.RGB8UI: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RGB8I: return WebGLConstants.BYTE;\r\n    case Format.RGB16F: return WebGLEXT.HALF_FLOAT_OES;\r\n    case Format.RGB16UI: return WebGLConstants.UNSIGNED_SHORT;\r\n    case Format.RGB16I: return WebGLConstants.SHORT;\r\n    case Format.RGB32F: return WebGLConstants.FLOAT;\r\n    case Format.RGB32UI: return WebGLConstants.UNSIGNED_INT;\r\n    case Format.RGB32I: return WebGLConstants.INT;\r\n\r\n    case Format.BGRA8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RGBA8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.SRGB8_A8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RGBA8SN: return WebGLConstants.BYTE;\r\n    case Format.RGBA8UI: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RGBA8I: return WebGLConstants.BYTE;\r\n    case Format.RGBA16F: return WebGLEXT.HALF_FLOAT_OES;\r\n    case Format.RGBA16UI: return WebGLConstants.UNSIGNED_SHORT;\r\n    case Format.RGBA16I: return WebGLConstants.SHORT;\r\n    case Format.RGBA32F: return WebGLConstants.FLOAT;\r\n    case Format.RGBA32UI: return WebGLConstants.UNSIGNED_INT;\r\n    case Format.RGBA32I: return WebGLConstants.INT;\r\n\r\n    case Format.R5G6B5: return WebGLConstants.UNSIGNED_SHORT_5_6_5;\r\n    case Format.R11G11B10F: return WebGLConstants.FLOAT;\r\n    case Format.RGB5A1: return WebGLConstants.UNSIGNED_SHORT_5_5_5_1;\r\n    case Format.RGBA4: return WebGLConstants.UNSIGNED_SHORT_4_4_4_4;\r\n    case Format.RGB10A2: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.RGB10A2UI: return WebGLConstants.UNSIGNED_INT;\r\n    case Format.RGB9E5: return WebGLConstants.UNSIGNED_BYTE;\r\n\r\n    case Format.DEPTH: return WebGLConstants.UNSIGNED_INT;\r\n    case Format.DEPTH_STENCIL: return WebGLEXT.UNSIGNED_INT_24_8_WEBGL;\r\n\r\n    case Format.BC1: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC1_SRGB: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC2: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC2_SRGB: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC3: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC3_SRGB: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC4: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC4_SNORM: return WebGLConstants.BYTE;\r\n    case Format.BC5: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC5_SNORM: return WebGLConstants.BYTE;\r\n    case Format.BC6H_SF16: return WebGLConstants.FLOAT;\r\n    case Format.BC6H_UF16: return WebGLConstants.FLOAT;\r\n    case Format.BC7: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.BC7_SRGB: return WebGLConstants.UNSIGNED_BYTE;\r\n\r\n    case Format.ETC_RGB8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.ETC2_RGB8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.ETC2_SRGB8: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.ETC2_RGB8_A1: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.ETC2_SRGB8_A1: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.EAC_R11: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.EAC_R11SN: return WebGLConstants.BYTE;\r\n    case Format.EAC_RG11: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.EAC_RG11SN: return WebGLConstants.BYTE;\r\n\r\n    case Format.PVRTC_RGB2: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.PVRTC_RGBA2: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.PVRTC_RGB4: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.PVRTC_RGBA4: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.PVRTC2_2BPP: return WebGLConstants.UNSIGNED_BYTE;\r\n    case Format.PVRTC2_4BPP: return WebGLConstants.UNSIGNED_BYTE;\r\n\r\n    case Format.ASTC_RGBA_4X4:\r\n    case Format.ASTC_RGBA_5X4:\r\n    case Format.ASTC_RGBA_5X5:\r\n    case Format.ASTC_RGBA_6X5:\r\n    case Format.ASTC_RGBA_6X6:\r\n    case Format.ASTC_RGBA_8X5:\r\n    case Format.ASTC_RGBA_8X6:\r\n    case Format.ASTC_RGBA_8X8:\r\n    case Format.ASTC_RGBA_10X5:\r\n    case Format.ASTC_RGBA_10X6:\r\n    case Format.ASTC_RGBA_10X8:\r\n    case Format.ASTC_RGBA_10X10:\r\n    case Format.ASTC_RGBA_12X10:\r\n    case Format.ASTC_RGBA_12X12:\r\n    case Format.ASTC_SRGBA_4X4:\r\n    case Format.ASTC_SRGBA_5X4:\r\n    case Format.ASTC_SRGBA_5X5:\r\n    case Format.ASTC_SRGBA_6X5:\r\n    case Format.ASTC_SRGBA_6X6:\r\n    case Format.ASTC_SRGBA_8X5:\r\n    case Format.ASTC_SRGBA_8X6:\r\n    case Format.ASTC_SRGBA_8X8:\r\n    case Format.ASTC_SRGBA_10X5:\r\n    case Format.ASTC_SRGBA_10X6:\r\n    case Format.ASTC_SRGBA_10X8:\r\n    case Format.ASTC_SRGBA_10X10:\r\n    case Format.ASTC_SRGBA_12X10:\r\n    case Format.ASTC_SRGBA_12X12:\r\n        return WebGLConstants.UNSIGNED_BYTE;\r\n\r\n    default: {\r\n        return WebGLConstants.UNSIGNED_BYTE;\r\n    }\r\n    }\r\n}\r\n\r\nexport function GFXFormatToWebGLInternalFormat (format: Format, gl: WebGLRenderingContext): GLenum {\r\n    switch (format) {\r\n    case Format.R5G6B5: return WebGLConstants.RGB565;\r\n    case Format.RGB5A1: return WebGLConstants.RGB5_A1;\r\n    case Format.RGBA4: return WebGLConstants.RGBA4;\r\n    case Format.RGBA16F: return WebGLEXT.RGBA16F_EXT;\r\n    case Format.RGBA32F: return WebGLEXT.RGBA32F_EXT;\r\n    case Format.SRGB8_A8: return WebGLEXT.SRGB8_ALPHA8_EXT;\r\n    case Format.DEPTH: return WebGLConstants.DEPTH_COMPONENT16;\r\n    case Format.DEPTH_STENCIL: return WebGLConstants.DEPTH_STENCIL;\r\n\r\n    default: {\r\n        errorID(16309);\r\n        return WebGLConstants.RGBA;\r\n    }\r\n    }\r\n}\r\n\r\nexport function GFXFormatToWebGLFormat (format: Format, gl: WebGLRenderingContext): GLenum {\r\n    switch (format) {\r\n    case Format.A8: return WebGLConstants.ALPHA;\r\n    case Format.L8: return WebGLConstants.LUMINANCE;\r\n    case Format.LA8: return WebGLConstants.LUMINANCE_ALPHA;\r\n    case Format.RGB8: return WebGLConstants.RGB;\r\n    case Format.RGB16F: return WebGLConstants.RGB;\r\n    case Format.RGB32F: return WebGLConstants.RGB;\r\n    case Format.BGRA8: return WebGLConstants.RGBA;\r\n    case Format.RGBA8: return WebGLConstants.RGBA;\r\n    case Format.SRGB8_A8: return WebGLConstants.RGBA;\r\n    case Format.RGBA16F: return WebGLConstants.RGBA;\r\n    case Format.RGBA32F: return WebGLConstants.RGBA;\r\n    case Format.R5G6B5: return WebGLConstants.RGB;\r\n    case Format.RGB5A1: return WebGLConstants.RGBA;\r\n    case Format.RGBA4: return WebGLConstants.RGBA;\r\n    case Format.DEPTH: return WebGLConstants.DEPTH_COMPONENT;\r\n    case Format.DEPTH_STENCIL: return WebGLConstants.DEPTH_STENCIL;\r\n\r\n    case Format.BC1: return WebGLEXT.COMPRESSED_RGB_S3TC_DXT1_EXT;\r\n    case Format.BC1_ALPHA: return WebGLEXT.COMPRESSED_RGBA_S3TC_DXT1_EXT;\r\n    case Format.BC1_SRGB: return WebGLEXT.COMPRESSED_SRGB_S3TC_DXT1_EXT;\r\n    case Format.BC1_SRGB_ALPHA: return WebGLEXT.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;\r\n    case Format.BC2: return WebGLEXT.COMPRESSED_RGBA_S3TC_DXT3_EXT;\r\n    case Format.BC2_SRGB: return WebGLEXT.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;\r\n    case Format.BC3: return WebGLEXT.COMPRESSED_RGBA_S3TC_DXT5_EXT;\r\n    case Format.BC3_SRGB: return WebGLEXT.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;\r\n\r\n    case Format.ETC_RGB8: return WebGLEXT.COMPRESSED_RGB_ETC1_WEBGL;\r\n    case Format.ETC2_RGB8: return WebGLEXT.COMPRESSED_RGB8_ETC2;\r\n    case Format.ETC2_SRGB8: return WebGLEXT.COMPRESSED_SRGB8_ETC2;\r\n    case Format.ETC2_RGB8_A1: return WebGLEXT.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;\r\n    case Format.ETC2_SRGB8_A1: return WebGLEXT.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;\r\n    case Format.ETC2_RGBA8: return WebGLEXT.COMPRESSED_RGBA8_ETC2_EAC;\r\n    case Format.ETC2_SRGB8_A8: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;\r\n    case Format.EAC_R11: return WebGLEXT.COMPRESSED_R11_EAC;\r\n    case Format.EAC_R11SN: return WebGLEXT.COMPRESSED_SIGNED_R11_EAC;\r\n    case Format.EAC_RG11: return WebGLEXT.COMPRESSED_RG11_EAC;\r\n    case Format.EAC_RG11SN: return WebGLEXT.COMPRESSED_SIGNED_RG11_EAC;\r\n\r\n    case Format.PVRTC_RGB2: return WebGLEXT.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;\r\n    case Format.PVRTC_RGBA2: return WebGLEXT.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;\r\n    case Format.PVRTC_RGB4: return WebGLEXT.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;\r\n    case Format.PVRTC_RGBA4: return WebGLEXT.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;\r\n\r\n    case Format.ASTC_RGBA_4X4: return WebGLEXT.COMPRESSED_RGBA_ASTC_4x4_KHR;\r\n    case Format.ASTC_RGBA_5X4: return WebGLEXT.COMPRESSED_RGBA_ASTC_5x4_KHR;\r\n    case Format.ASTC_RGBA_5X5: return WebGLEXT.COMPRESSED_RGBA_ASTC_5x5_KHR;\r\n    case Format.ASTC_RGBA_6X5: return WebGLEXT.COMPRESSED_RGBA_ASTC_6x5_KHR;\r\n    case Format.ASTC_RGBA_6X6: return WebGLEXT.COMPRESSED_RGBA_ASTC_6x6_KHR;\r\n    case Format.ASTC_RGBA_8X5: return WebGLEXT.COMPRESSED_RGBA_ASTC_8x5_KHR;\r\n    case Format.ASTC_RGBA_8X6: return WebGLEXT.COMPRESSED_RGBA_ASTC_8x6_KHR;\r\n    case Format.ASTC_RGBA_8X8: return WebGLEXT.COMPRESSED_RGBA_ASTC_8x8_KHR;\r\n    case Format.ASTC_RGBA_10X5: return WebGLEXT.COMPRESSED_RGBA_ASTC_10x5_KHR;\r\n    case Format.ASTC_RGBA_10X6: return WebGLEXT.COMPRESSED_RGBA_ASTC_10x6_KHR;\r\n    case Format.ASTC_RGBA_10X8: return WebGLEXT.COMPRESSED_RGBA_ASTC_10x8_KHR;\r\n    case Format.ASTC_RGBA_10X10: return WebGLEXT.COMPRESSED_RGBA_ASTC_10x10_KHR;\r\n    case Format.ASTC_RGBA_12X10: return WebGLEXT.COMPRESSED_RGBA_ASTC_12x10_KHR;\r\n    case Format.ASTC_RGBA_12X12: return WebGLEXT.COMPRESSED_RGBA_ASTC_12x12_KHR;\r\n\r\n    case Format.ASTC_SRGBA_4X4: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;\r\n    case Format.ASTC_SRGBA_5X4: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;\r\n    case Format.ASTC_SRGBA_5X5: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;\r\n    case Format.ASTC_SRGBA_6X5: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;\r\n    case Format.ASTC_SRGBA_6X6: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;\r\n    case Format.ASTC_SRGBA_8X5: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;\r\n    case Format.ASTC_SRGBA_8X6: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;\r\n    case Format.ASTC_SRGBA_8X8: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;\r\n    case Format.ASTC_SRGBA_10X5: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;\r\n    case Format.ASTC_SRGBA_10X6: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;\r\n    case Format.ASTC_SRGBA_10X8: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;\r\n    case Format.ASTC_SRGBA_10X10: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;\r\n    case Format.ASTC_SRGBA_12X10: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;\r\n    case Format.ASTC_SRGBA_12X12: return WebGLEXT.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;\r\n\r\n    default: {\r\n        errorID(16310);\r\n        return WebGLConstants.RGBA;\r\n    }\r\n    }\r\n}\r\n\r\nfunction GFXTypeToWebGLType (type: Type, gl: WebGLRenderingContext): GLenum {\r\n    switch (type) {\r\n    case Type.BOOL: return WebGLConstants.BOOL;\r\n    case Type.BOOL2: return WebGLConstants.BOOL_VEC2;\r\n    case Type.BOOL3: return WebGLConstants.BOOL_VEC3;\r\n    case Type.BOOL4: return WebGLConstants.BOOL_VEC4;\r\n    case Type.INT: return WebGLConstants.INT;\r\n    case Type.INT2: return WebGLConstants.INT_VEC2;\r\n    case Type.INT3: return WebGLConstants.INT_VEC3;\r\n    case Type.INT4: return WebGLConstants.INT_VEC4;\r\n    case Type.UINT: return WebGLConstants.UNSIGNED_INT;\r\n    case Type.FLOAT: return WebGLConstants.FLOAT;\r\n    case Type.FLOAT2: return WebGLConstants.FLOAT_VEC2;\r\n    case Type.FLOAT3: return WebGLConstants.FLOAT_VEC3;\r\n    case Type.FLOAT4: return WebGLConstants.FLOAT_VEC4;\r\n    case Type.MAT2: return WebGLConstants.FLOAT_MAT2;\r\n    case Type.MAT3: return WebGLConstants.FLOAT_MAT3;\r\n    case Type.MAT4: return WebGLConstants.FLOAT_MAT4;\r\n    case Type.SAMPLER2D: return WebGLConstants.SAMPLER_2D;\r\n    case Type.SAMPLER_CUBE: return WebGLConstants.SAMPLER_CUBE;\r\n    default: {\r\n        errorID(16311);\r\n        return Type.UNKNOWN;\r\n    }\r\n    }\r\n}\r\n\r\nfunction GFXTypeToTypedArrayCtor (type: Type): Int32ArrayConstructor | Float32ArrayConstructor {\r\n    switch (type) {\r\n    case Type.BOOL:\r\n    case Type.BOOL2:\r\n    case Type.BOOL3:\r\n    case Type.BOOL4:\r\n    case Type.INT:\r\n    case Type.INT2:\r\n    case Type.INT3:\r\n    case Type.INT4:\r\n    case Type.UINT:\r\n        return Int32Array;\r\n    case Type.FLOAT:\r\n    case Type.FLOAT2:\r\n    case Type.FLOAT3:\r\n    case Type.FLOAT4:\r\n    case Type.MAT2:\r\n    case Type.MAT3:\r\n    case Type.MAT4:\r\n        return Float32Array;\r\n    default: {\r\n        errorID(16312);\r\n        return Float32Array;\r\n    }\r\n    }\r\n}\r\n\r\nfunction WebGLTypeToGFXType (glType: GLenum, gl: WebGLRenderingContext): Type {\r\n    switch (glType) {\r\n    case WebGLConstants.BOOL: return Type.BOOL;\r\n    case WebGLConstants.BOOL_VEC2: return Type.BOOL2;\r\n    case WebGLConstants.BOOL_VEC3: return Type.BOOL3;\r\n    case WebGLConstants.BOOL_VEC4: return Type.BOOL4;\r\n    case WebGLConstants.INT: return Type.INT;\r\n    case WebGLConstants.INT_VEC2: return Type.INT2;\r\n    case WebGLConstants.INT_VEC3: return Type.INT3;\r\n    case WebGLConstants.INT_VEC4: return Type.INT4;\r\n    case WebGLConstants.UNSIGNED_INT: return Type.UINT;\r\n    case WebGLConstants.FLOAT: return Type.FLOAT;\r\n    case WebGLConstants.FLOAT_VEC2: return Type.FLOAT2;\r\n    case WebGLConstants.FLOAT_VEC3: return Type.FLOAT3;\r\n    case WebGLConstants.FLOAT_VEC4: return Type.FLOAT4;\r\n    case WebGLConstants.FLOAT_MAT2: return Type.MAT2;\r\n    case WebGLConstants.FLOAT_MAT3: return Type.MAT3;\r\n    case WebGLConstants.FLOAT_MAT4: return Type.MAT4;\r\n    case WebGLConstants.SAMPLER_2D: return Type.SAMPLER2D;\r\n    case WebGLConstants.SAMPLER_CUBE: return Type.SAMPLER_CUBE;\r\n    default: {\r\n        errorID(16313);\r\n        return Type.UNKNOWN;\r\n    }\r\n    }\r\n}\r\n\r\nfunction WebGLGetTypeSize (glType: GLenum, gl: WebGLRenderingContext): number {\r\n    switch (glType) {\r\n    case WebGLConstants.BOOL: return 4;\r\n    case WebGLConstants.BOOL_VEC2: return 8;\r\n    case WebGLConstants.BOOL_VEC3: return 12;\r\n    case WebGLConstants.BOOL_VEC4: return 16;\r\n    case WebGLConstants.INT: return 4;\r\n    case WebGLConstants.INT_VEC2: return 8;\r\n    case WebGLConstants.INT_VEC3: return 12;\r\n    case WebGLConstants.INT_VEC4: return 16;\r\n    case WebGLConstants.UNSIGNED_INT: return 4;\r\n    case WebGLConstants.FLOAT: return 4;\r\n    case WebGLConstants.FLOAT_VEC2: return 8;\r\n    case WebGLConstants.FLOAT_VEC3: return 12;\r\n    case WebGLConstants.FLOAT_VEC4: return 16;\r\n    case WebGLConstants.FLOAT_MAT2: return 16;\r\n    case WebGLConstants.FLOAT_MAT3: return 36;\r\n    case WebGLConstants.FLOAT_MAT4: return 64;\r\n    case WebGLConstants.SAMPLER_2D: return 4;\r\n    case WebGLConstants.SAMPLER_CUBE: return 4;\r\n    default: {\r\n        errorID(16314);\r\n        return 0;\r\n    }\r\n    }\r\n}\r\n\r\nfunction WebGLGetComponentCount (glType: GLenum, gl: WebGLRenderingContext): number {\r\n    switch (glType) {\r\n    case WebGLConstants.FLOAT_MAT2: return 2;\r\n    case WebGLConstants.FLOAT_MAT3: return 3;\r\n    case WebGLConstants.FLOAT_MAT4: return 4;\r\n    default: {\r\n        return 1;\r\n    }\r\n    }\r\n}\r\n\r\nconst WebGLCmpFuncs: GLenum[] = [\r\n    WebGLConstants.NEVER,\r\n    WebGLConstants.LESS,\r\n    WebGLConstants.EQUAL,\r\n    WebGLConstants.LEQUAL,\r\n    WebGLConstants.GREATER,\r\n    WebGLConstants.NOTEQUAL,\r\n    WebGLConstants.GEQUAL,\r\n    WebGLConstants.ALWAYS,\r\n];\r\n\r\nconst WebGLStencilOps: GLenum[] = [\r\n    0x0000, // WebGLRenderingContext.ZERO,\r\n    0x1E00, // WebGLRenderingContext.KEEP,\r\n    0x1E01, // WebGLRenderingContext.REPLACE,\r\n    0x1E02, // WebGLRenderingContext.INCR,\r\n    0x1E03, // WebGLRenderingContext.DECR,\r\n    0x150A, // WebGLRenderingContext.INVERT,\r\n    0x8507, // WebGLRenderingContext.INCR_WRAP,\r\n    0x8508, // WebGLRenderingContext.DECR_WRAP,\r\n];\r\n\r\nconst WebGLBlendOps: GLenum[] = [\r\n    0x8006, // WebGLRenderingContext.FUNC_ADD,\r\n    0x800A, // WebGLRenderingContext.FUNC_SUBTRACT,\r\n    0x800B, // WebGLRenderingContext.FUNC_REVERSE_SUBTRACT,\r\n    0x8007, // WebGLRenderingContext.MIN,\r\n    0x8008, // WebGLRenderingContext.MAX,\r\n];\r\n\r\nconst WebGLBlendFactors: GLenum[] = [\r\n    0x0000, // WebGLRenderingContext.ZERO,\r\n    0x0001, // WebGLRenderingContext.ONE,\r\n    0x0302, // WebGLRenderingContext.SRC_ALPHA,\r\n    0x0304, // WebGLRenderingContext.DST_ALPHA,\r\n    0x0303, // WebGLRenderingContext.ONE_MINUS_SRC_ALPHA,\r\n    0x0305, // WebGLRenderingContext.ONE_MINUS_DST_ALPHA,\r\n    0x0300, // WebGLRenderingContext.SRC_COLOR,\r\n    0x0306, // WebGLRenderingContext.DST_COLOR,\r\n    0x0301, // WebGLRenderingContext.ONE_MINUS_SRC_COLOR,\r\n    0x0307, // WebGLRenderingContext.ONE_MINUS_DST_COLOR,\r\n    0x0308, // WebGLRenderingContext.SRC_ALPHA_SATURATE,\r\n    0x8001, // WebGLRenderingContext.CONSTANT_COLOR,\r\n    0x8002, // WebGLRenderingContext.ONE_MINUS_CONSTANT_COLOR,\r\n    0x8003, // WebGLRenderingContext.CONSTANT_ALPHA,\r\n    0x8004, // WebGLRenderingContext.ONE_MINUS_CONSTANT_ALPHA,\r\n];\r\n\r\nexport function WebGLCmdFuncCreateBuffer (device: WebGLDevice, gpuBuffer: IWebGLGPUBuffer): void {\r\n    const { gl, stateCache } = device;\r\n    const glUsage: GLenum = gpuBuffer.memUsage & MemoryUsageBit.HOST ? WebGLConstants.DYNAMIC_DRAW : WebGLConstants.STATIC_DRAW;\r\n\r\n    if (gpuBuffer.usage & BufferUsageBit.VERTEX) {\r\n        gpuBuffer.glTarget = WebGLConstants.ARRAY_BUFFER;\r\n        const glBuffer = gl.createBuffer();\r\n        if (glBuffer) {\r\n            gpuBuffer.glBuffer = glBuffer;\r\n            if (gpuBuffer.size > 0) {\r\n                if (device.extensions.useVAO) {\r\n                    if (stateCache.glVAO) {\r\n                        device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                        stateCache.glVAO = null;\r\n                    }\r\n                }\r\n                gfxStateCache.gpuInputAssembler = null;\r\n\r\n                if (stateCache.glArrayBuffer !== gpuBuffer.glBuffer) {\r\n                    gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n                    stateCache.glArrayBuffer = gpuBuffer.glBuffer;\r\n                }\r\n\r\n                gl.bufferData(WebGLConstants.ARRAY_BUFFER, gpuBuffer.size, glUsage);\r\n                gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, null);\r\n                stateCache.glArrayBuffer = null;\r\n            }\r\n        }\r\n    } else if (gpuBuffer.usage & BufferUsageBit.INDEX) {\r\n        gpuBuffer.glTarget = WebGLConstants.ELEMENT_ARRAY_BUFFER;\r\n        const glBuffer = gl.createBuffer();\r\n\r\n        if (glBuffer) {\r\n            gpuBuffer.glBuffer = glBuffer;\r\n            if (gpuBuffer.size > 0) {\r\n                if (device.extensions.useVAO) {\r\n                    if (stateCache.glVAO) {\r\n                        device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                        stateCache.glVAO = null;\r\n                    }\r\n                }\r\n                gfxStateCache.gpuInputAssembler = null;\r\n\r\n                if (stateCache.glElementArrayBuffer !== gpuBuffer.glBuffer) {\r\n                    gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n                    stateCache.glElementArrayBuffer = gpuBuffer.glBuffer;\r\n                }\r\n\r\n                gl.bufferData(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.size, glUsage);\r\n                gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, null);\r\n                stateCache.glElementArrayBuffer = null;\r\n            }\r\n        }\r\n    } else if (gpuBuffer.usage & BufferUsageBit.UNIFORM) {\r\n        gpuBuffer.glTarget = WebGLConstants.NONE;\r\n\r\n        if (gpuBuffer.buffer) {\r\n            gpuBuffer.vf32 = new Float32Array(gpuBuffer.buffer.buffer);\r\n        }\r\n    } else if (gpuBuffer.usage & BufferUsageBit.INDIRECT) {\r\n        gpuBuffer.glTarget = WebGLConstants.NONE;\r\n    } else if (gpuBuffer.usage & BufferUsageBit.TRANSFER_DST) {\r\n        gpuBuffer.glTarget = WebGLConstants.NONE;\r\n    } else if (gpuBuffer.usage & BufferUsageBit.TRANSFER_SRC) {\r\n        gpuBuffer.glTarget = WebGLConstants.NONE;\r\n    } else {\r\n        errorID(16315);\r\n        gpuBuffer.glTarget = WebGLConstants.NONE;\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncDestroyBuffer (device: WebGLDevice, gpuBuffer: IWebGLGPUBuffer): void {\r\n    const { gl } = device;\r\n    const cache = device.stateCache;\r\n\r\n    if (gpuBuffer.glBuffer) {\r\n        // Firefox 75+ implicitly unbind whatever buffer there was on the slot sometimes\r\n        // can be reproduced in the static batching scene at https://github.com/cocos-creator/test-cases-3d\r\n        switch (gpuBuffer.glTarget) {\r\n        case WebGLConstants.ARRAY_BUFFER:\r\n            if (device.extensions.useVAO) {\r\n                if (cache.glVAO) {\r\n                    device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                    cache.glVAO = null;\r\n                }\r\n            }\r\n            gfxStateCache.gpuInputAssembler = null;\r\n\r\n            gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, null);\r\n            cache.glArrayBuffer = null;\r\n            break;\r\n        case WebGLConstants.ELEMENT_ARRAY_BUFFER:\r\n            if (device.extensions.useVAO) {\r\n                if (cache.glVAO) {\r\n                    device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                    cache.glVAO = null;\r\n                }\r\n            }\r\n            gfxStateCache.gpuInputAssembler = null;\r\n\r\n            gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, null);\r\n            cache.glElementArrayBuffer = null;\r\n            break;\r\n        default:\r\n        }\r\n\r\n        gl.deleteBuffer(gpuBuffer.glBuffer);\r\n        gpuBuffer.glBuffer = null;\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncResizeBuffer (device: WebGLDevice, gpuBuffer: IWebGLGPUBuffer): void {\r\n    const { gl, stateCache } = device;\r\n    const glUsage: GLenum = gpuBuffer.memUsage & MemoryUsageBit.HOST ? WebGLConstants.DYNAMIC_DRAW : WebGLConstants.STATIC_DRAW;\r\n\r\n    if (gpuBuffer.usage & BufferUsageBit.VERTEX) {\r\n        if (device.extensions.useVAO) {\r\n            if (stateCache.glVAO) {\r\n                device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                stateCache.glVAO = null;\r\n            }\r\n        }\r\n        gfxStateCache.gpuInputAssembler = null;\r\n\r\n        if (stateCache.glArrayBuffer !== gpuBuffer.glBuffer) {\r\n            gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n        }\r\n\r\n        if (gpuBuffer.buffer) {\r\n            gl.bufferData(WebGLConstants.ARRAY_BUFFER, gpuBuffer.buffer, glUsage);\r\n        } else {\r\n            gl.bufferData(WebGLConstants.ARRAY_BUFFER, gpuBuffer.size, glUsage);\r\n        }\r\n        gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, null);\r\n        stateCache.glArrayBuffer = null;\r\n    } else if (gpuBuffer.usage & BufferUsageBit.INDEX) {\r\n        if (device.extensions.useVAO) {\r\n            if (stateCache.glVAO) {\r\n                device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                stateCache.glVAO = null;\r\n            }\r\n        }\r\n        gfxStateCache.gpuInputAssembler = null;\r\n\r\n        if (stateCache.glElementArrayBuffer !== gpuBuffer.glBuffer) {\r\n            gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n        }\r\n\r\n        if (gpuBuffer.buffer) {\r\n            gl.bufferData(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.buffer, glUsage);\r\n        } else {\r\n            gl.bufferData(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.size, glUsage);\r\n        }\r\n        gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, null);\r\n        stateCache.glElementArrayBuffer = null;\r\n    } else if (gpuBuffer.usage & BufferUsageBit.UNIFORM) {\r\n        if (gpuBuffer.buffer) {\r\n            gpuBuffer.vf32 = new Float32Array(gpuBuffer.buffer.buffer);\r\n        }\r\n    } else if ((gpuBuffer.usage & BufferUsageBit.INDIRECT)\r\n            || (gpuBuffer.usage & BufferUsageBit.TRANSFER_DST)\r\n            || (gpuBuffer.usage & BufferUsageBit.TRANSFER_SRC)) {\r\n        gpuBuffer.glTarget = WebGLConstants.NONE;\r\n    } else {\r\n        errorID(16315);\r\n        gpuBuffer.glTarget = WebGLConstants.NONE;\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncUpdateBuffer (\r\n    device: WebGLDevice,\r\n    gpuBuffer: IWebGLGPUBuffer,\r\n    buffer: Readonly<BufferSource>,\r\n    offset: number,\r\n    size: number,\r\n): void {\r\n    if (gpuBuffer.usage & BufferUsageBit.UNIFORM) {\r\n        if (ArrayBuffer.isView(buffer)) {\r\n            gpuBuffer.vf32!.set(buffer as Float32Array, offset / Float32Array.BYTES_PER_ELEMENT);\r\n        } else {\r\n            gpuBuffer.vf32!.set(new Float32Array(buffer as ArrayBuffer), offset / Float32Array.BYTES_PER_ELEMENT);\r\n        }\r\n    } else if (gpuBuffer.usage & BufferUsageBit.INDIRECT) {\r\n        gpuBuffer.indirects.clearDraws();\r\n        const drawInfos = (buffer as IndirectBuffer).drawInfos;\r\n        for (let i = 0; i < drawInfos.length; ++i) {\r\n            gpuBuffer.indirects.setDrawInfo(offset + i, drawInfos[i]);\r\n        }\r\n    } else {\r\n        const buff = buffer as ArrayBuffer;\r\n        const { gl, stateCache } = device;\r\n\r\n        switch (gpuBuffer.glTarget) {\r\n        case WebGLConstants.ARRAY_BUFFER: {\r\n            if (device.extensions.useVAO) {\r\n                if (stateCache.glVAO) {\r\n                    device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                    stateCache.glVAO = null;\r\n                }\r\n            }\r\n            gfxStateCache.gpuInputAssembler = null;\r\n\r\n            if (stateCache.glArrayBuffer !== gpuBuffer.glBuffer) {\r\n                gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n                stateCache.glArrayBuffer = gpuBuffer.glBuffer;\r\n            }\r\n            break;\r\n        }\r\n        case WebGLConstants.ELEMENT_ARRAY_BUFFER: {\r\n            if (device.extensions.useVAO) {\r\n                if (stateCache.glVAO) {\r\n                    device.extensions.OES_vertex_array_object!.bindVertexArrayOES(null);\r\n                    stateCache.glVAO = null;\r\n                }\r\n            }\r\n            gfxStateCache.gpuInputAssembler = null;\r\n\r\n            if (stateCache.glElementArrayBuffer !== gpuBuffer.glBuffer) {\r\n                gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n                stateCache.glElementArrayBuffer = gpuBuffer.glBuffer;\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            errorID(16316);\r\n            return;\r\n        }\r\n        }\r\n\r\n        if (systemInfo.os === OS.IOS  && (gpuBuffer.memUsage & MemoryUsageBit.HOST) && offset === 0 && size === buff.byteLength) {\r\n            // Fix performance issue on iOS.\r\n            // TODO(zhouzhenglong): glBufferSubData is faster than glBufferData in most cases.\r\n            // We should use multiple buffers to avoid stall (cpu write conflicts with gpu read).\r\n            // Before that, we will use glBufferData instead of glBufferSubData.\r\n            gl.bufferData(gpuBuffer.glTarget, buff, gl.DYNAMIC_DRAW);\r\n        } else if (size === buff.byteLength) {\r\n            gl.bufferSubData(gpuBuffer.glTarget, offset, buff);\r\n        } else {\r\n            gl.bufferSubData(gpuBuffer.glTarget, offset, buff.slice(0, size));\r\n        }\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncCreateTexture (device: WebGLDevice, gpuTexture: IWebGLGPUTexture): void {\r\n    const { gl, stateCache } = device;\r\n\r\n    gpuTexture.glFormat = gpuTexture.glInternalFmt = GFXFormatToWebGLFormat(gpuTexture.format, gl);\r\n    gpuTexture.glType = GFXFormatToWebGLType(gpuTexture.format, gl);\r\n\r\n    let w = gpuTexture.width;\r\n    let h = gpuTexture.height;\r\n\r\n    switch (gpuTexture.type) {\r\n    case TextureType.TEX2D: {\r\n        gpuTexture.glTarget = WebGLConstants.TEXTURE_2D;\r\n\r\n        const maxSize = max(w, h);\r\n        if (maxSize > device.capabilities.maxTextureSize) {\r\n            errorID(9100, maxSize, device.capabilities.maxTextureSize);\r\n        }\r\n        // TODO: The system bug in the TikTok mini-game; once they fix it, a rollback will be necessary.\r\n        if (!device.textureExclusive[gpuTexture.format]\r\n            && ((!device.extensions.WEBGL_depth_texture || BYTEDANCE) && FormatInfos[gpuTexture.format].hasDepth)) {\r\n            gpuTexture.glInternalFmt = GFXFormatToWebGLInternalFormat(gpuTexture.format, gl);\r\n            gpuTexture.glRenderbuffer = gl.createRenderbuffer();\r\n            if (gpuTexture.size > 0) {\r\n                if (stateCache.glRenderbuffer !== gpuTexture.glRenderbuffer) {\r\n                    gl.bindRenderbuffer(WebGLConstants.RENDERBUFFER, gpuTexture.glRenderbuffer);\r\n                    stateCache.glRenderbuffer = gpuTexture.glRenderbuffer;\r\n                }\r\n                gl.renderbufferStorage(WebGLConstants.RENDERBUFFER, gpuTexture.glInternalFmt, w, h);\r\n            }\r\n        } else {\r\n            gpuTexture.glTexture = gl.createTexture();\r\n            if (gpuTexture.size > 0) {\r\n                const glTexUnit = stateCache.glTexUnits[stateCache.texUnit];\r\n\r\n                if (glTexUnit.glTexture !== gpuTexture.glTexture) {\r\n                    gl.bindTexture(WebGLConstants.TEXTURE_2D, gpuTexture.glTexture);\r\n                    glTexUnit.glTexture = gpuTexture.glTexture;\r\n                }\r\n\r\n                if (FormatInfos[gpuTexture.format].isCompressed) {\r\n                    for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                        const imgSize = FormatSize(gpuTexture.format, w, h, 1);\r\n                        const view: Uint8Array = new Uint8Array(imgSize);\r\n                        gl.compressedTexImage2D(WebGLConstants.TEXTURE_2D, i, gpuTexture.glInternalFmt, w, h, 0, view);\r\n                        w = max(1, w >> 1);\r\n                        h = max(1, h >> 1);\r\n                    }\r\n                } else {\r\n                    for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                        gl.texImage2D(WebGLConstants.TEXTURE_2D, i, gpuTexture.glInternalFmt, w, h, 0, gpuTexture.glFormat, gpuTexture.glType, null);\r\n                        w = max(1, w >> 1);\r\n                        h = max(1, h >> 1);\r\n                    }\r\n                }\r\n\r\n                if (gpuTexture.isPowerOf2) {\r\n                    gpuTexture.glWrapS = WebGLConstants.REPEAT;\r\n                    gpuTexture.glWrapT = WebGLConstants.REPEAT;\r\n                } else {\r\n                    gpuTexture.glWrapS = WebGLConstants.CLAMP_TO_EDGE;\r\n                    gpuTexture.glWrapT = WebGLConstants.CLAMP_TO_EDGE;\r\n                }\r\n                gpuTexture.glMinFilter = WebGLConstants.LINEAR;\r\n                gpuTexture.glMagFilter = WebGLConstants.LINEAR;\r\n\r\n                gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_WRAP_S, gpuTexture.glWrapS);\r\n                gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_WRAP_T, gpuTexture.glWrapT);\r\n                gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_MIN_FILTER, gpuTexture.glMinFilter);\r\n                gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_MAG_FILTER, gpuTexture.glMagFilter);\r\n            }\r\n        }\r\n\r\n        break;\r\n    }\r\n    case TextureType.CUBE: {\r\n        gpuTexture.glTarget = WebGLConstants.TEXTURE_CUBE_MAP;\r\n\r\n        const maxSize = max(w, h);\r\n        if (maxSize > device.capabilities.maxCubeMapTextureSize) {\r\n            errorID(9100, maxSize, device.capabilities.maxTextureSize);\r\n        }\r\n\r\n        gpuTexture.glTexture = gl.createTexture();\r\n        if (gpuTexture.size > 0) {\r\n            const glTexUnit = stateCache.glTexUnits[stateCache.texUnit];\r\n\r\n            if (glTexUnit.glTexture !== gpuTexture.glTexture) {\r\n                gl.bindTexture(WebGLConstants.TEXTURE_CUBE_MAP, gpuTexture.glTexture);\r\n                glTexUnit.glTexture = gpuTexture.glTexture;\r\n            }\r\n\r\n            if (FormatInfos[gpuTexture.format].isCompressed) {\r\n                for (let f = 0; f < 6; ++f) {\r\n                    w = gpuTexture.width;\r\n                    h = gpuTexture.height;\r\n                    for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                        const imgSize = FormatSize(gpuTexture.format, w, h, 1);\r\n                        const view: Uint8Array = new Uint8Array(imgSize);\r\n                        gl.compressedTexImage2D(WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f, i, gpuTexture.glInternalFmt, w, h, 0, view);\r\n                        w = max(1, w >> 1);\r\n                        h = max(1, h >> 1);\r\n                    }\r\n                }\r\n            } else {\r\n                for (let f = 0; f < 6; ++f) {\r\n                    w = gpuTexture.width;\r\n                    h = gpuTexture.height;\r\n                    for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                        gl.texImage2D(\r\n                            WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f,\r\n                            i,\r\n                            gpuTexture.glInternalFmt,\r\n                            w,\r\n                            h,\r\n                            0,\r\n                            gpuTexture.glFormat,\r\n                            gpuTexture.glType,\r\n                            null,\r\n                        );\r\n                        w = max(1, w >> 1);\r\n                        h = max(1, h >> 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (gpuTexture.isPowerOf2) {\r\n                gpuTexture.glWrapS = WebGLConstants.REPEAT;\r\n                gpuTexture.glWrapT = WebGLConstants.REPEAT;\r\n            } else {\r\n                gpuTexture.glWrapS = WebGLConstants.CLAMP_TO_EDGE;\r\n                gpuTexture.glWrapT = WebGLConstants.CLAMP_TO_EDGE;\r\n            }\r\n            gpuTexture.glMinFilter = WebGLConstants.LINEAR;\r\n            gpuTexture.glMagFilter = WebGLConstants.LINEAR;\r\n\r\n            gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_WRAP_S, gpuTexture.glWrapS);\r\n            gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_WRAP_T, gpuTexture.glWrapT);\r\n            gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_MIN_FILTER, gpuTexture.glMinFilter);\r\n            gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_MAG_FILTER, gpuTexture.glMagFilter);\r\n        }\r\n\r\n        break;\r\n    }\r\n    default: {\r\n        errorID(16317);\r\n        gpuTexture.type = TextureType.TEX2D;\r\n        gpuTexture.glTarget = WebGLConstants.TEXTURE_2D;\r\n    }\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncDestroyTexture (device: WebGLDevice, gpuTexture: IWebGLGPUTexture): void {\r\n    const { gl, stateCache } = device;\r\n    if (gpuTexture.glTexture) {\r\n        const glTexUnits = stateCache.glTexUnits;\r\n        let texUnit = stateCache.texUnit;\r\n        gl.deleteTexture(gpuTexture.glTexture);\r\n        for (let i = 0; i < glTexUnits.length; i++) {\r\n            if (glTexUnits[i].glTexture === gpuTexture.glTexture) {\r\n                gl.activeTexture(WebGLConstants.TEXTURE0 + i);\r\n                texUnit = i;\r\n                gl.bindTexture(gpuTexture.glTarget, null);\r\n                glTexUnits[i].glTexture = null;\r\n            }\r\n        }\r\n        stateCache.texUnit = texUnit;\r\n        gpuTexture.glTexture = null;\r\n    }\r\n\r\n    if (gpuTexture.glRenderbuffer) {\r\n        const glRenderbuffer = stateCache.glRenderbuffer;\r\n        gl.deleteRenderbuffer(gpuTexture.glRenderbuffer);\r\n        if (glRenderbuffer === gpuTexture.glRenderbuffer) {\r\n            gl.bindRenderbuffer(WebGLConstants.RENDERBUFFER, null);\r\n            stateCache.glRenderbuffer = null;\r\n        }\r\n        gpuTexture.glRenderbuffer = null;\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncResizeTexture (device: WebGLDevice, gpuTexture: IWebGLGPUTexture): void {\r\n    if (!gpuTexture.size) return;\r\n\r\n    const { gl, stateCache } = device;\r\n\r\n    let w = gpuTexture.width;\r\n    let h = gpuTexture.height;\r\n\r\n    switch (gpuTexture.type) {\r\n    case TextureType.TEX2D: {\r\n        gpuTexture.glTarget = WebGLConstants.TEXTURE_2D;\r\n\r\n        const maxSize = max(w, h);\r\n        if (maxSize > device.capabilities.maxTextureSize) {\r\n            errorID(9100, maxSize, device.capabilities.maxTextureSize);\r\n        }\r\n\r\n        if (gpuTexture.glRenderbuffer) {\r\n            if (stateCache.glRenderbuffer !== gpuTexture.glRenderbuffer) {\r\n                gl.bindRenderbuffer(WebGLConstants.RENDERBUFFER, gpuTexture.glRenderbuffer);\r\n                stateCache.glRenderbuffer = gpuTexture.glRenderbuffer;\r\n            }\r\n            gl.renderbufferStorage(WebGLConstants.RENDERBUFFER, gpuTexture.glInternalFmt, w, h);\r\n        } else if (gpuTexture.glTexture) {\r\n            const glTexUnit = stateCache.glTexUnits[stateCache.texUnit];\r\n\r\n            if (glTexUnit.glTexture !== gpuTexture.glTexture) {\r\n                gl.bindTexture(WebGLConstants.TEXTURE_2D, gpuTexture.glTexture);\r\n                glTexUnit.glTexture = gpuTexture.glTexture;\r\n            }\r\n\r\n            if (FormatInfos[gpuTexture.format].isCompressed) {\r\n                for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                    const imgSize = FormatSize(gpuTexture.format, w, h, 1);\r\n                    const view: Uint8Array = new Uint8Array(imgSize);\r\n                    gl.compressedTexImage2D(WebGLConstants.TEXTURE_2D, i, gpuTexture.glInternalFmt, w, h, 0, view);\r\n                    w = max(1, w >> 1);\r\n                    h = max(1, h >> 1);\r\n                }\r\n            } else {\r\n                for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                    gl.texImage2D(WebGLConstants.TEXTURE_2D, i, gpuTexture.glInternalFmt, w, h, 0, gpuTexture.glFormat, gpuTexture.glType, null);\r\n                    w = max(1, w >> 1);\r\n                    h = max(1, h >> 1);\r\n                }\r\n            }\r\n        }\r\n        break;\r\n    }\r\n    case TextureType.CUBE: {\r\n        gpuTexture.glTarget = WebGLConstants.TEXTURE_CUBE_MAP;\r\n\r\n        const maxSize = max(w, h);\r\n        if (maxSize > device.capabilities.maxCubeMapTextureSize) {\r\n            errorID(9100, maxSize, device.capabilities.maxTextureSize);\r\n        }\r\n\r\n        const glTexUnit = stateCache.glTexUnits[stateCache.texUnit];\r\n\r\n        if (glTexUnit.glTexture !== gpuTexture.glTexture) {\r\n            gl.bindTexture(WebGLConstants.TEXTURE_CUBE_MAP, gpuTexture.glTexture);\r\n            glTexUnit.glTexture = gpuTexture.glTexture;\r\n        }\r\n\r\n        if (FormatInfos[gpuTexture.format].isCompressed) {\r\n            for (let f = 0; f < 6; ++f) {\r\n                w = gpuTexture.width;\r\n                h = gpuTexture.height;\r\n                for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                    const imgSize = FormatSize(gpuTexture.format, w, h, 1);\r\n                    const view: Uint8Array = new Uint8Array(imgSize);\r\n                    gl.compressedTexImage2D(WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f, i, gpuTexture.glInternalFmt, w, h, 0, view);\r\n                    w = max(1, w >> 1);\r\n                    h = max(1, h >> 1);\r\n                }\r\n            }\r\n        } else {\r\n            for (let f = 0; f < 6; ++f) {\r\n                w = gpuTexture.width;\r\n                h = gpuTexture.height;\r\n                for (let i = 0; i < gpuTexture.mipLevel; ++i) {\r\n                    gl.texImage2D(\r\n                        WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f,\r\n                        i,\r\n                        gpuTexture.glInternalFmt,\r\n                        w,\r\n                        h,\r\n                        0,\r\n                        gpuTexture.glFormat,\r\n                        gpuTexture.glType,\r\n                        null,\r\n                    );\r\n                    w = max(1, w >> 1);\r\n                    h = max(1, h >> 1);\r\n                }\r\n            }\r\n        }\r\n        break;\r\n    }\r\n    default: {\r\n        errorID(16317);\r\n        gpuTexture.type = TextureType.TEX2D;\r\n        gpuTexture.glTarget = WebGLConstants.TEXTURE_2D;\r\n    }\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncCreateFramebuffer (device: WebGLDevice, gpuFramebuffer: IWebGLGPUFramebuffer): void {\r\n    for (let i = 0; i < gpuFramebuffer.gpuColorTextures.length; ++i) {\r\n        const tex = gpuFramebuffer.gpuColorTextures[i];\r\n        if (tex.isSwapchainTexture) {\r\n            gpuFramebuffer.isOffscreen = false;\r\n            return;\r\n        }\r\n    }\r\n\r\n    const { gl, stateCache } = device;\r\n    const attachments: GLenum[] = [];\r\n\r\n    const glFramebuffer = gl.createFramebuffer();\r\n    if (glFramebuffer) {\r\n        gpuFramebuffer.glFramebuffer = glFramebuffer;\r\n\r\n        if (stateCache.glFramebuffer !== gpuFramebuffer.glFramebuffer) {\r\n            gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, gpuFramebuffer.glFramebuffer);\r\n        }\r\n\r\n        for (let i = 0; i < gpuFramebuffer.gpuColorTextures.length; ++i) {\r\n            const gpuTexture = gpuFramebuffer.gpuColorTextures[i];\r\n            if (gpuTexture) {\r\n                if (gpuTexture.glTexture) {\r\n                    gl.framebufferTexture2D(\r\n                        WebGLConstants.FRAMEBUFFER,\r\n                        WebGLConstants.COLOR_ATTACHMENT0 + i,\r\n                        gpuTexture.glTarget,\r\n                        gpuTexture.glTexture,\r\n                        0,\r\n                    ); // level must be 0\r\n                } else {\r\n                    gl.framebufferRenderbuffer(\r\n                        WebGLConstants.FRAMEBUFFER,\r\n                        WebGLConstants.COLOR_ATTACHMENT0 + i,\r\n                        WebGLConstants.RENDERBUFFER,\r\n                        gpuTexture.glRenderbuffer,\r\n                    );\r\n                }\r\n\r\n                attachments.push(WebGLConstants.COLOR_ATTACHMENT0 + i);\r\n                gpuFramebuffer.width = min(gpuFramebuffer.width, gpuTexture.width);\r\n                gpuFramebuffer.height = min(gpuFramebuffer.height, gpuTexture.height);\r\n            }\r\n        }\r\n\r\n        const dst = gpuFramebuffer.gpuDepthStencilTexture;\r\n        if (dst) {\r\n            const glAttachment = FormatInfos[dst.format].hasStencil ? WebGLConstants.DEPTH_STENCIL_ATTACHMENT : WebGLConstants.DEPTH_ATTACHMENT;\r\n            if (dst.glTexture) {\r\n                gl.framebufferTexture2D(\r\n                    WebGLConstants.FRAMEBUFFER,\r\n                    glAttachment,\r\n                    dst.glTarget,\r\n                    dst.glTexture,\r\n                    0,\r\n                ); // level must be 0\r\n            } else {\r\n                gl.framebufferRenderbuffer(\r\n                    WebGLConstants.FRAMEBUFFER,\r\n                    glAttachment,\r\n                    WebGLConstants.RENDERBUFFER,\r\n                    dst.glRenderbuffer,\r\n                );\r\n            }\r\n            gpuFramebuffer.width = min(gpuFramebuffer.width, dst.width);\r\n            gpuFramebuffer.height = min(gpuFramebuffer.height, dst.height);\r\n        }\r\n\r\n        if (device.extensions.WEBGL_draw_buffers) {\r\n            device.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(attachments);\r\n        }\r\n\r\n        const status = gl.checkFramebufferStatus(WebGLConstants.FRAMEBUFFER);\r\n        if (status !== WebGLConstants.FRAMEBUFFER_COMPLETE) {\r\n            switch (status) {\r\n            case WebGLConstants.FRAMEBUFFER_INCOMPLETE_ATTACHMENT: {\r\n                errorID(16318);\r\n                break;\r\n            }\r\n            case WebGLConstants.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT: {\r\n                errorID(16319);\r\n                break;\r\n            }\r\n            case WebGLConstants.FRAMEBUFFER_INCOMPLETE_DIMENSIONS: {\r\n                errorID(16320);\r\n                break;\r\n            }\r\n            case WebGLConstants.FRAMEBUFFER_UNSUPPORTED: {\r\n                errorID(16321);\r\n                break;\r\n            }\r\n            default:\r\n            }\r\n        }\r\n\r\n        if (stateCache.glFramebuffer !== gpuFramebuffer.glFramebuffer) {\r\n            gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, stateCache.glFramebuffer);\r\n        }\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncDestroyFramebuffer (device: WebGLDevice, gpuFramebuffer: IWebGLGPUFramebuffer): void {\r\n    const { gl, stateCache } = device;\r\n    if (gpuFramebuffer.glFramebuffer) {\r\n        gl.deleteFramebuffer(gpuFramebuffer.glFramebuffer);\r\n        if (stateCache.glFramebuffer === gpuFramebuffer.glFramebuffer) {\r\n            gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, null);\r\n            stateCache.glFramebuffer = null;\r\n        }\r\n        gpuFramebuffer.glFramebuffer = null;\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncCreateShader (device: WebGLDevice, gpuShader: IWebGLGPUShader): void {\r\n    const { gl, stateCache } = device;\r\n\r\n    for (let k = 0; k < gpuShader.gpuStages.length; k++) {\r\n        const gpuStage = gpuShader.gpuStages[k];\r\n\r\n        let glShaderType: GLenum = 0;\r\n        let shaderTypeStr = '';\r\n        let lineNumber = 1;\r\n\r\n        switch (gpuStage.type) {\r\n        case ShaderStageFlagBit.VERTEX: {\r\n            shaderTypeStr = 'VertexShader';\r\n            glShaderType = WebGLConstants.VERTEX_SHADER;\r\n            break;\r\n        }\r\n        case ShaderStageFlagBit.FRAGMENT: {\r\n            shaderTypeStr = 'FragmentShader';\r\n            glShaderType = WebGLConstants.FRAGMENT_SHADER;\r\n            break;\r\n        }\r\n        default: {\r\n            errorID(16322);\r\n            return;\r\n        }\r\n        }\r\n\r\n        const glShader = gl.createShader(glShaderType);\r\n        if (glShader) {\r\n            gpuStage.glShader = glShader;\r\n            gl.shaderSource(gpuStage.glShader, gpuStage.source);\r\n            gl.compileShader(gpuStage.glShader);\r\n\r\n            if (!gl.getShaderParameter(gpuStage.glShader, WebGLConstants.COMPILE_STATUS)) {\r\n                errorID(16323, shaderTypeStr, gpuShader.name);\r\n                errorID(16324, gpuStage.source.replace(/^|\\n/g, (): string => `\\n${lineNumber++} `));\r\n                error(gl.getShaderInfoLog(gpuStage.glShader));\r\n\r\n                for (let l = 0; l < gpuShader.gpuStages.length; l++) {\r\n                    const stage = gpuShader.gpuStages[k];\r\n                    if (stage.glShader) {\r\n                        gl.deleteShader(stage.glShader);\r\n                        stage.glShader = null;\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    const glProgram = gl.createProgram();\r\n    if (!glProgram) {\r\n        return;\r\n    }\r\n\r\n    gpuShader.glProgram = glProgram;\r\n\r\n    // link program\r\n    for (let k = 0; k < gpuShader.gpuStages.length; k++) {\r\n        const gpuStage = gpuShader.gpuStages[k];\r\n        gl.attachShader(gpuShader.glProgram, gpuStage.glShader!);\r\n    }\r\n\r\n    gl.linkProgram(gpuShader.glProgram);\r\n\r\n    // detach & delete immediately\r\n    if (device.extensions.destroyShadersImmediately) {\r\n        for (let k = 0; k < gpuShader.gpuStages.length; k++) {\r\n            const gpuStage = gpuShader.gpuStages[k];\r\n            if (gpuStage.glShader) {\r\n                gl.detachShader(gpuShader.glProgram, gpuStage.glShader);\r\n                gl.deleteShader(gpuStage.glShader);\r\n                gpuStage.glShader = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (gl.getProgramParameter(gpuShader.glProgram, WebGLConstants.LINK_STATUS)) {\r\n        debugID(16325, gpuShader.name);\r\n    } else {\r\n        errorID(16326, gpuShader.name);\r\n        error(gl.getProgramInfoLog(gpuShader.glProgram));\r\n        return;\r\n    }\r\n\r\n    // parse inputs\r\n    const activeAttribCount: number = gl.getProgramParameter(gpuShader.glProgram, WebGLConstants.ACTIVE_ATTRIBUTES);\r\n    gpuShader.glInputs = new Array<IWebGLGPUInput>(activeAttribCount);\r\n\r\n    for (let i = 0; i < activeAttribCount; ++i) {\r\n        const attribInfo = gl.getActiveAttrib(gpuShader.glProgram, i);\r\n        if (attribInfo) {\r\n            const { type: attribType, name: attribName, size: attribSize } = attribInfo;\r\n            let varName: string;\r\n            const nameOffset = attribName.indexOf('[');\r\n            if (nameOffset !== -1) {\r\n                varName = attribName.substring(0, nameOffset);\r\n            } else {\r\n                varName = attribName;\r\n            }\r\n\r\n            const glLoc = gl.getAttribLocation(gpuShader.glProgram, varName);\r\n            const gfxType = WebGLTypeToGFXType(attribType, gl);\r\n            const stride = WebGLGetTypeSize(attribType, gl);\r\n\r\n            gpuShader.glInputs[i] = {\r\n                binding: glLoc,\r\n                name: varName,\r\n                type: gfxType,\r\n                stride,\r\n                count: attribSize,\r\n                size: stride * attribSize,\r\n\r\n                glType: attribType,\r\n                glLoc,\r\n            };\r\n        }\r\n    }\r\n\r\n    // create uniform blocks\r\n    if (gpuShader.blocks.length > 0) {\r\n        gpuShader.glBlocks = new Array<IWebGLGPUUniformBlock>(gpuShader.blocks.length);\r\n        for (let i = 0; i < gpuShader.blocks.length; ++i) {\r\n            const block = gpuShader.blocks[i];\r\n\r\n            const glBlock: IWebGLGPUUniformBlock = {\r\n                set: block.set,\r\n                binding: block.binding,\r\n                name: block.name,\r\n                size: 0,\r\n                glUniforms: new Array<IWebGLGPUUniform>(block.members.length),\r\n                glActiveUniforms: [],\r\n            };\r\n\r\n            gpuShader.glBlocks[i] = glBlock;\r\n\r\n            for (let u = 0; u < block.members.length; ++u) {\r\n                const uniform = block.members[u];\r\n                const glType = GFXTypeToWebGLType(uniform.type, gl);\r\n                const stride = WebGLGetTypeSize(glType, gl);\r\n                const size = stride * uniform.count;\r\n\r\n                glBlock.glUniforms[u] = {\r\n                    binding: -1,\r\n                    name: uniform.name,\r\n                    type: uniform.type,\r\n                    stride,\r\n                    count: uniform.count,\r\n                    size,\r\n                    offset: 0,\r\n\r\n                    glType,\r\n                    glLoc: null!,\r\n                    array: null!,\r\n                };\r\n            }\r\n        }\r\n    }\r\n\r\n    // WebGL doesn't support Framebuffer Fetch\r\n    for (let i = 0; i < gpuShader.subpassInputs.length; ++i) {\r\n        const subpassInput = gpuShader.subpassInputs[i];\r\n        gpuShader.samplerTextures.push(\r\n            new UniformSamplerTexture(subpassInput.set, subpassInput.binding, subpassInput.name, Type.SAMPLER2D, subpassInput.count),\r\n        );\r\n    }\r\n\r\n    // create uniform sampler textures\r\n    if (gpuShader.samplerTextures.length > 0) {\r\n        gpuShader.glSamplerTextures = new Array<IWebGLGPUUniformSamplerTexture>(gpuShader.samplerTextures.length);\r\n\r\n        for (let i = 0; i < gpuShader.samplerTextures.length; ++i) {\r\n            const sampler = gpuShader.samplerTextures[i];\r\n            gpuShader.glSamplerTextures[i] = {\r\n                set: sampler.set,\r\n                binding: sampler.binding,\r\n                name: sampler.name,\r\n                type: sampler.type,\r\n                count: sampler.count,\r\n                units: [],\r\n                glUnits: null!,\r\n                glType: GFXTypeToWebGLType(sampler.type, gl),\r\n                glLoc: null!,\r\n            };\r\n        }\r\n    }\r\n\r\n    // parse uniforms\r\n    const activeUniformCount = gl.getProgramParameter(gpuShader.glProgram, WebGLConstants.ACTIVE_UNIFORMS);\r\n\r\n    for (let i = 0; i < activeUniformCount; ++i) {\r\n        const uniformInfo = gl.getActiveUniform(gpuShader.glProgram, i);\r\n        if (uniformInfo) {\r\n            const isSampler = (uniformInfo.type === WebGLConstants.SAMPLER_2D)\r\n                || (uniformInfo.type === WebGLConstants.SAMPLER_CUBE);\r\n\r\n            if (!isSampler) {\r\n                const glLoc = gl.getUniformLocation(gpuShader.glProgram, uniformInfo.name);\r\n                if (device.extensions.isLocationActive(glLoc)) {\r\n                    let varName: string;\r\n                    const nameOffset = uniformInfo.name.indexOf('[');\r\n                    if (nameOffset !== -1) {\r\n                        varName = uniformInfo.name.substring(0, nameOffset);\r\n                    } else {\r\n                        varName = uniformInfo.name;\r\n                    }\r\n\r\n                    // build uniform block mapping\r\n                    for (let j = 0; j < gpuShader.glBlocks.length; j++) {\r\n                        const glBlock = gpuShader.glBlocks[j];\r\n\r\n                        for (let k = 0; k < glBlock.glUniforms.length; k++) {\r\n                            const glUniform = glBlock.glUniforms[k];\r\n                            if (glUniform.name === varName) {\r\n                                glUniform.glLoc = glLoc;\r\n                                glUniform.count = uniformInfo.size;\r\n                                glUniform.size = glUniform.stride * glUniform.count;\r\n                                glUniform.array = new (GFXTypeToTypedArrayCtor(glUniform.type))(glUniform.size / 4);\r\n\r\n                                glBlock.glActiveUniforms.push(glUniform);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // calculate offset & size\r\n    // WARNING: we can't handle inactive uniform arrays with wrong input sizes\r\n    // and there is no way to detect that for now\r\n    for (let j = 0; j < gpuShader.glBlocks.length; j++) {\r\n        const glBlock = gpuShader.glBlocks[j];\r\n        for (let k = 0; k < glBlock.glUniforms.length; k++) {\r\n            const glUniform = glBlock.glUniforms[k];\r\n            glUniform.offset = glBlock.size / 4;\r\n            glBlock.size += glUniform.size;\r\n        }\r\n    }\r\n\r\n    // texture unit index mapping optimization\r\n    const glActiveSamplers: IWebGLGPUUniformSamplerTexture[] = [];\r\n    const glActiveSamplerLocations: WebGLUniformLocation[] = [];\r\n    const { bindingMappings, capabilities } = device;\r\n    const { texUnitCacheMap } = device.stateCache;\r\n    const { maxTextureUnits } = capabilities;\r\n\r\n    if (!(cclegacy.rendering && cclegacy.rendering.enableEffectImport)) {\r\n        let flexibleSetBaseOffset = 0;\r\n        for (let i = 0; i < gpuShader.blocks.length; ++i) {\r\n            if (gpuShader.blocks[i].set === bindingMappings.flexibleSet) {\r\n                flexibleSetBaseOffset++;\r\n            }\r\n        }\r\n\r\n        let arrayOffset = 0;\r\n        for (let i = 0; i < gpuShader.samplerTextures.length; ++i) {\r\n            const sampler = gpuShader.samplerTextures[i];\r\n            const glLoc = gl.getUniformLocation(gpuShader.glProgram, sampler.name);\r\n            if (device.extensions.isLocationActive(glLoc)) {\r\n                glActiveSamplers.push(gpuShader.glSamplerTextures[i]);\r\n                glActiveSamplerLocations.push(glLoc);\r\n            }\r\n            if (texUnitCacheMap[sampler.name] === undefined) {\r\n                let binding = sampler.binding + bindingMappings.samplerTextureOffsets[sampler.set] + arrayOffset;\r\n                if (sampler.set === bindingMappings.flexibleSet) { binding -= flexibleSetBaseOffset; }\r\n                texUnitCacheMap[sampler.name] = binding % maxTextureUnits;\r\n                arrayOffset += sampler.count - 1;\r\n            }\r\n        }\r\n    } else {\r\n        for (let i = 0; i < gpuShader.samplerTextures.length; ++i) {\r\n            const sampler = gpuShader.samplerTextures[i];\r\n            const glLoc = gl.getUniformLocation(gpuShader.glProgram, sampler.name);\r\n            if (device.extensions.isLocationActive(glLoc)) {\r\n                glActiveSamplers.push(gpuShader.glSamplerTextures[i]);\r\n                glActiveSamplerLocations.push(glLoc);\r\n            }\r\n            if (texUnitCacheMap[sampler.name] === undefined) {\r\n                texUnitCacheMap[sampler.name] = sampler.flattened % maxTextureUnits;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (glActiveSamplers.length) {\r\n        const usedTexUnits: boolean[] = [];\r\n        // try to reuse existing mappings first\r\n        for (let i = 0; i < glActiveSamplers.length; ++i) {\r\n            const glSampler = glActiveSamplers[i];\r\n\r\n            let cachedUnit = texUnitCacheMap[glSampler.name];\r\n            if (cachedUnit !== undefined) {\r\n                glSampler.glLoc = glActiveSamplerLocations[i];\r\n                for (let t = 0; t < glSampler.count; ++t) {\r\n                    while (usedTexUnits[cachedUnit]) {\r\n                        cachedUnit = (cachedUnit + 1) % maxTextureUnits;\r\n                    }\r\n                    glSampler.units.push(cachedUnit);\r\n                    usedTexUnits[cachedUnit] = true;\r\n                }\r\n            }\r\n        }\r\n        // fill in the rest sequencially\r\n        let unitIdx = 0;\r\n        for (let i = 0; i < glActiveSamplers.length; ++i) {\r\n            const glSampler = glActiveSamplers[i];\r\n\r\n            if (!device.extensions.isLocationActive(glSampler.glLoc)) {\r\n                glSampler.glLoc = glActiveSamplerLocations[i];\r\n                for (let t = 0; t < glSampler.count; ++t) {\r\n                    while (usedTexUnits[unitIdx]) {\r\n                        unitIdx = (unitIdx + 1) % maxTextureUnits;\r\n                    }\r\n                    if (texUnitCacheMap[glSampler.name] === undefined) {\r\n                        texUnitCacheMap[glSampler.name] = unitIdx;\r\n                    }\r\n                    glSampler.units.push(unitIdx);\r\n                    usedTexUnits[unitIdx] = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (stateCache.glProgram !== gpuShader.glProgram) {\r\n            gl.useProgram(gpuShader.glProgram);\r\n        }\r\n\r\n        for (let i = 0; i < glActiveSamplers.length; i++) {\r\n            const glSampler = glActiveSamplers[i];\r\n            glSampler.glUnits = new Int32Array(glSampler.units);\r\n            gl.uniform1iv(glSampler.glLoc, glSampler.glUnits);\r\n        }\r\n\r\n        if (stateCache.glProgram !== gpuShader.glProgram) {\r\n            gl.useProgram(stateCache.glProgram);\r\n        }\r\n    }\r\n\r\n    // strip out the inactive ones\r\n    for (let i = 0; i < gpuShader.glBlocks.length;) {\r\n        if (gpuShader.glBlocks[i].glActiveUniforms.length) {\r\n            i++;\r\n        } else {\r\n            gpuShader.glBlocks[i] = gpuShader.glBlocks[gpuShader.glBlocks.length - 1];\r\n            gpuShader.glBlocks.length--;\r\n        }\r\n    }\r\n\r\n    gpuShader.glSamplerTextures = glActiveSamplers;\r\n}\r\n\r\nexport function WebGLCmdFuncDestroyShader (device: WebGLDevice, gpuShader: IWebGLGPUShader): void {\r\n    if (gpuShader.glProgram) {\r\n        const { gl, stateCache } = device;\r\n        if (!device.extensions.destroyShadersImmediately) {\r\n            for (let k = 0; k < gpuShader.gpuStages.length; k++) {\r\n                const gpuStage = gpuShader.gpuStages[k];\r\n                if (gpuStage.glShader) {\r\n                    gl.detachShader(gpuShader.glProgram, gpuStage.glShader);\r\n                    gl.deleteShader(gpuStage.glShader);\r\n                    gpuStage.glShader = null;\r\n                }\r\n            }\r\n        }\r\n        gl.deleteProgram(gpuShader.glProgram);\r\n        if (stateCache.glProgram === gpuShader.glProgram) {\r\n            gl.useProgram(null);\r\n            stateCache.glProgram = null;\r\n        }\r\n        gpuShader.glProgram = null;\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncCreateInputAssember (device: WebGLDevice, gpuInputAssembler: IWebGLGPUInputAssembler): void {\r\n    const { gl } = device;\r\n\r\n    gpuInputAssembler.glAttribs = new Array<IWebGLAttrib>(gpuInputAssembler.attributes.length);\r\n\r\n    const offsets = [0, 0, 0, 0, 0, 0, 0, 0];\r\n\r\n    for (let i = 0; i < gpuInputAssembler.attributes.length; ++i) {\r\n        const attrib = gpuInputAssembler.attributes[i];\r\n        const { format: attribFormat, isNormalized: attribIsNormalized, isInstanced: attribIsInstanced } = attrib;\r\n\r\n        const stream = attrib.stream !== undefined ? attrib.stream : 0;\r\n\r\n        const gpuBuffer = gpuInputAssembler.gpuVertexBuffers[stream];\r\n\r\n        const glType = GFXFormatToWebGLType(attribFormat, gl);\r\n        const { size } = FormatInfos[attribFormat];\r\n\r\n        gpuInputAssembler.glAttribs[i] = {\r\n            name: attrib.name,\r\n            glBuffer: gpuBuffer.glBuffer,\r\n            glType,\r\n            size,\r\n            count: FormatInfos[attribFormat].count,\r\n            stride: gpuBuffer.stride,\r\n            componentCount: WebGLGetComponentCount(glType, gl),\r\n            isNormalized: (attribIsNormalized !== undefined ? attribIsNormalized : false),\r\n            isInstanced: (attribIsInstanced !== undefined ? attribIsInstanced : false),\r\n            offset: offsets[stream],\r\n        };\r\n\r\n        offsets[stream] += size;\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncDestroyInputAssembler (device: WebGLDevice, gpuInputAssembler: IWebGLGPUInputAssembler): void {\r\n    const { stateCache } = device;\r\n    const it = gpuInputAssembler.glVAOs.values();\r\n    let res = it.next();\r\n    const OES_vertex_array_object = device.extensions.OES_vertex_array_object!;\r\n    let glVAO = stateCache.glVAO;\r\n    while (!res.done) {\r\n        OES_vertex_array_object.deleteVertexArrayOES(res.value);\r\n        if (glVAO === res.value) {\r\n            OES_vertex_array_object.bindVertexArrayOES(null);\r\n            glVAO = null;\r\n        }\r\n        res = it.next();\r\n    }\r\n    stateCache.glVAO = glVAO;\r\n    gpuInputAssembler.glVAOs.clear();\r\n}\r\n\r\ninterface IWebGLStateCache {\r\n    gpuPipelineState: IWebGLGPUPipelineState | null;\r\n    gpuInputAssembler: IWebGLGPUInputAssembler | null;\r\n    glPrimitive: number;\r\n}\r\nconst gfxStateCache: IWebGLStateCache = {\r\n    gpuPipelineState: null,\r\n    gpuInputAssembler: null,\r\n    glPrimitive: 0,\r\n};\r\n\r\nconst realRenderArea = new Rect();\r\nexport function WebGLCmdFuncBeginRenderPass (\r\n    device: WebGLDevice,\r\n    gpuRenderPass: IWebGLGPURenderPass | null,\r\n    gpuFramebuffer: IWebGLGPUFramebuffer | null,\r\n    renderArea: Readonly<Rect>,\r\n    clearColors: Readonly<Color[]>,\r\n    clearDepth: number,\r\n    clearStencil: number,\r\n): void {\r\n    const { gl } = device;\r\n    const cache = device.stateCache;\r\n    let clears: GLbitfield = 0;\r\n\r\n    if (gpuFramebuffer) {\r\n        const lodLevel = gpuFramebuffer.lodLevel;\r\n        realRenderArea.x = renderArea.x << lodLevel;\r\n        realRenderArea.y = renderArea.y << lodLevel;\r\n        realRenderArea.width = renderArea.width << lodLevel;\r\n        realRenderArea.height = renderArea.height << lodLevel;\r\n    }\r\n\r\n    if (gpuFramebuffer && gpuRenderPass) {\r\n        const curGPUFrameBuffer = gpuFramebuffer.glFramebuffer;\r\n        const { x: realRenderAreaX, y: realRenderAreaY, width: realRenderAreaWidth, height: realRenderAreaHeight } = realRenderArea;\r\n        if (cache.glFramebuffer !== curGPUFrameBuffer) {\r\n            gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, curGPUFrameBuffer);\r\n            cache.glFramebuffer = curGPUFrameBuffer;\r\n        }\r\n\r\n        const cacheViewport = cache.viewport;\r\n        if (cacheViewport.left !== realRenderAreaX\r\n            || cacheViewport.top !== realRenderAreaY\r\n            || cacheViewport.width !== realRenderAreaWidth\r\n            || cacheViewport.height !== realRenderAreaHeight) {\r\n            gl.viewport(realRenderAreaX, realRenderAreaY, realRenderAreaWidth, realRenderAreaHeight);\r\n\r\n            cacheViewport.left = realRenderAreaX;\r\n            cacheViewport.top = realRenderAreaY;\r\n            cacheViewport.width = realRenderAreaWidth;\r\n            cacheViewport.height = realRenderAreaHeight;\r\n        }\r\n\r\n        const cacheScissorRect = cache.scissorRect;\r\n        if (cacheScissorRect.x !== realRenderAreaX\r\n            || cacheScissorRect.y !== realRenderAreaY\r\n            || cacheScissorRect.width !== realRenderAreaWidth\r\n            || cacheScissorRect.height !== realRenderAreaHeight) {\r\n            gl.scissor(realRenderAreaX, realRenderAreaY, realRenderAreaWidth, realRenderAreaHeight);\r\n\r\n            cacheScissorRect.x = realRenderAreaX;\r\n            cacheScissorRect.y = realRenderAreaY;\r\n            cacheScissorRect.width = realRenderAreaWidth;\r\n            cacheScissorRect.height = realRenderAreaHeight;\r\n        }\r\n\r\n        // const invalidateAttachments: GLenum[] = [];\r\n        let clearCount = clearColors.length;\r\n\r\n        if (!device.extensions.WEBGL_draw_buffers) {\r\n            clearCount = 1;\r\n        }\r\n\r\n        const cacheDSS = cache.dss;\r\n\r\n        for (let j = 0; j < clearCount; ++j) {\r\n            const colorAttachment = gpuRenderPass.colorAttachments[j];\r\n\r\n            if (colorAttachment.format !== Format.UNKNOWN) {\r\n                switch (colorAttachment.loadOp) {\r\n                case LoadOp.LOAD: break; // GL default behavior\r\n                case LoadOp.CLEAR: {\r\n                    if (cache.bs.targets[0].blendColorMask !== ColorMask.ALL) {\r\n                        gl.colorMask(true, true, true, true);\r\n                    }\r\n\r\n                    const clearColor = clearColors[0];\r\n                    gl.clearColor(clearColor.x, clearColor.y, clearColor.z, clearColor.w);\r\n                    clears |= WebGLConstants.COLOR_BUFFER_BIT;\r\n                    break;\r\n                }\r\n                case LoadOp.DISCARD: {\r\n                    // invalidate the framebuffer\r\n                    // invalidateAttachments.push(WebGLConstants.COLOR_ATTACHMENT0 + j);\r\n                    break;\r\n                }\r\n                default:\r\n                }\r\n            }\r\n        } // if (curGPURenderPass)\r\n\r\n        if (gpuRenderPass.depthStencilAttachment) {\r\n            if (gpuRenderPass.depthStencilAttachment.format !== Format.UNKNOWN) {\r\n                switch (gpuRenderPass.depthStencilAttachment.depthLoadOp) {\r\n                case LoadOp.LOAD: break; // GL default behavior\r\n                case LoadOp.CLEAR: {\r\n                    if (!cacheDSS.depthWrite) {\r\n                        gl.depthMask(true);\r\n                    }\r\n\r\n                    gl.clearDepth(clearDepth);\r\n\r\n                    clears |= WebGLConstants.DEPTH_BUFFER_BIT;\r\n                    break;\r\n                }\r\n                case LoadOp.DISCARD: {\r\n                    // invalidate the framebuffer\r\n                    // invalidateAttachments.push(WebGLConstants.DEPTH_ATTACHMENT);\r\n                    break;\r\n                }\r\n                default:\r\n                }\r\n\r\n                if (FormatInfos[gpuRenderPass.depthStencilAttachment.format].hasStencil) {\r\n                    switch (gpuRenderPass.depthStencilAttachment.stencilLoadOp) {\r\n                    case LoadOp.LOAD: break; // GL default behavior\r\n                    case LoadOp.CLEAR: {\r\n                        if (!cacheDSS.stencilWriteMaskFront) {\r\n                            gl.stencilMaskSeparate(WebGLConstants.FRONT, 0xffff);\r\n                        }\r\n\r\n                        if (!cacheDSS.stencilWriteMaskBack) {\r\n                            gl.stencilMaskSeparate(WebGLConstants.BACK, 0xffff);\r\n                        }\r\n\r\n                        gl.clearStencil(clearStencil);\r\n                        clears |= WebGLConstants.STENCIL_BUFFER_BIT;\r\n                        break;\r\n                    }\r\n                    case LoadOp.DISCARD: {\r\n                        // invalidate the framebuffer\r\n                        // invalidateAttachments.push(WebGLConstants.STENCIL_ATTACHMENT);\r\n                        break;\r\n                    }\r\n                    default:\r\n                    }\r\n                }\r\n            }\r\n        } // if (gpuRenderPass.depthStencilAttachment)\r\n\r\n        /*\r\n        if (invalidateAttachments.length) {\r\n            gl.invalidateFramebuffer(WebGLConstants.FRAMEBUFFER, invalidateAttachments);\r\n        }\r\n        */\r\n\r\n        if (clears) {\r\n            gl.clear(clears);\r\n        }\r\n\r\n        // restore states\r\n        if (clears & WebGLConstants.COLOR_BUFFER_BIT) {\r\n            const colorMask = cache.bs.targets[0].blendColorMask;\r\n            if (colorMask !== ColorMask.ALL) {\r\n                const r = (colorMask & ColorMask.R) !== ColorMask.NONE;\r\n                const g = (colorMask & ColorMask.G) !== ColorMask.NONE;\r\n                const b = (colorMask & ColorMask.B) !== ColorMask.NONE;\r\n                const a = (colorMask & ColorMask.A) !== ColorMask.NONE;\r\n                gl.colorMask(r, g, b, a);\r\n            }\r\n        }\r\n\r\n        if ((clears & WebGLConstants.DEPTH_BUFFER_BIT)\r\n            && !cacheDSS.depthWrite) {\r\n            gl.depthMask(false);\r\n        }\r\n\r\n        if (clears & WebGLConstants.STENCIL_BUFFER_BIT) {\r\n            if (!cacheDSS.stencilWriteMaskFront) {\r\n                gl.stencilMaskSeparate(WebGLConstants.FRONT, 0);\r\n            }\r\n\r\n            if (!cacheDSS.stencilWriteMaskBack) {\r\n                gl.stencilMaskSeparate(WebGLConstants.BACK, 0);\r\n            }\r\n        }\r\n    } // if (gpuFramebuffer)\r\n}\r\n\r\nexport function WebGLCmdFuncBindStates (\r\n    device: WebGLDevice,\r\n    gpuPipelineState: IWebGLGPUPipelineState | null,\r\n    gpuInputAssembler: IWebGLGPUInputAssembler | null,\r\n    gpuDescriptorSets: Readonly<IWebGLGPUDescriptorSet[]>,\r\n    dynamicOffsets: Readonly<number[]>,\r\n    dynamicStates: Readonly<DynamicStates>,\r\n): void {\r\n    const { gl } = device;\r\n    const cache = device.stateCache;\r\n    const cacheDSS = cache.dss;\r\n    const cacheBS = cache.bs;\r\n    const gpuShader = gpuPipelineState && gpuPipelineState.gpuShader;\r\n\r\n    let isShaderChanged = false;\r\n    let glWrapS: number;\r\n    let glWrapT: number;\r\n    let glMinFilter: number;\r\n\r\n    // bind pipeline\r\n    if (gpuPipelineState && gfxStateCache.gpuPipelineState !== gpuPipelineState) {\r\n        gfxStateCache.gpuPipelineState = gpuPipelineState;\r\n        gfxStateCache.glPrimitive = gpuPipelineState.glPrimitive;\r\n\r\n        if (gpuPipelineState.gpuShader) {\r\n            const { glProgram } = gpuPipelineState.gpuShader;\r\n            if (cache.glProgram !== glProgram) {\r\n                gl.useProgram(glProgram);\r\n                cache.glProgram = glProgram;\r\n                isShaderChanged = true;\r\n            }\r\n        }\r\n\r\n        // rasterizer state\r\n        const { rs } = gpuPipelineState;\r\n        const cacheRS = cache.rs;\r\n        if (rs) {\r\n            if (cacheRS.cullMode !== rs.cullMode) {\r\n                switch (rs.cullMode) {\r\n                case CullMode.NONE: {\r\n                    gl.disable(WebGLConstants.CULL_FACE);\r\n                    break;\r\n                }\r\n                case CullMode.FRONT: {\r\n                    gl.enable(WebGLConstants.CULL_FACE);\r\n                    gl.cullFace(WebGLConstants.FRONT);\r\n                    break;\r\n                }\r\n                case CullMode.BACK: {\r\n                    gl.enable(WebGLConstants.CULL_FACE);\r\n                    gl.cullFace(WebGLConstants.BACK);\r\n                    break;\r\n                }\r\n                default:\r\n                }\r\n\r\n                cacheRS.cullMode = rs.cullMode;\r\n            }\r\n\r\n            const isFrontFaceCCW = rs.isFrontFaceCCW;\r\n            if (cacheRS.isFrontFaceCCW !== isFrontFaceCCW) {\r\n                gl.frontFace(isFrontFaceCCW ? WebGLConstants.CCW : WebGLConstants.CW);\r\n                cacheRS.isFrontFaceCCW = isFrontFaceCCW;\r\n            }\r\n\r\n            if ((cacheRS.depthBias !== rs.depthBias)\r\n                || (cacheRS.depthBiasSlop !== rs.depthBiasSlop)) {\r\n                gl.polygonOffset(rs.depthBias, rs.depthBiasSlop);\r\n                cacheRS.depthBias = rs.depthBias;\r\n                cacheRS.depthBiasSlop = rs.depthBiasSlop;\r\n            }\r\n\r\n            if (cacheRS.lineWidth !== rs.lineWidth) {\r\n                gl.lineWidth(rs.lineWidth);\r\n                cacheRS.lineWidth = rs.lineWidth;\r\n            }\r\n        } // rasterizater state\r\n\r\n        // depth-stencil state\r\n        const { dss } = gpuPipelineState;\r\n\r\n        if (dss) {\r\n            if (cacheDSS.depthTest !== dss.depthTest) {\r\n                if (dss.depthTest) {\r\n                    gl.enable(WebGLConstants.DEPTH_TEST);\r\n                } else {\r\n                    gl.disable(WebGLConstants.DEPTH_TEST);\r\n                }\r\n                cacheDSS.depthTest = dss.depthTest;\r\n            }\r\n\r\n            if (cacheDSS.depthWrite !== dss.depthWrite) {\r\n                gl.depthMask(dss.depthWrite);\r\n                cacheDSS.depthWrite = dss.depthWrite;\r\n            }\r\n\r\n            if (cacheDSS.depthFunc !== dss.depthFunc) {\r\n                gl.depthFunc(WebGLCmpFuncs[dss.depthFunc]);\r\n                cacheDSS.depthFunc = dss.depthFunc;\r\n            }\r\n\r\n            // front\r\n            if ((cacheDSS.stencilTestFront !== dss.stencilTestFront)\r\n                || (cacheDSS.stencilTestBack !== dss.stencilTestBack)) {\r\n                if (dss.stencilTestFront || dss.stencilTestBack) {\r\n                    gl.enable(WebGLConstants.STENCIL_TEST);\r\n                } else {\r\n                    gl.disable(WebGLConstants.STENCIL_TEST);\r\n                }\r\n                cacheDSS.stencilTestFront = dss.stencilTestFront;\r\n                cacheDSS.stencilTestBack = dss.stencilTestBack;\r\n            }\r\n\r\n            if ((cacheDSS.stencilFuncFront !== dss.stencilFuncFront)\r\n                || (cacheDSS.stencilRefFront !== dss.stencilRefFront)\r\n                || (cacheDSS.stencilReadMaskFront !== dss.stencilReadMaskFront)) {\r\n                gl.stencilFuncSeparate(\r\n                    WebGLConstants.FRONT,\r\n                    WebGLCmpFuncs[dss.stencilFuncFront],\r\n                    dss.stencilRefFront,\r\n                    dss.stencilReadMaskFront,\r\n                );\r\n\r\n                cacheDSS.stencilFuncFront = dss.stencilFuncFront;\r\n                cacheDSS.stencilRefFront = dss.stencilRefFront;\r\n                cacheDSS.stencilReadMaskFront = dss.stencilReadMaskFront;\r\n            }\r\n\r\n            if ((cacheDSS.stencilFailOpFront !== dss.stencilFailOpFront)\r\n                || (cacheDSS.stencilZFailOpFront !== dss.stencilZFailOpFront)\r\n                || (cacheDSS.stencilPassOpFront !== dss.stencilPassOpFront)) {\r\n                gl.stencilOpSeparate(\r\n                    WebGLConstants.FRONT,\r\n                    WebGLStencilOps[dss.stencilFailOpFront],\r\n                    WebGLStencilOps[dss.stencilZFailOpFront],\r\n                    WebGLStencilOps[dss.stencilPassOpFront],\r\n                );\r\n\r\n                cacheDSS.stencilFailOpFront = dss.stencilFailOpFront;\r\n                cacheDSS.stencilZFailOpFront = dss.stencilZFailOpFront;\r\n                cacheDSS.stencilPassOpFront = dss.stencilPassOpFront;\r\n            }\r\n\r\n            if (cacheDSS.stencilWriteMaskFront !== dss.stencilWriteMaskFront) {\r\n                gl.stencilMaskSeparate(WebGLConstants.FRONT, dss.stencilWriteMaskFront);\r\n                cacheDSS.stencilWriteMaskFront = dss.stencilWriteMaskFront;\r\n            }\r\n\r\n            // back\r\n            if ((cacheDSS.stencilFuncBack !== dss.stencilFuncBack)\r\n                || (cacheDSS.stencilRefBack !== dss.stencilRefBack)\r\n                || (cacheDSS.stencilReadMaskBack !== dss.stencilReadMaskBack)) {\r\n                gl.stencilFuncSeparate(\r\n                    WebGLConstants.BACK,\r\n                    WebGLCmpFuncs[dss.stencilFuncBack],\r\n                    dss.stencilRefBack,\r\n                    dss.stencilReadMaskBack,\r\n                );\r\n\r\n                cacheDSS.stencilFuncBack = dss.stencilFuncBack;\r\n                cacheDSS.stencilRefBack = dss.stencilRefBack;\r\n                cacheDSS.stencilReadMaskBack = dss.stencilReadMaskBack;\r\n            }\r\n\r\n            if ((cacheDSS.stencilFailOpBack !== dss.stencilFailOpBack)\r\n                || (cacheDSS.stencilZFailOpBack !== dss.stencilZFailOpBack)\r\n                || (cacheDSS.stencilPassOpBack !== dss.stencilPassOpBack)) {\r\n                gl.stencilOpSeparate(\r\n                    WebGLConstants.BACK,\r\n                    WebGLStencilOps[dss.stencilFailOpBack],\r\n                    WebGLStencilOps[dss.stencilZFailOpBack],\r\n                    WebGLStencilOps[dss.stencilPassOpBack],\r\n                );\r\n\r\n                cacheDSS.stencilFailOpBack = dss.stencilFailOpBack;\r\n                cacheDSS.stencilZFailOpBack = dss.stencilZFailOpBack;\r\n                cacheDSS.stencilPassOpBack = dss.stencilPassOpBack;\r\n            }\r\n\r\n            if (cacheDSS.stencilWriteMaskBack !== dss.stencilWriteMaskBack) {\r\n                gl.stencilMaskSeparate(WebGLConstants.BACK, dss.stencilWriteMaskBack);\r\n                cacheDSS.stencilWriteMaskBack = dss.stencilWriteMaskBack;\r\n            }\r\n        } // depth-stencil state\r\n\r\n        // blend state\r\n        const { bs } = gpuPipelineState;\r\n\r\n        if (bs) {\r\n            if (cacheBS.isA2C !== bs.isA2C) {\r\n                if (bs.isA2C) {\r\n                    gl.enable(WebGLConstants.SAMPLE_ALPHA_TO_COVERAGE);\r\n                } else {\r\n                    gl.disable(WebGLConstants.SAMPLE_ALPHA_TO_COVERAGE);\r\n                }\r\n                cacheBS.isA2C = bs.isA2C;\r\n            }\r\n\r\n            if ((cacheBS.blendColor.x !== bs.blendColor.x)\r\n                || (cacheBS.blendColor.y !== bs.blendColor.y)\r\n                || (cacheBS.blendColor.z !== bs.blendColor.z)\r\n                || (cacheBS.blendColor.w !== bs.blendColor.w)) {\r\n                gl.blendColor(bs.blendColor.x, bs.blendColor.y, bs.blendColor.z, bs.blendColor.w);\r\n\r\n                cacheBS.blendColor.x = bs.blendColor.x;\r\n                cacheBS.blendColor.y = bs.blendColor.y;\r\n                cacheBS.blendColor.z = bs.blendColor.z;\r\n                cacheBS.blendColor.w = bs.blendColor.w;\r\n            }\r\n\r\n            const target0 = bs.targets[0];\r\n            const target0Cache = cacheBS.targets[0];\r\n\r\n            if (target0Cache.blend !== target0.blend) {\r\n                if (target0.blend) {\r\n                    gl.enable(WebGLConstants.BLEND);\r\n                } else {\r\n                    gl.disable(WebGLConstants.BLEND);\r\n                }\r\n                target0Cache.blend = target0.blend;\r\n            }\r\n\r\n            if ((target0Cache.blendEq !== target0.blendEq)\r\n                || (target0Cache.blendAlphaEq !== target0.blendAlphaEq)) {\r\n                gl.blendEquationSeparate(WebGLBlendOps[target0.blendEq], WebGLBlendOps[target0.blendAlphaEq]);\r\n                target0Cache.blendEq = target0.blendEq;\r\n                target0Cache.blendAlphaEq = target0.blendAlphaEq;\r\n            }\r\n\r\n            if ((target0Cache.blendSrc !== target0.blendSrc)\r\n                || (target0Cache.blendDst !== target0.blendDst)\r\n                || (target0Cache.blendSrcAlpha !== target0.blendSrcAlpha)\r\n                || (target0Cache.blendDstAlpha !== target0.blendDstAlpha)) {\r\n                gl.blendFuncSeparate(\r\n                    WebGLBlendFactors[target0.blendSrc],\r\n                    WebGLBlendFactors[target0.blendDst],\r\n                    WebGLBlendFactors[target0.blendSrcAlpha],\r\n                    WebGLBlendFactors[target0.blendDstAlpha],\r\n                );\r\n\r\n                target0Cache.blendSrc = target0.blendSrc;\r\n                target0Cache.blendDst = target0.blendDst;\r\n                target0Cache.blendSrcAlpha = target0.blendSrcAlpha;\r\n                target0Cache.blendDstAlpha = target0.blendDstAlpha;\r\n            }\r\n\r\n            if (target0Cache.blendColorMask !== target0.blendColorMask) {\r\n                gl.colorMask(\r\n                    (target0.blendColorMask & ColorMask.R) !== ColorMask.NONE,\r\n                    (target0.blendColorMask & ColorMask.G) !== ColorMask.NONE,\r\n                    (target0.blendColorMask & ColorMask.B) !== ColorMask.NONE,\r\n                    (target0.blendColorMask & ColorMask.A) !== ColorMask.NONE,\r\n                );\r\n\r\n                target0Cache.blendColorMask = target0.blendColorMask;\r\n            }\r\n        } // blend state\r\n    } // bind pipeline\r\n\r\n    // bind descriptor sets\r\n    if (gpuPipelineState && gpuPipelineState.gpuPipelineLayout && gpuShader) {\r\n        const blockLen = gpuShader.glBlocks.length;\r\n        const { dynamicOffsetIndices } = gpuPipelineState.gpuPipelineLayout;\r\n\r\n        for (let j = 0; j < blockLen; j++) {\r\n            const glBlock = gpuShader.glBlocks[j];\r\n            const gpuDescriptorSet = gpuDescriptorSets[glBlock.set];\r\n            const descriptorIdx = gpuDescriptorSet && gpuDescriptorSet.descriptorIndices[glBlock.binding];\r\n            const gpuDescriptor = descriptorIdx >= 0 && gpuDescriptorSet.gpuDescriptors[descriptorIdx];\r\n            let vf32: Float32Array | null = null; let offset = 0;\r\n\r\n            if (gpuDescriptor && gpuDescriptor.gpuBuffer) {\r\n                const { gpuBuffer } = gpuDescriptor;\r\n                const dynamicOffsetIndexSet = dynamicOffsetIndices[glBlock.set];\r\n                const dynamicOffsetIndex = dynamicOffsetIndexSet && dynamicOffsetIndexSet[glBlock.binding];\r\n                if (dynamicOffsetIndex >= 0) { offset = dynamicOffsets[dynamicOffsetIndex]; }\r\n\r\n                if ('vf32' in gpuBuffer) {\r\n                    vf32 = gpuBuffer.vf32;\r\n                } else {\r\n                    offset += gpuBuffer.offset;\r\n                    vf32 = gpuBuffer.gpuBuffer.vf32;\r\n                }\r\n                offset >>= 2;\r\n            }\r\n\r\n            if (!vf32) {\r\n                // error(`Buffer binding '${glBlock.name}' at set ${glBlock.set} binding ${glBlock.binding} is not bounded`);\r\n                continue;\r\n            }\r\n\r\n            const uniformLen = glBlock.glActiveUniforms.length;\r\n            for (let l = 0; l < uniformLen; l++) {\r\n                const glUniform = glBlock.glActiveUniforms[l];\r\n                switch (glUniform.glType) {\r\n                case WebGLConstants.BOOL:\r\n                case WebGLConstants.INT: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform1iv(glUniform.glLoc, glUniform.array as Int32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.BOOL_VEC2:\r\n                case WebGLConstants.INT_VEC2: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform2iv(glUniform.glLoc, glUniform.array as Int32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.BOOL_VEC3:\r\n                case WebGLConstants.INT_VEC3: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform3iv(glUniform.glLoc, glUniform.array as Int32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.BOOL_VEC4:\r\n                case WebGLConstants.INT_VEC4: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform4iv(glUniform.glLoc, glUniform.array as Int32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.FLOAT: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform1fv(glUniform.glLoc, glUniform.array as Float32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.FLOAT_VEC2: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform2fv(glUniform.glLoc, glUniform.array as Float32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.FLOAT_VEC3: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform3fv(glUniform.glLoc, glUniform.array as Float32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.FLOAT_VEC4: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniform4fv(glUniform.glLoc, glUniform.array as Float32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.FLOAT_MAT2: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniformMatrix2fv(glUniform.glLoc, false, glUniform.array as Float32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.FLOAT_MAT3: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniformMatrix3fv(glUniform.glLoc, false, glUniform.array as Float32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                case WebGLConstants.FLOAT_MAT4: {\r\n                    for (let u = 0; u < glUniform.array.length; ++u) {\r\n                        const idx = glUniform.offset + offset + u;\r\n                        if (vf32[idx] !== glUniform.array[u]) {\r\n                            for (let n = u, m = idx; n < glUniform.array.length; ++n, ++m) {\r\n                                glUniform.array[n] = vf32[m];\r\n                            }\r\n                            gl.uniformMatrix4fv(glUniform.glLoc, false, glUniform.array as Float32Array);\r\n                            break;\r\n                        }\r\n                    }\r\n                    break;\r\n                }\r\n                default:\r\n                }\r\n            }\r\n            continue;\r\n        }\r\n\r\n        const samplerLen = gpuShader.glSamplerTextures.length;\r\n        for (let i = 0; i < samplerLen; i++) {\r\n            const glSampler = gpuShader.glSamplerTextures[i];\r\n            const gpuDescriptorSet = gpuDescriptorSets[glSampler.set];\r\n            let descriptorIndex = gpuDescriptorSet && gpuDescriptorSet.descriptorIndices[glSampler.binding];\r\n            let gpuDescriptor = descriptorIndex >= 0 && gpuDescriptorSet.gpuDescriptors[descriptorIndex];\r\n\r\n            const texUnitLen = glSampler.units.length;\r\n            for (let l = 0; l < texUnitLen; l++) {\r\n                const texUnit = glSampler.units[l];\r\n\r\n                if (!gpuDescriptor || !gpuDescriptor.gpuSampler) {\r\n                    // error(`Sampler binding '${glSampler.name}' at set ${glSampler.set} binding ${glSampler.binding} index ${l} is not bounded`);\r\n                    continue;\r\n                }\r\n\r\n                if (gpuDescriptor.gpuTexture && gpuDescriptor.gpuTexture.size > 0) {\r\n                    const { gpuTexture } = gpuDescriptor;\r\n                    const glTexUnit = cache.glTexUnits[texUnit];\r\n\r\n                    if (glTexUnit.glTexture !== gpuTexture.glTexture) {\r\n                        if (cache.texUnit !== texUnit) {\r\n                            gl.activeTexture(WebGLConstants.TEXTURE0 + texUnit);\r\n                            cache.texUnit = texUnit;\r\n                        }\r\n                        if (gpuTexture.glTexture) {\r\n                            gl.bindTexture(gpuTexture.glTarget, gpuTexture.glTexture);\r\n                        } else {\r\n                            gl.bindTexture(gpuTexture.glTarget, device.nullTex2D.gpuTexture.glTexture);\r\n                        }\r\n                        glTexUnit.glTexture = gpuTexture.glTexture;\r\n                    }\r\n\r\n                    const { gpuSampler } = gpuDescriptor;\r\n                    if (gpuTexture.isPowerOf2) {\r\n                        glWrapS = gpuSampler.glWrapS;\r\n                        glWrapT = gpuSampler.glWrapT;\r\n                    } else {\r\n                        glWrapS = WebGLConstants.CLAMP_TO_EDGE;\r\n                        glWrapT = WebGLConstants.CLAMP_TO_EDGE;\r\n                    }\r\n\r\n                    if (gpuTexture.isPowerOf2) {\r\n                        if (gpuTexture.mipLevel <= 1\r\n                            && (gpuSampler.glMinFilter === WebGLConstants.LINEAR_MIPMAP_NEAREST\r\n                            || gpuSampler.glMinFilter === WebGLConstants.LINEAR_MIPMAP_LINEAR)) {\r\n                            glMinFilter = WebGLConstants.LINEAR;\r\n                        } else {\r\n                            glMinFilter = gpuSampler.glMinFilter;\r\n                        }\r\n                    } else if (gpuSampler.glMinFilter === WebGLConstants.LINEAR\r\n                            || gpuSampler.glMinFilter === WebGLConstants.LINEAR_MIPMAP_NEAREST\r\n                            || gpuSampler.glMinFilter === WebGLConstants.LINEAR_MIPMAP_LINEAR) {\r\n                        glMinFilter = WebGLConstants.LINEAR;\r\n                    } else {\r\n                        glMinFilter = WebGLConstants.NEAREST;\r\n                    }\r\n\r\n                    if (gpuTexture.glWrapS !== glWrapS) {\r\n                        if (cache.texUnit !== texUnit) {\r\n                            gl.activeTexture(WebGLConstants.TEXTURE0 + texUnit);\r\n                            cache.texUnit = texUnit;\r\n                        }\r\n                        gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_WRAP_S, glWrapS);\r\n                        gpuTexture.glWrapS = glWrapS;\r\n                    }\r\n\r\n                    if (gpuTexture.glWrapT !== glWrapT) {\r\n                        if (cache.texUnit !== texUnit) {\r\n                            gl.activeTexture(WebGLConstants.TEXTURE0 + texUnit);\r\n                            cache.texUnit = texUnit;\r\n                        }\r\n                        gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_WRAP_T, glWrapT);\r\n                        gpuTexture.glWrapT = glWrapT;\r\n                    }\r\n\r\n                    if (gpuTexture.glMinFilter !== glMinFilter) {\r\n                        if (cache.texUnit !== texUnit) {\r\n                            gl.activeTexture(WebGLConstants.TEXTURE0 + texUnit);\r\n                            cache.texUnit = texUnit;\r\n                        }\r\n                        gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_MIN_FILTER, glMinFilter);\r\n                        gpuTexture.glMinFilter = glMinFilter;\r\n                    }\r\n\r\n                    if (gpuTexture.glMagFilter !== gpuSampler.glMagFilter) {\r\n                        if (cache.texUnit !== texUnit) {\r\n                            gl.activeTexture(WebGLConstants.TEXTURE0 + texUnit);\r\n                            cache.texUnit = texUnit;\r\n                        }\r\n                        gl.texParameteri(gpuTexture.glTarget, WebGLConstants.TEXTURE_MAG_FILTER, gpuSampler.glMagFilter);\r\n                        gpuTexture.glMagFilter = gpuSampler.glMagFilter;\r\n                    }\r\n                }\r\n\r\n                gpuDescriptor = gpuDescriptorSet.gpuDescriptors[++descriptorIndex];\r\n            }\r\n        }\r\n    } // bind descriptor sets\r\n\r\n    // bind vertex/index buffer\r\n    if (gpuInputAssembler && gpuShader\r\n        && (isShaderChanged || gfxStateCache.gpuInputAssembler !== gpuInputAssembler)) {\r\n        gfxStateCache.gpuInputAssembler = gpuInputAssembler;\r\n        const ia = device.extensions.ANGLE_instanced_arrays;\r\n\r\n        if (device.extensions.useVAO) {\r\n            const vao = device.extensions.OES_vertex_array_object!;\r\n\r\n            // check vao\r\n            let glVAO = gpuInputAssembler.glVAOs.get(gpuShader.glProgram!);\r\n            if (!glVAO) {\r\n                glVAO = vao.createVertexArrayOES()!;\r\n                gpuInputAssembler.glVAOs.set(gpuShader.glProgram!, glVAO);\r\n\r\n                vao.bindVertexArrayOES(glVAO);\r\n                gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, null);\r\n                gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, null);\r\n                cache.glArrayBuffer = null;\r\n                cache.glElementArrayBuffer = null;\r\n\r\n                let glAttrib: IWebGLAttrib | null;\r\n                const inputLen = gpuShader.glInputs.length;\r\n                for (let j = 0; j < inputLen; j++) {\r\n                    const glInput = gpuShader.glInputs[j];\r\n                    glAttrib = null;\r\n\r\n                    const attribLen = gpuInputAssembler.glAttribs.length;\r\n                    for (let k = 0; k < attribLen; k++) {\r\n                        const attrib = gpuInputAssembler.glAttribs[k];\r\n                        if (attrib.name === glInput.name) {\r\n                            glAttrib = attrib;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (glAttrib) {\r\n                        if (cache.glArrayBuffer !== glAttrib.glBuffer) {\r\n                            gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, glAttrib.glBuffer);\r\n                            cache.glArrayBuffer = glAttrib.glBuffer;\r\n                        }\r\n\r\n                        for (let c = 0; c < glAttrib.componentCount; ++c) {\r\n                            const glLoc = glInput.glLoc + c;\r\n                            const attribOffset = glAttrib.offset + glAttrib.size * c;\r\n\r\n                            gl.enableVertexAttribArray(glLoc);\r\n                            cache.glCurrentAttribLocs[glLoc] = true;\r\n\r\n                            gl.vertexAttribPointer(glLoc, glAttrib.count, glAttrib.glType, glAttrib.isNormalized, glAttrib.stride, attribOffset);\r\n                            if (ia) { ia.vertexAttribDivisorANGLE(glLoc, glAttrib.isInstanced ? 1 : 0); }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                const gpuBuffer = gpuInputAssembler.gpuIndexBuffer;\r\n                if (gpuBuffer) {\r\n                    gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n                }\r\n\r\n                vao.bindVertexArrayOES(null);\r\n                gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, null);\r\n                gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, null);\r\n                cache.glArrayBuffer = null;\r\n                cache.glElementArrayBuffer = null;\r\n            }\r\n\r\n            if (cache.glVAO !== glVAO) {\r\n                vao.bindVertexArrayOES(glVAO);\r\n                cache.glVAO = glVAO;\r\n            }\r\n        } else {\r\n            for (let a = 0; a < device.capabilities.maxVertexAttributes; ++a) {\r\n                cache.glCurrentAttribLocs[a] = false;\r\n            }\r\n\r\n            const inputLen = gpuShader.glInputs.length;\r\n            for (let j = 0; j < inputLen; j++) {\r\n                const glInput = gpuShader.glInputs[j];\r\n                let glAttrib: IWebGLAttrib | null = null;\r\n\r\n                const attribLen = gpuInputAssembler.glAttribs.length;\r\n                for (let k = 0; k < attribLen; k++) {\r\n                    const attrib = gpuInputAssembler.glAttribs[k];\r\n                    if (attrib.name === glInput.name) {\r\n                        glAttrib = attrib;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (glAttrib) {\r\n                    if (cache.glArrayBuffer !== glAttrib.glBuffer) {\r\n                        gl.bindBuffer(WebGLConstants.ARRAY_BUFFER, glAttrib.glBuffer);\r\n                        cache.glArrayBuffer = glAttrib.glBuffer;\r\n                    }\r\n\r\n                    for (let c = 0; c < glAttrib.componentCount; ++c) {\r\n                        const glLoc = glInput.glLoc + c;\r\n                        const attribOffset = glAttrib.offset + glAttrib.size * c;\r\n\r\n                        if (!cache.glEnabledAttribLocs[glLoc] && glLoc >= 0) {\r\n                            gl.enableVertexAttribArray(glLoc);\r\n                            cache.glEnabledAttribLocs[glLoc] = true;\r\n                        }\r\n                        cache.glCurrentAttribLocs[glLoc] = true;\r\n\r\n                        gl.vertexAttribPointer(glLoc, glAttrib.count, glAttrib.glType, glAttrib.isNormalized, glAttrib.stride, attribOffset);\r\n                        if (ia) { ia.vertexAttribDivisorANGLE(glLoc, glAttrib.isInstanced ? 1 : 0); }\r\n                    }\r\n                }\r\n            } // for\r\n\r\n            const gpuBuffer = gpuInputAssembler.gpuIndexBuffer;\r\n            if (gpuBuffer) {\r\n                if (cache.glElementArrayBuffer !== gpuBuffer.glBuffer) {\r\n                    gl.bindBuffer(WebGLConstants.ELEMENT_ARRAY_BUFFER, gpuBuffer.glBuffer);\r\n                    cache.glElementArrayBuffer = gpuBuffer.glBuffer;\r\n                }\r\n            }\r\n\r\n            for (let a = 0; a < device.capabilities.maxVertexAttributes; ++a) {\r\n                if (cache.glEnabledAttribLocs[a] !== cache.glCurrentAttribLocs[a]) {\r\n                    gl.disableVertexAttribArray(a);\r\n                    cache.glEnabledAttribLocs[a] = false;\r\n                }\r\n            }\r\n        }\r\n    } // bind vertex/index buffer\r\n\r\n    // update dynamic states\r\n    if (gpuPipelineState && gpuPipelineState.dynamicStates.length) {\r\n        const dsLen = gpuPipelineState.dynamicStates.length;\r\n        for (let j = 0; j < dsLen; j++) {\r\n            const dynamicState = gpuPipelineState.dynamicStates[j];\r\n            switch (dynamicState) {\r\n            case DynamicStateFlagBit.LINE_WIDTH: {\r\n                if (cache.rs.lineWidth !== dynamicStates.lineWidth) {\r\n                    gl.lineWidth(dynamicStates.lineWidth);\r\n                    cache.rs.lineWidth = dynamicStates.lineWidth;\r\n                }\r\n                break;\r\n            }\r\n            case DynamicStateFlagBit.DEPTH_BIAS: {\r\n                if (cache.rs.depthBias !== dynamicStates.depthBiasConstant\r\n                    || cache.rs.depthBiasSlop !== dynamicStates.depthBiasSlope) {\r\n                    gl.polygonOffset(dynamicStates.depthBiasConstant, dynamicStates.depthBiasSlope);\r\n                    cache.rs.depthBias = dynamicStates.depthBiasConstant;\r\n                    cache.rs.depthBiasSlop = dynamicStates.depthBiasSlope;\r\n                }\r\n                break;\r\n            }\r\n            case DynamicStateFlagBit.BLEND_CONSTANTS: {\r\n                const blendConstant = dynamicStates.blendConstant;\r\n                if ((cacheBS.blendColor.x !== blendConstant.x)\r\n                    || (cacheBS.blendColor.y !== blendConstant.y)\r\n                    || (cacheBS.blendColor.z !== blendConstant.z)\r\n                    || (cacheBS.blendColor.w !== blendConstant.w)) {\r\n                    gl.blendColor(blendConstant.x, blendConstant.y, blendConstant.z, blendConstant.w);\r\n                    cacheBS.blendColor.copy(blendConstant);\r\n                }\r\n                break;\r\n            }\r\n            case DynamicStateFlagBit.STENCIL_WRITE_MASK: {\r\n                const front = dynamicStates.stencilStatesFront;\r\n                const back = dynamicStates.stencilStatesBack;\r\n                if (cacheDSS.stencilWriteMaskFront !== front.writeMask) {\r\n                    gl.stencilMaskSeparate(WebGLConstants.FRONT, front.writeMask);\r\n                    cacheDSS.stencilWriteMaskFront = front.writeMask;\r\n                }\r\n                if (cacheDSS.stencilWriteMaskBack !== back.writeMask) {\r\n                    gl.stencilMaskSeparate(WebGLConstants.BACK, back.writeMask);\r\n                    cacheDSS.stencilWriteMaskBack = back.writeMask;\r\n                }\r\n                break;\r\n            }\r\n            case DynamicStateFlagBit.STENCIL_COMPARE_MASK: {\r\n                const front = dynamicStates.stencilStatesFront;\r\n                const back = dynamicStates.stencilStatesBack;\r\n                if (cacheDSS.stencilRefFront !== front.reference\r\n                    || cacheDSS.stencilReadMaskFront !== front.compareMask) {\r\n                    gl.stencilFuncSeparate(WebGLConstants.FRONT, WebGLCmpFuncs[cacheDSS.stencilFuncFront], front.reference, front.compareMask);\r\n                    cacheDSS.stencilRefFront = front.reference;\r\n                    cacheDSS.stencilReadMaskFront = front.compareMask;\r\n                }\r\n                if (cacheDSS.stencilRefBack !== back.reference\r\n                    || cacheDSS.stencilReadMaskBack !== back.compareMask) {\r\n                    gl.stencilFuncSeparate(WebGLConstants.BACK, WebGLCmpFuncs[cacheDSS.stencilFuncBack], back.reference, back.compareMask);\r\n                    cacheDSS.stencilRefBack = back.reference;\r\n                    cacheDSS.stencilReadMaskBack = back.compareMask;\r\n                }\r\n                break;\r\n            }\r\n            default:\r\n            } // switch\r\n        } // for\r\n    } // update dynamic states\r\n}\r\n\r\nexport function WebGLCmdFuncDraw (device: WebGLDevice, drawInfo: Readonly<DrawInfo>): void {\r\n    const { gl } = device;\r\n    const { ANGLE_instanced_arrays: ia, WEBGL_multi_draw: md } = device.extensions;\r\n    const { gpuInputAssembler, glPrimitive } = gfxStateCache;\r\n\r\n    if (gpuInputAssembler) {\r\n        const indexBuffer = gpuInputAssembler.gpuIndexBuffer;\r\n        if (gpuInputAssembler.gpuIndirectBuffer) {\r\n            const indirects = gpuInputAssembler.gpuIndirectBuffer.indirects;\r\n            if (indirects.drawByIndex) {\r\n                for (let j = 0; j < indirects.drawCount; j++) {\r\n                    indirects.byteOffsets[j] = indirects.offsets[j] * indexBuffer!.stride;\r\n                }\r\n                if (md) {\r\n                    if (indirects.instancedDraw) {\r\n                        md.multiDrawElementsInstancedWEBGL(\r\n                            glPrimitive,\r\n                            indirects.counts,\r\n                            0,\r\n                            gpuInputAssembler.glIndexType,\r\n                            indirects.byteOffsets,\r\n                            0,\r\n                            indirects.instances,\r\n                            0,\r\n                            indirects.drawCount,\r\n                        );\r\n                    } else {\r\n                        md.multiDrawElementsWEBGL(\r\n                            glPrimitive,\r\n                            indirects.counts,\r\n                            0,\r\n                            gpuInputAssembler.glIndexType,\r\n                            indirects.byteOffsets,\r\n                            0,\r\n                            indirects.drawCount,\r\n                        );\r\n                    }\r\n                } else {\r\n                    for (let j = 0; j < indirects.drawCount; j++) {\r\n                        if (indirects.instances[j] && ia) {\r\n                            ia.drawElementsInstancedANGLE(\r\n                                glPrimitive,\r\n                                indirects.counts[j],\r\n                                gpuInputAssembler.glIndexType,\r\n                                indirects.byteOffsets[j],\r\n                                indirects.instances[j],\r\n                            );\r\n                        } else {\r\n                            gl.drawElements(glPrimitive, indirects.counts[j], gpuInputAssembler.glIndexType, indirects.byteOffsets[j]);\r\n                        }\r\n                    }\r\n                }\r\n            } else if (md) {\r\n                if (indirects.instancedDraw) {\r\n                    md.multiDrawArraysInstancedWEBGL(\r\n                        glPrimitive,\r\n                        indirects.offsets,\r\n                        0,\r\n                        indirects.counts,\r\n                        0,\r\n                        indirects.instances,\r\n                        0,\r\n                        indirects.drawCount,\r\n                    );\r\n                } else {\r\n                    md.multiDrawArraysWEBGL(\r\n                        glPrimitive,\r\n                        indirects.offsets,\r\n                        0,\r\n                        indirects.counts,\r\n                        0,\r\n                        indirects.drawCount,\r\n                    );\r\n                }\r\n            } else {\r\n                for (let j = 0; j < indirects.drawCount; j++) {\r\n                    if (indirects.instances[j] && ia) {\r\n                        ia.drawArraysInstancedANGLE(glPrimitive, indirects.offsets[j], indirects.counts[j], indirects.instances[j]);\r\n                    } else {\r\n                        gl.drawArrays(glPrimitive, indirects.offsets[j], indirects.counts[j]);\r\n                    }\r\n                }\r\n            }\r\n        } else if (drawInfo.instanceCount && ia) {\r\n            if (indexBuffer) {\r\n                if (drawInfo.indexCount > 0) {\r\n                    const offset = drawInfo.firstIndex * indexBuffer.stride;\r\n                    ia.drawElementsInstancedANGLE(\r\n                        glPrimitive,\r\n                        drawInfo.indexCount,\r\n                        gpuInputAssembler.glIndexType,\r\n                        offset,\r\n                        drawInfo.instanceCount,\r\n                    );\r\n                }\r\n            } else if (drawInfo.vertexCount > 0) {\r\n                ia.drawArraysInstancedANGLE(glPrimitive, drawInfo.firstVertex, drawInfo.vertexCount, drawInfo.instanceCount);\r\n            }\r\n        } else if (indexBuffer) {\r\n            if (drawInfo.indexCount > 0) {\r\n                const offset = drawInfo.firstIndex * indexBuffer.stride;\r\n                gl.drawElements(glPrimitive, drawInfo.indexCount, gpuInputAssembler.glIndexType, offset);\r\n            }\r\n        } else if (drawInfo.vertexCount > 0) {\r\n            gl.drawArrays(glPrimitive, drawInfo.firstVertex, drawInfo.vertexCount);\r\n        }\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncCopyTexImagesToTexture (\r\n    device: WebGLDevice,\r\n    texImages: Readonly<TexImageSource[]>,\r\n    gpuTexture: IWebGLGPUTexture,\r\n    regions: Readonly<BufferTextureCopy[]>,\r\n): void {\r\n    const { gl, stateCache } = device;\r\n    const glTexUnit = stateCache.glTexUnits[stateCache.texUnit];\r\n    if (glTexUnit.glTexture !== gpuTexture.glTexture) {\r\n        gl.bindTexture(gpuTexture.glTarget, gpuTexture.glTexture);\r\n        glTexUnit.glTexture = gpuTexture.glTexture;\r\n    }\r\n\r\n    let n = 0;\r\n    let f = 0;\r\n\r\n    switch (gpuTexture.glTarget) {\r\n    case WebGLConstants.TEXTURE_2D: {\r\n        for (let i = 0; i < regions.length; i++) {\r\n            const region = regions[i];\r\n            // console.debug('Copying image to texture 2D: ' + region.texExtent.width + ' x ' + region.texExtent.height);\r\n            gl.texSubImage2D(\r\n                WebGLConstants.TEXTURE_2D,\r\n                region.texSubres.mipLevel,\r\n                region.texOffset.x,\r\n                region.texOffset.y,\r\n                gpuTexture.glFormat,\r\n                gpuTexture.glType,\r\n                texImages[n++],\r\n            );\r\n        }\r\n        break;\r\n    }\r\n    case WebGLConstants.TEXTURE_CUBE_MAP: {\r\n        for (let i = 0; i < regions.length; i++) {\r\n            const region = regions[i];\r\n            const regionTexOffset = region.texOffset;\r\n            const regionTexSubres = region.texSubres;\r\n            // console.debug('Copying image to texture cube: ' + region.texExtent.width + ' x ' + region.texExtent.height);\r\n            const fcount = regionTexSubres.baseArrayLayer + regionTexSubres.layerCount;\r\n            for (f = regionTexSubres.baseArrayLayer; f < fcount; ++f) {\r\n                gl.texSubImage2D(\r\n                    WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f,\r\n                    regionTexSubres.mipLevel,\r\n                    regionTexOffset.x,\r\n                    regionTexOffset.y,\r\n                    gpuTexture.glFormat,\r\n                    gpuTexture.glType,\r\n                    texImages[n++],\r\n                );\r\n            }\r\n        }\r\n        break;\r\n    }\r\n    default: {\r\n        errorID(16327);\r\n    }\r\n    }\r\n\r\n    if ((gpuTexture.flags & TextureFlagBit.GEN_MIPMAP)\r\n        && gpuTexture.isPowerOf2) {\r\n        gl.generateMipmap(gpuTexture.glTarget);\r\n    }\r\n}\r\n\r\nlet stagingBuffer = new Uint8Array(1);\r\nfunction pixelBufferPick (\r\n    buffer: ArrayBufferView,\r\n    format: Format,\r\n    offset: number,\r\n    stride: Extent,\r\n    extent: Extent,\r\n): ArrayBufferView {\r\n    const blockHeight = formatAlignment(format).height;\r\n\r\n    const bufferSize = FormatSize(format, extent.width, extent.height, extent.depth);\r\n    const rowStride = FormatSize(format, stride.width, 1, 1);\r\n    const sliceStride = FormatSize(format, stride.width, stride.height, 1);\r\n    const chunkSize = FormatSize(format, extent.width, 1, 1);\r\n\r\n    const ArrayBufferCtor: TypedArrayConstructor = getTypedArrayConstructor(FormatInfos[format]);\r\n\r\n    if (stagingBuffer.byteLength < bufferSize) {\r\n        stagingBuffer = new Uint8Array(bufferSize);\r\n    }\r\n\r\n    let destOffset = 0;\r\n    let bufferOffset = offset;\r\n\r\n    for (let i = 0; i < extent.depth; i++) {\r\n        bufferOffset = offset + sliceStride * i;\r\n        for (let j = 0; j < extent.height; j += blockHeight) {\r\n            stagingBuffer.subarray(destOffset, destOffset + chunkSize).set(\r\n                new Uint8Array(buffer.buffer, buffer.byteOffset + bufferOffset, chunkSize),\r\n            );\r\n            destOffset += chunkSize;\r\n            bufferOffset += rowStride;\r\n        }\r\n    }\r\n    const length = bufferSize / ArrayBufferCtor.BYTES_PER_ELEMENT;\r\n    assertID(Number.isInteger(length), 9101);\r\n    return new ArrayBufferCtor(stagingBuffer.buffer, 0, length);\r\n}\r\n\r\nexport function WebGLCmdFuncCopyBuffersToTexture (\r\n    device: WebGLDevice,\r\n    buffers: Readonly<ArrayBufferView[]>,\r\n    gpuTexture: IWebGLGPUTexture,\r\n    regions: Readonly<BufferTextureCopy[]>,\r\n): void {\r\n    const { gl, stateCache } = device;\r\n    const glTexUnit = stateCache.glTexUnits[stateCache.texUnit];\r\n    if (glTexUnit.glTexture !== gpuTexture.glTexture) {\r\n        gl.bindTexture(gpuTexture.glTarget, gpuTexture.glTexture);\r\n        glTexUnit.glTexture = gpuTexture.glTexture;\r\n    }\r\n\r\n    let n = 0;\r\n    let f = 0;\r\n    const fmtInfo: FormatInfo = FormatInfos[gpuTexture.format];\r\n    const ArrayBufferCtor: TypedArrayConstructor = getTypedArrayConstructor(fmtInfo);\r\n    const { isCompressed } = fmtInfo;\r\n\r\n    const blockSize = formatAlignment(gpuTexture.format);\r\n\r\n    const extent: Extent = new Extent();\r\n    const offset: Offset = new Offset();\r\n    const stride: Extent = new Extent();\r\n\r\n    switch (gpuTexture.glTarget) {\r\n    case WebGLConstants.TEXTURE_2D: {\r\n        for (let i = 0; i < regions.length; i++) {\r\n            const region = regions[i];\r\n            const mipLevel = region.texSubres.mipLevel;\r\n\r\n            const regionTexOffset = region.texOffset;\r\n            const regionTexExtent = region.texExtent;\r\n            const regionTexExtentWidth = regionTexExtent.width;\r\n            const regionTexExtentHeight = regionTexExtent.height;\r\n            const blockSizeWidth = blockSize.width;\r\n            const blockSizeHeight = blockSize.height;\r\n            const regionBuffStride = region.buffStride;\r\n\r\n            offset.x =  regionTexOffset.x === 0 ? 0 : alignTo(regionTexOffset.x, blockSizeWidth);\r\n            offset.y =  regionTexOffset.y === 0 ? 0 : alignTo(regionTexOffset.y, blockSizeHeight);\r\n            extent.width = regionTexExtentWidth < blockSizeWidth ? regionTexExtentWidth : alignTo(regionTexExtentWidth, blockSizeWidth);\r\n            extent.height = regionTexExtentHeight < blockSizeHeight ? regionTexExtentWidth\r\n                : alignTo(regionTexExtentHeight, blockSizeHeight);\r\n            stride.width = regionBuffStride > 0 ?  regionBuffStride : extent.width;\r\n            stride.height = region.buffTexHeight > 0 ? region.buffTexHeight : extent.height;\r\n\r\n            const destWidth  = (regionTexExtentWidth + offset.x === (gpuTexture.width >> mipLevel)) ? regionTexExtentWidth : extent.width;\r\n            const destHeight = (regionTexExtentHeight + offset.y === (gpuTexture.height >> mipLevel)) ? regionTexExtentHeight : extent.height;\r\n\r\n            let pixels: ArrayBufferView;\r\n            const buffer = buffers[n++];\r\n            if (stride.width === extent.width && stride.height === extent.height) {\r\n                const length = FormatSize(gpuTexture.format, destWidth, destHeight, 1) / ArrayBufferCtor.BYTES_PER_ELEMENT;\r\n                assertID(Number.isInteger(length), 9101);\r\n                pixels = new ArrayBufferCtor(buffer.buffer, buffer.byteOffset + region.buffOffset, length);\r\n            } else {\r\n                pixels = pixelBufferPick(buffer, gpuTexture.format, region.buffOffset, stride, extent);\r\n            }\r\n\r\n            if (!isCompressed) {\r\n                gl.texSubImage2D(\r\n                    WebGLConstants.TEXTURE_2D,\r\n                    mipLevel,\r\n                    offset.x,\r\n                    offset.y,\r\n                    destWidth,\r\n                    destHeight,\r\n                    gpuTexture.glFormat,\r\n                    gpuTexture.glType,\r\n                    pixels,\r\n                );\r\n            } else if (gpuTexture.glInternalFmt !== (WebGLEXT.COMPRESSED_RGB_ETC1_WEBGL as number) && !device.extensions.noCompressedTexSubImage2D) {\r\n                gl.compressedTexSubImage2D(\r\n                    WebGLConstants.TEXTURE_2D,\r\n                    mipLevel,\r\n                    offset.x,\r\n                    offset.y,\r\n                    destWidth,\r\n                    destHeight,\r\n                    gpuTexture.glFormat,\r\n                    pixels,\r\n                );\r\n            } else { // WEBGL_compressed_texture_etc1\r\n                gl.compressedTexImage2D(\r\n                    WebGLConstants.TEXTURE_2D,\r\n                    mipLevel,\r\n                    gpuTexture.glInternalFmt,\r\n                    destWidth,\r\n                    destHeight,\r\n                    0,\r\n                    pixels,\r\n                );\r\n            }\r\n        }\r\n        break;\r\n    }\r\n    case WebGLConstants.TEXTURE_CUBE_MAP: {\r\n        for (let i = 0; i < regions.length; i++) {\r\n            const region = regions[i];\r\n            const mipLevel = region.texSubres.mipLevel;\r\n\r\n            const regionTexOffset = region.texOffset;\r\n            const regionTexExtent = region.texExtent;\r\n            const regionTexSubres = region.texSubres;\r\n            const regionTexExtentWidth = regionTexExtent.width;\r\n            const regionTexExtentHeight = regionTexExtent.height;\r\n            const blockSizeWidth = blockSize.width;\r\n            const blockSizeHeight = blockSize.height;\r\n\r\n            offset.x =  regionTexOffset.x === 0 ? 0 : alignTo(regionTexOffset.x, blockSizeWidth);\r\n            offset.y =  regionTexOffset.y === 0 ? 0 : alignTo(regionTexOffset.y, blockSizeHeight);\r\n            extent.width = regionTexExtentWidth < blockSizeWidth ? regionTexExtentWidth : alignTo(regionTexExtentWidth, blockSizeWidth);\r\n            extent.height = regionTexExtentHeight < blockSizeHeight ? regionTexExtentWidth\r\n                : alignTo(regionTexExtentHeight, blockSizeHeight);\r\n            stride.width = region.buffStride > 0 ?  region.buffStride : extent.width;\r\n            stride.height = region.buffTexHeight > 0 ? region.buffTexHeight : extent.height;\r\n\r\n            const destWidth  = (regionTexExtentWidth + offset.x === (gpuTexture.width >> mipLevel)) ? regionTexExtentWidth : extent.width;\r\n            const destHeight = (regionTexExtentHeight + offset.y === (gpuTexture.height >> mipLevel)) ? regionTexExtentHeight : extent.height;\r\n\r\n            const fcount = regionTexSubres.baseArrayLayer + regionTexSubres.layerCount;\r\n            for (f = regionTexSubres.baseArrayLayer; f < fcount; ++f) {\r\n                let pixels: ArrayBufferView;\r\n                const buffer = buffers[n++];\r\n                if (stride.width === extent.width && stride.height === extent.height) {\r\n                    const length = FormatSize(gpuTexture.format, destWidth, destHeight, 1) / ArrayBufferCtor.BYTES_PER_ELEMENT;\r\n                    assertID(Number.isInteger(length), 9101);\r\n                    pixels = new ArrayBufferCtor(buffer.buffer, buffer.byteOffset + region.buffOffset, length);\r\n                } else {\r\n                    pixels = pixelBufferPick(buffer, gpuTexture.format, region.buffOffset, stride, extent);\r\n                }\r\n\r\n                if (!isCompressed) {\r\n                    gl.texSubImage2D(\r\n                        WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f,\r\n                        mipLevel,\r\n                        offset.x,\r\n                        offset.y,\r\n                        destWidth,\r\n                        destHeight,\r\n                        gpuTexture.glFormat,\r\n                        gpuTexture.glType,\r\n                        pixels,\r\n                    );\r\n                } else if (gpuTexture.glInternalFmt !== (WebGLEXT.COMPRESSED_RGB_ETC1_WEBGL as number)\r\n                    && !device.extensions.noCompressedTexSubImage2D) {\r\n                    gl.compressedTexSubImage2D(\r\n                        WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f,\r\n                        mipLevel,\r\n                        offset.x,\r\n                        offset.y,\r\n                        destWidth,\r\n                        destHeight,\r\n                        gpuTexture.glFormat,\r\n                        pixels,\r\n                    );\r\n                } else { // WEBGL_compressed_texture_etc1\r\n                    gl.compressedTexImage2D(\r\n                        WebGLConstants.TEXTURE_CUBE_MAP_POSITIVE_X + f,\r\n                        mipLevel,\r\n                        gpuTexture.glInternalFmt,\r\n                        destWidth,\r\n                        destHeight,\r\n                        0,\r\n                        pixels,\r\n                    );\r\n                }\r\n            }\r\n        }\r\n        break;\r\n    }\r\n    default: {\r\n        errorID(16327);\r\n    }\r\n    }\r\n\r\n    if (gpuTexture.flags & TextureFlagBit.GEN_MIPMAP) {\r\n        gl.generateMipmap(gpuTexture.glTarget);\r\n    }\r\n}\r\n\r\nexport function WebGLCmdFuncCopyTextureToBuffers (\r\n    device: WebGLDevice,\r\n    gpuTexture: IWebGLGPUTexture,\r\n    buffers: Readonly<ArrayBufferView[]>,\r\n    regions: Readonly<BufferTextureCopy[]>,\r\n): void {\r\n    const { gl } = device;\r\n    const cache = device.stateCache;\r\n\r\n    const framebuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, framebuffer);\r\n    let x = 0;\r\n    let y = 0;\r\n    let w = 1;\r\n    let h = 1;\r\n\r\n    switch (gpuTexture.glTarget) {\r\n    case WebGLConstants.TEXTURE_2D: {\r\n        for (let k = 0; k < regions.length; k++) {\r\n            const region = regions[k];\r\n            gl.framebufferTexture2D(\r\n                WebGLConstants.FRAMEBUFFER,\r\n                WebGLConstants.COLOR_ATTACHMENT0,\r\n                gpuTexture.glTarget,\r\n                gpuTexture.glTexture,\r\n                region.texSubres.mipLevel,\r\n            );\r\n            x = region.texOffset.x;\r\n            y = region.texOffset.y;\r\n            w = region.texExtent.width;\r\n            h = region.texExtent.height;\r\n            gl.readPixels(x, y, w, h, gpuTexture.glFormat, gpuTexture.glType, buffers[k]);\r\n        }\r\n        break;\r\n    }\r\n    default: {\r\n        errorID(16399);\r\n    }\r\n    }\r\n    gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, null);\r\n    cache.glFramebuffer = null;\r\n    gl.deleteFramebuffer(framebuffer);\r\n}\r\n\r\nexport function WebGLCmdFuncBlitTexture (\r\n    device: WebGLDevice,\r\n    srcTexture: Readonly<IWebGLGPUTexture>,\r\n    dstTexture: IWebGLGPUTexture,\r\n    regions: Readonly<TextureBlit []>,\r\n    filter: Filter,\r\n): void {\r\n    // logic different from native, because framebuffer map is not implemented in webgl\r\n    device.blitManager.draw(srcTexture, dstTexture, regions as TextureBlit[], filter);\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport {\r\n    DescriptorType, BufferUsage, Format, MemoryUsage, SampleCount, DynamicStateFlagBit,\r\n    ShaderStageFlagBit, TextureFlags, TextureType, TextureUsage, Type,\r\n    Attribute, ColorAttachment, DepthStencilAttachment,\r\n    UniformBlock, UniformSamplerTexture, DescriptorSetLayoutBinding,\r\n    DrawInfo, UniformInputAttachment, Uniform, BufferUsageBit, MemoryUsageBit,\r\n    TextureBlit, Filter, FormatInfos,\r\n} from '../base/define';\r\nimport { BlendState, DepthStencilState, RasterizerState } from '../base/pipeline-state';\r\nimport { WebGLCmdFuncBindStates, WebGLCmdFuncCreateBuffer, WebGLCmdFuncCreateInputAssember,\r\n    WebGLCmdFuncCreateShader, WebGLCmdFuncDestroyBuffer, WebGLCmdFuncDestroyInputAssembler,\r\n    WebGLCmdFuncDestroyShader, WebGLCmdFuncDraw, WebGLCmdFuncUpdateBuffer,\r\n} from './webgl-commands';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { WebGLConstants } from '../gl-constants';\r\nimport { nextPow2 } from '../../core/math/bits';\r\n\r\nfunction createInt32Array (capacity: number): Int32Array {\r\n    return new Int32Array(capacity);\r\n}\r\n\r\n/** @mangle */\r\nexport class WebGLIndirectDrawInfos {\r\n    public declare counts: Int32Array;\r\n    public declare offsets: Int32Array;\r\n    public declare instances: Int32Array;\r\n    public drawCount = 0;\r\n    public drawByIndex = false;\r\n    public instancedDraw = false;\r\n\r\n    // staging buffer\r\n    public declare byteOffsets: Int32Array;\r\n\r\n    private _capacity = 4;\r\n\r\n    constructor () {\r\n        this.counts = createInt32Array(this._capacity);\r\n        this.offsets = createInt32Array(this._capacity);\r\n        this.instances  = createInt32Array(this._capacity);\r\n        this.byteOffsets = createInt32Array(this._capacity);\r\n    }\r\n\r\n    public clearDraws (): void {\r\n        this.drawCount = 0;\r\n        this.drawByIndex = false;\r\n        this.instancedDraw = false;\r\n    }\r\n\r\n    public setDrawInfo (idx: number, info: Readonly<DrawInfo>): void {\r\n        this._ensureCapacity(idx);\r\n        this.drawByIndex = info.indexCount > 0;\r\n        this.instancedDraw = !!info.instanceCount;\r\n        this.drawCount = Math.max(idx + 1, this.drawCount);\r\n\r\n        if (this.drawByIndex) {\r\n            this.counts[idx] = info.indexCount;\r\n            this.offsets[idx] = info.firstIndex;\r\n        } else {\r\n            this.counts[idx] = info.vertexCount;\r\n            this.offsets[idx] = info.firstVertex;\r\n        }\r\n        this.instances[idx] = Math.max(1, info.instanceCount);\r\n    }\r\n\r\n    private _ensureCapacity (target: number): void {\r\n        if (this._capacity > target) return;\r\n        this._capacity = nextPow2(target);\r\n\r\n        const counts = createInt32Array(this._capacity);\r\n        const offsets = createInt32Array(this._capacity);\r\n        const instances = createInt32Array(this._capacity);\r\n        this.byteOffsets = createInt32Array(this._capacity);\r\n\r\n        counts.set(this.counts);\r\n        offsets.set(this.offsets);\r\n        instances.set(this.instances);\r\n\r\n        this.counts = counts;\r\n        this.offsets = offsets;\r\n        this.instances = instances;\r\n    }\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUUniformInfo {\r\n    name: string;\r\n    type: Type;\r\n    count: number;\r\n    offset: number;\r\n    view: Float32Array | Int32Array;\r\n    isDirty: boolean;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLBindingMapping {\r\n    blockOffsets: number[];\r\n    samplerTextureOffsets: number[];\r\n    flexibleSet: number;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUBufferView {\r\n    gpuBuffer: IWebGLGPUBuffer;\r\n    offset: number;\r\n    range: number;\r\n}\r\n\r\nexport interface IWebGLGPUBuffer {\r\n    /** @mangle */\r\n    usage: BufferUsage;\r\n    /** @mangle */\r\n    memUsage: MemoryUsage;\r\n    /** @mangle */\r\n    size: number;\r\n    /** @mangle */\r\n    stride: number;\r\n\r\n    /** @mangle */\r\n    glTarget: GLenum;\r\n    /** @mangle */\r\n    glBuffer: WebGLBuffer | null;\r\n\r\n    /** @mangle */\r\n    buffer: ArrayBufferView | null;\r\n    // Should not mangle vf32 since there is a `if ('vf32' in gpuBuffer)` code in webgl-commands.ts\r\n    vf32: Float32Array | null;\r\n    /** @mangle */\r\n    indirects: WebGLIndirectDrawInfos;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUTexture {\r\n    type: TextureType;\r\n    format: Format;\r\n    usage: TextureUsage;\r\n    width: number;\r\n    height: number;\r\n    depth: number;\r\n    size: number;\r\n    arrayLayer: number;\r\n    mipLevel: number;\r\n    samples: SampleCount;\r\n    flags: TextureFlags;\r\n    isPowerOf2: boolean;\r\n\r\n    glTarget: GLenum;\r\n    glInternalFmt: GLenum;\r\n    glFormat: GLenum;\r\n    glType: GLenum;\r\n    glUsage: GLenum;\r\n    glTexture: WebGLTexture | null;\r\n    glRenderbuffer: WebGLRenderbuffer | null;\r\n    glWrapS: GLenum;\r\n    glWrapT: GLenum;\r\n    glMinFilter: GLenum;\r\n    glMagFilter: GLenum;\r\n    isSwapchainTexture: boolean;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPURenderPass {\r\n    colorAttachments: ColorAttachment[];\r\n    depthStencilAttachment: DepthStencilAttachment | null;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUFramebuffer {\r\n    gpuRenderPass: IWebGLGPURenderPass;\r\n    gpuColorTextures: IWebGLGPUTexture[];\r\n    gpuDepthStencilTexture: IWebGLGPUTexture | null;\r\n    glFramebuffer: WebGLFramebuffer | null;\r\n    isOffscreen: boolean;\r\n    width: number;\r\n    height: number;\r\n    lodLevel: number;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUSampler {\r\n    glMinFilter: GLenum;\r\n    glMagFilter: GLenum;\r\n    glWrapS: GLenum;\r\n    glWrapT: GLenum;\r\n    glWrapR: GLenum;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUInput {\r\n    binding: number;\r\n    name: string;\r\n    type: Type;\r\n    stride: number;\r\n    count: number;\r\n    size: number;\r\n\r\n    glType: GLenum;\r\n    glLoc: GLint;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUUniform {\r\n    binding: number;\r\n    name: string;\r\n    type: Type;\r\n    stride: number;\r\n    count: number;\r\n    size: number;\r\n    offset: number;\r\n\r\n    glType: GLenum;\r\n    glLoc: WebGLUniformLocation;\r\n    array: Int32Array | Float32Array;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUUniformBlock {\r\n    set: number;\r\n    binding: number;\r\n    name: string;\r\n    size: number;\r\n    glUniforms: IWebGLGPUUniform[];\r\n    glActiveUniforms: IWebGLGPUUniform[];\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUUniformSamplerTexture {\r\n    set: number;\r\n    binding: number;\r\n    name: string;\r\n    type: Type;\r\n    count: number;\r\n    units: number[];\r\n    glUnits: Int32Array;\r\n\r\n    glType: GLenum;\r\n    glLoc: WebGLUniformLocation;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUShaderStage {\r\n    type: ShaderStageFlagBit;\r\n    source: string;\r\n    glShader: WebGLShader | null;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUShader {\r\n    name: string;\r\n    blocks: UniformBlock[];\r\n    samplerTextures: UniformSamplerTexture[];\r\n    subpassInputs: UniformInputAttachment[];\r\n\r\n    gpuStages: IWebGLGPUShaderStage[];\r\n    glProgram: WebGLProgram | null;\r\n    glInputs: IWebGLGPUInput[];\r\n    glUniforms: IWebGLGPUUniform[];\r\n    glBlocks: IWebGLGPUUniformBlock[];\r\n    glSamplerTextures: IWebGLGPUUniformSamplerTexture[];\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUDescriptorSetLayout {\r\n    bindings: DescriptorSetLayoutBinding[];\r\n    dynamicBindings: number[];\r\n    descriptorIndices: number[];\r\n    descriptorCount: number;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUPipelineLayout {\r\n    gpuSetLayouts: IWebGLGPUDescriptorSetLayout[];\r\n    dynamicOffsetCount: number;\r\n    dynamicOffsetOffsets: number[];\r\n    dynamicOffsetIndices: number[][];\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUPipelineState {\r\n    glPrimitive: GLenum;\r\n    gpuShader: IWebGLGPUShader | null;\r\n    gpuPipelineLayout: IWebGLGPUPipelineLayout | null;\r\n    rs: RasterizerState;\r\n    dss: DepthStencilState;\r\n    bs: BlendState;\r\n    dynamicStates: DynamicStateFlagBit[];\r\n    gpuRenderPass: IWebGLGPURenderPass | null;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUDescriptor {\r\n    type: DescriptorType;\r\n    gpuBuffer: IWebGLGPUBuffer | IWebGLGPUBufferView | null;\r\n    gpuTexture: IWebGLGPUTexture | null;\r\n    gpuSampler: IWebGLGPUSampler | null;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUDescriptorSet {\r\n    gpuDescriptors: IWebGLGPUDescriptor[];\r\n    descriptorIndices: number[];\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLAttrib {\r\n    name: string;\r\n    glBuffer: WebGLBuffer | null;\r\n    glType: GLenum;\r\n    size: number;\r\n    count: number;\r\n    stride: number;\r\n    componentCount: number;\r\n    isNormalized: boolean;\r\n    isInstanced: boolean;\r\n    offset: number;\r\n}\r\n\r\n/** @mangle */\r\nexport interface IWebGLGPUInputAssembler {\r\n    attributes: Attribute[];\r\n    gpuVertexBuffers: IWebGLGPUBuffer[];\r\n    gpuIndexBuffer: IWebGLGPUBuffer | null;\r\n    gpuIndirectBuffer: IWebGLGPUBuffer | null;\r\n\r\n    glAttribs: IWebGLAttrib[];\r\n    glIndexType: GLenum;\r\n    glVAOs: Map<WebGLProgram, WebGLVertexArrayObjectOES>;\r\n}\r\n\r\n/** @mangle */\r\nexport class IWebGLBlitManager {\r\n    private _gpuShader: IWebGLGPUShader | null = null;\r\n    private _gpuDescriptorSetLayout: IWebGLGPUDescriptorSetLayout | null = null;\r\n    private _gpuPipelineLayout: IWebGLGPUPipelineLayout | null = null;\r\n    private _gpuPipelineState: IWebGLGPUPipelineState | null = null;\r\n\r\n    private _gpuVertexBuffer: IWebGLGPUBuffer | null = null;\r\n    private _gpuInputAssembler: IWebGLGPUInputAssembler | null = null;\r\n    private _gpuPointSampler: IWebGLGPUSampler | null = null;\r\n    private _gpuLinearSampler: IWebGLGPUSampler | null = null;\r\n    private _gpuDescriptorSet: IWebGLGPUDescriptorSet | null = null;\r\n    private _gpuUniformBuffer: IWebGLGPUBuffer | null = null;\r\n    private _drawInfo: DrawInfo | null = null;\r\n    private _glFramebuffer: WebGLFramebuffer | null = null;\r\n\r\n    private _uniformBuffer: Float32Array | null = null;\r\n\r\n    constructor () {\r\n        const device = WebGLDeviceManager.instance;\r\n        const samplerOffset = device.bindingMappingInfo.maxBlockCounts[0];\r\n\r\n        this._gpuShader = {\r\n            name: 'Blit Pass',\r\n            blocks: [\r\n                new UniformBlock(\r\n                    0,\r\n                    0,\r\n                    `BlitParams`,\r\n                    [\r\n                        new Uniform(`tilingOffsetSrc`, Type.FLOAT4, 1),\r\n                        new Uniform(`tilingOffsetDst`, Type.FLOAT4, 1),\r\n                    ],\r\n                    1,\r\n                ),\r\n            ],\r\n            samplerTextures: [new UniformSamplerTexture(0, samplerOffset, 'textureSrc', Type.SAMPLER2D, 1)],\r\n            subpassInputs: [],\r\n            gpuStages: [\r\n                {\r\n                    type: ShaderStageFlagBit.VERTEX,\r\n                    source: `\r\nprecision mediump float;\r\nattribute vec2 a_position;\r\nattribute vec2 a_texCoord;\r\nuniform vec4 tilingOffsetSrc;\r\nuniform vec4 tilingOffsetDst;\r\nvarying vec2 v_texCoord;\r\nvoid main() {\r\n    v_texCoord = a_texCoord * tilingOffsetSrc.xy + tilingOffsetSrc.zw;\r\n    gl_Position = vec4((a_position + 1.0) * tilingOffsetDst.xy - 1.0 + tilingOffsetDst.zw * 2.0, 0, 1);\r\n}`,\r\n                    glShader: null },\r\n                {\r\n                    type: ShaderStageFlagBit.FRAGMENT,\r\n                    source: `\r\nprecision mediump float;\r\nuniform sampler2D textureSrc;\r\nvarying vec2 v_texCoord;\r\nvoid main() {\r\n    gl_FragColor = texture2D(textureSrc, v_texCoord);\r\n}`,\r\n                    glShader: null },\r\n\r\n            ],\r\n            glProgram: null,\r\n            glInputs: [],\r\n            glUniforms: [],\r\n            glBlocks: [],\r\n            glSamplerTextures: [],\r\n        };\r\n        WebGLCmdFuncCreateShader(WebGLDeviceManager.instance, this._gpuShader);\r\n\r\n        this._gpuDescriptorSetLayout = {\r\n            bindings: [\r\n                new DescriptorSetLayoutBinding(0, DescriptorType.UNIFORM_BUFFER, 1, ShaderStageFlagBit.VERTEX),\r\n                new DescriptorSetLayoutBinding(samplerOffset, DescriptorType.SAMPLER_TEXTURE, 1, ShaderStageFlagBit.FRAGMENT),\r\n            ],\r\n            dynamicBindings: [],\r\n            descriptorIndices: [],\r\n            descriptorCount: samplerOffset + 1,\r\n        };\r\n        for (let i = 0; i < samplerOffset; i++) {\r\n            this._gpuDescriptorSetLayout.descriptorIndices[i] = 0;\r\n        }\r\n        this._gpuDescriptorSetLayout.descriptorIndices.push(1);\r\n\r\n        this._gpuPipelineLayout = {\r\n            gpuSetLayouts: [this._gpuDescriptorSetLayout],\r\n            dynamicOffsetCount: 0,\r\n            dynamicOffsetOffsets: [0],\r\n            dynamicOffsetIndices: [[]],\r\n        };\r\n\r\n        this._gpuPipelineState = {\r\n            glPrimitive: WebGLConstants.TRIANGLE_STRIP,\r\n            gpuShader: this._gpuShader,\r\n            gpuPipelineLayout: this._gpuPipelineLayout,\r\n            rs: null!,\r\n            dss: new DepthStencilState(false, false),\r\n            bs: null!,\r\n            dynamicStates: [],\r\n            gpuRenderPass: null,\r\n        };\r\n\r\n        this._gpuVertexBuffer = {\r\n            usage: BufferUsageBit.VERTEX,\r\n            memUsage: MemoryUsageBit.DEVICE,\r\n            size: 16 * Float32Array.BYTES_PER_ELEMENT,\r\n            stride: 4 * Float32Array.BYTES_PER_ELEMENT,\r\n            buffer: null,\r\n            vf32: null,\r\n            indirects: new WebGLIndirectDrawInfos(),\r\n            glTarget: 0,\r\n            glBuffer: null,\r\n        };\r\n        WebGLCmdFuncCreateBuffer(WebGLDeviceManager.instance, this._gpuVertexBuffer);\r\n        WebGLDeviceManager.instance.memoryStatus.bufferSize += this._gpuVertexBuffer.size;\r\n        const data  = new Float32Array(\r\n            [-1.0, -1.0, 0.0, 0.0,\r\n                1.0, -1.0, 1.0, 0.0,\r\n                -1.0, 1.0, 0.0, 1.0,\r\n                1.0, 1.0, 1.0, 1.0],\r\n        );\r\n        WebGLCmdFuncUpdateBuffer(WebGLDeviceManager.instance, this._gpuVertexBuffer, data, 0, data.length);\r\n\r\n        this._gpuInputAssembler = {\r\n            attributes: [new Attribute(`a_position`, Format.RG32F), new Attribute(`a_texCoord`, Format.RG32F)],\r\n            gpuVertexBuffers: [this._gpuVertexBuffer],\r\n            gpuIndexBuffer: null,\r\n            gpuIndirectBuffer: null,\r\n\r\n            glAttribs: [],\r\n            glIndexType: 0,\r\n            glVAOs: new Map<WebGLProgram, WebGLVertexArrayObject>(),\r\n        };\r\n        WebGLCmdFuncCreateInputAssember(WebGLDeviceManager.instance, this._gpuInputAssembler);\r\n\r\n        this._gpuPointSampler = {\r\n            glMinFilter: 0x2600, // WebGLRenderingContext.NEAREST\r\n            glMagFilter: 0x2600, // WebGLRenderingContext.NEAREST\r\n            glWrapS: 0x2901, // WebGLRenderingContext.REPEAT,\r\n            glWrapT: 0x2901, // WebGLRenderingContext.REPEAT,\r\n            glWrapR: 0x2901, // WebGLRenderingContext.REPEAT,\r\n        };\r\n\r\n        this._gpuLinearSampler = {\r\n            glMinFilter: 0x2601, // WebGLRenderingContext.LINEAR;\r\n            glMagFilter: 0x2601, // WebGLRenderingContext.LINEAR;\r\n            glWrapS: 0x2901, // WebGLRenderingContext.REPEAT,\r\n            glWrapT: 0x2901, // WebGLRenderingContext.REPEAT,\r\n            glWrapR: 0x2901, // WebGLRenderingContext.REPEAT,\r\n        };\r\n\r\n        this._uniformBuffer = new Float32Array(8);\r\n        this._gpuUniformBuffer = {\r\n            usage: BufferUsageBit.UNIFORM,\r\n            memUsage: MemoryUsageBit.DEVICE,\r\n            size: 8 * Float32Array.BYTES_PER_ELEMENT,\r\n            stride: 8 * Float32Array.BYTES_PER_ELEMENT,\r\n            buffer: this._uniformBuffer,\r\n            vf32: null,\r\n            indirects: new WebGLIndirectDrawInfos(),\r\n            glTarget: 0,\r\n            glBuffer: null,\r\n        };\r\n        WebGLCmdFuncCreateBuffer(WebGLDeviceManager.instance, this._gpuUniformBuffer);\r\n        WebGLDeviceManager.instance.memoryStatus.bufferSize += this._gpuUniformBuffer.size;\r\n\r\n        this._gpuDescriptorSet = {\r\n            gpuDescriptors: [\r\n                { type: DescriptorType.UNIFORM_BUFFER, gpuBuffer: this._gpuUniformBuffer, gpuTexture: null, gpuSampler: null },\r\n                { type: DescriptorType.SAMPLER_TEXTURE, gpuBuffer: null, gpuTexture: null, gpuSampler: null }],\r\n            descriptorIndices: this._gpuDescriptorSetLayout.descriptorIndices,\r\n        };\r\n\r\n        this._drawInfo = new DrawInfo(4, 0, 0, 0, 0, 0, 0);\r\n        this._glFramebuffer = WebGLDeviceManager.instance.gl.createFramebuffer();\r\n    }\r\n\r\n    public destroy (): void {\r\n        if (this._glFramebuffer) {\r\n            WebGLDeviceManager.instance.gl.deleteFramebuffer(this._glFramebuffer);\r\n            this._glFramebuffer = null;\r\n        }\r\n        if (this._gpuVertexBuffer) {\r\n            WebGLDeviceManager.instance.memoryStatus.bufferSize -= this._gpuVertexBuffer.size;\r\n            WebGLCmdFuncDestroyBuffer(WebGLDeviceManager.instance, this._gpuVertexBuffer);\r\n        }\r\n        if (this._gpuUniformBuffer) {\r\n            WebGLDeviceManager.instance.memoryStatus.bufferSize -= this._gpuUniformBuffer.size;\r\n            WebGLCmdFuncDestroyBuffer(WebGLDeviceManager.instance, this._gpuUniformBuffer);\r\n        }\r\n        if (this._gpuShader) {\r\n            WebGLCmdFuncDestroyShader(WebGLDeviceManager.instance, this._gpuShader);\r\n        }\r\n        if (this._gpuInputAssembler) {\r\n            WebGLCmdFuncDestroyInputAssembler(WebGLDeviceManager.instance, this._gpuInputAssembler);\r\n        }\r\n    }\r\n\r\n    public draw (gpuTextureSrc: IWebGLGPUTexture, gpuTextureDst: IWebGLGPUTexture, regions: TextureBlit[], filter: Filter): void {\r\n        const device = WebGLDeviceManager.instance;\r\n        const { gl } = device;\r\n        const stateCache = device.stateCache;\r\n        const origFramebuffer = stateCache.glFramebuffer;\r\n\r\n        gl.viewport(0, 0, gpuTextureDst.width, gpuTextureDst.height);\r\n        gl.scissor(0, 0, gpuTextureDst.width, gpuTextureDst.height);\r\n\r\n        if (!this._uniformBuffer || !this._gpuUniformBuffer || !this._gpuPipelineState\r\n            || !this._gpuInputAssembler || !this._gpuDescriptorSet || !this._drawInfo) {\r\n            return;\r\n        }\r\n\r\n        const descriptor = this._gpuDescriptorSet.gpuDescriptors[1];\r\n        descriptor.gpuTexture = gpuTextureSrc;\r\n        descriptor.gpuSampler = filter === Filter.POINT ? this._gpuPointSampler : this._gpuLinearSampler;\r\n\r\n        const formatInfo = FormatInfos[gpuTextureDst.format];\r\n        let attachment: number = WebGLConstants.COLOR_ATTACHMENT0;\r\n        if (formatInfo.hasStencil) {\r\n            attachment = WebGLConstants.DEPTH_STENCIL_ATTACHMENT;\r\n        } else if (formatInfo.hasDepth) {\r\n            attachment = WebGLConstants.DEPTH_ATTACHMENT;\r\n        }\r\n\r\n        const regionIndices = regions.map((_, i): number => i);\r\n        regionIndices.sort((a, b): number => regions[a].srcSubres.mipLevel - regions[b].srcSubres.mipLevel);\r\n\r\n        if (stateCache.glFramebuffer !== this._glFramebuffer) {\r\n            gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, this._glFramebuffer);\r\n            stateCache.glFramebuffer = this._glFramebuffer;\r\n        }\r\n\r\n        let mipLevel = regions[0].dstSubres.mipLevel;\r\n        if (gpuTextureDst.glTexture) {\r\n            gl.framebufferTexture2D(WebGLConstants.FRAMEBUFFER, attachment, gpuTextureDst.glTarget, gpuTextureDst.glTexture, mipLevel);\r\n        } else {\r\n            gl.framebufferRenderbuffer(WebGLConstants.FRAMEBUFFER, attachment, WebGLConstants.RENDERBUFFER, gpuTextureDst.glRenderbuffer);\r\n        }\r\n\r\n        for (let i = 0; i < regionIndices.length; ++i) {\r\n            const region = regions[regionIndices[i]];\r\n\r\n            if (gpuTextureSrc.glTexture && mipLevel !== region.srcSubres.mipLevel) {\r\n                mipLevel = region.srcSubres.mipLevel;\r\n                gl.framebufferTexture2D(WebGLConstants.FRAMEBUFFER, attachment, gpuTextureDst.glTarget, gpuTextureDst.glTexture, mipLevel);\r\n            }\r\n\r\n            const srcWidth = gpuTextureSrc.width;\r\n            const srcHeight = gpuTextureSrc.height;\r\n            const dstWidth = gpuTextureDst.width;\r\n            const dstHeight = gpuTextureDst.height;\r\n\r\n            this._uniformBuffer[0] = region.srcExtent.width / srcWidth;\r\n            this._uniformBuffer[1] = region.srcExtent.height / srcHeight;\r\n            this._uniformBuffer[2] = region.srcOffset.x / srcWidth;\r\n            this._uniformBuffer[3] = region.srcOffset.y / srcHeight;\r\n            this._uniformBuffer[4] = region.dstExtent.width / dstWidth;\r\n            this._uniformBuffer[5] = region.dstExtent.height / dstHeight;\r\n            this._uniformBuffer[6] = region.dstOffset.x / dstWidth;\r\n            this._uniformBuffer[7] = region.dstOffset.y / dstHeight;\r\n\r\n            WebGLCmdFuncUpdateBuffer(\r\n                device,\r\n                this._gpuUniformBuffer,\r\n                this._uniformBuffer,\r\n                0,\r\n                this._uniformBuffer.length * Float32Array.BYTES_PER_ELEMENT,\r\n            );\r\n            WebGLCmdFuncBindStates(device, this._gpuPipelineState, this._gpuInputAssembler, [this._gpuDescriptorSet], [], null!);\r\n            WebGLCmdFuncDraw(device, this._drawInfo);\r\n        }\r\n\r\n        // restore fbo\r\n        if (stateCache.glFramebuffer !== origFramebuffer) {\r\n            gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, origFramebuffer);\r\n            stateCache.glFramebuffer = origFramebuffer;\r\n        }\r\n        // restore viewport\r\n        const origViewport = stateCache.viewport;\r\n        gl.viewport(origViewport.left, origViewport.top, origViewport.width, origViewport.height);\r\n        // restore scissor\r\n        const origScissor = stateCache.scissorRect;\r\n        gl.scissor(origScissor.x, origScissor.y, origScissor.width, origScissor.height);\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { BufferSource, BufferInfo, BufferViewInfo, BufferUsageBit } from '../base/define';\r\nimport { Buffer } from '../base/buffer';\r\n\r\nimport {\r\n    WebGLCmdFuncCreateBuffer,\r\n    WebGLCmdFuncDestroyBuffer,\r\n    WebGLCmdFuncResizeBuffer,\r\n    WebGLCmdFuncUpdateBuffer,\r\n} from './webgl-commands';\r\nimport { IWebGLGPUBuffer, IWebGLGPUBufferView, WebGLIndirectDrawInfos } from './webgl-gpu-objects';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { warnID } from '../../core/platform/debug';\r\n\r\n/** @mangle */\r\nexport class WebGLBuffer extends Buffer {\r\n    get gpuBuffer (): IWebGLGPUBuffer {\r\n        return  this._gpuBuffer!;\r\n    }\r\n\r\n    get gpuBufferView (): IWebGLGPUBufferView {\r\n        return  this._gpuBufferView!;\r\n    }\r\n\r\n    private _gpuBuffer: IWebGLGPUBuffer | null = null;\r\n    private _gpuBufferView: IWebGLGPUBufferView | null = null;\r\n    private _uniformBuffer: Uint8Array | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<BufferInfo> | Readonly<BufferViewInfo>): void {\r\n        if ('buffer' in info) { // buffer view\r\n            this._isBufferView = true;\r\n\r\n            const buffer = info.buffer as WebGLBuffer;\r\n\r\n            this._usage = buffer.usage;\r\n            this._memUsage = buffer.memUsage;\r\n            this._size = this._stride = info.range;\r\n            this._count = 1;\r\n            this._flags = buffer.flags;\r\n\r\n            this._gpuBufferView = {\r\n                gpuBuffer: buffer.gpuBuffer,\r\n                offset: info.offset,\r\n                range: info.range,\r\n            };\r\n        } else { // native buffer\r\n            this._usage = info.usage;\r\n            this._memUsage = info.memUsage;\r\n            this._size = info.size;\r\n            this._stride = Math.max(info.stride || this._size, 1);\r\n            this._count = this._size / this._stride;\r\n            this._flags = info.flags;\r\n\r\n            if ((this._usage & BufferUsageBit.UNIFORM) && this._size > 0) {\r\n                this._uniformBuffer = new Uint8Array(this._size);\r\n            }\r\n\r\n            this._gpuBuffer = {\r\n                usage: this._usage,\r\n                memUsage: this._memUsage,\r\n                size: this._size,\r\n                stride: this._stride,\r\n                buffer: null,\r\n                vf32: null,\r\n                indirects: new WebGLIndirectDrawInfos(),\r\n                glTarget: 0,\r\n                glBuffer: null,\r\n            };\r\n\r\n            if (this._usage & BufferUsageBit.UNIFORM) {\r\n                this._gpuBuffer.buffer = this._uniformBuffer;\r\n            }\r\n\r\n            WebGLCmdFuncCreateBuffer(WebGLDeviceManager.instance, this._gpuBuffer);\r\n\r\n            WebGLDeviceManager.instance.memoryStatus.bufferSize += this._size;\r\n        }\r\n    }\r\n\r\n    public destroy (): void {\r\n        if (this._gpuBuffer) {\r\n            WebGLCmdFuncDestroyBuffer(WebGLDeviceManager.instance, this._gpuBuffer);\r\n            WebGLDeviceManager.instance.memoryStatus.bufferSize -= this._size;\r\n            this._gpuBuffer = null;\r\n        }\r\n\r\n        if (this._gpuBufferView) {\r\n            this._gpuBufferView = null;\r\n        }\r\n    }\r\n\r\n    public resize (size: number): void {\r\n        if (this._isBufferView) {\r\n            warnID(16379);\r\n            return;\r\n        }\r\n\r\n        const oldSize = this._size;\r\n        if (oldSize === size) { return; }\r\n\r\n        this._size = size;\r\n        this._count = this._size / this._stride;\r\n\r\n        if (this._uniformBuffer) {\r\n            this._uniformBuffer = new Uint8Array(size);\r\n        }\r\n\r\n        if (this._gpuBuffer) {\r\n            if (this._uniformBuffer) {\r\n                this._gpuBuffer.buffer = this._uniformBuffer;\r\n            }\r\n\r\n            this._gpuBuffer.size = size;\r\n            if (size > 0) {\r\n                WebGLCmdFuncResizeBuffer(WebGLDeviceManager.instance, this._gpuBuffer);\r\n                WebGLDeviceManager.instance.memoryStatus.bufferSize -= oldSize;\r\n                WebGLDeviceManager.instance.memoryStatus.bufferSize += size;\r\n            }\r\n        }\r\n    }\r\n\r\n    public update (buffer: Readonly<BufferSource>, size?: number): void {\r\n        if (this._isBufferView) {\r\n            warnID(16380);\r\n            return;\r\n        }\r\n\r\n        let buffSize: number;\r\n        if (size !== undefined) {\r\n            buffSize = size;\r\n        } else if (this._usage & BufferUsageBit.INDIRECT) {\r\n            buffSize = 0;\r\n        } else {\r\n            buffSize = (buffer as ArrayBuffer).byteLength;\r\n        }\r\n\r\n        WebGLCmdFuncUpdateBuffer(\r\n            WebGLDeviceManager.instance,\r\n            this._gpuBuffer!,\r\n            buffer as BufferSource,\r\n            0,\r\n            buffSize,\r\n        );\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { DescriptorSet } from '../base/descriptor-set';\r\nimport { Buffer } from '../base/buffer';\r\nimport { CommandBuffer } from '../base/command-buffer';\r\nimport { Framebuffer } from '../base/framebuffer';\r\nimport { InputAssembler } from '../base/input-assembler';\r\nimport { PipelineState } from '../base/pipeline-state';\r\nimport { Texture } from '../base/texture';\r\nimport { WebGLDescriptorSet } from './webgl-descriptor-set';\r\nimport { IWebGLGPUInputAssembler, IWebGLGPUDescriptorSet, IWebGLGPUPipelineState } from './webgl-gpu-objects';\r\nimport { WebGLInputAssembler } from './webgl-input-assembler';\r\nimport { WebGLPipelineState } from './webgl-pipeline-state';\r\nimport { RenderPass } from '../base/render-pass';\r\nimport { StencilFace, BufferSource,\r\n    CommandBufferInfo, BufferTextureCopy, Color, Rect, Viewport, DrawInfo, DynamicStates, TextureBlit, Filter } from '../base/define';\r\nimport { GeneralBarrier } from '../base/states/general-barrier';\r\nimport { TextureBarrier } from '../base/states/texture-barrier';\r\nimport { BufferBarrier } from '../base/states/buffer-barrier';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { errorID } from '../../core/platform/debug';\r\n\r\n/** @mangle */\r\nexport class WebGLCommandBuffer extends CommandBuffer {\r\n    protected _isInRenderPass = false;\r\n    protected _curGPUPipelineState: IWebGLGPUPipelineState | null = null;\r\n    protected _curGPUInputAssembler: IWebGLGPUInputAssembler | null = null;\r\n    protected _curGPUDescriptorSets: IWebGLGPUDescriptorSet[] = [];\r\n    protected _curDynamicOffsets: number[] = Array(8).fill(0);\r\n    protected _curDynamicStates: DynamicStates = new DynamicStates();\r\n    protected _isStateInvalied = false;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public override initialize (info: Readonly<CommandBufferInfo>): void {\r\n        this._type = info.type;\r\n        this._queue = info.queue;\r\n\r\n        const setCount = WebGLDeviceManager.instance.bindingMappings.blockOffsets.length;\r\n        for (let i = 0; i < setCount; i++) {\r\n            this._curGPUDescriptorSets.push(null!);\r\n        }\r\n    }\r\n\r\n    public override destroy (): void {\r\n    }\r\n\r\n    public override begin (renderPass?: RenderPass, subpass?: number, frameBuffer?: Framebuffer): void {\r\n        this._curGPUPipelineState = null;\r\n        this._curGPUInputAssembler = null;\r\n        this._curGPUDescriptorSets.length = 0;\r\n        this._numDrawCalls = 0;\r\n        this._numInstances = 0;\r\n        this._numTris = 0;\r\n    }\r\n\r\n    public override end (): void {\r\n        if (this._isStateInvalied) {\r\n            this.bindStates();\r\n        }\r\n\r\n        this._isInRenderPass = false;\r\n    }\r\n\r\n    public override beginRenderPass (\r\n        renderPass: RenderPass,\r\n        framebuffer: Framebuffer,\r\n        renderArea: Readonly<Rect>,\r\n        clearColors: Readonly<Color[]>,\r\n        clearDepth: number,\r\n        clearStencil: number,\r\n    ): void {\r\n        errorID(16401);\r\n        this._isInRenderPass = true;\r\n    }\r\n\r\n    public override endRenderPass (): void {\r\n        this._isInRenderPass = false;\r\n    }\r\n\r\n    public override bindPipelineState (pipelineState: PipelineState): void {\r\n        const gpuPipelineState = (pipelineState as WebGLPipelineState).gpuPipelineState;\r\n        if (gpuPipelineState !== this._curGPUPipelineState) {\r\n            this._curGPUPipelineState = gpuPipelineState;\r\n            this._isStateInvalied = true;\r\n        }\r\n    }\r\n\r\n    public override bindDescriptorSet (set: number, descriptorSet: DescriptorSet, dynamicOffsets?: Readonly<number[]>): void {\r\n        const gpuDescriptorSet = (descriptorSet as WebGLDescriptorSet).gpuDescriptorSet;\r\n        if (gpuDescriptorSet !== this._curGPUDescriptorSets[set]) {\r\n            this._curGPUDescriptorSets[set] = gpuDescriptorSet;\r\n            this._isStateInvalied = true;\r\n        }\r\n        if (dynamicOffsets) {\r\n            const gpuPipelineLayout = this._curGPUPipelineState?.gpuPipelineLayout;\r\n            if (gpuPipelineLayout) {\r\n                const offsets = this._curDynamicOffsets;\r\n                const idx = gpuPipelineLayout.dynamicOffsetOffsets[set];\r\n                for (let i = 0; i < dynamicOffsets.length; i++) offsets[idx + i] = dynamicOffsets[i];\r\n                this._isStateInvalied = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    public override bindInputAssembler (inputAssembler: InputAssembler): void {\r\n        const gpuInputAssembler = (inputAssembler as WebGLInputAssembler).getGpuInputAssembler();\r\n        this._curGPUInputAssembler = gpuInputAssembler;\r\n        this._isStateInvalied = true;\r\n    }\r\n\r\n    public override setViewport (viewport: Readonly<Viewport>): void {\r\n        const cache = this._curDynamicStates.viewport;\r\n        if (cache.left !== viewport.left\r\n            || cache.top !== viewport.top\r\n            || cache.width !== viewport.width\r\n            || cache.height !== viewport.height\r\n            || cache.minDepth !== viewport.minDepth\r\n            || cache.maxDepth !== viewport.maxDepth) {\r\n            cache.left = viewport.left;\r\n            cache.top = viewport.top;\r\n            cache.width = viewport.width;\r\n            cache.height = viewport.height;\r\n            cache.minDepth = viewport.minDepth;\r\n            cache.maxDepth = viewport.maxDepth;\r\n            this._isStateInvalied = true;\r\n        }\r\n    }\r\n\r\n    public override setScissor (scissor: Readonly<Rect>): void {\r\n        const cache = this._curDynamicStates.scissor;\r\n        if (cache.x !== scissor.x\r\n            || cache.y !== scissor.y\r\n            || cache.width !== scissor.width\r\n            || cache.height !== scissor.height) {\r\n            cache.x = scissor.x;\r\n            cache.y = scissor.y;\r\n            cache.width = scissor.width;\r\n            cache.height = scissor.height;\r\n            this._isStateInvalied = true;\r\n        }\r\n    }\r\n\r\n    public override setLineWidth (lineWidth: number): void {\r\n        if (this._curDynamicStates.lineWidth !== lineWidth) {\r\n            this._curDynamicStates.lineWidth = lineWidth;\r\n            this._isStateInvalied = true;\r\n        }\r\n    }\r\n\r\n    public override setDepthBias (depthBiasConstantFactor: number, depthBiasClamp: number, depthBiasSlopeFactor: number): void {\r\n        const cache = this._curDynamicStates;\r\n        if (cache.depthBiasConstant !== depthBiasConstantFactor\r\n            || cache.depthBiasClamp !== depthBiasClamp\r\n            || cache.depthBiasSlope !== depthBiasSlopeFactor) {\r\n            cache.depthBiasConstant = depthBiasConstantFactor;\r\n            cache.depthBiasClamp = depthBiasClamp;\r\n            cache.depthBiasSlope = depthBiasSlopeFactor;\r\n            this._isStateInvalied = true;\r\n        }\r\n    }\r\n\r\n    public override setBlendConstants (blendConstants: Readonly<Color>): void {\r\n        const cache = this._curDynamicStates.blendConstant;\r\n        if (cache.x !== blendConstants.x\r\n            || cache.y !== blendConstants.y\r\n            || cache.z !== blendConstants.z\r\n            || cache.w !== blendConstants.w) {\r\n            cache.copy(blendConstants);\r\n            this._isStateInvalied = true;\r\n        }\r\n    }\r\n\r\n    public override setDepthBound (minDepthBounds: number, maxDepthBounds: number): void {\r\n        const cache = this._curDynamicStates;\r\n        if (cache.depthMinBounds !== minDepthBounds\r\n            || cache.depthMaxBounds !== maxDepthBounds) {\r\n            cache.depthMinBounds = minDepthBounds;\r\n            cache.depthMaxBounds = maxDepthBounds;\r\n            this._isStateInvalied = true;\r\n        }\r\n    }\r\n\r\n    public override setStencilWriteMask (face: StencilFace, writeMask: number): void {\r\n        const front = this._curDynamicStates.stencilStatesFront;\r\n        const back = this._curDynamicStates.stencilStatesBack;\r\n        if (face & StencilFace.FRONT) {\r\n            if (front.writeMask !== writeMask) {\r\n                front.writeMask = writeMask;\r\n                this._isStateInvalied = true;\r\n            }\r\n        }\r\n        if (face & StencilFace.BACK) {\r\n            if (back.writeMask !== writeMask) {\r\n                back.writeMask = writeMask;\r\n                this._isStateInvalied = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    public override setStencilCompareMask (face: StencilFace, reference: number, compareMask: number): void {\r\n        const front = this._curDynamicStates.stencilStatesFront;\r\n        const back = this._curDynamicStates.stencilStatesBack;\r\n        if (face & StencilFace.FRONT) {\r\n            if (front.compareMask !== compareMask\r\n                || front.reference !== reference) {\r\n                front.reference = reference;\r\n                front.compareMask = compareMask;\r\n                this._isStateInvalied = true;\r\n            }\r\n        }\r\n        if (face & StencilFace.BACK) {\r\n            if (back.compareMask !== compareMask\r\n                || back.reference !== reference) {\r\n                back.reference = reference;\r\n                back.compareMask = compareMask;\r\n                this._isStateInvalied = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    public override draw (infoOrAssembler: Readonly<DrawInfo> | Readonly<InputAssembler>): void {\r\n        errorID(16328);\r\n    }\r\n\r\n    public override updateBuffer (buffer: Buffer, data: Readonly<BufferSource>, size?: number): void {\r\n        errorID(16329);\r\n    }\r\n\r\n    public override copyBuffersToTexture (buffers: Readonly<ArrayBufferView[]>, texture: Texture, regions: Readonly<BufferTextureCopy[]>): void {\r\n        errorID(16330);\r\n    }\r\n\r\n    public override execute (cmdBuffs: Readonly<CommandBuffer[]>, count: number): void {\r\n        errorID(16402);\r\n    }\r\n\r\n    public override pipelineBarrier (\r\n        GeneralBarrier: Readonly<GeneralBarrier>,\r\n        bufferBarriers?: Readonly<BufferBarrier[]>,\r\n        buffers?: Readonly<Buffer[]>,\r\n        textureBarriers?: Readonly<TextureBarrier[]>,\r\n        textures?: Readonly<Texture[]>,\r\n    ): void {\r\n\r\n    }\r\n\r\n    protected bindStates (): void {\r\n        errorID(16401);\r\n    }\r\n\r\n    public override blitTexture (srcTexture: Readonly<Texture>, dstTexture: Texture, regions: Readonly<TextureBlit []>, filter: Filter): void {\r\n        errorID(16401);\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { FramebufferInfo } from '../base/define';\r\nimport { Framebuffer } from '../base/framebuffer';\r\nimport { WebGLCmdFuncCreateFramebuffer, WebGLCmdFuncDestroyFramebuffer } from './webgl-commands';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { IWebGLGPUFramebuffer, IWebGLGPUTexture } from './webgl-gpu-objects';\r\nimport { WebGLRenderPass } from './webgl-render-pass';\r\n\r\nimport { WebGLTexture as CCWebGLTexture } from './webgl-texture';\r\n\r\n/** @mangle */\r\nexport class WebGLFramebuffer extends Framebuffer {\r\n    getGpuFramebuffer (): IWebGLGPUFramebuffer {\r\n        return  this._gpuFramebuffer!;\r\n    }\r\n\r\n    private _gpuFramebuffer: IWebGLGPUFramebuffer | null = null;\r\n    private _gpuColorTextures: (WebGLTexture | null)[] = [];\r\n    private _gpuDepthStencilTexture: WebGLTexture | null | undefined;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    get needRebuild (): boolean {\r\n        const gpuFramebuffer = this._gpuFramebuffer;\r\n        if (gpuFramebuffer) {\r\n            for (let i = 0; i < gpuFramebuffer.gpuColorTextures.length; i++) {\r\n                if (gpuFramebuffer.gpuColorTextures[i].glTexture !== this._gpuColorTextures[i]) {\r\n                    return true;\r\n                }\r\n            }\r\n            if (gpuFramebuffer.gpuDepthStencilTexture?.glTexture !== this._gpuDepthStencilTexture) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public override initialize (info: Readonly<FramebufferInfo>): void {\r\n        this._renderPass = info.renderPass;\r\n        this._colorTextures = info.colorTextures || [];\r\n        const depthStencilTexture: CCWebGLTexture = this._depthStencilTexture = info.depthStencilTexture  as CCWebGLTexture || null;\r\n\r\n        let lodLevel = 0;\r\n\r\n        const gpuColorTextures: IWebGLGPUTexture[] = [];\r\n        for (let i = 0; i < info.colorTextures.length; ++i) {\r\n            const colorTexture = info.colorTextures[i] as CCWebGLTexture;\r\n            if (colorTexture) {\r\n                gpuColorTextures.push(colorTexture.gpuTexture);\r\n                lodLevel = colorTexture.lodLevel;\r\n            }\r\n        }\r\n\r\n        let gpuDepthStencilTexture: IWebGLGPUTexture | null = null;\r\n        if (depthStencilTexture) {\r\n            gpuDepthStencilTexture = depthStencilTexture.gpuTexture;\r\n            lodLevel = depthStencilTexture.lodLevel;\r\n        }\r\n\r\n        let width = Number.MAX_SAFE_INTEGER;\r\n        let height = Number.MAX_SAFE_INTEGER;\r\n        this._gpuFramebuffer = {\r\n            gpuRenderPass: (info.renderPass as WebGLRenderPass).gpuRenderPass,\r\n            gpuColorTextures,\r\n            gpuDepthStencilTexture,\r\n            glFramebuffer: null,\r\n            isOffscreen: true,\r\n            get width (): number {\r\n                if (this.gpuColorTextures.length > 0) {\r\n                    return this.gpuColorTextures[0].width;\r\n                } else if (this.gpuDepthStencilTexture) {\r\n                    return this.gpuDepthStencilTexture.width;\r\n                }\r\n                return width;\r\n            },\r\n            set width (val) {\r\n                width = val;\r\n            },\r\n            get height (): number {\r\n                if (this.gpuColorTextures.length > 0) {\r\n                    return this.gpuColorTextures[0].height;\r\n                } else if (this.gpuDepthStencilTexture) {\r\n                    return this.gpuDepthStencilTexture.height;\r\n                }\r\n                return height;\r\n            },\r\n            set height (val) {\r\n                height = val;\r\n            },\r\n            lodLevel,\r\n        };\r\n\r\n        WebGLCmdFuncCreateFramebuffer(WebGLDeviceManager.instance, this._gpuFramebuffer);\r\n        this._gpuFramebuffer.gpuColorTextures.forEach((tex) => this._gpuColorTextures.push(tex.glTexture));\r\n        this._gpuDepthStencilTexture = this._gpuFramebuffer.gpuDepthStencilTexture?.glTexture;\r\n        this._width = this._gpuFramebuffer.width;\r\n        this._height = this._gpuFramebuffer.height;\r\n    }\r\n\r\n    public override destroy (): void {\r\n        if (this._gpuFramebuffer) {\r\n            WebGLCmdFuncDestroyFramebuffer(WebGLDeviceManager.instance, this._gpuFramebuffer);\r\n            this._gpuFramebuffer = null;\r\n            this._gpuColorTextures.length = 0;\r\n            this._gpuDepthStencilTexture = null;\r\n        }\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { errorID } from '../../core/platform/debug';\r\nimport { InputAssemblerInfo } from '../base/define';\r\nimport { InputAssembler } from '../base/input-assembler';\r\nimport { WebGLBuffer } from './webgl-buffer';\r\nimport { WebGLCmdFuncCreateInputAssember, WebGLCmdFuncDestroyInputAssembler } from './webgl-commands';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { IWebGLGPUInputAssembler, IWebGLGPUBuffer } from './webgl-gpu-objects';\r\n\r\n/** @mangle */\r\nexport class WebGLInputAssembler extends InputAssembler {\r\n    getGpuInputAssembler (): IWebGLGPUInputAssembler {\r\n        return  this._gpuInputAssembler!;\r\n    }\r\n\r\n    private _gpuInputAssembler: IWebGLGPUInputAssembler | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public override initialize (info: Readonly<InputAssemblerInfo>): void {\r\n        if (info.vertexBuffers.length === 0) {\r\n            errorID(16331);\r\n            return;\r\n        }\r\n\r\n        this._attributes = info.attributes;\r\n        this._attributesHash = this.computeAttributesHash();\r\n        this._vertexBuffers = info.vertexBuffers;\r\n\r\n        if (info.indexBuffer) {\r\n            this._indexBuffer = info.indexBuffer;\r\n            this._drawInfo.indexCount = this._indexBuffer.size / this._indexBuffer.stride;\r\n            this._drawInfo.firstIndex = 0;\r\n        } else {\r\n            const vertBuff = this._vertexBuffers[0];\r\n            this._drawInfo.vertexCount = vertBuff.size / vertBuff.stride;\r\n            this._drawInfo.firstVertex = 0;\r\n            this._drawInfo.vertexOffset = 0;\r\n        }\r\n        this._drawInfo.instanceCount = 0;\r\n        this._drawInfo.firstInstance = 0;\r\n\r\n        this._indirectBuffer = info.indirectBuffer || null;\r\n\r\n        const gpuVertexBuffers: IWebGLGPUBuffer[] = new Array<IWebGLGPUBuffer>(info.vertexBuffers.length);\r\n        for (let i = 0; i < info.vertexBuffers.length; ++i) {\r\n            const vb = info.vertexBuffers[i] as WebGLBuffer;\r\n            if (vb.gpuBuffer) {\r\n                gpuVertexBuffers[i] = vb.gpuBuffer;\r\n            }\r\n        }\r\n\r\n        let gpuIndexBuffer: IWebGLGPUBuffer | null = null;\r\n        let glIndexType = 0;\r\n        if (info.indexBuffer) {\r\n            gpuIndexBuffer = (info.indexBuffer as WebGLBuffer).gpuBuffer;\r\n            if (gpuIndexBuffer) {\r\n                switch (gpuIndexBuffer.stride) {\r\n                case 1: glIndexType = 0x1401; break; // WebGLRenderingContext.UNSIGNED_BYTE\r\n                case 2: glIndexType = 0x1403; break; // WebGLRenderingContext.UNSIGNED_SHORT\r\n                case 4: glIndexType = 0x1405; break; // WebGLRenderingContext.UNSIGNED_INT\r\n                default: {\r\n                    errorID(16332);\r\n                }\r\n                }\r\n            }\r\n        }\r\n\r\n        let gpuIndirectBuffer: IWebGLGPUBuffer | null = null;\r\n        if (info.indirectBuffer) {\r\n            gpuIndirectBuffer = (info.indirectBuffer as WebGLBuffer).gpuBuffer;\r\n        }\r\n\r\n        this._gpuInputAssembler = {\r\n            attributes: info.attributes,\r\n            gpuVertexBuffers,\r\n            gpuIndexBuffer,\r\n            gpuIndirectBuffer,\r\n\r\n            glAttribs: [],\r\n            glIndexType,\r\n            glVAOs: new Map<WebGLProgram, WebGLVertexArrayObjectOES>(),\r\n        };\r\n\r\n        WebGLCmdFuncCreateInputAssember(WebGLDeviceManager.instance, this._gpuInputAssembler);\r\n    }\r\n\r\n    public override destroy (): void {\r\n        const device = WebGLDeviceManager.instance;\r\n        if (this._gpuInputAssembler && device.extensions.useVAO) {\r\n            WebGLCmdFuncDestroyInputAssembler(device, this._gpuInputAssembler);\r\n        }\r\n        this._gpuInputAssembler = null;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { DescriptorSetLayoutInfo, DESCRIPTOR_DYNAMIC_TYPE } from '../base/define';\r\nimport { DescriptorSetLayout } from '../base/descriptor-set-layout';\r\nimport { IWebGLGPUDescriptorSetLayout } from './webgl-gpu-objects';\r\n\r\n/** @mangle */\r\nexport class WebGLDescriptorSetLayout extends DescriptorSetLayout {\r\n    get gpuDescriptorSetLayout (): IWebGLGPUDescriptorSetLayout { return this._gpuDescriptorSetLayout!; }\r\n\r\n    private _gpuDescriptorSetLayout: IWebGLGPUDescriptorSetLayout | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<DescriptorSetLayoutInfo>): void {\r\n        Array.prototype.push.apply(this._bindings, info.bindings);\r\n\r\n        let descriptorCount = 0; let maxBinding = -1;\r\n        const flattenedIndices: number[] = [];\r\n        for (let i = 0; i < this._bindings.length; i++) {\r\n            const binding = this._bindings[i];\r\n            flattenedIndices.push(descriptorCount);\r\n            descriptorCount += binding.count;\r\n            if (binding.binding > maxBinding) maxBinding = binding.binding;\r\n        }\r\n\r\n        this._bindingIndices = Array(maxBinding + 1).fill(-1);\r\n        const descriptorIndices = this._descriptorIndices = Array(maxBinding + 1).fill(-1);\r\n        for (let i = 0; i < this._bindings.length; i++) {\r\n            const binding = this._bindings[i];\r\n            this._bindingIndices[binding.binding] = i;\r\n            descriptorIndices[binding.binding] = flattenedIndices[i];\r\n        }\r\n\r\n        const dynamicBindings: number[] = [];\r\n        for (let i = 0; i < this._bindings.length; i++) {\r\n            const binding = this._bindings[i];\r\n            if (binding.descriptorType & DESCRIPTOR_DYNAMIC_TYPE) {\r\n                for (let j = 0; j < binding.count; j++) {\r\n                    dynamicBindings.push(binding.binding);\r\n                }\r\n            }\r\n        }\r\n\r\n        this._gpuDescriptorSetLayout = {\r\n            bindings: this._bindings,\r\n            dynamicBindings,\r\n            descriptorIndices,\r\n            descriptorCount,\r\n        };\r\n    }\r\n\r\n    public destroy (): void {\r\n        this._bindings.length = 0;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { PipelineLayout } from '../base/pipeline-layout';\r\nimport { IWebGLGPUPipelineLayout, IWebGLGPUDescriptorSetLayout } from './webgl-gpu-objects';\r\nimport { WebGLDescriptorSetLayout } from './webgl-descriptor-set-layout';\r\nimport { PipelineLayoutInfo } from '../base/define';\r\n\r\n/** @mangle */\r\nexport class WebGLPipelineLayout extends PipelineLayout {\r\n    get gpuPipelineLayout (): IWebGLGPUPipelineLayout { return this._gpuPipelineLayout!; }\r\n\r\n    private _gpuPipelineLayout: IWebGLGPUPipelineLayout | null = null;\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<PipelineLayoutInfo>): void {\r\n        Array.prototype.push.apply(this._setLayouts, info.setLayouts);\r\n\r\n        const dynamicOffsetIndices: number[][] = [];\r\n\r\n        const gpuSetLayouts: IWebGLGPUDescriptorSetLayout[] = [];\r\n        let dynamicOffsetCount = 0;\r\n        const dynamicOffsetOffsets: number[] = [];\r\n        for (let i = 0; i < this._setLayouts.length; i++) {\r\n            const setLayout = this._setLayouts[i] as WebGLDescriptorSetLayout;\r\n            const dynamicBindings = setLayout.gpuDescriptorSetLayout.dynamicBindings;\r\n            const indices = Array<number>(setLayout.bindingIndices.length).fill(-1);\r\n            for (let j = 0; j < dynamicBindings.length; j++) {\r\n                const binding = dynamicBindings[j];\r\n                if (indices[binding] < 0) indices[binding] = dynamicOffsetCount + j;\r\n            }\r\n\r\n            gpuSetLayouts.push(setLayout.gpuDescriptorSetLayout);\r\n            dynamicOffsetIndices.push(indices);\r\n            dynamicOffsetOffsets.push(dynamicOffsetCount);\r\n            dynamicOffsetCount += dynamicBindings.length;\r\n        }\r\n\r\n        this._gpuPipelineLayout = {\r\n            gpuSetLayouts,\r\n            dynamicOffsetIndices,\r\n            dynamicOffsetCount,\r\n            dynamicOffsetOffsets,\r\n        };\r\n    }\r\n\r\n    public destroy (): void {\r\n        this._setLayouts.length = 0;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { PipelineState, PipelineStateInfo } from '../base/pipeline-state';\r\nimport { IWebGLGPUPipelineState } from './webgl-gpu-objects';\r\nimport { WebGLRenderPass } from './webgl-render-pass';\r\nimport { WebGLShader } from './webgl-shader';\r\nimport { DynamicStateFlagBit } from '../base/define';\r\nimport { WebGLPipelineLayout } from './webgl-pipeline-layout';\r\n\r\nconst WebGLPrimitives: GLenum[] = [\r\n    0x0000, // WebGLRenderingContext.POINTS,\r\n    0x0001, // WebGLRenderingContext.LINES,\r\n    0x0003, // WebGLRenderingContext.LINE_STRIP,\r\n    0x0002, // WebGLRenderingContext.LINE_LOOP,\r\n    0x0000, // WebGLRenderingContext.NONE,\r\n    0x0000, // WebGLRenderingContext.NONE,\r\n    0x0000, // WebGLRenderingContext.NONE,\r\n    0x0004, // WebGLRenderingContext.TRIANGLES,\r\n    0x0005, // WebGLRenderingContext.TRIANGLE_STRIP,\r\n    0x0006, // WebGLRenderingContext.TRIANGLE_FAN,\r\n    0x0000, // WebGLRenderingContext.NONE,\r\n    0x0000, // WebGLRenderingContext.NONE,\r\n    0x0000, // WebGLRenderingContext.NONE,\r\n    0x0000, // WebGLRenderingContext.NONE,\r\n];\r\n\r\n/** @mangle */\r\nexport class WebGLPipelineState extends PipelineState {\r\n    get gpuPipelineState (): IWebGLGPUPipelineState {\r\n        return  this._gpuPipelineState!;\r\n    }\r\n\r\n    private _gpuPipelineState: IWebGLGPUPipelineState | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<PipelineStateInfo>): void {\r\n        this._primitive = info.primitive;\r\n        this._shader = info.shader;\r\n        this._pipelineLayout = info.pipelineLayout;\r\n        const bs = this._bs;\r\n        if (info.blendState) {\r\n            const bsInfo = info.blendState;\r\n            const { targets } = bsInfo;\r\n            if (targets) {\r\n                targets.forEach((t, i): void => {\r\n                    bs.setTarget(i, t);\r\n                });\r\n            }\r\n\r\n            if (bsInfo.isA2C !== undefined) { bs.isA2C = bsInfo.isA2C; }\r\n            if (bsInfo.isIndepend !== undefined) { bs.isIndepend = bsInfo.isIndepend; }\r\n            if (bsInfo.blendColor !== undefined) { bs.blendColor = bsInfo.blendColor; }\r\n        }\r\n        Object.assign(this._rs, info.rasterizerState);\r\n        Object.assign(this._dss, info.depthStencilState);\r\n        this._is = info.inputState;\r\n        this._renderPass = info.renderPass;\r\n        this._dynamicStates = info.dynamicStates;\r\n\r\n        const dynamicStates: DynamicStateFlagBit[] = [];\r\n        for (let i = 0; i < 31; i++) {\r\n            if (this._dynamicStates & (1 << i)) {\r\n                dynamicStates.push(1 << i);\r\n            }\r\n        }\r\n\r\n        this._gpuPipelineState = {\r\n            glPrimitive: WebGLPrimitives[info.primitive],\r\n            gpuShader: (info.shader as WebGLShader).gpuShader,\r\n            gpuPipelineLayout: (info.pipelineLayout as WebGLPipelineLayout).gpuPipelineLayout,\r\n            rs: info.rasterizerState,\r\n            dss: info.depthStencilState,\r\n            bs: info.blendState,\r\n            gpuRenderPass: (info.renderPass as WebGLRenderPass).gpuRenderPass,\r\n            dynamicStates,\r\n        };\r\n    }\r\n\r\n    public destroy (): void {\r\n        this._gpuPipelineState = null;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Buffer } from '../base/buffer';\r\nimport { CommandBuffer } from '../base/command-buffer';\r\nimport { BufferSource, DrawInfo, BufferTextureCopy, Color, Rect, BufferUsageBit, Viewport, TextureBlit, Filter } from '../base/define';\r\nimport { Framebuffer } from '../base/framebuffer';\r\nimport { InputAssembler } from '../base/input-assembler';\r\nimport { Texture } from '../base/texture';\r\nimport { WebGLBuffer } from './webgl-buffer';\r\nimport { WebGLCommandBuffer } from './webgl-command-buffer';\r\nimport {\r\n    WebGLCmdFuncBeginRenderPass, WebGLCmdFuncBindStates, WebGLCmdFuncBlitTexture, WebGLCmdFuncCopyBuffersToTexture,\r\n    WebGLCmdFuncDraw, WebGLCmdFuncUpdateBuffer } from './webgl-commands';\r\nimport { WebGLFramebuffer } from './webgl-framebuffer';\r\nimport { WebGLTexture } from './webgl-texture';\r\nimport { RenderPass } from '../base/render-pass';\r\nimport { WebGLRenderPass } from './webgl-render-pass';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { error, errorID } from '../../core/platform/debug';\r\nimport { WebGLConstants } from '../gl-constants';\r\n\r\n/** @mangle */\r\nexport class WebGLPrimaryCommandBuffer extends WebGLCommandBuffer {\r\n    public override beginRenderPass (\r\n        renderPass: RenderPass,\r\n        framebuffer: Framebuffer,\r\n        renderArea: Readonly<Rect>,\r\n        clearColors: Readonly<Color[]>,\r\n        clearDepth: number,\r\n        clearStencil: number,\r\n    ): void {\r\n        WebGLCmdFuncBeginRenderPass(\r\n            WebGLDeviceManager.instance,\r\n            (renderPass as WebGLRenderPass).gpuRenderPass,\r\n            (framebuffer as WebGLFramebuffer).getGpuFramebuffer(),\r\n            renderArea,\r\n            clearColors,\r\n            clearDepth,\r\n            clearStencil,\r\n        );\r\n        this._isInRenderPass = true;\r\n    }\r\n\r\n    public override draw (infoOrAssembler: DrawInfo | InputAssembler): void {\r\n        if (this._isInRenderPass) {\r\n            if (this._isStateInvalied) {\r\n                this.bindStates();\r\n            }\r\n\r\n            const info = 'drawInfo' in infoOrAssembler ? infoOrAssembler.drawInfo : infoOrAssembler;\r\n\r\n            WebGLCmdFuncDraw(WebGLDeviceManager.instance, info);\r\n\r\n            ++this._numDrawCalls;\r\n            this._numInstances += info.instanceCount;\r\n            const indexCount = info.indexCount || info.vertexCount;\r\n            if (this._curGPUPipelineState) {\r\n                const glPrimitive = this._curGPUPipelineState.glPrimitive;\r\n                switch (glPrimitive) {\r\n                case WebGLConstants.TRIANGLES: {\r\n                    this._numTris += indexCount / 3 * Math.max(info.instanceCount, 1);\r\n                    break;\r\n                }\r\n                case WebGLConstants.TRIANGLE_STRIP:\r\n                case WebGLConstants.TRIANGLE_FAN: {\r\n                    this._numTris += (indexCount - 2) * Math.max(info.instanceCount, 1);\r\n                    break;\r\n                }\r\n                default:\r\n                }\r\n            }\r\n        } else {\r\n            errorID(16328);\r\n        }\r\n    }\r\n\r\n    public override setViewport (viewport: Readonly<Viewport>): void {\r\n        const { stateCache: cache, gl } = WebGLDeviceManager.instance;\r\n\r\n        if (cache.viewport.left !== viewport.left\r\n            || cache.viewport.top !== viewport.top\r\n            || cache.viewport.width !== viewport.width\r\n            || cache.viewport.height !== viewport.height) {\r\n            gl.viewport(viewport.left, viewport.top, viewport.width, viewport.height);\r\n\r\n            cache.viewport.left = viewport.left;\r\n            cache.viewport.top = viewport.top;\r\n            cache.viewport.width = viewport.width;\r\n            cache.viewport.height = viewport.height;\r\n        }\r\n    }\r\n\r\n    public override setScissor (scissor: Readonly<Rect>): void {\r\n        const { stateCache: cache, gl } = WebGLDeviceManager.instance;\r\n\r\n        if (cache.scissorRect.x !== scissor.x\r\n            || cache.scissorRect.y !== scissor.y\r\n            || cache.scissorRect.width !== scissor.width\r\n            || cache.scissorRect.height !== scissor.height) {\r\n            gl.scissor(scissor.x, scissor.y, scissor.width, scissor.height);\r\n\r\n            cache.scissorRect.x = scissor.x;\r\n            cache.scissorRect.y = scissor.y;\r\n            cache.scissorRect.width = scissor.width;\r\n            cache.scissorRect.height = scissor.height;\r\n        }\r\n    }\r\n\r\n    public override updateBuffer (buffer: Buffer, data: Readonly<BufferSource>, size?: number): void {\r\n        if (!this._isInRenderPass) {\r\n            const gpuBuffer = (buffer as WebGLBuffer).gpuBuffer;\r\n            if (gpuBuffer) {\r\n                let buffSize: number;\r\n                if (size !== undefined) {\r\n                    buffSize = size;\r\n                } else if (buffer.usage & BufferUsageBit.INDIRECT) {\r\n                    buffSize = 0;\r\n                } else {\r\n                    buffSize = (data as ArrayBuffer).byteLength;\r\n                }\r\n\r\n                WebGLCmdFuncUpdateBuffer(WebGLDeviceManager.instance, gpuBuffer, data as ArrayBuffer, 0, buffSize);\r\n            }\r\n        } else {\r\n            errorID(16329);\r\n        }\r\n    }\r\n\r\n    public override copyBuffersToTexture (buffers: Readonly<ArrayBufferView[]>, texture: Texture, regions: Readonly<BufferTextureCopy[]>): void {\r\n        if (!this._isInRenderPass) {\r\n            const gpuTexture = (texture as WebGLTexture).gpuTexture;\r\n            if (gpuTexture) {\r\n                WebGLCmdFuncCopyBuffersToTexture(WebGLDeviceManager.instance, buffers, gpuTexture, regions);\r\n            }\r\n        } else {\r\n            errorID(16330);\r\n        }\r\n    }\r\n\r\n    public override execute (cmdBuffs: Readonly<CommandBuffer[]>, count: number): void {\r\n        errorID(16402);\r\n    }\r\n\r\n    protected override bindStates (): void {\r\n        WebGLCmdFuncBindStates(\r\n            WebGLDeviceManager.instance,\r\n            this._curGPUPipelineState,\r\n            this._curGPUInputAssembler,\r\n            this._curGPUDescriptorSets,\r\n            this._curDynamicOffsets,\r\n            this._curDynamicStates,\r\n        );\r\n        this._isStateInvalied = false;\r\n    }\r\n\r\n    public override blitTexture (srcTexture: Readonly<Texture>, dstTexture: Texture, regions: Readonly<TextureBlit []>, filter: Filter): void {\r\n        const gpuTextureSrc = (srcTexture as WebGLTexture).gpuTexture;\r\n        const gpuTextureDst = (dstTexture as WebGLTexture).gpuTexture;\r\n        WebGLCmdFuncBlitTexture(WebGLDeviceManager.instance, gpuTextureSrc, gpuTextureDst, regions, filter);\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { QueueInfo } from '../base/define';\r\nimport { CommandBuffer } from '../base/command-buffer';\r\nimport { Queue } from '../base/queue';\r\n\r\n/** @mangle */\r\nexport class WebGLQueue extends Queue {\r\n    public numDrawCalls = 0;\r\n    public numInstances = 0;\r\n    public numTris = 0;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<QueueInfo>): void {\r\n        this._type = info.type;\r\n    }\r\n\r\n    public destroy (): void {\r\n    }\r\n\r\n    public submit (cmdBuffs: Readonly<CommandBuffer[]>): void {\r\n        const len = cmdBuffs.length;\r\n        for (let i = 0; i < len; i++) {\r\n            const cmdBuff = cmdBuffs[i];\r\n            // WebGLCmdFuncExecuteCmds( this._device as WebGLDevice, (cmdBuff as WebGLCommandBuffer).cmdPackage); // opted out\r\n            this.numDrawCalls += cmdBuff.numDrawCalls;\r\n            this.numInstances += cmdBuff.numInstances;\r\n            this.numTris += cmdBuff.numTris;\r\n        }\r\n    }\r\n\r\n    public clear (): void {\r\n        this.numDrawCalls = 0;\r\n        this.numInstances = 0;\r\n        this.numTris = 0;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { RenderPassInfo } from '../base/define';\r\nimport { RenderPass } from '../base/render-pass';\r\nimport { IWebGLGPURenderPass } from './webgl-gpu-objects';\r\n\r\n/** @mangle */\r\nexport class WebGLRenderPass extends RenderPass {\r\n    public get gpuRenderPass (): IWebGLGPURenderPass {\r\n        return  this._gpuRenderPass!;\r\n    }\r\n\r\n    private _gpuRenderPass: IWebGLGPURenderPass | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<RenderPassInfo>): void {\r\n        this._colorInfos = info.colorAttachments;\r\n        this._depthStencilInfo = info.depthStencilAttachment;\r\n        this._subpasses = info.subpasses;\r\n\r\n        this._gpuRenderPass = {\r\n            colorAttachments: this._colorInfos,\r\n            depthStencilAttachment: this._depthStencilInfo,\r\n        };\r\n\r\n        this._hash = this.computeHash();\r\n    }\r\n\r\n    public destroy (): void {\r\n        this._gpuRenderPass = null;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Filter, SamplerInfo } from '../../base/define';\r\nimport { Sampler } from '../../base/states/sampler';\r\nimport { WebGLConstants } from '../../gl-constants';\r\nimport { IWebGLGPUSampler } from '../webgl-gpu-objects';\r\n\r\nconst WebGLWraps: GLenum[] = [\r\n    0x2901, // WebGLRenderingContext.REPEAT,\r\n    0x8370, // WebGLRenderingContext.MIRRORED_REPEAT,\r\n    0x812F, // WebGLRenderingContext.CLAMP_TO_EDGE,\r\n    0x812F, // WebGLRenderingContext.CLAMP_TO_EDGE,\r\n];\r\n\r\n/** @mangle */\r\nexport class WebGLSampler extends Sampler {\r\n    public get gpuSampler (): IWebGLGPUSampler {\r\n        return  this._gpuSampler!;\r\n    }\r\n\r\n    private _gpuSampler: IWebGLGPUSampler | null = null;\r\n\r\n    constructor (info: Readonly<SamplerInfo>, hash: number) {\r\n        super(info, hash);\r\n\r\n        let glMinFilter = 0;\r\n        let glMagFilter = 0;\r\n\r\n        const minFilter = this._info.minFilter;\r\n        const magFilter = this._info.magFilter;\r\n        const mipFilter = this._info.mipFilter;\r\n\r\n        if (minFilter === Filter.LINEAR || minFilter === Filter.ANISOTROPIC) {\r\n            if (mipFilter === Filter.LINEAR || mipFilter === Filter.ANISOTROPIC) {\r\n                glMinFilter = WebGLConstants.LINEAR_MIPMAP_LINEAR;\r\n            } else if (mipFilter === Filter.POINT) {\r\n                glMinFilter = WebGLConstants.LINEAR_MIPMAP_NEAREST;\r\n            } else {\r\n                glMinFilter = WebGLConstants.LINEAR;\r\n            }\r\n        } else if (mipFilter === Filter.LINEAR || mipFilter === Filter.ANISOTROPIC) {\r\n            glMinFilter = WebGLConstants.NEAREST_MIPMAP_LINEAR;\r\n        } else if (mipFilter === Filter.POINT) {\r\n            glMinFilter = WebGLConstants.NEAREST_MIPMAP_NEAREST;\r\n        } else {\r\n            glMinFilter = WebGLConstants.NEAREST;\r\n        }\r\n\r\n        if (magFilter === Filter.LINEAR || magFilter === Filter.ANISOTROPIC) {\r\n            glMagFilter = WebGLConstants.LINEAR;\r\n        } else {\r\n            glMagFilter = WebGLConstants.NEAREST;\r\n        }\r\n\r\n        const glWrapS = WebGLWraps[this._info.addressU];\r\n        const glWrapT = WebGLWraps[this._info.addressV];\r\n        const glWrapR = WebGLWraps[this._info.addressW];\r\n\r\n        this._gpuSampler = {\r\n            glMinFilter,\r\n            glMagFilter,\r\n            glWrapS,\r\n            glWrapT,\r\n            glWrapR,\r\n        };\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { ShaderInfo } from '../base/define';\r\nimport { Shader } from '../base/shader';\r\nimport { WebGLCmdFuncCreateShader, WebGLCmdFuncDestroyShader } from './webgl-commands';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { IWebGLGPUShader, IWebGLGPUShaderStage } from './webgl-gpu-objects';\r\n\r\n/** @mangle */\r\nexport class WebGLShader extends Shader {\r\n    get gpuShader (): IWebGLGPUShader {\r\n        if (this._gpuShader!.glProgram === null) {\r\n            WebGLCmdFuncCreateShader(WebGLDeviceManager.instance, this._gpuShader!);\r\n        }\r\n        return this._gpuShader!;\r\n    }\r\n\r\n    private _gpuShader: IWebGLGPUShader | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<ShaderInfo>): void {\r\n        this._name = info.name;\r\n        this._stages = info.stages;\r\n        this._attributes = info.attributes;\r\n        this._blocks = info.blocks;\r\n        this._samplers = info.samplers;\r\n\r\n        this._gpuShader = {\r\n            name: info.name,\r\n            blocks: info.blocks.slice(),\r\n            samplerTextures: info.samplerTextures.slice(),\r\n            subpassInputs: info.subpassInputs.slice(),\r\n\r\n            gpuStages: new Array<IWebGLGPUShaderStage>(info.stages.length),\r\n            glProgram: null,\r\n            glInputs: [],\r\n            glUniforms: [],\r\n            glBlocks: [],\r\n            glSamplerTextures: [],\r\n        };\r\n\r\n        for (let i = 0; i < info.stages.length; ++i) {\r\n            const stage = info.stages[i];\r\n            this._gpuShader.gpuStages[i] = {\r\n                type: stage.stage,\r\n                source: stage.source,\r\n                glShader: null,\r\n            };\r\n        }\r\n    }\r\n\r\n    public destroy (): void {\r\n        if (this._gpuShader) {\r\n            WebGLCmdFuncDestroyShader(WebGLDeviceManager.instance, this._gpuShader);\r\n            this._gpuShader = null;\r\n        }\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Rect, Viewport } from '../base/define';\r\nimport { BlendState, DepthStencilState, RasterizerState } from '../base/pipeline-state';\r\n\r\n/** @mangle */\r\nexport interface IWebGLTexUnit {\r\n    glTexture: WebGLTexture | null;\r\n}\r\n\r\n/** @mangle */\r\nexport class WebGLStateCache {\r\n    public glArrayBuffer: WebGLBuffer | null = null;\r\n    public glElementArrayBuffer: WebGLBuffer | null = null;\r\n    public glVAO: WebGLVertexArrayObjectOES | null = null;\r\n    public texUnit = 0;\r\n    public glTexUnits: IWebGLTexUnit[] = [];\r\n    public glRenderbuffer: WebGLRenderbuffer | null = null;\r\n    public glFramebuffer: WebGLFramebuffer | null = null;\r\n    public viewport = new Viewport();\r\n    public scissorRect = new Rect(0, 0, 0, 0);\r\n    public rs = new RasterizerState();\r\n    public dss = new DepthStencilState();\r\n    public bs = new BlendState();\r\n    public glProgram: WebGLProgram | null = null;\r\n    public glEnabledAttribLocs: boolean[] = [];\r\n    public glCurrentAttribLocs: boolean[] = [];\r\n    public texUnitCacheMap: Record<string, number> = {};\r\n\r\n    initialize (texUnit: number, vertexAttributes: number): void {\r\n        for (let i = 0; i < texUnit; ++i) {\r\n            const glTexUnit: IWebGLTexUnit = { glTexture: null };\r\n            this.glTexUnits.push(glTexUnit);\r\n        }\r\n\r\n        this.glEnabledAttribLocs.length = vertexAttributes;\r\n        this.glEnabledAttribLocs.fill(false);\r\n\r\n        this.glCurrentAttribLocs.length = vertexAttributes;\r\n        this.glCurrentAttribLocs.fill(false);\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { FormatSurfaceSize, TextureInfo, TextureViewInfo, IsPowerOf2, ISwapchainTextureInfo, TextureUsageBit, FormatInfos } from '../base/define';\r\nimport { Texture } from '../base/texture';\r\nimport { WebGLCmdFuncCreateTexture, WebGLCmdFuncDestroyTexture, WebGLCmdFuncResizeTexture } from './webgl-commands';\r\nimport { WebGLDeviceManager } from './webgl-define';\r\nimport { IWebGLGPUTexture } from './webgl-gpu-objects';\r\n\r\n/** @mangle */\r\nexport class WebGLTexture extends Texture {\r\n    get gpuTexture (): IWebGLGPUTexture {\r\n        return this._gpuTexture!;\r\n    }\r\n\r\n    get lodLevel (): number {\r\n        return this._lodLevel;\r\n    }\r\n\r\n    private _gpuTexture: IWebGLGPUTexture | null = null;\r\n    private _lodLevel = 0;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<TextureInfo> | Readonly<TextureViewInfo>, isSwapchainTexture?: boolean): void {\r\n        const self = this;\r\n        const { instance } = WebGLDeviceManager;\r\n        let texInfo = info as Readonly<TextureInfo>;\r\n        const viewInfo = info as Readonly<TextureViewInfo>;\r\n\r\n        if ('texture' in info) {\r\n            texInfo = viewInfo.texture.info;\r\n            self._isTextureView = true;\r\n        }\r\n        const thisTextureInfo = self._info;\r\n        thisTextureInfo.copy(texInfo);\r\n\r\n        const thisViewInfo = self._viewInfo;\r\n\r\n        self._isPowerOf2 = IsPowerOf2(thisTextureInfo.width) && IsPowerOf2(thisTextureInfo.height);\r\n        self._size = FormatSurfaceSize(\r\n            thisTextureInfo.format,\r\n            self.width,\r\n            self.height,\r\n            self.depth,\r\n            thisTextureInfo.levelCount,\r\n        ) * thisTextureInfo.layerCount;\r\n\r\n        if (!self._isTextureView) {\r\n            self._gpuTexture = {\r\n                type: texInfo.type,\r\n                format: texInfo.format,\r\n                usage: texInfo.usage,\r\n                width: texInfo.width,\r\n                height: texInfo.height,\r\n                depth: texInfo.depth,\r\n                size: self._size,\r\n                arrayLayer: texInfo.layerCount,\r\n                mipLevel: texInfo.levelCount,\r\n                samples: texInfo.samples,\r\n                flags: texInfo.flags,\r\n                isPowerOf2: self._isPowerOf2,\r\n\r\n                glTarget: 0,\r\n                glInternalFmt: 0,\r\n                glFormat: 0,\r\n                glType: 0,\r\n                glUsage: 0,\r\n                glTexture: null,\r\n                glRenderbuffer: null,\r\n                glWrapS: 0,\r\n                glWrapT: 0,\r\n                glMinFilter: 0,\r\n                glMagFilter: 0,\r\n\r\n                isSwapchainTexture: isSwapchainTexture || false,\r\n            };\r\n\r\n            if (!self._gpuTexture.isSwapchainTexture) {\r\n                WebGLCmdFuncCreateTexture(instance, self._gpuTexture);\r\n                instance.memoryStatus.textureSize += self._size;\r\n            }\r\n\r\n            thisViewInfo.texture = self;\r\n            thisViewInfo.type = info.type;\r\n            thisViewInfo.format = info.format;\r\n            thisViewInfo.baseLevel = 0;\r\n            thisViewInfo.levelCount = info.levelCount;\r\n            thisViewInfo.baseLayer = 0;\r\n            thisViewInfo.layerCount = info.layerCount;\r\n        } else {\r\n            thisViewInfo.copy(viewInfo);\r\n            self._lodLevel = viewInfo.baseLevel;\r\n            self._gpuTexture = (viewInfo.texture as WebGLTexture)._gpuTexture;\r\n        }\r\n    }\r\n\r\n    public destroy (): void {\r\n        const self = this;\r\n        const { instance } = WebGLDeviceManager;\r\n        if (!self._isTextureView && self._gpuTexture) {\r\n            WebGLCmdFuncDestroyTexture(instance, self._gpuTexture);\r\n            instance.memoryStatus.textureSize -= self._size;\r\n            self._gpuTexture = null;\r\n        }\r\n    }\r\n\r\n    public getTextureHandle (): number {\r\n        const gpuTexture = this._gpuTexture;\r\n        if (!gpuTexture) {\r\n            return 0;\r\n        }\r\n\r\n        if (gpuTexture.glTexture) {\r\n            return gpuTexture.glTexture as number;\r\n        } else if (gpuTexture.glRenderbuffer) {\r\n            return gpuTexture.glRenderbuffer as number;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    public resize (width: number, height: number): void {\r\n        const self = this;\r\n        const { instance } = WebGLDeviceManager;\r\n        const thisTextureInfo = self._info;\r\n        if (thisTextureInfo.width === width && thisTextureInfo.height === height) {\r\n            return;\r\n        }\r\n\r\n        if (thisTextureInfo.levelCount === WebGLTexture.getLevelCount(thisTextureInfo.width, thisTextureInfo.height)) {\r\n            thisTextureInfo.levelCount = WebGLTexture.getLevelCount(width, height);\r\n        } else if (thisTextureInfo.levelCount > 1) {\r\n            thisTextureInfo.levelCount = Math.min(thisTextureInfo.levelCount, WebGLTexture.getLevelCount(width, height));\r\n        }\r\n\r\n        const oldSize = self._size;\r\n        thisTextureInfo.width = width;\r\n        thisTextureInfo.height = height;\r\n\r\n        self._size = FormatSurfaceSize(\r\n            thisTextureInfo.format,\r\n            self.width,\r\n            self.height,\r\n            self.depth,\r\n            thisTextureInfo.levelCount,\r\n        ) * thisTextureInfo.layerCount;\r\n\r\n        const thisGpuTexture = self._gpuTexture;\r\n        if (!self._isTextureView && thisGpuTexture) {\r\n            thisGpuTexture.width = width;\r\n            thisGpuTexture.height = height;\r\n            thisGpuTexture.size = self._size;\r\n            if (!thisGpuTexture.isSwapchainTexture) {\r\n                WebGLCmdFuncResizeTexture(instance, thisGpuTexture);\r\n                instance.memoryStatus.textureSize -= oldSize;\r\n                instance.memoryStatus.textureSize += self._size;\r\n            }\r\n        }\r\n    }\r\n\r\n    // ======================= Swapchain Specific ======================= //\r\n\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    public initAsSwapchainTexture (info: Readonly<ISwapchainTextureInfo>): void {\r\n        const texInfo = new TextureInfo();\r\n        texInfo.format = info.format;\r\n        texInfo.usage = FormatInfos[info.format].hasDepth ? TextureUsageBit.DEPTH_STENCIL_ATTACHMENT : TextureUsageBit.COLOR_ATTACHMENT;\r\n        texInfo.width = info.width;\r\n        texInfo.height = info.height;\r\n        this.initialize(texInfo, true);\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { ALIPAY, RUNTIME_BASED, BYTEDANCE, WECHAT, HUAWEI, EDITOR, TAOBAO, TAOBAO_MINIGAME, WECHAT_MINI_PROGRAM } from 'internal:constants';\r\nimport { systemInfo } from 'pal/system-info';\r\nimport { WebGLStateCache } from './webgl-state-cache';\r\nimport { WebGLTexture } from './webgl-texture';\r\nimport { Format, TextureInfo, TextureFlagBit, TextureType, TextureUsageBit,\r\n    BufferTextureCopy, SwapchainInfo, SurfaceTransform } from '../base/define';\r\nimport { Swapchain } from '../base/swapchain';\r\nimport { IWebGLExtensions, WebGLDeviceManager } from './webgl-define';\r\nimport { BrowserType, OS } from '../../../pal/system-info/enum-type';\r\nimport { IWebGLBlitManager } from './webgl-gpu-objects';\r\nimport { WebGLConstants } from '../gl-constants';\r\nimport { macro } from '../../core/platform/macro';\r\nimport { debug, warn, warnID } from '../../core/platform/debug';\r\n\r\nconst eventWebGLContextLost = 'webglcontextlost';\r\n\r\nfunction initStates (gl: WebGLRenderingContext): void {\r\n    gl.activeTexture(WebGLConstants.TEXTURE0);\r\n    gl.pixelStorei(WebGLConstants.PACK_ALIGNMENT, 1);\r\n    gl.pixelStorei(WebGLConstants.UNPACK_ALIGNMENT, 1);\r\n    gl.pixelStorei(WebGLConstants.UNPACK_FLIP_Y_WEBGL, false);\r\n\r\n    gl.bindFramebuffer(WebGLConstants.FRAMEBUFFER, null);\r\n\r\n    // rasterizer state\r\n    gl.enable(WebGLConstants.SCISSOR_TEST);\r\n    gl.enable(WebGLConstants.CULL_FACE);\r\n    gl.cullFace(WebGLConstants.BACK);\r\n    gl.frontFace(WebGLConstants.CCW);\r\n    gl.disable(WebGLConstants.POLYGON_OFFSET_FILL);\r\n    gl.polygonOffset(0.0, 0.0);\r\n\r\n    // depth stencil state\r\n    gl.enable(WebGLConstants.DEPTH_TEST);\r\n    gl.depthMask(true);\r\n    gl.depthFunc(WebGLConstants.LESS);\r\n    gl.depthRange(0.0, 1.0);\r\n\r\n    gl.stencilFuncSeparate(WebGLConstants.FRONT, WebGLConstants.ALWAYS, 1, 0xffff);\r\n    gl.stencilOpSeparate(WebGLConstants.FRONT, WebGLConstants.KEEP, WebGLConstants.KEEP, WebGLConstants.KEEP);\r\n    gl.stencilMaskSeparate(WebGLConstants.FRONT, 0xffff);\r\n    gl.stencilFuncSeparate(WebGLConstants.BACK, WebGLConstants.ALWAYS, 1, 0xffff);\r\n    gl.stencilOpSeparate(WebGLConstants.BACK, WebGLConstants.KEEP, WebGLConstants.KEEP, WebGLConstants.KEEP);\r\n    gl.stencilMaskSeparate(WebGLConstants.BACK, 0xffff);\r\n\r\n    gl.disable(WebGLConstants.STENCIL_TEST);\r\n\r\n    // blend state\r\n    gl.disable(WebGLConstants.SAMPLE_ALPHA_TO_COVERAGE);\r\n    gl.disable(WebGLConstants.BLEND);\r\n    gl.blendEquationSeparate(WebGLConstants.FUNC_ADD, WebGLConstants.FUNC_ADD);\r\n    gl.blendFuncSeparate(WebGLConstants.ONE, WebGLConstants.ZERO, WebGLConstants.ONE, WebGLConstants.ZERO);\r\n    gl.colorMask(true, true, true, true);\r\n    gl.blendColor(0.0, 0.0, 0.0, 0.0);\r\n}\r\n\r\nfunction getExtension (gl: WebGLRenderingContext, ext: string): any {\r\n    const prefixes = ['', 'WEBKIT_', 'MOZ_'];\r\n    for (let i = 0; i < prefixes.length; ++i) {\r\n        const _ext = gl.getExtension(prefixes[i] + ext);\r\n        if (_ext) {\r\n            return _ext;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function getExtensions (gl: WebGLRenderingContext): IWebGLExtensions {\r\n    const res: IWebGLExtensions = {\r\n        EXT_texture_filter_anisotropic: getExtension(gl, 'EXT_texture_filter_anisotropic'),\r\n        EXT_blend_minmax: getExtension(gl, 'EXT_blend_minmax'),\r\n        EXT_frag_depth: getExtension(gl, 'EXT_frag_depth'),\r\n        EXT_shader_texture_lod: getExtension(gl, 'EXT_shader_texture_lod'),\r\n        EXT_sRGB: getExtension(gl, 'EXT_sRGB'),\r\n        OES_vertex_array_object: getExtension(gl, 'OES_vertex_array_object'),\r\n        EXT_color_buffer_half_float: getExtension(gl, 'EXT_color_buffer_half_float'),\r\n        WEBGL_color_buffer_float: getExtension(gl, 'WEBGL_color_buffer_float'),\r\n        WEBGL_compressed_texture_etc1: getExtension(gl, 'WEBGL_compressed_texture_etc1'),\r\n        WEBGL_compressed_texture_etc: getExtension(gl, 'WEBGL_compressed_texture_etc'),\r\n        WEBGL_compressed_texture_pvrtc: getExtension(gl, 'WEBGL_compressed_texture_pvrtc'),\r\n        WEBGL_compressed_texture_s3tc: getExtension(gl, 'WEBGL_compressed_texture_s3tc'),\r\n        WEBGL_compressed_texture_s3tc_srgb: getExtension(gl, 'WEBGL_compressed_texture_s3tc_srgb'),\r\n        WEBGL_debug_shaders: getExtension(gl, 'WEBGL_debug_shaders'),\r\n        WEBGL_draw_buffers: getExtension(gl, 'WEBGL_draw_buffers'),\r\n        WEBGL_lose_context: getExtension(gl, 'WEBGL_lose_context'),\r\n        WEBGL_depth_texture: getExtension(gl, 'WEBGL_depth_texture'),\r\n        OES_texture_half_float: getExtension(gl, 'OES_texture_half_float'),\r\n        OES_texture_half_float_linear: getExtension(gl, 'OES_texture_half_float_linear'),\r\n        OES_texture_float: getExtension(gl, 'OES_texture_float'),\r\n        OES_texture_float_linear: getExtension(gl, 'OES_texture_float_linear'),\r\n        OES_standard_derivatives: getExtension(gl, 'OES_standard_derivatives'),\r\n        OES_element_index_uint: getExtension(gl, 'OES_element_index_uint'),\r\n        ANGLE_instanced_arrays: getExtension(gl, 'ANGLE_instanced_arrays'),\r\n        WEBGL_debug_renderer_info: getExtension(gl, 'WEBGL_debug_renderer_info'),\r\n        WEBGL_multi_draw: null,\r\n        WEBGL_compressed_texture_astc: null,\r\n        destroyShadersImmediately: true,\r\n        noCompressedTexSubImage2D: false,\r\n        isLocationActive: (glLoc: unknown): glLoc is WebGLUniformLocation => !!glLoc,\r\n        useVAO: false,\r\n    };\r\n\r\n    // platform-specific extension hacks\r\n    // eslint-disable-next-line no-lone-blocks\r\n    {\r\n        // iOS 14 browsers crash on getExtension('WEBGL_compressed_texture_astc')\r\n        if (systemInfo.os !== OS.IOS || systemInfo.osMainVersion !== 14 || !systemInfo.isBrowser) {\r\n            res.WEBGL_compressed_texture_astc = getExtension(gl, 'WEBGL_compressed_texture_astc');\r\n        }\r\n\r\n        // Mobile implementation seems to have performance issues\r\n        if (systemInfo.os !== OS.ANDROID && systemInfo.os !== OS.IOS) {\r\n            res.WEBGL_multi_draw = getExtension(gl, 'WEBGL_multi_draw');\r\n        }\r\n\r\n        // UC browser instancing implementation doesn't work\r\n        if (systemInfo.browserType === BrowserType.UC) {\r\n            res.ANGLE_instanced_arrays = null;\r\n        }\r\n\r\n        // bytedance ios depth texture implementation doesn't work\r\n        if (BYTEDANCE && systemInfo.os === OS.IOS) {\r\n            res.WEBGL_depth_texture = null;\r\n        }\r\n\r\n        if (RUNTIME_BASED) {\r\n            // VAO implementations doesn't work well on some runtime platforms\r\n            if (HUAWEI) {\r\n                res.OES_vertex_array_object = null;\r\n            }\r\n        }\r\n\r\n        // some earlier version of iOS and android wechat implement gl.detachShader incorrectly\r\n        if ((systemInfo.os === OS.IOS && systemInfo.osMainVersion <= 10)\r\n            || ((WECHAT || WECHAT_MINI_PROGRAM) && systemInfo.os === OS.ANDROID)) {\r\n            res.destroyShadersImmediately = false;\r\n        }\r\n\r\n        // getUniformLocation has always been problematic because the\r\n        // paradigm differs from GLES, and many platforms get it wrong [eyerolling]\r\n        if (WECHAT || WECHAT_MINI_PROGRAM) {\r\n            // wEcHaT just returns { id: -1 } for inactive names\r\n            res.isLocationActive = (glLoc: unknown): glLoc is WebGLUniformLocation => !!glLoc && (glLoc as { id: number }).id !== -1;\r\n        }\r\n        if (ALIPAY) {\r\n            // aLiPaY just returns the location number directly on actual devices, and WebGLUniformLocation objects in simulators\r\n            res.isLocationActive = (glLoc: unknown): glLoc is WebGLUniformLocation => !!glLoc && glLoc !== -1 || glLoc === 0;\r\n        }\r\n\r\n        // compressedTexSubImage2D too\r\n        if (WECHAT || WECHAT_MINI_PROGRAM) {\r\n            res.noCompressedTexSubImage2D = true;\r\n        }\r\n\r\n        // HACK: on Taobao Android, some devices can't query texture float extension correctly, especially Huawei devices\r\n        // the query interface returns null.\r\n        if ((TAOBAO || TAOBAO_MINIGAME) && systemInfo.os === OS.ANDROID) {\r\n            res.OES_texture_half_float = { HALF_FLOAT_OES: 36193 };\r\n            res.OES_texture_half_float_linear = {};\r\n            res.OES_texture_float = {};\r\n            res.OES_texture_float_linear = {};\r\n        }\r\n    }\r\n\r\n    if (res.OES_vertex_array_object) {\r\n        res.useVAO = true;\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\nexport function getContext (canvas: HTMLCanvasElement): WebGLRenderingContext | null {\r\n    let context: WebGLRenderingContext | null = null;\r\n    try {\r\n        const webGLCtxAttribs: WebGLContextAttributes = {\r\n            alpha: macro.ENABLE_TRANSPARENT_CANVAS,\r\n            antialias: EDITOR || macro.ENABLE_WEBGL_ANTIALIAS,\r\n            depth: true,\r\n            stencil: true,\r\n            premultipliedAlpha: false,\r\n            preserveDrawingBuffer: false,\r\n            powerPreference: 'default',\r\n            failIfMajorPerformanceCaveat: false,\r\n        };\r\n\r\n        context = canvas.getContext('webgl', webGLCtxAttribs);\r\n    } catch (err) {\r\n        return null;\r\n    }\r\n\r\n    return context;\r\n}\r\n\r\n/** @mangle */\r\nexport class WebGLSwapchain extends Swapchain {\r\n    get extensions (): IWebGLExtensions {\r\n        return this._extensions as IWebGLExtensions;\r\n    }\r\n\r\n    get blitManager (): IWebGLBlitManager {\r\n        return this._blitManager!;\r\n    }\r\n\r\n    public stateCache: WebGLStateCache = new WebGLStateCache();\r\n    public nullTex2D: WebGLTexture = null!;\r\n    public nullTexCube: WebGLTexture = null!;\r\n\r\n    private _canvas: HTMLCanvasElement | null = null;\r\n    private _webGLContextLostHandler: ((event: Event) => void) | null = null;\r\n    private _extensions: IWebGLExtensions | null = null;\r\n    private _blitManager: IWebGLBlitManager | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    public initialize (info: Readonly<SwapchainInfo>): void {\r\n        const self = this;\r\n        self._canvas = info.windowHandle;\r\n\r\n        self._webGLContextLostHandler = self._onWebGLContextLost.bind(self);\r\n        self._canvas.addEventListener(eventWebGLContextLost, self._webGLContextLostHandler);\r\n\r\n        const { instance } = WebGLDeviceManager;\r\n        const { gl, capabilities } = instance;\r\n\r\n        self.stateCache.initialize(capabilities.maxTextureUnits, capabilities.maxVertexAttributes);\r\n\r\n        self._extensions = getExtensions(gl);\r\n\r\n        // init states\r\n        initStates(gl);\r\n\r\n        const colorFmt = Format.RGBA8;\r\n        let depthStencilFmt = Format.DEPTH_STENCIL;\r\n\r\n        let depthBits = gl.getParameter(WebGLConstants.DEPTH_BITS);\r\n        const stencilBits = gl.getParameter(WebGLConstants.STENCIL_BITS);\r\n\r\n        if (ALIPAY) {\r\n            depthBits = 24;\r\n        }\r\n\r\n        if (depthBits && stencilBits) depthStencilFmt = Format.DEPTH_STENCIL;\r\n        else if (depthBits) depthStencilFmt = Format.DEPTH;\r\n\r\n        self._colorTexture = new WebGLTexture();\r\n        self._colorTexture.initAsSwapchainTexture({\r\n            swapchain: self,\r\n            format: colorFmt,\r\n            width: info.width,\r\n            height: info.height,\r\n        });\r\n\r\n        self._depthStencilTexture = new WebGLTexture();\r\n        self._depthStencilTexture.initAsSwapchainTexture({\r\n            swapchain: self,\r\n            format: depthStencilFmt,\r\n            width: info.width,\r\n            height: info.height,\r\n        });\r\n\r\n        // create default null texture\r\n        self.nullTex2D = instance.createTexture(new TextureInfo(\r\n            TextureType.TEX2D,\r\n            TextureUsageBit.SAMPLED,\r\n            Format.RGBA8,\r\n            2,\r\n            2,\r\n            TextureFlagBit.GEN_MIPMAP,\r\n        )) as WebGLTexture;\r\n\r\n        self.nullTexCube = instance.createTexture(new TextureInfo(\r\n            TextureType.CUBE,\r\n            TextureUsageBit.SAMPLED,\r\n            Format.RGBA8,\r\n            2,\r\n            2,\r\n            TextureFlagBit.GEN_MIPMAP,\r\n            6,\r\n        )) as WebGLTexture;\r\n\r\n        const nullTexRegion = new BufferTextureCopy();\r\n        nullTexRegion.texExtent.width = 2;\r\n        nullTexRegion.texExtent.height = 2;\r\n\r\n        const nullTexBuff = new Uint8Array(self.nullTex2D.size);\r\n        nullTexBuff.fill(0);\r\n        instance.copyBuffersToTexture([nullTexBuff], self.nullTex2D, [nullTexRegion]);\r\n\r\n        nullTexRegion.texSubres.layerCount = 6;\r\n        instance.copyBuffersToTexture(\r\n            [nullTexBuff, nullTexBuff, nullTexBuff, nullTexBuff, nullTexBuff, nullTexBuff],\r\n            self.nullTexCube,\r\n            [nullTexRegion],\r\n        );\r\n        self._blitManager = new IWebGLBlitManager();\r\n    }\r\n\r\n    public destroy (): void {\r\n        const self = this;\r\n        if (self._canvas && self._webGLContextLostHandler) {\r\n            self._canvas.removeEventListener(eventWebGLContextLost, self._webGLContextLostHandler);\r\n            self._webGLContextLostHandler = null;\r\n        }\r\n\r\n        if (self.nullTex2D) {\r\n            self.nullTex2D.destroy();\r\n            self.nullTex2D = null!;\r\n        }\r\n\r\n        if (self.nullTexCube) {\r\n            self.nullTexCube.destroy();\r\n            self.nullTexCube = null!;\r\n        }\r\n\r\n        if (self._blitManager) {\r\n            self._blitManager.destroy();\r\n            self._blitManager = null!;\r\n        }\r\n\r\n        self._extensions = null;\r\n        self._canvas = null;\r\n    }\r\n\r\n    public resize (width: number, height: number, surfaceTransform: SurfaceTransform): void {\r\n        const self = this;\r\n        if (self._colorTexture.width !== width || self._colorTexture.height !== height) {\r\n            debug(`Resizing swapchain: ${width}x${height}`);\r\n            self._canvas!.width = width;\r\n            self._canvas!.height = height;\r\n            self._colorTexture.resize(width, height);\r\n            self._depthStencilTexture.resize(width, height);\r\n        }\r\n    }\r\n\r\n    private _onWebGLContextLost (event: Event): void {\r\n        warnID(11000);\r\n        warn(event);\r\n        // 2020.9.3: `preventDefault` is not available on some platforms\r\n        // event.preventDefault();\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { DescriptorSet } from '../base/descriptor-set';\r\nimport { DescriptorSetLayout } from '../base/descriptor-set-layout';\r\nimport { PipelineLayout } from '../base/pipeline-layout';\r\nimport { Buffer } from '../base/buffer';\r\nimport { CommandBuffer } from '../base/command-buffer';\r\nimport { Device } from '../base/device';\r\nimport { Framebuffer } from '../base/framebuffer';\r\nimport { InputAssembler } from '../base/input-assembler';\r\nimport { PipelineState, PipelineStateInfo } from '../base/pipeline-state';\r\nimport { Queue } from '../base/queue';\r\nimport { RenderPass } from '../base/render-pass';\r\nimport { Sampler } from '../base/states/sampler';\r\nimport { Shader } from '../base/shader';\r\nimport { Texture } from '../base/texture';\r\nimport { WebGLDescriptorSet } from './webgl-descriptor-set';\r\nimport { WebGLBuffer } from './webgl-buffer';\r\nimport { WebGLCommandBuffer } from './webgl-command-buffer';\r\nimport { WebGLFramebuffer } from './webgl-framebuffer';\r\nimport { WebGLInputAssembler } from './webgl-input-assembler';\r\nimport { WebGLDescriptorSetLayout } from './webgl-descriptor-set-layout';\r\nimport { WebGLPipelineLayout } from './webgl-pipeline-layout';\r\nimport { WebGLPipelineState } from './webgl-pipeline-state';\r\nimport { WebGLPrimaryCommandBuffer } from './webgl-primary-command-buffer';\r\nimport { WebGLQueue } from './webgl-queue';\r\nimport { WebGLRenderPass } from './webgl-render-pass';\r\nimport { WebGLSampler } from './states/webgl-sampler';\r\nimport { WebGLShader } from './webgl-shader';\r\nimport { getContext, getExtensions, WebGLSwapchain } from './webgl-swapchain';\r\nimport { WebGLTexture } from './webgl-texture';\r\nimport {\r\n    CommandBufferType, ShaderInfo,\r\n    QueueInfo, CommandBufferInfo, DescriptorSetInfo, DescriptorSetLayoutInfo, FramebufferInfo, InputAssemblerInfo, PipelineLayoutInfo,\r\n    RenderPassInfo, SamplerInfo, TextureInfo, TextureViewInfo, BufferInfo, BufferViewInfo, DeviceInfo, TextureBarrierInfo, GeneralBarrierInfo,\r\n    BufferBarrierInfo, QueueType, API, Feature, BufferTextureCopy, SwapchainInfo, FormatFeature, FormatFeatureBit, Format,\r\n} from '../base/define';\r\nimport { WebGLCmdFuncCopyBuffersToTexture, WebGLCmdFuncCopyTextureToBuffers, WebGLCmdFuncCopyTexImagesToTexture } from './webgl-commands';\r\nimport { GeneralBarrier } from '../base/states/general-barrier';\r\nimport { TextureBarrier } from '../base/states/texture-barrier';\r\nimport { BufferBarrier } from '../base/states/buffer-barrier';\r\nimport { Swapchain } from '../base/swapchain';\r\nimport { IWebGLExtensions, WebGLDeviceManager } from './webgl-define';\r\nimport { IWebGLBindingMapping, IWebGLBlitManager } from './webgl-gpu-objects';\r\nimport type { WebGLStateCache } from './webgl-state-cache';\r\nimport { WebGLConstants } from '../gl-constants';\r\nimport { debug, errorID } from '../../core/platform/debug';\r\n\r\nfunction setFormatFeature (formatFeatures: FormatFeature[], indexArray: Format[], feature: FormatFeature): void {\r\n    for (let i = 0; i < indexArray.length; ++i) {\r\n        formatFeatures[indexArray[i]] = feature;\r\n    }\r\n}\r\n\r\nfunction setFormatFeatureBitwiseOr (formatFeatures: FormatFeature[], indexArray: Format[], feature: FormatFeature): void {\r\n    for (let i = 0; i < indexArray.length; ++i) {\r\n        formatFeatures[indexArray[i]] |= feature;\r\n    }\r\n}\r\n\r\nfunction setTextureExclusive (textureExclusive: boolean[], indexArray: Format[], isExclusive: boolean): void {\r\n    for (let i = 0; i < indexArray.length; ++i) {\r\n        textureExclusive[indexArray[i]] = isExclusive;\r\n    }\r\n}\r\n\r\n/** @mangle */\r\nexport class WebGLDevice extends Device {\r\n    constructor () {\r\n        super();\r\n    }\r\n\r\n    get gl (): WebGLRenderingContext {\r\n        return this._context!;\r\n    }\r\n\r\n    get extensions (): IWebGLExtensions {\r\n        return this._swapchain!.extensions;\r\n    }\r\n\r\n    get stateCache (): WebGLStateCache {\r\n        return this._swapchain!.stateCache;\r\n    }\r\n\r\n    get nullTex2D (): WebGLTexture {\r\n        return this._swapchain!.nullTex2D;\r\n    }\r\n\r\n    get nullTexCube (): WebGLTexture {\r\n        return this._swapchain!.nullTexCube;\r\n    }\r\n\r\n    get textureExclusive (): boolean[] {\r\n        return this._textureExclusive;\r\n    }\r\n\r\n    get bindingMappings (): IWebGLBindingMapping {\r\n        return this._bindingMappings!;\r\n    }\r\n\r\n    get blitManager (): IWebGLBlitManager {\r\n        return this._swapchain!.blitManager;\r\n    }\r\n\r\n    private _swapchain: WebGLSwapchain | null = null;\r\n    private _context: WebGLRenderingContext | null = null;\r\n    private _bindingMappings: IWebGLBindingMapping | null = null;\r\n\r\n    protected _textureExclusive = new Array<boolean>(Format.COUNT);\r\n\r\n    public initialize (info: Readonly<DeviceInfo>): boolean {\r\n        WebGLDeviceManager.setInstance(this);\r\n        this._gfxAPI = API.WEBGL;\r\n\r\n        const mapping = this._bindingMappingInfo = info.bindingMappingInfo;\r\n        const blockOffsets: number[] = [];\r\n        const samplerTextureOffsets: number[] = [];\r\n        const firstSet = mapping.setIndices[0];\r\n        blockOffsets[firstSet] = 0;\r\n        samplerTextureOffsets[firstSet] = 0;\r\n        for (let i = 1; i < mapping.setIndices.length; ++i) {\r\n            const curSet = mapping.setIndices[i];\r\n            const prevSet = mapping.setIndices[i - 1];\r\n            // accumulate the per set offset according to the specified capacity\r\n            blockOffsets[curSet] = mapping.maxBlockCounts[prevSet] + blockOffsets[prevSet];\r\n            samplerTextureOffsets[curSet] = mapping.maxSamplerTextureCounts[prevSet] + samplerTextureOffsets[prevSet];\r\n        }\r\n        for (let i = 0; i < mapping.setIndices.length; ++i) {\r\n            const curSet = mapping.setIndices[i];\r\n            // textures always come after UBOs\r\n            samplerTextureOffsets[curSet] -= mapping.maxBlockCounts[curSet];\r\n        }\r\n        this._bindingMappings = {\r\n            blockOffsets,\r\n            samplerTextureOffsets,\r\n            flexibleSet: mapping.setIndices[mapping.setIndices.length - 1],\r\n        };\r\n\r\n        const gl = this._context = getContext(Device.canvas);\r\n\r\n        if (!gl) {\r\n            errorID(16333);\r\n            return false;\r\n        }\r\n\r\n        // create queue\r\n        this._queue = this.createQueue(new QueueInfo(QueueType.GRAPHICS));\r\n        this._cmdBuff = this.createCommandBuffer(new CommandBufferInfo(this._queue));\r\n\r\n        const glGetParameter = gl.getParameter.bind(gl);\r\n\r\n        const caps = this._caps;\r\n        caps.maxVertexAttributes = glGetParameter(WebGLConstants.MAX_VERTEX_ATTRIBS);\r\n        caps.maxVertexUniformVectors = glGetParameter(WebGLConstants.MAX_VERTEX_UNIFORM_VECTORS);\r\n        caps.maxFragmentUniformVectors = glGetParameter(WebGLConstants.MAX_FRAGMENT_UNIFORM_VECTORS);\r\n        caps.maxTextureUnits = glGetParameter(WebGLConstants.MAX_TEXTURE_IMAGE_UNITS);\r\n        caps.maxVertexTextureUnits = glGetParameter(WebGLConstants.MAX_VERTEX_TEXTURE_IMAGE_UNITS);\r\n        caps.maxTextureSize = glGetParameter(WebGLConstants.MAX_TEXTURE_SIZE);\r\n        caps.maxCubeMapTextureSize = glGetParameter(WebGLConstants.MAX_CUBE_MAP_TEXTURE_SIZE);\r\n        caps.maxArrayTextureLayers = 0;\r\n        caps.max3DTextureSize = 0;\r\n        // WebGL doesn't support UBOs at all, so here we return\r\n        // the guaranteed minimum number of available bindings in WebGL2\r\n        caps.maxUniformBufferBindings = 16;\r\n\r\n        const extensions = gl.getSupportedExtensions();\r\n        let extStr = '';\r\n        if (extensions) {\r\n            extensions.forEach((ext) => {\r\n                extStr += `${ext} `;\r\n            });\r\n        }\r\n\r\n        const exts = getExtensions(gl);\r\n\r\n        if (exts.WEBGL_debug_renderer_info) {\r\n            this._renderer = glGetParameter(exts.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL);\r\n            this._vendor = glGetParameter(exts.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL);\r\n        } else {\r\n            this._renderer = glGetParameter(WebGLConstants.RENDERER);\r\n            this._vendor = glGetParameter(WebGLConstants.VENDOR);\r\n        }\r\n\r\n        const version: string = glGetParameter(WebGLConstants.VERSION);\r\n        const features = this._features;\r\n        features.fill(false);\r\n\r\n        this.initFormatFeatures(exts);\r\n\r\n        if (exts.EXT_blend_minmax) {\r\n            features[Feature.BLEND_MINMAX] = true;\r\n        }\r\n\r\n        if (exts.OES_element_index_uint) {\r\n            features[Feature.ELEMENT_INDEX_UINT] = true;\r\n        }\r\n\r\n        if (exts.ANGLE_instanced_arrays) {\r\n            features[Feature.INSTANCED_ARRAYS] = true;\r\n        }\r\n\r\n        if (exts.WEBGL_draw_buffers) {\r\n            features[Feature.MULTIPLE_RENDER_TARGETS] = true;\r\n        }\r\n\r\n        let compressedFormat = '';\r\n\r\n        if (this.getFormatFeatures(Format.ETC_RGB8)) {\r\n            compressedFormat += 'etc1 ';\r\n        }\r\n\r\n        if (this.getFormatFeatures(Format.ETC2_RGB8)) {\r\n            compressedFormat += 'etc2 ';\r\n        }\r\n\r\n        if (this.getFormatFeatures(Format.BC1)) {\r\n            compressedFormat += 'dxt ';\r\n        }\r\n\r\n        if (this.getFormatFeatures(Format.PVRTC_RGB2)) {\r\n            compressedFormat += 'pvrtc ';\r\n        }\r\n\r\n        if (this.getFormatFeatures(Format.ASTC_RGBA_4X4)) {\r\n            compressedFormat += 'astc ';\r\n        }\r\n\r\n        debug('WebGL device initialized.');\r\n        debug(`RENDERER: ${this._renderer}`);\r\n        debug(`VENDOR: ${this._vendor}`);\r\n        debug(`VERSION: ${version}`);\r\n        debug(`COMPRESSED_FORMAT: ${compressedFormat}`);\r\n        debug(`EXTENSIONS: ${extStr}`);\r\n\r\n        return true;\r\n    }\r\n\r\n    public destroy (): void {\r\n        if (this._queue) {\r\n            this._queue.destroy();\r\n            this._queue = null;\r\n        }\r\n\r\n        if (this._cmdBuff) {\r\n            this._cmdBuff.destroy();\r\n            this._cmdBuff = null;\r\n        }\r\n\r\n        this._swapchain = null;\r\n    }\r\n\r\n    public flushCommands (cmdBuffs: CommandBuffer[]): void {\r\n        // noop\r\n    }\r\n\r\n    public acquire (swapchains: Swapchain[]): void {\r\n        // noop\r\n    }\r\n\r\n    public present (): void {\r\n        const queue = (this._queue as WebGLQueue);\r\n        this._numDrawCalls = queue.numDrawCalls;\r\n        this._numInstances = queue.numInstances;\r\n        this._numTris = queue.numTris;\r\n        queue.clear();\r\n    }\r\n\r\n    protected initFormatFeatures (exts: IWebGLExtensions): void {\r\n        const formatFeatures = this._formatFeatures;\r\n        formatFeatures.fill(FormatFeatureBit.NONE);\r\n\r\n        const textureExclusive = this._textureExclusive;\r\n        textureExclusive.fill(true);\r\n\r\n        const tempFeature: FormatFeature = FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE\r\n            | FormatFeatureBit.LINEAR_FILTER;\r\n\r\n        setFormatFeature(formatFeatures, [\r\n            Format.RGB8,\r\n            Format.R5G6B5,\r\n            Format.RGBA8,\r\n            Format.RGBA4,\r\n            Format.RGB5A1,\r\n        ], tempFeature);\r\n\r\n        setFormatFeature(formatFeatures, [\r\n            Format.DEPTH,\r\n            Format.DEPTH_STENCIL,\r\n        ], FormatFeatureBit.RENDER_TARGET);\r\n\r\n        setTextureExclusive(textureExclusive, [\r\n            Format.R5G6B5,\r\n            Format.RGBA4,\r\n            Format.RGB5A1,\r\n            Format.DEPTH,\r\n            Format.DEPTH_STENCIL,\r\n        ], false);\r\n\r\n        setFormatFeatureBitwiseOr(formatFeatures, [\r\n            Format.R8I,\r\n            Format.RG8I,\r\n            Format.RGB8I,\r\n            Format.RGBA8I,\r\n\r\n            Format.R8UI,\r\n            Format.RG8UI,\r\n            Format.RGB8UI,\r\n            Format.RGBA8UI,\r\n\r\n            Format.R8I,\r\n            Format.RG8I,\r\n            Format.RGB8I,\r\n            Format.RGBA8I,\r\n\r\n            Format.R8UI,\r\n            Format.RG8UI,\r\n            Format.RGB8UI,\r\n            Format.RGBA8UI,\r\n\r\n            Format.R32F,\r\n            Format.RG32F,\r\n            Format.RGB32F,\r\n            Format.RGBA32F,\r\n        ], FormatFeatureBit.VERTEX_ATTRIBUTE);\r\n\r\n        if (exts.EXT_sRGB) {\r\n            formatFeatures[Format.SRGB8] = tempFeature;\r\n            formatFeatures[Format.SRGB8_A8] = tempFeature;\r\n\r\n            textureExclusive[Format.SRGB8_A8] = false;\r\n        }\r\n\r\n        if (exts.WEBGL_depth_texture) {\r\n            formatFeatures[Format.DEPTH] |= tempFeature;\r\n            formatFeatures[Format.DEPTH_STENCIL] |= tempFeature;\r\n        }\r\n\r\n        if (exts.WEBGL_color_buffer_float) {\r\n            formatFeatures[Format.RGB32F] |= FormatFeatureBit.RENDER_TARGET;\r\n            formatFeatures[Format.RGBA32F] |= FormatFeatureBit.RENDER_TARGET;\r\n            textureExclusive[Format.RGB32F] = false;\r\n            textureExclusive[Format.RGBA32F] = false;\r\n        }\r\n\r\n        if (exts.EXT_color_buffer_half_float) {\r\n            formatFeatures[Format.RGB16F] |= FormatFeatureBit.RENDER_TARGET;\r\n            formatFeatures[Format.RGBA16F] |= FormatFeatureBit.RENDER_TARGET;\r\n            textureExclusive[Format.RGB16F] = false;\r\n            textureExclusive[Format.RGBA16F] = false;\r\n        }\r\n\r\n        if (exts.OES_texture_float) {\r\n            formatFeatures[Format.RGB32F] |= FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE;\r\n            formatFeatures[Format.RGBA32F] |= FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE;\r\n        }\r\n\r\n        if (exts.OES_texture_half_float) {\r\n            formatFeatures[Format.RGB16F] |= FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE;\r\n            formatFeatures[Format.RGBA16F] |= FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE;\r\n        }\r\n\r\n        if (exts.OES_texture_float_linear) {\r\n            formatFeatures[Format.RGB32F] |= FormatFeatureBit.LINEAR_FILTER;\r\n            formatFeatures[Format.RGBA32F] |= FormatFeatureBit.LINEAR_FILTER;\r\n        }\r\n\r\n        if (exts.OES_texture_half_float_linear) {\r\n            formatFeatures[Format.RGB16F] |= FormatFeatureBit.LINEAR_FILTER;\r\n            formatFeatures[Format.RGBA16F] |= FormatFeatureBit.LINEAR_FILTER;\r\n        }\r\n\r\n        const compressedFeature: FormatFeature = FormatFeatureBit.SAMPLED_TEXTURE | FormatFeatureBit.LINEAR_FILTER;\r\n\r\n        if (exts.WEBGL_compressed_texture_etc1) {\r\n            formatFeatures[Format.ETC_RGB8] = compressedFeature;\r\n        }\r\n\r\n        if (exts.WEBGL_compressed_texture_etc) {\r\n            setFormatFeature(formatFeatures, [\r\n                Format.ETC2_RGB8,\r\n                Format.ETC2_RGBA8,\r\n                Format.ETC2_SRGB8,\r\n                Format.ETC2_SRGB8_A8,\r\n                Format.ETC2_RGB8_A1,\r\n                Format.ETC2_SRGB8_A1,\r\n            ], compressedFeature);\r\n        }\r\n\r\n        if (exts.WEBGL_compressed_texture_s3tc) {\r\n            setFormatFeature(formatFeatures, [\r\n                Format.BC1,\r\n                Format.BC1_ALPHA,\r\n                Format.BC1_SRGB,\r\n                Format.BC1_SRGB_ALPHA,\r\n                Format.BC2,\r\n                Format.BC2_SRGB,\r\n                Format.BC3,\r\n                Format.BC3_SRGB,\r\n            ], compressedFeature);\r\n        }\r\n\r\n        if (exts.WEBGL_compressed_texture_pvrtc) {\r\n            setFormatFeatureBitwiseOr(formatFeatures, [\r\n                Format.PVRTC_RGB2,\r\n                Format.PVRTC_RGBA2,\r\n                Format.PVRTC_RGB4,\r\n                Format.PVRTC_RGBA4,\r\n            ], compressedFeature);\r\n        }\r\n\r\n        if (exts.WEBGL_compressed_texture_astc) {\r\n            setFormatFeatureBitwiseOr(formatFeatures, [\r\n                Format.ASTC_RGBA_4X4,\r\n                Format.ASTC_RGBA_5X4,\r\n                Format.ASTC_RGBA_5X5,\r\n                Format.ASTC_RGBA_6X5,\r\n                Format.ASTC_RGBA_6X6,\r\n                Format.ASTC_RGBA_8X5,\r\n                Format.ASTC_RGBA_8X6,\r\n                Format.ASTC_RGBA_8X8,\r\n                Format.ASTC_RGBA_10X5,\r\n                Format.ASTC_RGBA_10X6,\r\n                Format.ASTC_RGBA_10X8,\r\n                Format.ASTC_RGBA_10X10,\r\n                Format.ASTC_RGBA_12X10,\r\n                Format.ASTC_RGBA_12X12,\r\n\r\n                Format.ASTC_SRGBA_4X4,\r\n                Format.ASTC_SRGBA_5X4,\r\n                Format.ASTC_SRGBA_5X5,\r\n                Format.ASTC_SRGBA_6X5,\r\n                Format.ASTC_SRGBA_6X6,\r\n                Format.ASTC_SRGBA_8X5,\r\n                Format.ASTC_SRGBA_8X6,\r\n                Format.ASTC_SRGBA_8X8,\r\n                Format.ASTC_SRGBA_10X5,\r\n                Format.ASTC_SRGBA_10X6,\r\n                Format.ASTC_SRGBA_10X8,\r\n                Format.ASTC_SRGBA_10X10,\r\n                Format.ASTC_SRGBA_12X10,\r\n                Format.ASTC_SRGBA_12X12,\r\n            ], compressedFeature);\r\n        }\r\n    }\r\n\r\n    public createCommandBuffer (info: Readonly<CommandBufferInfo>): CommandBuffer {\r\n        // const Ctor = WebGLCommandBuffer; // opt to instant invocation\r\n        const Ctor = info.type === CommandBufferType.PRIMARY ? WebGLPrimaryCommandBuffer : WebGLCommandBuffer;\r\n        const cmdBuff = new Ctor();\r\n        cmdBuff.initialize(info);\r\n        return cmdBuff;\r\n    }\r\n\r\n    public createSwapchain (info: Readonly<SwapchainInfo>): Swapchain {\r\n        const swapchain = new WebGLSwapchain();\r\n        this._swapchain = swapchain;\r\n        swapchain.initialize(info);\r\n        return swapchain;\r\n    }\r\n\r\n    public createBuffer (info: Readonly<BufferInfo> | Readonly<BufferViewInfo>): Buffer {\r\n        const buffer = new WebGLBuffer();\r\n        buffer.initialize(info);\r\n        return buffer;\r\n    }\r\n\r\n    public createTexture (info: Readonly<TextureInfo> | Readonly<TextureViewInfo>): Texture {\r\n        const texture = new WebGLTexture();\r\n        texture.initialize(info);\r\n        return texture;\r\n    }\r\n\r\n    public createDescriptorSet (info: Readonly<DescriptorSetInfo>): DescriptorSet {\r\n        const descriptorSet = new WebGLDescriptorSet();\r\n        descriptorSet.initialize(info);\r\n        return descriptorSet;\r\n    }\r\n\r\n    public createShader (info: Readonly<ShaderInfo>): Shader {\r\n        const shader = new WebGLShader();\r\n        shader.initialize(info);\r\n        return shader;\r\n    }\r\n\r\n    public createInputAssembler (info: Readonly<InputAssemblerInfo>): InputAssembler {\r\n        const inputAssembler = new WebGLInputAssembler();\r\n        inputAssembler.initialize(info);\r\n        return inputAssembler;\r\n    }\r\n\r\n    public createRenderPass (info: Readonly<RenderPassInfo>): RenderPass {\r\n        const renderPass = new WebGLRenderPass();\r\n        renderPass.initialize(info);\r\n        return renderPass;\r\n    }\r\n\r\n    public createFramebuffer (info: Readonly<FramebufferInfo>): Framebuffer {\r\n        const framebuffer = new WebGLFramebuffer();\r\n        framebuffer.initialize(info);\r\n        return framebuffer;\r\n    }\r\n\r\n    public createDescriptorSetLayout (info: Readonly<DescriptorSetLayoutInfo>): DescriptorSetLayout {\r\n        const descriptorSetLayout = new WebGLDescriptorSetLayout();\r\n        descriptorSetLayout.initialize(info);\r\n        return descriptorSetLayout;\r\n    }\r\n\r\n    public createPipelineLayout (info: Readonly<PipelineLayoutInfo>): PipelineLayout {\r\n        const pipelineLayout = new WebGLPipelineLayout();\r\n        pipelineLayout.initialize(info);\r\n        return pipelineLayout;\r\n    }\r\n\r\n    public createPipelineState (info: Readonly<PipelineStateInfo>): PipelineState {\r\n        const pipelineState = new WebGLPipelineState();\r\n        pipelineState.initialize(info);\r\n        return pipelineState;\r\n    }\r\n\r\n    public createQueue (info: Readonly<QueueInfo>): Queue {\r\n        const queue = new WebGLQueue();\r\n        queue.initialize(info);\r\n        return queue;\r\n    }\r\n\r\n    public getSampler (info: Readonly<SamplerInfo>): Sampler {\r\n        const hash = Sampler.computeHash(info);\r\n        if (!this._samplers.has(hash)) {\r\n            this._samplers.set(hash, new WebGLSampler(info, hash));\r\n        }\r\n        return this._samplers.get(hash)!;\r\n    }\r\n\r\n    public getSwapchains (): Readonly<Swapchain[]> {\r\n        return [this._swapchain as Swapchain];\r\n    }\r\n\r\n    public getGeneralBarrier (info: Readonly<GeneralBarrierInfo>): GeneralBarrier {\r\n        const hash = GeneralBarrier.computeHash(info);\r\n        if (!this._generalBarrierss.has(hash)) {\r\n            this._generalBarrierss.set(hash, new GeneralBarrier(info, hash));\r\n        }\r\n        return this._generalBarrierss.get(hash)!;\r\n    }\r\n\r\n    public getTextureBarrier (info: Readonly<TextureBarrierInfo>): TextureBarrier {\r\n        const hash = TextureBarrier.computeHash(info);\r\n        if (!this._textureBarriers.has(hash)) {\r\n            this._textureBarriers.set(hash, new TextureBarrier(info, hash));\r\n        }\r\n        return this._textureBarriers.get(hash)!;\r\n    }\r\n\r\n    public getBufferBarrier (info: Readonly<BufferBarrierInfo>): BufferBarrier {\r\n        const hash = BufferBarrier.computeHash(info);\r\n        if (!this._bufferBarriers.has(hash)) {\r\n            this._bufferBarriers.set(hash, new BufferBarrier(info, hash));\r\n        }\r\n        return this._bufferBarriers.get(hash)!;\r\n    }\r\n\r\n    public copyBuffersToTexture (buffers: Readonly<ArrayBufferView[]>, texture: Texture, regions: Readonly<BufferTextureCopy[]>): void {\r\n        WebGLCmdFuncCopyBuffersToTexture(\r\n            this,\r\n            buffers as ArrayBufferView[],\r\n            (texture as WebGLTexture).gpuTexture,\r\n            regions,\r\n        );\r\n    }\r\n\r\n    public copyTextureToBuffers (texture: Readonly<Texture>, buffers: ArrayBufferView[], regions: Readonly<BufferTextureCopy[]>): void {\r\n        WebGLCmdFuncCopyTextureToBuffers(\r\n            this,\r\n            (texture as WebGLTexture).gpuTexture,\r\n            buffers,\r\n            regions,\r\n        );\r\n    }\r\n\r\n    public copyTexImagesToTexture (\r\n        texImages: Readonly<TexImageSource[]>,\r\n        texture: Texture,\r\n        regions: Readonly<BufferTextureCopy[]>,\r\n    ): void {\r\n        WebGLCmdFuncCopyTexImagesToTexture(\r\n            this,\r\n            texImages,\r\n            (texture as WebGLTexture).gpuTexture,\r\n            regions,\r\n        );\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated engine source code (the \"Software\"), a limited,\r\n worldwide, royalty-free, non-assignable, revocable and non-exclusive license\r\n to use Cocos Creator solely to develop games on your target platforms. You shall\r\n not use Cocos Creator software for developing other software or tools that's\r\n used for developing games. You are not granted to publish, distribute,\r\n sublicense, and/or sell copies of Cocos Creator.\r\n\r\n The software or tools in this License Agreement are licensed, not sold.\r\n Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n */\r\n\r\nimport { WebGLDevice } from '../cocos/gfx/webgl/webgl-device';\r\nimport { legacyCC } from '../cocos/core/global-exports';\r\n\r\nexport { WebGLDevice };\r\nlegacyCC.WebGLDevice = WebGLDevice;\r\n"],"names":["WebGLDescriptorSet","_DescriptorSet","_this","call","_gpuDescriptorSet","_inheritsLoose","_proto","prototype","initialize","info","_layout","layout","_gpuDescriptorSetLayo","gpuDescriptorSetLayout","bindings","descriptorIndices","descriptorCount","_buffers","Array","fill","_textures","_samplers","gpuDescriptors","i","length","binding","j","count","gpuDescriptor","type","descriptorType","gpuBuffer","gpuTexture","gpuSampler","push","destroy","update","_isDirty","descriptors","DESCRIPTOR_BUFFER_TYPE","buffer","gpuBufferView","DESCRIPTOR_SAMPLER_TYPE","_createClass","key","get","DescriptorSet","WebGLEXT","WebGLDeviceManager","setInstance","instance","_instance","max","Math","min","GFXFormatToWebGLType","format","gl","Format","R8","WebGLConstants","UNSIGNED_BYTE","R8SN","BYTE","R8UI","R8I","R16F","HALF_FLOAT_OES","R16UI","UNSIGNED_SHORT","R16I","SHORT","R32F","FLOAT","R32UI","UNSIGNED_INT","R32I","INT","RG8","RG8SN","RG8UI","RG8I","RG16F","RG16UI","RG16I","RG32F","RG32UI","RG32I","RGB8","SRGB8","RGB8SN","RGB8UI","RGB8I","RGB16F","RGB16UI","RGB16I","RGB32F","RGB32UI","RGB32I","BGRA8","RGBA8","SRGB8_A8","RGBA8SN","RGBA8UI","RGBA8I","RGBA16F","RGBA16UI","RGBA16I","RGBA32F","RGBA32UI","RGBA32I","R5G6B5","UNSIGNED_SHORT_5_6_5","R11G11B10F","RGB5A1","UNSIGNED_SHORT_5_5_5_1","RGBA4","UNSIGNED_SHORT_4_4_4_4","RGB10A2","RGB10A2UI","RGB9E5","DEPTH","DEPTH_STENCIL","UNSIGNED_INT_24_8_WEBGL","BC1","BC1_SRGB","BC2","BC2_SRGB","BC3","BC3_SRGB","BC4","BC4_SNORM","BC5","BC5_SNORM","BC6H_SF16","BC6H_UF16","BC7","BC7_SRGB","ETC_RGB8","ETC2_RGB8","ETC2_SRGB8","ETC2_RGB8_A1","ETC2_SRGB8_A1","EAC_R11","EAC_R11SN","EAC_RG11","EAC_RG11SN","PVRTC_RGB2","PVRTC_RGBA2","PVRTC_RGB4","PVRTC_RGBA4","PVRTC2_2BPP","PVRTC2_4BPP","ASTC_RGBA_4X4","ASTC_RGBA_5X4","ASTC_RGBA_5X5","ASTC_RGBA_6X5","ASTC_RGBA_6X6","ASTC_RGBA_8X5","ASTC_RGBA_8X6","ASTC_RGBA_8X8","ASTC_RGBA_10X5","ASTC_RGBA_10X6","ASTC_RGBA_10X8","ASTC_RGBA_10X10","ASTC_RGBA_12X10","ASTC_RGBA_12X12","ASTC_SRGBA_4X4","ASTC_SRGBA_5X4","ASTC_SRGBA_5X5","ASTC_SRGBA_6X5","ASTC_SRGBA_6X6","ASTC_SRGBA_8X5","ASTC_SRGBA_8X6","ASTC_SRGBA_8X8","ASTC_SRGBA_10X5","ASTC_SRGBA_10X6","ASTC_SRGBA_10X8","ASTC_SRGBA_10X10","ASTC_SRGBA_12X10","ASTC_SRGBA_12X12","GFXFormatToWebGLInternalFormat","RGB565","RGB5_A1","RGBA16F_EXT","RGBA32F_EXT","SRGB8_ALPHA8_EXT","DEPTH_COMPONENT16","errorID","RGBA","GFXFormatToWebGLFormat","A8","ALPHA","L8","LUMINANCE","LA8","LUMINANCE_ALPHA","RGB","DEPTH_COMPONENT","COMPRESSED_RGB_S3TC_DXT1_EXT","BC1_ALPHA","COMPRESSED_RGBA_S3TC_DXT1_EXT","COMPRESSED_SRGB_S3TC_DXT1_EXT","BC1_SRGB_ALPHA","COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT","COMPRESSED_RGBA_S3TC_DXT3_EXT","COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT","COMPRESSED_RGBA_S3TC_DXT5_EXT","COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT","COMPRESSED_RGB_ETC1_WEBGL","COMPRESSED_RGB8_ETC2","COMPRESSED_SRGB8_ETC2","COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2","COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2","ETC2_RGBA8","COMPRESSED_RGBA8_ETC2_EAC","ETC2_SRGB8_A8","COMPRESSED_SRGB8_ALPHA8_ETC2_EAC","COMPRESSED_R11_EAC","COMPRESSED_SIGNED_R11_EAC","COMPRESSED_RG11_EAC","COMPRESSED_SIGNED_RG11_EAC","COMPRESSED_RGB_PVRTC_2BPPV1_IMG","COMPRESSED_RGBA_PVRTC_2BPPV1_IMG","COMPRESSED_RGB_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_PVRTC_4BPPV1_IMG","COMPRESSED_RGBA_ASTC_4x4_KHR","COMPRESSED_RGBA_ASTC_5x4_KHR","COMPRESSED_RGBA_ASTC_5x5_KHR","COMPRESSED_RGBA_ASTC_6x5_KHR","COMPRESSED_RGBA_ASTC_6x6_KHR","COMPRESSED_RGBA_ASTC_8x5_KHR","COMPRESSED_RGBA_ASTC_8x6_KHR","COMPRESSED_RGBA_ASTC_8x8_KHR","COMPRESSED_RGBA_ASTC_10x5_KHR","COMPRESSED_RGBA_ASTC_10x6_KHR","COMPRESSED_RGBA_ASTC_10x8_KHR","COMPRESSED_RGBA_ASTC_10x10_KHR","COMPRESSED_RGBA_ASTC_12x10_KHR","COMPRESSED_RGBA_ASTC_12x12_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR","COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR","GFXTypeToWebGLType","Type","BOOL","BOOL2","BOOL_VEC2","BOOL3","BOOL_VEC3","BOOL4","BOOL_VEC4","INT2","INT_VEC2","INT3","INT_VEC3","INT4","INT_VEC4","UINT","FLOAT2","FLOAT_VEC2","FLOAT3","FLOAT_VEC3","FLOAT4","FLOAT_VEC4","MAT2","FLOAT_MAT2","MAT3","FLOAT_MAT3","MAT4","FLOAT_MAT4","SAMPLER2D","SAMPLER_2D","SAMPLER_CUBE","UNKNOWN","GFXTypeToTypedArrayCtor","Int32Array","Float32Array","WebGLTypeToGFXType","glType","WebGLGetTypeSize","WebGLGetComponentCount","WebGLCmpFuncs","NEVER","LESS","EQUAL","LEQUAL","GREATER","NOTEQUAL","GEQUAL","ALWAYS","WebGLStencilOps","WebGLBlendOps","WebGLBlendFactors","WebGLCmdFuncCreateBuffer","device","stateCache","glUsage","memUsage","MemoryUsageBit","HOST","DYNAMIC_DRAW","STATIC_DRAW","usage","BufferUsageBit","VERTEX","glTarget","ARRAY_BUFFER","glBuffer","createBuffer","size","extensions","useVAO","glVAO","OES_vertex_array_object","bindVertexArrayOES","gfxStateCache","gpuInputAssembler","glArrayBuffer","bindBuffer","bufferData","INDEX","ELEMENT_ARRAY_BUFFER","glElementArrayBuffer","UNIFORM","NONE","vf32","INDIRECT","TRANSFER_DST","TRANSFER_SRC","WebGLCmdFuncDestroyBuffer","cache","deleteBuffer","WebGLCmdFuncResizeBuffer","WebGLCmdFuncUpdateBuffer","offset","ArrayBuffer","isView","set","BYTES_PER_ELEMENT","indirects","clearDraws","drawInfos","setDrawInfo","buff","systemInfo","os","OS","IOS","byteLength","bufferSubData","slice","WebGLCmdFuncCreateTexture","glFormat","glInternalFmt","w","width","h","height","TextureType","TEX2D","TEXTURE_2D","maxSize","capabilities","maxTextureSize","textureExclusive","WEBGL_depth_texture","BYTEDANCE","FormatInfos","hasDepth","glRenderbuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","glTexture","createTexture","glTexUnit","glTexUnits","texUnit","bindTexture","isCompressed","mipLevel","imgSize","FormatSize","view","Uint8Array","compressedTexImage2D","texImage2D","isPowerOf2","glWrapS","REPEAT","glWrapT","CLAMP_TO_EDGE","glMinFilter","LINEAR","glMagFilter","texParameteri","TEXTURE_WRAP_S","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","CUBE","TEXTURE_CUBE_MAP","maxCubeMapTextureSize","f","TEXTURE_CUBE_MAP_POSITIVE_X","WebGLCmdFuncDestroyTexture","deleteTexture","activeTexture","TEXTURE0","deleteRenderbuffer","WebGLCmdFuncResizeTexture","WebGLCmdFuncCreateFramebuffer","gpuFramebuffer","gpuColorTextures","tex","isSwapchainTexture","isOffscreen","attachments","glFramebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","dst","gpuDepthStencilTexture","glAttachment","hasStencil","DEPTH_STENCIL_ATTACHMENT","DEPTH_ATTACHMENT","WEBGL_draw_buffers","drawBuffersWEBGL","status","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","FRAMEBUFFER_INCOMPLETE_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT","FRAMEBUFFER_INCOMPLETE_DIMENSIONS","FRAMEBUFFER_UNSUPPORTED","WebGLCmdFuncDestroyFramebuffer","deleteFramebuffer","WebGLCmdFuncCreateShader","gpuShader","_loop","gpuStage","gpuStages","k","glShaderType","shaderTypeStr","lineNumber","ShaderStageFlagBit","VERTEX_SHADER","FRAGMENT","FRAGMENT_SHADER","v","glShader","createShader","shaderSource","source","compileShader","getShaderParameter","COMPILE_STATUS","name","replace","error","getShaderInfoLog","l","stage","deleteShader","_ret","glProgram","createProgram","attachShader","linkProgram","destroyShadersImmediately","detachShader","getProgramParameter","LINK_STATUS","debugID","getProgramInfoLog","activeAttribCount","ACTIVE_ATTRIBUTES","glInputs","attribInfo","getActiveAttrib","attribType","attribName","attribSize","varName","nameOffset","indexOf","substring","glLoc","getAttribLocation","gfxType","stride","blocks","glBlocks","block","glBlock","glUniforms","members","glActiveUniforms","u","uniform","array","subpassInputs","subpassInput","samplerTextures","UniformSamplerTexture","glSamplerTextures","sampler","units","glUnits","activeUniformCount","ACTIVE_UNIFORMS","uniformInfo","getActiveUniform","isSampler","getUniformLocation","isLocationActive","glUniform","glActiveSamplers","glActiveSamplerLocations","bindingMappings","texUnitCacheMap","maxTextureUnits","cclegacy","rendering","enableEffectImport","flexibleSetBaseOffset","flexibleSet","arrayOffset","undefined","samplerTextureOffsets","flattened","usedTexUnits","glSampler","cachedUnit","t","unitIdx","useProgram","uniform1iv","WebGLCmdFuncDestroyShader","deleteProgram","WebGLCmdFuncCreateInputAssember","glAttribs","attributes","offsets","attrib","attribFormat","attribIsNormalized","isNormalized","attribIsInstanced","isInstanced","stream","gpuVertexBuffers","componentCount","WebGLCmdFuncDestroyInputAssembler","it","glVAOs","values","res","next","done","deleteVertexArrayOES","value","clear","gpuPipelineState","glPrimitive","realRenderArea","Rect","WebGLCmdFuncBeginRenderPass","gpuRenderPass","renderArea","clearColors","clearDepth","clearStencil","clears","lodLevel","x","y","curGPUFrameBuffer","realRenderAreaX","realRenderAreaY","realRenderAreaWidth","realRenderAreaHeight","cacheViewport","viewport","left","top","cacheScissorRect","scissorRect","scissor","clearCount","cacheDSS","dss","colorAttachment","colorAttachments","loadOp","LoadOp","LOAD","CLEAR","bs","targets","blendColorMask","ColorMask","ALL","colorMask","clearColor","z","COLOR_BUFFER_BIT","DISCARD","depthStencilAttachment","depthLoadOp","depthWrite","depthMask","DEPTH_BUFFER_BIT","stencilLoadOp","stencilWriteMaskFront","stencilMaskSeparate","FRONT","stencilWriteMaskBack","BACK","STENCIL_BUFFER_BIT","r","R","g","G","b","B","a","A","WebGLCmdFuncBindStates","gpuDescriptorSets","dynamicOffsets","dynamicStates","cacheBS","isShaderChanged","rs","cacheRS","cullMode","CullMode","disable","CULL_FACE","enable","cullFace","isFrontFaceCCW","frontFace","CCW","CW","depthBias","depthBiasSlop","polygonOffset","lineWidth","depthTest","DEPTH_TEST","depthFunc","stencilTestFront","stencilTestBack","STENCIL_TEST","stencilFuncFront","stencilRefFront","stencilReadMaskFront","stencilFuncSeparate","stencilFailOpFront","stencilZFailOpFront","stencilPassOpFront","stencilOpSeparate","stencilFuncBack","stencilRefBack","stencilReadMaskBack","stencilFailOpBack","stencilZFailOpBack","stencilPassOpBack","isA2C","SAMPLE_ALPHA_TO_COVERAGE","blendColor","target0","target0Cache","blend","BLEND","blendEq","blendAlphaEq","blendEquationSeparate","blendSrc","blendDst","blendSrcAlpha","blendDstAlpha","blendFuncSeparate","gpuPipelineLayout","blockLen","dynamicOffsetIndices","gpuDescriptorSet","descriptorIdx","dynamicOffsetIndexSet","dynamicOffsetIndex","uniformLen","idx","n","m","uniform2iv","uniform3iv","uniform4iv","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","samplerLen","descriptorIndex","texUnitLen","_gpuDescriptor2","nullTex2D","_gpuDescriptor3","LINEAR_MIPMAP_NEAREST","LINEAR_MIPMAP_LINEAR","NEAREST","ia","ANGLE_instanced_arrays","vao","createVertexArrayOES","glAttrib","inputLen","glInput","attribLen","c","attribOffset","enableVertexAttribArray","glCurrentAttribLocs","vertexAttribPointer","vertexAttribDivisorANGLE","gpuIndexBuffer","maxVertexAttributes","glEnabledAttribLocs","disableVertexAttribArray","dsLen","dynamicState","DynamicStateFlagBit","LINE_WIDTH","DEPTH_BIAS","depthBiasConstant","depthBiasSlope","BLEND_CONSTANTS","blendConstant","copy","STENCIL_WRITE_MASK","front","stencilStatesFront","back","stencilStatesBack","writeMask","STENCIL_COMPARE_MASK","reference","compareMask","WebGLCmdFuncDraw","drawInfo","_device$extensions","md","WEBGL_multi_draw","indexBuffer","gpuIndirectBuffer","drawByIndex","drawCount","byteOffsets","instancedDraw","multiDrawElementsInstancedWEBGL","counts","glIndexType","instances","multiDrawElementsWEBGL","drawElementsInstancedANGLE","drawElements","multiDrawArraysInstancedWEBGL","multiDrawArraysWEBGL","drawArraysInstancedANGLE","drawArrays","instanceCount","indexCount","firstIndex","vertexCount","firstVertex","WebGLCmdFuncCopyTexImagesToTexture","texImages","regions","region","texSubImage2D","texSubres","texOffset","regionTexOffset","regionTexSubres","fcount","baseArrayLayer","layerCount","flags","TextureFlagBit","GEN_MIPMAP","generateMipmap","stagingBuffer","pixelBufferPick","extent","blockHeight","formatAlignment","bufferSize","depth","rowStride","sliceStride","chunkSize","ArrayBufferCtor","getTypedArrayConstructor","destOffset","bufferOffset","subarray","byteOffset","assertID","Number","isInteger","WebGLCmdFuncCopyBuffersToTexture","buffers","fmtInfo","blockSize","Extent","Offset","regionTexExtent","texExtent","regionTexExtentWidth","regionTexExtentHeight","blockSizeWidth","blockSizeHeight","regionBuffStride","buffStride","alignTo","buffTexHeight","destWidth","destHeight","pixels","buffOffset","noCompressedTexSubImage2D","compressedTexSubImage2D","WebGLCmdFuncCopyTextureToBuffers","framebuffer","readPixels","WebGLCmdFuncBlitTexture","srcTexture","dstTexture","filter","blitManager","draw","createInt32Array","capacity","WebGLIndirectDrawInfos","_capacity","_ensureCapacity","target","nextPow2","IWebGLBlitManager","_gpuShader","_gpuDescriptorSetLayout","_gpuPipelineLayout","_gpuPipelineState","_gpuVertexBuffer","_gpuInputAssembler","_gpuPointSampler","_gpuLinearSampler","_gpuUniformBuffer","_drawInfo","_glFramebuffer","_uniformBuffer","samplerOffset","bindingMappingInfo","maxBlockCounts","UniformBlock","Uniform","DescriptorSetLayoutBinding","DescriptorType","UNIFORM_BUFFER","SAMPLER_TEXTURE","dynamicBindings","gpuSetLayouts","dynamicOffsetCount","dynamicOffsetOffsets","TRIANGLE_STRIP","DepthStencilState","DEVICE","memoryStatus","data","Attribute","Map","glWrapR","DrawInfo","_proto2","gpuTextureSrc","gpuTextureDst","origFramebuffer","descriptor","Filter","POINT","formatInfo","attachment","regionIndices","map","_","sort","srcSubres","dstSubres","srcWidth","srcHeight","dstWidth","dstHeight","srcExtent","srcOffset","dstExtent","dstOffset","origViewport","origScissor","WebGLBuffer","_Buffer","_gpuBuffer","_gpuBufferView","_isBufferView","_usage","_memUsage","_size","_stride","range","_count","_flags","resize","warnID","oldSize","buffSize","Buffer","WebGLCommandBuffer","_CommandBuffer","_isInRenderPass","_curGPUPipelineState","_curGPUInputAssembler","_curGPUDescriptorSets","_curDynamicOffsets","_curDynamicStates","DynamicStates","_isStateInvalied","_type","_queue","queue","setCount","blockOffsets","begin","renderPass","subpass","frameBuffer","_numDrawCalls","_numInstances","_numTris","end","bindStates","beginRenderPass","endRenderPass","bindPipelineState","pipelineState","bindDescriptorSet","descriptorSet","_this$_curGPUPipeline","bindInputAssembler","inputAssembler","getGpuInputAssembler","setViewport","minDepth","maxDepth","setScissor","setLineWidth","setDepthBias","depthBiasConstantFactor","depthBiasClamp","depthBiasSlopeFactor","setBlendConstants","blendConstants","setDepthBound","minDepthBounds","maxDepthBounds","depthMinBounds","depthMaxBounds","setStencilWriteMask","face","StencilFace","setStencilCompareMask","infoOrAssembler","updateBuffer","copyBuffersToTexture","texture","execute","cmdBuffs","pipelineBarrier","GeneralBarrier","bufferBarriers","textureBarriers","textures","blitTexture","CommandBuffer","WebGLFramebuffer","_Framebuffer","_gpuFramebuffer","_gpuColorTextures","_gpuDepthStencilTexture","getGpuFramebuffer","_this2","_this$_gpuFramebuffer","_renderPass","_colorTextures","colorTextures","depthStencilTexture","_depthStencilTexture","colorTexture","MAX_SAFE_INTEGER","val","forEach","_width","_height","_gpuFramebuffer$gpuDe","Framebuffer","WebGLInputAssembler","_InputAssembler","vertexBuffers","_attributes","_attributesHash","computeAttributesHash","_vertexBuffers","_indexBuffer","vertBuff","vertexOffset","firstInstance","_indirectBuffer","indirectBuffer","vb","InputAssembler","WebGLDescriptorSetLayout","_DescriptorSetLayout","apply","_bindings","maxBinding","flattenedIndices","_bindingIndices","_descriptorIndices","DESCRIPTOR_DYNAMIC_TYPE","DescriptorSetLayout","WebGLPipelineLayout","_PipelineLayout","_setLayouts","setLayouts","setLayout","indices","bindingIndices","PipelineLayout","WebGLPrimitives","WebGLPipelineState","_PipelineState","_primitive","primitive","_shader","shader","_pipelineLayout","pipelineLayout","_bs","blendState","bsInfo","setTarget","isIndepend","Object","assign","_rs","rasterizerState","_dss","depthStencilState","_is","inputState","_dynamicStates","PipelineState","WebGLPrimaryCommandBuffer","_WebGLCommandBuffer","arguments","TRIANGLES","TRIANGLE_FAN","_WebGLDeviceManager$i","_WebGLDeviceManager$i2","WebGLQueue","_Queue","numDrawCalls","numInstances","numTris","submit","len","cmdBuff","Queue","WebGLRenderPass","_RenderPass","_gpuRenderPass","_colorInfos","_depthStencilInfo","_subpasses","subpasses","_hash","computeHash","RenderPass","WebGLWraps","WebGLSampler","_Sampler","hash","_gpuSampler","minFilter","_info","magFilter","mipFilter","ANISOTROPIC","NEAREST_MIPMAP_LINEAR","NEAREST_MIPMAP_NEAREST","addressU","addressV","addressW","Sampler","WebGLShader","_Shader","_name","_stages","stages","_blocks","samplers","Shader","WebGLStateCache","Viewport","RasterizerState","BlendState","vertexAttributes","WebGLTexture","_Texture","_gpuTexture","_lodLevel","self","texInfo","viewInfo","_isTextureView","thisTextureInfo","thisViewInfo","_viewInfo","_isPowerOf2","IsPowerOf2","FormatSurfaceSize","levelCount","arrayLayer","samples","textureSize","baseLevel","baseLayer","getTextureHandle","getLevelCount","thisGpuTexture","initAsSwapchainTexture","TextureInfo","TextureUsageBit","COLOR_ATTACHMENT","Texture","eventWebGLContextLost","initStates","pixelStorei","PACK_ALIGNMENT","UNPACK_ALIGNMENT","UNPACK_FLIP_Y_WEBGL","SCISSOR_TEST","POLYGON_OFFSET_FILL","depthRange","KEEP","FUNC_ADD","ONE","ZERO","getExtension","ext","prefixes","_ext","getExtensions","EXT_texture_filter_anisotropic","EXT_blend_minmax","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","EXT_color_buffer_half_float","WEBGL_color_buffer_float","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_shaders","WEBGL_lose_context","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","OES_standard_derivatives","OES_element_index_uint","WEBGL_debug_renderer_info","WEBGL_compressed_texture_astc","osMainVersion","isBrowser","ANDROID","browserType","BrowserType","UC","WECHAT_MINI_PROGRAM","getContext","canvas","context","webGLCtxAttribs","alpha","macro","ENABLE_TRANSPARENT_CANVAS","antialias","EDITOR","ENABLE_WEBGL_ANTIALIAS","stencil","premultipliedAlpha","preserveDrawingBuffer","powerPreference","failIfMajorPerformanceCaveat","err","WebGLSwapchain","_Swapchain","nullTexCube","_canvas","_webGLContextLostHandler","_extensions","_blitManager","windowHandle","_onWebGLContextLost","bind","addEventListener","colorFmt","depthStencilFmt","depthBits","getParameter","DEPTH_BITS","stencilBits","STENCIL_BITS","_colorTexture","swapchain","SAMPLED","nullTexRegion","BufferTextureCopy","nullTexBuff","removeEventListener","surfaceTransform","debug","event","warn","Swapchain","setFormatFeature","formatFeatures","indexArray","feature","setFormatFeatureBitwiseOr","setTextureExclusive","isExclusive","WebGLDevice","_Device","_swapchain","_context","_bindingMappings","_textureExclusive","COUNT","_gfxAPI","API","WEBGL","mapping","_bindingMappingInfo","firstSet","setIndices","curSet","prevSet","maxSamplerTextureCounts","Device","createQueue","QueueInfo","QueueType","GRAPHICS","_cmdBuff","createCommandBuffer","CommandBufferInfo","glGetParameter","caps","_caps","MAX_VERTEX_ATTRIBS","maxVertexUniformVectors","MAX_VERTEX_UNIFORM_VECTORS","maxFragmentUniformVectors","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_TEXTURE_IMAGE_UNITS","maxVertexTextureUnits","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","maxArrayTextureLayers","max3DTextureSize","maxUniformBufferBindings","getSupportedExtensions","extStr","exts","_renderer","UNMASKED_RENDERER_WEBGL","_vendor","UNMASKED_VENDOR_WEBGL","RENDERER","VENDOR","version","VERSION","features","_features","initFormatFeatures","Feature","BLEND_MINMAX","ELEMENT_INDEX_UINT","INSTANCED_ARRAYS","MULTIPLE_RENDER_TARGETS","compressedFormat","getFormatFeatures","flushCommands","acquire","swapchains","present","_formatFeatures","FormatFeatureBit","tempFeature","RENDER_TARGET","SAMPLED_TEXTURE","LINEAR_FILTER","VERTEX_ATTRIBUTE","compressedFeature","Ctor","CommandBufferType","PRIMARY","createSwapchain","createDescriptorSet","createInputAssembler","createRenderPass","createDescriptorSetLayout","descriptorSetLayout","createPipelineLayout","createPipelineState","getSampler","has","getSwapchains","getGeneralBarrier","_generalBarrierss","getTextureBarrier","TextureBarrier","_textureBarriers","getBufferBarrier","BufferBarrier","_bufferBarriers","copyTextureToBuffers","copyTexImagesToTexture","legacyCC"],"mappings":";;;;;;AAiCA,IAAaA,kBAAmB,aAAAC,cAAA,EAAA;AAO5B,EAAA,SAAAD,qBAAA;AAAA,IAAA,IAAAE,KAAA;AACIA,IAAAA,KAAA,GAAAD,cAAA,CAAAE,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAHJE,iBAAiB,GAAkC,IAAI;AAAA,IAAA,OAAAF,KAAA;AAI/D,EAAA;EAACG,cAAA,CAAAL,kBAAA,EAAAC,cAAA,CAAA;AAAA,EAAA,IAAAK,MAAA,GAAAN,kBAAA,CAAAO,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAAiC,EAAO;AACvD,IAAA,IAAI,CAACC,OAAO,GAAGD,IAAI,CAACE,MAAM;AAC1B,IAAA,IAAAC,qBAAA,GAA0DH,IAAI,CAACE,MAAM,CAA8BE,sBAAsB;MAAjHC,QAAQ,GAAAF,qBAAA,CAARE,QAAQ;MAAEC,iBAAiB,GAAAH,qBAAA,CAAjBG,iBAAiB;MAAEC,eAAe,GAAAJ,qBAAA,CAAfI,eAAe;IAEpD,IAAI,CAACC,QAAQ,GAAGC,KAAK,CAACF,eAAe,CAAC,CAACG,IAAI,CAAC,IAAI,CAAC;IACjD,IAAI,CAACC,SAAS,GAAGF,KAAK,CAACF,eAAe,CAAC,CAACG,IAAI,CAAC,IAAI,CAAC;IAClD,IAAI,CAACE,SAAS,GAAGH,KAAK,CAACF,eAAe,CAAC,CAACG,IAAI,CAAC,IAAI,CAAC;IAElD,IAAMG,cAAqC,GAAG,EAAE;IAChD,IAAI,CAAClB,iBAAiB,GAAG;AAAEkB,MAAAA,cAAc,EAAdA,cAAc;AAAEP,MAAAA,iBAAiB,EAAjBA;KAAmB;AAE9D,IAAA,KAAK,IAAIQ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGT,QAAQ,CAACU,MAAM,EAAE,EAAED,CAAC,EAAE;AACtC,MAAA,IAAME,OAAO,GAAGX,QAAQ,CAACS,CAAC,CAAC;AAC3B,MAAA,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,OAAO,CAACE,KAAK,EAAED,CAAC,EAAE,EAAE;AACpC,QAAA,IAAME,aAAkC,GAAG;UACvCC,IAAI,EAAEJ,OAAO,CAACK,cAAc;AAC5BC,UAAAA,SAAS,EAAE,IAAI;AACfC,UAAAA,UAAU,EAAE,IAAI;AAChBC,UAAAA,UAAU,EAAE;SACf;AACDX,QAAAA,cAAc,CAACY,IAAI,CAACN,aAAa,CAAC;AACrC,MAAA;AACJ,IAAA;EACL,CAAC;AAAAtB,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAI,CAACzB,OAAO,GAAG,IAAI;IACnB,IAAI,CAACN,iBAAiB,GAAG,IAAI;EACjC,CAAC;AAAAE,EAAAA,MAAA,CAEM8B,MAAM,GAAb,SAAOA,MAAMA,GAAS;AAClB,IAAA,IAAI,IAAI,CAACC,QAAQ,IAAI,IAAI,CAACjC,iBAAiB,EAAE;AACzC,MAAA,IAAMkC,WAAW,GAAG,IAAI,CAAClC,iBAAiB,CAACkB,cAAc;AACzD,MAAA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGe,WAAW,CAACd,MAAM,EAAE,EAAED,CAAC,EAAE;QACzC,IAAIe,WAAW,CAACf,CAAC,CAAC,CAACM,IAAI,GAAGU,sBAAsB,EAAE;AAC9C,UAAA,IAAMC,MAAM,GAAG,IAAI,CAACvB,QAAQ,CAACM,CAAC,CAAuB;AACrD,UAAA,IAAIiB,MAAM,EAAE;AACRF,YAAAA,WAAW,CAACf,CAAC,CAAC,CAACQ,SAAS,GAAGS,MAAM,CAACT,SAAS,IAAIS,MAAM,CAACC,aAAa;AACtE,UAAA;QACJ,CAAA,MAAM,IAAIH,WAAW,CAACf,CAAC,CAAC,CAACM,IAAI,GAAGa,uBAAuB,EAAE;AACtD,UAAA,IAAI,IAAI,CAACtB,SAAS,CAACG,CAAC,CAAC,EAAE;AACnBe,YAAAA,WAAW,CAACf,CAAC,CAAC,CAACS,UAAU,GAAI,IAAI,CAACZ,SAAS,CAACG,CAAC,CAAC,CAAkBS,UAAU;AAC7E,UAAA;AACD,UAAA,IAAI,IAAI,CAACX,SAAS,CAACE,CAAC,CAAC,EAAE;AACnBe,YAAAA,WAAW,CAACf,CAAC,CAAC,CAACU,UAAU,GAAI,IAAI,CAACZ,SAAS,CAACE,CAAC,CAAC,CAAkBU,UAAU;AAC7E,UAAA;AACJ,QAAA;AACJ,MAAA;MACD,IAAI,CAACI,QAAQ,GAAG,KAAK;AACxB,IAAA;EACL,CAAC;EAAA,OAAAM,YAAA,CAAA3C,kBAAA,EAAA,CAAA;IAAA4C,GAAA,EAAA,kBAAA;IAAAC,GAAA,EA5DD,SAAAA,GAAAA,GAA+C;MAC3C,OAAO,IAAI,CAACzC,iBAAiB;AACjC,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAHmC0C,aAAa,CAAA;;ACNrD,IAAYC,QAAQ;AAsEnB,CAAA,UAtEWA,QAAQ,EAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,aAAA,CAAA,GAAA,KAAA,CAAA,GAAA,aAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,YAAA,CAAA,GAAA,KAAA,CAAA,GAAA,YAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,aAAA,CAAA,GAAA,KAAA,CAAA,GAAA,aAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,2CAAA,CAAA,GAAA,KAAA,CAAA,GAAA,2CAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,yBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,yBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,yBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,yBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,gBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,gBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,UAAA,CAAA,GAAA,KAAA,CAAA,GAAA,UAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,gBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,gBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,kBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,kBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,+BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,+BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,+BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,+BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,+BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,+BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,+BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,+BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,qCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,qCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,qCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,iCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,iCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,iCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,iCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,kCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,kCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,kCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,kCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,2BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,2BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,oBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,oBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,2BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,2BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,qBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,4BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,4BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,uBAAA,CAAA,GAAA,KAAA,CAAA,GAAA,uBAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,0CAAA,CAAA,GAAA,KAAA,CAAA,GAAA,0CAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,2CAAA,CAAA,GAAA,KAAA,CAAA,GAAA,2CAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,2BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,2BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,kCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,kCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,8BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,8BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,+BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,+BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,+BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,+BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,+BAAA,CAAA,GAAA,KAAA,CAAA,GAAA,+BAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,gCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,gCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,gCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,gCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,gCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,gCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,sCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,sCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,uCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,uCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,uCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,uCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,uCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,uCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,wCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,wCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,wCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,wCAAA;AAARA,EAAAA,QAAQ,CAARA,QAAQ,CAAA,wCAAA,CAAA,GAAA,KAAA,CAAA,GAAA,wCAAA;AAAA,CAAA,EAARA,QAAQ,KAARA,QAAQ,GAAA,EAAA,CAAA,CAAA;AA4GpB,IAAaC,kBAAkB,GAAA,YAAA;AAAA,EAAA,SAAAA,kBAAAA,GAAA,CAAA;AAAAA,EAAAA,kBAAA,CAIpBC,WAAW,GAAlB,SAAOA,WAAWA,CAAEC,QAAqB,EAAO;IAC5CF,kBAAkB,CAACG,SAAS,GAAGD,QAAQ;EAC3C,CAAC;EAAA,OAAAP,YAAA,CAAAK,kBAAA,EAAA,IAAA,EAAA,CAAA;IAAAJ,GAAA,EAAA,UAAA;IAAAC,GAAA,EALD,SAAAA,GAAAA,GAAmC;MAC/B,OAAOG,kBAAkB,CAACG,SAAS;AACvC,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,EAAA;AAHQH,kBAAkB,CAOZG,SAAS,GAAuB,IAAI;;ACjGvD,IAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG;AACpB,IAAME,GAAG,GAAGD,IAAI,CAACC,GAAG;AAEd,SAAUC,oBAAoBA,CAAEC,MAAc,EAAEC,EAAyB,EAAS;AACpF,EAAA,QAAQD,MAAM;IACd,KAAKE,MAAM,CAACC,EAAE;MAAE,OAAOC,cAAc,CAACC,aAAa;IACnD,KAAKH,MAAM,CAACI,IAAI;MAAE,OAAOF,cAAc,CAACG,IAAI;IAC5C,KAAKL,MAAM,CAACM,IAAI;MAAE,OAAOJ,cAAc,CAACC,aAAa;IACrD,KAAKH,MAAM,CAACO,GAAG;MAAE,OAAOL,cAAc,CAACG,IAAI;IAC3C,KAAKL,MAAM,CAACQ,IAAI;MAAE,OAAOnB,QAAQ,CAACoB,cAAc;IAChD,KAAKT,MAAM,CAACU,KAAK;MAAE,OAAOR,cAAc,CAACS,cAAc;IACvD,KAAKX,MAAM,CAACY,IAAI;MAAE,OAAOV,cAAc,CAACW,KAAK;IAC7C,KAAKb,MAAM,CAACc,IAAI;MAAE,OAAOZ,cAAc,CAACa,KAAK;IAC7C,KAAKf,MAAM,CAACgB,KAAK;MAAE,OAAOd,cAAc,CAACe,YAAY;IACrD,KAAKjB,MAAM,CAACkB,IAAI;MAAE,OAAOhB,cAAc,CAACiB,GAAG;IAE3C,KAAKnB,MAAM,CAACoB,GAAG;MAAE,OAAOlB,cAAc,CAACC,aAAa;IACpD,KAAKH,MAAM,CAACqB,KAAK;MAAE,OAAOnB,cAAc,CAACG,IAAI;IAC7C,KAAKL,MAAM,CAACsB,KAAK;MAAE,OAAOpB,cAAc,CAACC,aAAa;IACtD,KAAKH,MAAM,CAACuB,IAAI;MAAE,OAAOrB,cAAc,CAACG,IAAI;IAC5C,KAAKL,MAAM,CAACwB,KAAK;MAAE,OAAOnC,QAAQ,CAACoB,cAAc;IACjD,KAAKT,MAAM,CAACyB,MAAM;MAAE,OAAOvB,cAAc,CAACS,cAAc;IACxD,KAAKX,MAAM,CAAC0B,KAAK;MAAE,OAAOxB,cAAc,CAACW,KAAK;IAC9C,KAAKb,MAAM,CAAC2B,KAAK;MAAE,OAAOzB,cAAc,CAACa,KAAK;IAC9C,KAAKf,MAAM,CAAC4B,MAAM;MAAE,OAAO1B,cAAc,CAACe,YAAY;IACtD,KAAKjB,MAAM,CAAC6B,KAAK;MAAE,OAAO3B,cAAc,CAACiB,GAAG;IAE5C,KAAKnB,MAAM,CAAC8B,IAAI;MAAE,OAAO5B,cAAc,CAACC,aAAa;IACrD,KAAKH,MAAM,CAAC+B,KAAK;MAAE,OAAO7B,cAAc,CAACC,aAAa;IACtD,KAAKH,MAAM,CAACgC,MAAM;MAAE,OAAO9B,cAAc,CAACG,IAAI;IAC9C,KAAKL,MAAM,CAACiC,MAAM;MAAE,OAAO/B,cAAc,CAACC,aAAa;IACvD,KAAKH,MAAM,CAACkC,KAAK;MAAE,OAAOhC,cAAc,CAACG,IAAI;IAC7C,KAAKL,MAAM,CAACmC,MAAM;MAAE,OAAO9C,QAAQ,CAACoB,cAAc;IAClD,KAAKT,MAAM,CAACoC,OAAO;MAAE,OAAOlC,cAAc,CAACS,cAAc;IACzD,KAAKX,MAAM,CAACqC,MAAM;MAAE,OAAOnC,cAAc,CAACW,KAAK;IAC/C,KAAKb,MAAM,CAACsC,MAAM;MAAE,OAAOpC,cAAc,CAACa,KAAK;IAC/C,KAAKf,MAAM,CAACuC,OAAO;MAAE,OAAOrC,cAAc,CAACe,YAAY;IACvD,KAAKjB,MAAM,CAACwC,MAAM;MAAE,OAAOtC,cAAc,CAACiB,GAAG;IAE7C,KAAKnB,MAAM,CAACyC,KAAK;MAAE,OAAOvC,cAAc,CAACC,aAAa;IACtD,KAAKH,MAAM,CAAC0C,KAAK;MAAE,OAAOxC,cAAc,CAACC,aAAa;IACtD,KAAKH,MAAM,CAAC2C,QAAQ;MAAE,OAAOzC,cAAc,CAACC,aAAa;IACzD,KAAKH,MAAM,CAAC4C,OAAO;MAAE,OAAO1C,cAAc,CAACG,IAAI;IAC/C,KAAKL,MAAM,CAAC6C,OAAO;MAAE,OAAO3C,cAAc,CAACC,aAAa;IACxD,KAAKH,MAAM,CAAC8C,MAAM;MAAE,OAAO5C,cAAc,CAACG,IAAI;IAC9C,KAAKL,MAAM,CAAC+C,OAAO;MAAE,OAAO1D,QAAQ,CAACoB,cAAc;IACnD,KAAKT,MAAM,CAACgD,QAAQ;MAAE,OAAO9C,cAAc,CAACS,cAAc;IAC1D,KAAKX,MAAM,CAACiD,OAAO;MAAE,OAAO/C,cAAc,CAACW,KAAK;IAChD,KAAKb,MAAM,CAACkD,OAAO;MAAE,OAAOhD,cAAc,CAACa,KAAK;IAChD,KAAKf,MAAM,CAACmD,QAAQ;MAAE,OAAOjD,cAAc,CAACe,YAAY;IACxD,KAAKjB,MAAM,CAACoD,OAAO;MAAE,OAAOlD,cAAc,CAACiB,GAAG;IAE9C,KAAKnB,MAAM,CAACqD,MAAM;MAAE,OAAOnD,cAAc,CAACoD,oBAAoB;IAC9D,KAAKtD,MAAM,CAACuD,UAAU;MAAE,OAAOrD,cAAc,CAACa,KAAK;IACnD,KAAKf,MAAM,CAACwD,MAAM;MAAE,OAAOtD,cAAc,CAACuD,sBAAsB;IAChE,KAAKzD,MAAM,CAAC0D,KAAK;MAAE,OAAOxD,cAAc,CAACyD,sBAAsB;IAC/D,KAAK3D,MAAM,CAAC4D,OAAO;MAAE,OAAO1D,cAAc,CAACC,aAAa;IACxD,KAAKH,MAAM,CAAC6D,SAAS;MAAE,OAAO3D,cAAc,CAACe,YAAY;IACzD,KAAKjB,MAAM,CAAC8D,MAAM;MAAE,OAAO5D,cAAc,CAACC,aAAa;IAEvD,KAAKH,MAAM,CAAC+D,KAAK;MAAE,OAAO7D,cAAc,CAACe,YAAY;IACrD,KAAKjB,MAAM,CAACgE,aAAa;MAAE,OAAO3E,QAAQ,CAAC4E,uBAAuB;IAElE,KAAKjE,MAAM,CAACkE,GAAG;MAAE,OAAOhE,cAAc,CAACC,aAAa;IACpD,KAAKH,MAAM,CAACmE,QAAQ;MAAE,OAAOjE,cAAc,CAACC,aAAa;IACzD,KAAKH,MAAM,CAACoE,GAAG;MAAE,OAAOlE,cAAc,CAACC,aAAa;IACpD,KAAKH,MAAM,CAACqE,QAAQ;MAAE,OAAOnE,cAAc,CAACC,aAAa;IACzD,KAAKH,MAAM,CAACsE,GAAG;MAAE,OAAOpE,cAAc,CAACC,aAAa;IACpD,KAAKH,MAAM,CAACuE,QAAQ;MAAE,OAAOrE,cAAc,CAACC,aAAa;IACzD,KAAKH,MAAM,CAACwE,GAAG;MAAE,OAAOtE,cAAc,CAACC,aAAa;IACpD,KAAKH,MAAM,CAACyE,SAAS;MAAE,OAAOvE,cAAc,CAACG,IAAI;IACjD,KAAKL,MAAM,CAAC0E,GAAG;MAAE,OAAOxE,cAAc,CAACC,aAAa;IACpD,KAAKH,MAAM,CAAC2E,SAAS;MAAE,OAAOzE,cAAc,CAACG,IAAI;IACjD,KAAKL,MAAM,CAAC4E,SAAS;MAAE,OAAO1E,cAAc,CAACa,KAAK;IAClD,KAAKf,MAAM,CAAC6E,SAAS;MAAE,OAAO3E,cAAc,CAACa,KAAK;IAClD,KAAKf,MAAM,CAAC8E,GAAG;MAAE,OAAO5E,cAAc,CAACC,aAAa;IACpD,KAAKH,MAAM,CAAC+E,QAAQ;MAAE,OAAO7E,cAAc,CAACC,aAAa;IAEzD,KAAKH,MAAM,CAACgF,QAAQ;MAAE,OAAO9E,cAAc,CAACC,aAAa;IACzD,KAAKH,MAAM,CAACiF,SAAS;MAAE,OAAO/E,cAAc,CAACC,aAAa;IAC1D,KAAKH,MAAM,CAACkF,UAAU;MAAE,OAAOhF,cAAc,CAACC,aAAa;IAC3D,KAAKH,MAAM,CAACmF,YAAY;MAAE,OAAOjF,cAAc,CAACC,aAAa;IAC7D,KAAKH,MAAM,CAACoF,aAAa;MAAE,OAAOlF,cAAc,CAACC,aAAa;IAC9D,KAAKH,MAAM,CAACqF,OAAO;MAAE,OAAOnF,cAAc,CAACC,aAAa;IACxD,KAAKH,MAAM,CAACsF,SAAS;MAAE,OAAOpF,cAAc,CAACG,IAAI;IACjD,KAAKL,MAAM,CAACuF,QAAQ;MAAE,OAAOrF,cAAc,CAACC,aAAa;IACzD,KAAKH,MAAM,CAACwF,UAAU;MAAE,OAAOtF,cAAc,CAACG,IAAI;IAElD,KAAKL,MAAM,CAACyF,UAAU;MAAE,OAAOvF,cAAc,CAACC,aAAa;IAC3D,KAAKH,MAAM,CAAC0F,WAAW;MAAE,OAAOxF,cAAc,CAACC,aAAa;IAC5D,KAAKH,MAAM,CAAC2F,UAAU;MAAE,OAAOzF,cAAc,CAACC,aAAa;IAC3D,KAAKH,MAAM,CAAC4F,WAAW;MAAE,OAAO1F,cAAc,CAACC,aAAa;IAC5D,KAAKH,MAAM,CAAC6F,WAAW;MAAE,OAAO3F,cAAc,CAACC,aAAa;IAC5D,KAAKH,MAAM,CAAC8F,WAAW;MAAE,OAAO5F,cAAc,CAACC,aAAa;IAE5D,KAAKH,MAAM,CAAC+F,aAAa;IACzB,KAAK/F,MAAM,CAACgG,aAAa;IACzB,KAAKhG,MAAM,CAACiG,aAAa;IACzB,KAAKjG,MAAM,CAACkG,aAAa;IACzB,KAAKlG,MAAM,CAACmG,aAAa;IACzB,KAAKnG,MAAM,CAACoG,aAAa;IACzB,KAAKpG,MAAM,CAACqG,aAAa;IACzB,KAAKrG,MAAM,CAACsG,aAAa;IACzB,KAAKtG,MAAM,CAACuG,cAAc;IAC1B,KAAKvG,MAAM,CAACwG,cAAc;IAC1B,KAAKxG,MAAM,CAACyG,cAAc;IAC1B,KAAKzG,MAAM,CAAC0G,eAAe;IAC3B,KAAK1G,MAAM,CAAC2G,eAAe;IAC3B,KAAK3G,MAAM,CAAC4G,eAAe;IAC3B,KAAK5G,MAAM,CAAC6G,cAAc;IAC1B,KAAK7G,MAAM,CAAC8G,cAAc;IAC1B,KAAK9G,MAAM,CAAC+G,cAAc;IAC1B,KAAK/G,MAAM,CAACgH,cAAc;IAC1B,KAAKhH,MAAM,CAACiH,cAAc;IAC1B,KAAKjH,MAAM,CAACkH,cAAc;IAC1B,KAAKlH,MAAM,CAACmH,cAAc;IAC1B,KAAKnH,MAAM,CAACoH,cAAc;IAC1B,KAAKpH,MAAM,CAACqH,eAAe;IAC3B,KAAKrH,MAAM,CAACsH,eAAe;IAC3B,KAAKtH,MAAM,CAACuH,eAAe;IAC3B,KAAKvH,MAAM,CAACwH,gBAAgB;IAC5B,KAAKxH,MAAM,CAACyH,gBAAgB;IAC5B,KAAKzH,MAAM,CAAC0H,gBAAgB;MACxB,OAAOxH,cAAc,CAACC,aAAa;AAEvC,IAAA;AAAS,MAAA;QACL,OAAOD,cAAc,CAACC,aAAa;AACtC,MAAA;AACA;AACL;AAEM,SAAUwH,8BAA8BA,CAAE7H,MAAc,EAAEC,EAAyB,EAAS;AAC9F,EAAA,QAAQD,MAAM;IACd,KAAKE,MAAM,CAACqD,MAAM;MAAE,OAAOnD,cAAc,CAAC0H,MAAM;IAChD,KAAK5H,MAAM,CAACwD,MAAM;MAAE,OAAOtD,cAAc,CAAC2H,OAAO;IACjD,KAAK7H,MAAM,CAAC0D,KAAK;MAAE,OAAOxD,cAAc,CAACwD,KAAK;IAC9C,KAAK1D,MAAM,CAAC+C,OAAO;MAAE,OAAO1D,QAAQ,CAACyI,WAAW;IAChD,KAAK9H,MAAM,CAACkD,OAAO;MAAE,OAAO7D,QAAQ,CAAC0I,WAAW;IAChD,KAAK/H,MAAM,CAAC2C,QAAQ;MAAE,OAAOtD,QAAQ,CAAC2I,gBAAgB;IACtD,KAAKhI,MAAM,CAAC+D,KAAK;MAAE,OAAO7D,cAAc,CAAC+H,iBAAiB;IAC1D,KAAKjI,MAAM,CAACgE,aAAa;MAAE,OAAO9D,cAAc,CAAC8D,aAAa;AAE9D,IAAA;AAAS,MAAA;QACLkE,OAAO,CAAC,KAAK,CAAC;QACd,OAAOhI,cAAc,CAACiI,IAAI;AAC7B,MAAA;AACA;AACL;AAEM,SAAUC,sBAAsBA,CAAEtI,MAAc,EAAEC,EAAyB,EAAS;AACtF,EAAA,QAAQD,MAAM;IACd,KAAKE,MAAM,CAACqI,EAAE;MAAE,OAAOnI,cAAc,CAACoI,KAAK;IAC3C,KAAKtI,MAAM,CAACuI,EAAE;MAAE,OAAOrI,cAAc,CAACsI,SAAS;IAC/C,KAAKxI,MAAM,CAACyI,GAAG;MAAE,OAAOvI,cAAc,CAACwI,eAAe;IACtD,KAAK1I,MAAM,CAAC8B,IAAI;MAAE,OAAO5B,cAAc,CAACyI,GAAG;IAC3C,KAAK3I,MAAM,CAACmC,MAAM;MAAE,OAAOjC,cAAc,CAACyI,GAAG;IAC7C,KAAK3I,MAAM,CAACsC,MAAM;MAAE,OAAOpC,cAAc,CAACyI,GAAG;IAC7C,KAAK3I,MAAM,CAACyC,KAAK;MAAE,OAAOvC,cAAc,CAACiI,IAAI;IAC7C,KAAKnI,MAAM,CAAC0C,KAAK;MAAE,OAAOxC,cAAc,CAACiI,IAAI;IAC7C,KAAKnI,MAAM,CAAC2C,QAAQ;MAAE,OAAOzC,cAAc,CAACiI,IAAI;IAChD,KAAKnI,MAAM,CAAC+C,OAAO;MAAE,OAAO7C,cAAc,CAACiI,IAAI;IAC/C,KAAKnI,MAAM,CAACkD,OAAO;MAAE,OAAOhD,cAAc,CAACiI,IAAI;IAC/C,KAAKnI,MAAM,CAACqD,MAAM;MAAE,OAAOnD,cAAc,CAACyI,GAAG;IAC7C,KAAK3I,MAAM,CAACwD,MAAM;MAAE,OAAOtD,cAAc,CAACiI,IAAI;IAC9C,KAAKnI,MAAM,CAAC0D,KAAK;MAAE,OAAOxD,cAAc,CAACiI,IAAI;IAC7C,KAAKnI,MAAM,CAAC+D,KAAK;MAAE,OAAO7D,cAAc,CAAC0I,eAAe;IACxD,KAAK5I,MAAM,CAACgE,aAAa;MAAE,OAAO9D,cAAc,CAAC8D,aAAa;IAE9D,KAAKhE,MAAM,CAACkE,GAAG;MAAE,OAAO7E,QAAQ,CAACwJ,4BAA4B;IAC7D,KAAK7I,MAAM,CAAC8I,SAAS;MAAE,OAAOzJ,QAAQ,CAAC0J,6BAA6B;IACpE,KAAK/I,MAAM,CAACmE,QAAQ;MAAE,OAAO9E,QAAQ,CAAC2J,6BAA6B;IACnE,KAAKhJ,MAAM,CAACiJ,cAAc;MAAE,OAAO5J,QAAQ,CAAC6J,mCAAmC;IAC/E,KAAKlJ,MAAM,CAACoE,GAAG;MAAE,OAAO/E,QAAQ,CAAC8J,6BAA6B;IAC9D,KAAKnJ,MAAM,CAACqE,QAAQ;MAAE,OAAOhF,QAAQ,CAAC+J,mCAAmC;IACzE,KAAKpJ,MAAM,CAACsE,GAAG;MAAE,OAAOjF,QAAQ,CAACgK,6BAA6B;IAC9D,KAAKrJ,MAAM,CAACuE,QAAQ;MAAE,OAAOlF,QAAQ,CAACiK,mCAAmC;IAEzE,KAAKtJ,MAAM,CAACgF,QAAQ;MAAE,OAAO3F,QAAQ,CAACkK,yBAAyB;IAC/D,KAAKvJ,MAAM,CAACiF,SAAS;MAAE,OAAO5F,QAAQ,CAACmK,oBAAoB;IAC3D,KAAKxJ,MAAM,CAACkF,UAAU;MAAE,OAAO7F,QAAQ,CAACoK,qBAAqB;IAC7D,KAAKzJ,MAAM,CAACmF,YAAY;MAAE,OAAO9F,QAAQ,CAACqK,wCAAwC;IAClF,KAAK1J,MAAM,CAACoF,aAAa;MAAE,OAAO/F,QAAQ,CAACsK,yCAAyC;IACpF,KAAK3J,MAAM,CAAC4J,UAAU;MAAE,OAAOvK,QAAQ,CAACwK,yBAAyB;IACjE,KAAK7J,MAAM,CAAC8J,aAAa;MAAE,OAAOzK,QAAQ,CAAC0K,gCAAgC;IAC3E,KAAK/J,MAAM,CAACqF,OAAO;MAAE,OAAOhG,QAAQ,CAAC2K,kBAAkB;IACvD,KAAKhK,MAAM,CAACsF,SAAS;MAAE,OAAOjG,QAAQ,CAAC4K,yBAAyB;IAChE,KAAKjK,MAAM,CAACuF,QAAQ;MAAE,OAAOlG,QAAQ,CAAC6K,mBAAmB;IACzD,KAAKlK,MAAM,CAACwF,UAAU;MAAE,OAAOnG,QAAQ,CAAC8K,0BAA0B;IAElE,KAAKnK,MAAM,CAACyF,UAAU;MAAE,OAAOpG,QAAQ,CAAC+K,+BAA+B;IACvE,KAAKpK,MAAM,CAAC0F,WAAW;MAAE,OAAOrG,QAAQ,CAACgL,gCAAgC;IACzE,KAAKrK,MAAM,CAAC2F,UAAU;MAAE,OAAOtG,QAAQ,CAACiL,+BAA+B;IACvE,KAAKtK,MAAM,CAAC4F,WAAW;MAAE,OAAOvG,QAAQ,CAACkL,gCAAgC;IAEzE,KAAKvK,MAAM,CAAC+F,aAAa;MAAE,OAAO1G,QAAQ,CAACmL,4BAA4B;IACvE,KAAKxK,MAAM,CAACgG,aAAa;MAAE,OAAO3G,QAAQ,CAACoL,4BAA4B;IACvE,KAAKzK,MAAM,CAACiG,aAAa;MAAE,OAAO5G,QAAQ,CAACqL,4BAA4B;IACvE,KAAK1K,MAAM,CAACkG,aAAa;MAAE,OAAO7G,QAAQ,CAACsL,4BAA4B;IACvE,KAAK3K,MAAM,CAACmG,aAAa;MAAE,OAAO9G,QAAQ,CAACuL,4BAA4B;IACvE,KAAK5K,MAAM,CAACoG,aAAa;MAAE,OAAO/G,QAAQ,CAACwL,4BAA4B;IACvE,KAAK7K,MAAM,CAACqG,aAAa;MAAE,OAAOhH,QAAQ,CAACyL,4BAA4B;IACvE,KAAK9K,MAAM,CAACsG,aAAa;MAAE,OAAOjH,QAAQ,CAAC0L,4BAA4B;IACvE,KAAK/K,MAAM,CAACuG,cAAc;MAAE,OAAOlH,QAAQ,CAAC2L,6BAA6B;IACzE,KAAKhL,MAAM,CAACwG,cAAc;MAAE,OAAOnH,QAAQ,CAAC4L,6BAA6B;IACzE,KAAKjL,MAAM,CAACyG,cAAc;MAAE,OAAOpH,QAAQ,CAAC6L,6BAA6B;IACzE,KAAKlL,MAAM,CAAC0G,eAAe;MAAE,OAAOrH,QAAQ,CAAC8L,8BAA8B;IAC3E,KAAKnL,MAAM,CAAC2G,eAAe;MAAE,OAAOtH,QAAQ,CAAC+L,8BAA8B;IAC3E,KAAKpL,MAAM,CAAC4G,eAAe;MAAE,OAAOvH,QAAQ,CAACgM,8BAA8B;IAE3E,KAAKrL,MAAM,CAAC6G,cAAc;MAAE,OAAOxH,QAAQ,CAACiM,oCAAoC;IAChF,KAAKtL,MAAM,CAAC8G,cAAc;MAAE,OAAOzH,QAAQ,CAACkM,oCAAoC;IAChF,KAAKvL,MAAM,CAAC+G,cAAc;MAAE,OAAO1H,QAAQ,CAACmM,oCAAoC;IAChF,KAAKxL,MAAM,CAACgH,cAAc;MAAE,OAAO3H,QAAQ,CAACoM,oCAAoC;IAChF,KAAKzL,MAAM,CAACiH,cAAc;MAAE,OAAO5H,QAAQ,CAACqM,oCAAoC;IAChF,KAAK1L,MAAM,CAACkH,cAAc;MAAE,OAAO7H,QAAQ,CAACsM,oCAAoC;IAChF,KAAK3L,MAAM,CAACmH,cAAc;MAAE,OAAO9H,QAAQ,CAACuM,oCAAoC;IAChF,KAAK5L,MAAM,CAACoH,cAAc;MAAE,OAAO/H,QAAQ,CAACwM,oCAAoC;IAChF,KAAK7L,MAAM,CAACqH,eAAe;MAAE,OAAOhI,QAAQ,CAACyM,qCAAqC;IAClF,KAAK9L,MAAM,CAACsH,eAAe;MAAE,OAAOjI,QAAQ,CAAC0M,qCAAqC;IAClF,KAAK/L,MAAM,CAACuH,eAAe;MAAE,OAAOlI,QAAQ,CAAC2M,qCAAqC;IAClF,KAAKhM,MAAM,CAACwH,gBAAgB;MAAE,OAAOnI,QAAQ,CAAC4M,sCAAsC;IACpF,KAAKjM,MAAM,CAACyH,gBAAgB;MAAE,OAAOpI,QAAQ,CAAC6M,sCAAsC;IACpF,KAAKlM,MAAM,CAAC0H,gBAAgB;MAAE,OAAOrI,QAAQ,CAAC8M,sCAAsC;AAEpF,IAAA;AAAS,MAAA;QACLjE,OAAO,CAAC,KAAK,CAAC;QACd,OAAOhI,cAAc,CAACiI,IAAI;AAC7B,MAAA;AACA;AACL;AAEA,SAASiE,kBAAkBA,CAAEjO,IAAU,EAAE4B,EAAyB,EAAS;AACvE,EAAA,QAAQ5B,IAAI;IACZ,KAAKkO,IAAI,CAACC,IAAI;MAAE,OAAOpM,cAAc,CAACoM,IAAI;IAC1C,KAAKD,IAAI,CAACE,KAAK;MAAE,OAAOrM,cAAc,CAACsM,SAAS;IAChD,KAAKH,IAAI,CAACI,KAAK;MAAE,OAAOvM,cAAc,CAACwM,SAAS;IAChD,KAAKL,IAAI,CAACM,KAAK;MAAE,OAAOzM,cAAc,CAAC0M,SAAS;IAChD,KAAKP,IAAI,CAAClL,GAAG;MAAE,OAAOjB,cAAc,CAACiB,GAAG;IACxC,KAAKkL,IAAI,CAACQ,IAAI;MAAE,OAAO3M,cAAc,CAAC4M,QAAQ;IAC9C,KAAKT,IAAI,CAACU,IAAI;MAAE,OAAO7M,cAAc,CAAC8M,QAAQ;IAC9C,KAAKX,IAAI,CAACY,IAAI;MAAE,OAAO/M,cAAc,CAACgN,QAAQ;IAC9C,KAAKb,IAAI,CAACc,IAAI;MAAE,OAAOjN,cAAc,CAACe,YAAY;IAClD,KAAKoL,IAAI,CAACtL,KAAK;MAAE,OAAOb,cAAc,CAACa,KAAK;IAC5C,KAAKsL,IAAI,CAACe,MAAM;MAAE,OAAOlN,cAAc,CAACmN,UAAU;IAClD,KAAKhB,IAAI,CAACiB,MAAM;MAAE,OAAOpN,cAAc,CAACqN,UAAU;IAClD,KAAKlB,IAAI,CAACmB,MAAM;MAAE,OAAOtN,cAAc,CAACuN,UAAU;IAClD,KAAKpB,IAAI,CAACqB,IAAI;MAAE,OAAOxN,cAAc,CAACyN,UAAU;IAChD,KAAKtB,IAAI,CAACuB,IAAI;MAAE,OAAO1N,cAAc,CAAC2N,UAAU;IAChD,KAAKxB,IAAI,CAACyB,IAAI;MAAE,OAAO5N,cAAc,CAAC6N,UAAU;IAChD,KAAK1B,IAAI,CAAC2B,SAAS;MAAE,OAAO9N,cAAc,CAAC+N,UAAU;IACrD,KAAK5B,IAAI,CAAC6B,YAAY;MAAE,OAAOhO,cAAc,CAACgO,YAAY;AAC1D,IAAA;AAAS,MAAA;QACLhG,OAAO,CAAC,KAAK,CAAC;QACd,OAAOmE,IAAI,CAAC8B,OAAO;AACtB,MAAA;AACA;AACL;AAEA,SAASC,uBAAuBA,CAAEjQ,IAAU,EAAkD;AAC1F,EAAA,QAAQA,IAAI;IACZ,KAAKkO,IAAI,CAACC,IAAI;IACd,KAAKD,IAAI,CAACE,KAAK;IACf,KAAKF,IAAI,CAACI,KAAK;IACf,KAAKJ,IAAI,CAACM,KAAK;IACf,KAAKN,IAAI,CAAClL,GAAG;IACb,KAAKkL,IAAI,CAACQ,IAAI;IACd,KAAKR,IAAI,CAACU,IAAI;IACd,KAAKV,IAAI,CAACY,IAAI;IACd,KAAKZ,IAAI,CAACc,IAAI;AACV,MAAA,OAAOkB,UAAU;IACrB,KAAKhC,IAAI,CAACtL,KAAK;IACf,KAAKsL,IAAI,CAACe,MAAM;IAChB,KAAKf,IAAI,CAACiB,MAAM;IAChB,KAAKjB,IAAI,CAACmB,MAAM;IAChB,KAAKnB,IAAI,CAACqB,IAAI;IACd,KAAKrB,IAAI,CAACuB,IAAI;IACd,KAAKvB,IAAI,CAACyB,IAAI;AACV,MAAA,OAAOQ,YAAY;AACvB,IAAA;AAAS,MAAA;QACLpG,OAAO,CAAC,KAAK,CAAC;AACd,QAAA,OAAOoG,YAAY;AACtB,MAAA;AACA;AACL;AAEA,SAASC,kBAAkBA,CAAEC,MAAc,EAAEzO,EAAyB,EAAO;AACzE,EAAA,QAAQyO,MAAM;IACd,KAAKtO,cAAc,CAACoM,IAAI;MAAE,OAAOD,IAAI,CAACC,IAAI;IAC1C,KAAKpM,cAAc,CAACsM,SAAS;MAAE,OAAOH,IAAI,CAACE,KAAK;IAChD,KAAKrM,cAAc,CAACwM,SAAS;MAAE,OAAOL,IAAI,CAACI,KAAK;IAChD,KAAKvM,cAAc,CAAC0M,SAAS;MAAE,OAAOP,IAAI,CAACM,KAAK;IAChD,KAAKzM,cAAc,CAACiB,GAAG;MAAE,OAAOkL,IAAI,CAAClL,GAAG;IACxC,KAAKjB,cAAc,CAAC4M,QAAQ;MAAE,OAAOT,IAAI,CAACQ,IAAI;IAC9C,KAAK3M,cAAc,CAAC8M,QAAQ;MAAE,OAAOX,IAAI,CAACU,IAAI;IAC9C,KAAK7M,cAAc,CAACgN,QAAQ;MAAE,OAAOb,IAAI,CAACY,IAAI;IAC9C,KAAK/M,cAAc,CAACe,YAAY;MAAE,OAAOoL,IAAI,CAACc,IAAI;IAClD,KAAKjN,cAAc,CAACa,KAAK;MAAE,OAAOsL,IAAI,CAACtL,KAAK;IAC5C,KAAKb,cAAc,CAACmN,UAAU;MAAE,OAAOhB,IAAI,CAACe,MAAM;IAClD,KAAKlN,cAAc,CAACqN,UAAU;MAAE,OAAOlB,IAAI,CAACiB,MAAM;IAClD,KAAKpN,cAAc,CAACuN,UAAU;MAAE,OAAOpB,IAAI,CAACmB,MAAM;IAClD,KAAKtN,cAAc,CAACyN,UAAU;MAAE,OAAOtB,IAAI,CAACqB,IAAI;IAChD,KAAKxN,cAAc,CAAC2N,UAAU;MAAE,OAAOxB,IAAI,CAACuB,IAAI;IAChD,KAAK1N,cAAc,CAAC6N,UAAU;MAAE,OAAO1B,IAAI,CAACyB,IAAI;IAChD,KAAK5N,cAAc,CAAC+N,UAAU;MAAE,OAAO5B,IAAI,CAAC2B,SAAS;IACrD,KAAK9N,cAAc,CAACgO,YAAY;MAAE,OAAO7B,IAAI,CAAC6B,YAAY;AAC1D,IAAA;AAAS,MAAA;QACLhG,OAAO,CAAC,KAAK,CAAC;QACd,OAAOmE,IAAI,CAAC8B,OAAO;AACtB,MAAA;AACA;AACL;AAEA,SAASM,gBAAgBA,CAAED,MAAc,EAAEzO,EAAyB,EAAS;AACzE,EAAA,QAAQyO,MAAM;IACd,KAAKtO,cAAc,CAACoM,IAAI;AAAE,MAAA,OAAO,CAAC;IAClC,KAAKpM,cAAc,CAACsM,SAAS;AAAE,MAAA,OAAO,CAAC;IACvC,KAAKtM,cAAc,CAACwM,SAAS;AAAE,MAAA,OAAO,EAAE;IACxC,KAAKxM,cAAc,CAAC0M,SAAS;AAAE,MAAA,OAAO,EAAE;IACxC,KAAK1M,cAAc,CAACiB,GAAG;AAAE,MAAA,OAAO,CAAC;IACjC,KAAKjB,cAAc,CAAC4M,QAAQ;AAAE,MAAA,OAAO,CAAC;IACtC,KAAK5M,cAAc,CAAC8M,QAAQ;AAAE,MAAA,OAAO,EAAE;IACvC,KAAK9M,cAAc,CAACgN,QAAQ;AAAE,MAAA,OAAO,EAAE;IACvC,KAAKhN,cAAc,CAACe,YAAY;AAAE,MAAA,OAAO,CAAC;IAC1C,KAAKf,cAAc,CAACa,KAAK;AAAE,MAAA,OAAO,CAAC;IACnC,KAAKb,cAAc,CAACmN,UAAU;AAAE,MAAA,OAAO,CAAC;IACxC,KAAKnN,cAAc,CAACqN,UAAU;AAAE,MAAA,OAAO,EAAE;IACzC,KAAKrN,cAAc,CAACuN,UAAU;AAAE,MAAA,OAAO,EAAE;IACzC,KAAKvN,cAAc,CAACyN,UAAU;AAAE,MAAA,OAAO,EAAE;IACzC,KAAKzN,cAAc,CAAC2N,UAAU;AAAE,MAAA,OAAO,EAAE;IACzC,KAAK3N,cAAc,CAAC6N,UAAU;AAAE,MAAA,OAAO,EAAE;IACzC,KAAK7N,cAAc,CAAC+N,UAAU;AAAE,MAAA,OAAO,CAAC;IACxC,KAAK/N,cAAc,CAACgO,YAAY;AAAE,MAAA,OAAO,CAAC;AAC1C,IAAA;AAAS,MAAA;QACLhG,OAAO,CAAC,KAAK,CAAC;AACd,QAAA,OAAO,CAAC;AACX,MAAA;AACA;AACL;AAEA,SAASwG,sBAAsBA,CAAEF,MAAc,EAAEzO,EAAyB,EAAS;AAC/E,EAAA,QAAQyO,MAAM;IACd,KAAKtO,cAAc,CAACyN,UAAU;AAAE,MAAA,OAAO,CAAC;IACxC,KAAKzN,cAAc,CAAC2N,UAAU;AAAE,MAAA,OAAO,CAAC;IACxC,KAAK3N,cAAc,CAAC6N,UAAU;AAAE,MAAA,OAAO,CAAC;AACxC,IAAA;AAAS,MAAA;AACL,QAAA,OAAO,CAAC;AACX,MAAA;AACA;AACL;AAEA,IAAMY,aAAuB,GAAG,CAC5BzO,cAAc,CAAC0O,KAAK,EACpB1O,cAAc,CAAC2O,IAAI,EACnB3O,cAAc,CAAC4O,KAAK,EACpB5O,cAAc,CAAC6O,MAAM,EACrB7O,cAAc,CAAC8O,OAAO,EACtB9O,cAAc,CAAC+O,QAAQ,EACvB/O,cAAc,CAACgP,MAAM,EACrBhP,cAAc,CAACiP,MAAM,CACxB;AAED,IAAMC,eAAyB,GAAG,CAC9B,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,CACT;AAED,IAAMC,aAAuB,GAAG,CAC5B,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,CACT;AAED,IAAMC,iBAA2B,GAAG,CAChC,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,CACT;AAEK,SAAUC,wBAAwBA,CAAEC,MAAmB,EAAEnR,SAA0B,EAAO;AAC5F,EAAA,IAAQ0B,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;AACtB,EAAA,IAAMC,OAAe,GAAGrR,SAAS,CAACsR,QAAQ,GAAGC,cAAc,CAACC,IAAI,GAAG3P,cAAc,CAAC4P,YAAY,GAAG5P,cAAc,CAAC6P,WAAW;AAE3H,EAAA,IAAI1R,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACC,MAAM,EAAE;AACzC7R,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACkQ,YAAY;AAChD,IAAA,IAAMC,QAAQ,GAAGtQ,EAAE,CAACuQ,YAAY,EAAE;AAClC,IAAA,IAAID,QAAQ,EAAE;MACVhS,SAAS,CAACgS,QAAQ,GAAGA,QAAQ;AAC7B,MAAA,IAAIhS,SAAS,CAACkS,IAAI,GAAG,CAAC,EAAE;AACpB,QAAA,IAAIf,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;UAC1B,IAAIhB,UAAU,CAACiB,KAAK,EAAE;YAClBlB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;YACnEnB,UAAU,CAACiB,KAAK,GAAG,IAAI;AAC1B,UAAA;AACJ,QAAA;QACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;AAEtC,QAAA,IAAIrB,UAAU,CAACsB,aAAa,KAAK1S,SAAS,CAACgS,QAAQ,EAAE;UACjDtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE/R,SAAS,CAACgS,QAAQ,CAAC;AAC9DZ,UAAAA,UAAU,CAACsB,aAAa,GAAG1S,SAAS,CAACgS,QAAQ;AAChD,QAAA;AAEDtQ,QAAAA,EAAE,CAACkR,UAAU,CAAC/Q,cAAc,CAACkQ,YAAY,EAAE/R,SAAS,CAACkS,IAAI,EAAEb,OAAO,CAAC;QACnE3P,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE,IAAI,CAAC;QAChDX,UAAU,CAACsB,aAAa,GAAG,IAAI;AAClC,MAAA;AACJ,IAAA;EACJ,CAAA,MAAM,IAAI1S,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACiB,KAAK,EAAE;AAC/C7S,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACiR,oBAAoB;AACxD,IAAA,IAAMd,SAAQ,GAAGtQ,EAAE,CAACuQ,YAAY,EAAE;AAElC,IAAA,IAAID,SAAQ,EAAE;MACVhS,SAAS,CAACgS,QAAQ,GAAGA,SAAQ;AAC7B,MAAA,IAAIhS,SAAS,CAACkS,IAAI,GAAG,CAAC,EAAE;AACpB,QAAA,IAAIf,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;UAC1B,IAAIhB,UAAU,CAACiB,KAAK,EAAE;YAClBlB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;YACnEnB,UAAU,CAACiB,KAAK,GAAG,IAAI;AAC1B,UAAA;AACJ,QAAA;QACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;AAEtC,QAAA,IAAIrB,UAAU,CAAC2B,oBAAoB,KAAK/S,SAAS,CAACgS,QAAQ,EAAE;UACxDtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE9S,SAAS,CAACgS,QAAQ,CAAC;AACtEZ,UAAAA,UAAU,CAAC2B,oBAAoB,GAAG/S,SAAS,CAACgS,QAAQ;AACvD,QAAA;AAEDtQ,QAAAA,EAAE,CAACkR,UAAU,CAAC/Q,cAAc,CAACiR,oBAAoB,EAAE9S,SAAS,CAACkS,IAAI,EAAEb,OAAO,CAAC;QAC3E3P,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE,IAAI,CAAC;QACxD1B,UAAU,CAAC2B,oBAAoB,GAAG,IAAI;AACzC,MAAA;AACJ,IAAA;EACJ,CAAA,MAAM,IAAI/S,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACoB,OAAO,EAAE;AACjDhT,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACoR,IAAI;IAExC,IAAIjT,SAAS,CAACS,MAAM,EAAE;MAClBT,SAAS,CAACkT,IAAI,GAAG,IAAIjD,YAAY,CAACjQ,SAAS,CAACS,MAAM,CAACA,MAAM,CAAC;AAC7D,IAAA;EACJ,CAAA,MAAM,IAAIT,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACuB,QAAQ,EAAE;AAClDnT,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACoR,IAAI;EAC3C,CAAA,MAAM,IAAIjT,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACwB,YAAY,EAAE;AACtDpT,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACoR,IAAI;EAC3C,CAAA,MAAM,IAAIjT,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACyB,YAAY,EAAE;AACtDrT,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACoR,IAAI;AAC3C,EAAA,CAAA,MAAM;IACHpJ,OAAO,CAAC,KAAK,CAAC;AACd7J,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACoR,IAAI;AAC3C,EAAA;AACL;AAEM,SAAUK,yBAAyBA,CAAEnC,MAAmB,EAAEnR,SAA0B,EAAO;AAC7F,EAAA,IAAQ0B,EAAE,GAAKyP,MAAM,CAAbzP,EAAE;AACV,EAAA,IAAM6R,KAAK,GAAGpC,MAAM,CAACC,UAAU;EAE/B,IAAIpR,SAAS,CAACgS,QAAQ,EAAE;IAGpB,QAAQhS,SAAS,CAAC8R,QAAQ;MAC1B,KAAKjQ,cAAc,CAACkQ,YAAY;AAC5B,QAAA,IAAIZ,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;UAC1B,IAAImB,KAAK,CAAClB,KAAK,EAAE;YACblB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;YACnEgB,KAAK,CAAClB,KAAK,GAAG,IAAI;AACrB,UAAA;AACJ,QAAA;QACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;QAEtC/Q,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE,IAAI,CAAC;QAChDwB,KAAK,CAACb,aAAa,GAAG,IAAI;AAC1B,QAAA;MACJ,KAAK7Q,cAAc,CAACiR,oBAAoB;AACpC,QAAA,IAAI3B,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;UAC1B,IAAImB,KAAK,CAAClB,KAAK,EAAE;YACblB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;YACnEgB,KAAK,CAAClB,KAAK,GAAG,IAAI;AACrB,UAAA;AACJ,QAAA;QACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;QAEtC/Q,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE,IAAI,CAAC;QACxDS,KAAK,CAACR,oBAAoB,GAAG,IAAI;AACjC,QAAA;AAEH;AAEDrR,IAAAA,EAAE,CAAC8R,YAAY,CAACxT,SAAS,CAACgS,QAAQ,CAAC;IACnChS,SAAS,CAACgS,QAAQ,GAAG,IAAI;AAC5B,EAAA;AACL;AAEM,SAAUyB,wBAAwBA,CAAEtC,MAAmB,EAAEnR,SAA0B,EAAO;AAC5F,EAAA,IAAQ0B,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;AACtB,EAAA,IAAMC,OAAe,GAAGrR,SAAS,CAACsR,QAAQ,GAAGC,cAAc,CAACC,IAAI,GAAG3P,cAAc,CAAC4P,YAAY,GAAG5P,cAAc,CAAC6P,WAAW;AAE3H,EAAA,IAAI1R,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACC,MAAM,EAAE;AACzC,IAAA,IAAIV,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;MAC1B,IAAIhB,UAAU,CAACiB,KAAK,EAAE;QAClBlB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;QACnEnB,UAAU,CAACiB,KAAK,GAAG,IAAI;AAC1B,MAAA;AACJ,IAAA;IACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;AAEtC,IAAA,IAAIrB,UAAU,CAACsB,aAAa,KAAK1S,SAAS,CAACgS,QAAQ,EAAE;MACjDtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE/R,SAAS,CAACgS,QAAQ,CAAC;AACjE,IAAA;IAED,IAAIhS,SAAS,CAACS,MAAM,EAAE;AAClBiB,MAAAA,EAAE,CAACkR,UAAU,CAAC/Q,cAAc,CAACkQ,YAAY,EAAE/R,SAAS,CAACS,MAAM,EAAE4Q,OAAO,CAAC;AACxE,IAAA,CAAA,MAAM;AACH3P,MAAAA,EAAE,CAACkR,UAAU,CAAC/Q,cAAc,CAACkQ,YAAY,EAAE/R,SAAS,CAACkS,IAAI,EAAEb,OAAO,CAAC;AACtE,IAAA;IACD3P,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE,IAAI,CAAC;IAChDX,UAAU,CAACsB,aAAa,GAAG,IAAI;EAClC,CAAA,MAAM,IAAI1S,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACiB,KAAK,EAAE;AAC/C,IAAA,IAAI1B,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;MAC1B,IAAIhB,UAAU,CAACiB,KAAK,EAAE;QAClBlB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;QACnEnB,UAAU,CAACiB,KAAK,GAAG,IAAI;AAC1B,MAAA;AACJ,IAAA;IACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;AAEtC,IAAA,IAAIrB,UAAU,CAAC2B,oBAAoB,KAAK/S,SAAS,CAACgS,QAAQ,EAAE;MACxDtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE9S,SAAS,CAACgS,QAAQ,CAAC;AACzE,IAAA;IAED,IAAIhS,SAAS,CAACS,MAAM,EAAE;AAClBiB,MAAAA,EAAE,CAACkR,UAAU,CAAC/Q,cAAc,CAACiR,oBAAoB,EAAE9S,SAAS,CAACS,MAAM,EAAE4Q,OAAO,CAAC;AAChF,IAAA,CAAA,MAAM;AACH3P,MAAAA,EAAE,CAACkR,UAAU,CAAC/Q,cAAc,CAACiR,oBAAoB,EAAE9S,SAAS,CAACkS,IAAI,EAAEb,OAAO,CAAC;AAC9E,IAAA;IACD3P,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE,IAAI,CAAC;IACxD1B,UAAU,CAAC2B,oBAAoB,GAAG,IAAI;EACzC,CAAA,MAAM,IAAI/S,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACoB,OAAO,EAAE;IACjD,IAAIhT,SAAS,CAACS,MAAM,EAAE;MAClBT,SAAS,CAACkT,IAAI,GAAG,IAAIjD,YAAY,CAACjQ,SAAS,CAACS,MAAM,CAACA,MAAM,CAAC;AAC7D,IAAA;EACJ,CAAA,MAAM,IAAKT,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACuB,QAAQ,IACzCnT,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACwB,YAAa,IAC9CpT,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACyB,YAAa,EAAE;AACxDrT,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACoR,IAAI;AAC3C,EAAA,CAAA,MAAM;IACHpJ,OAAO,CAAC,KAAK,CAAC;AACd7J,IAAAA,SAAS,CAAC8R,QAAQ,GAAGjQ,cAAc,CAACoR,IAAI;AAC3C,EAAA;AACL;AAEM,SAAUS,wBAAwBA,CACpCvC,MAAmB,EACnBnR,SAA0B,EAC1BS,MAA8B,EAC9BkT,MAAc,EACdzB,IAAY,EACT;AACH,EAAA,IAAIlS,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACoB,OAAO,EAAE;AAC1C,IAAA,IAAIY,WAAW,CAACC,MAAM,CAACpT,MAAM,CAAC,EAAE;AAC5BT,MAAAA,SAAS,CAACkT,IAAI,CAAEY,GAAG,CAACrT,MAAM,EAAkBkT,MAAM,GAAG1D,YAAY,CAAC8D,iBAAiB,CAAC;AACvF,IAAA,CAAA,MAAM;AACH/T,MAAAA,SAAS,CAACkT,IAAI,CAAEY,GAAG,CAAC,IAAI7D,YAAY,CAACxP,MAAqB,CAAC,EAAEkT,MAAM,GAAG1D,YAAY,CAAC8D,iBAAiB,CAAC;AACxG,IAAA;EACJ,CAAA,MAAM,IAAI/T,SAAS,CAAC2R,KAAK,GAAGC,cAAc,CAACuB,QAAQ,EAAE;AAClDnT,IAAAA,SAAS,CAACgU,SAAS,CAACC,UAAU,EAAE;AAChC,IAAA,IAAMC,SAAS,GAAIzT,MAAM,CAAoByT,SAAS;AACtD,IAAA,KAAK,IAAI1U,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG0U,SAAS,CAACzU,MAAM,EAAE,EAAED,CAAC,EAAE;AACvCQ,MAAAA,SAAS,CAACgU,SAAS,CAACG,WAAW,CAACR,MAAM,GAAGnU,CAAC,EAAE0U,SAAS,CAAC1U,CAAC,CAAC,CAAC;AAC5D,IAAA;AACJ,EAAA,CAAA,MAAM;IACH,IAAM4U,IAAI,GAAG3T,MAAqB;AAClC,IAAA,IAAQiB,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;MAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;IAEtB,QAAQpR,SAAS,CAAC8R,QAAQ;MAC1B,KAAKjQ,cAAc,CAACkQ,YAAY;AAAE,QAAA;AAC9B,UAAA,IAAIZ,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;YAC1B,IAAIhB,UAAU,CAACiB,KAAK,EAAE;cAClBlB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;cACnEnB,UAAU,CAACiB,KAAK,GAAG,IAAI;AAC1B,YAAA;AACJ,UAAA;UACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;AAEtC,UAAA,IAAIrB,UAAU,CAACsB,aAAa,KAAK1S,SAAS,CAACgS,QAAQ,EAAE;YACjDtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE/R,SAAS,CAACgS,QAAQ,CAAC;AAC9DZ,YAAAA,UAAU,CAACsB,aAAa,GAAG1S,SAAS,CAACgS,QAAQ;AAChD,UAAA;AACD,UAAA;AACH,QAAA;MACD,KAAKnQ,cAAc,CAACiR,oBAAoB;AAAE,QAAA;AACtC,UAAA,IAAI3B,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;YAC1B,IAAIhB,UAAU,CAACiB,KAAK,EAAE;cAClBlB,MAAM,CAACgB,UAAU,CAACG,uBAAuB,CAAEC,kBAAkB,CAAC,IAAI,CAAC;cACnEnB,UAAU,CAACiB,KAAK,GAAG,IAAI;AAC1B,YAAA;AACJ,UAAA;UACDG,aAAa,CAACC,iBAAiB,GAAG,IAAI;AAEtC,UAAA,IAAIrB,UAAU,CAAC2B,oBAAoB,KAAK/S,SAAS,CAACgS,QAAQ,EAAE;YACxDtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE9S,SAAS,CAACgS,QAAQ,CAAC;AACtEZ,YAAAA,UAAU,CAAC2B,oBAAoB,GAAG/S,SAAS,CAACgS,QAAQ;AACvD,UAAA;AACD,UAAA;AACH,QAAA;AACD,MAAA;AAAS,QAAA;UACLnI,OAAO,CAAC,KAAK,CAAC;AACd,UAAA;AACH,QAAA;AACA;IAED,IAAIwK,UAAU,CAACC,EAAE,KAAKC,EAAE,CAACC,GAAG,IAAMxU,SAAS,CAACsR,QAAQ,GAAGC,cAAc,CAACC,IAAK,IAAImC,MAAM,KAAK,CAAC,IAAIzB,IAAI,KAAKkC,IAAI,CAACK,UAAU,EAAE;AAKrH/S,MAAAA,EAAE,CAACkR,UAAU,CAAC5S,SAAS,CAAC8R,QAAQ,EAAEsC,IAAI,EAAE1S,EAAE,CAAC+P,YAAY,CAAC;AAC3D,IAAA,CAAA,MAAM,IAAIS,IAAI,KAAKkC,IAAI,CAACK,UAAU,EAAE;MACjC/S,EAAE,CAACgT,aAAa,CAAC1U,SAAS,CAAC8R,QAAQ,EAAE6B,MAAM,EAAES,IAAI,CAAC;AACrD,IAAA,CAAA,MAAM;AACH1S,MAAAA,EAAE,CAACgT,aAAa,CAAC1U,SAAS,CAAC8R,QAAQ,EAAE6B,MAAM,EAAES,IAAI,CAACO,KAAK,CAAC,CAAC,EAAEzC,IAAI,CAAC,CAAC;AACpE,IAAA;AACJ,EAAA;AACL;AAEM,SAAU0C,yBAAyBA,CAAEzD,MAAmB,EAAElR,UAA4B,EAAO;AAC/F,EAAA,IAAQyB,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;AAEtBnR,EAAAA,UAAU,CAAC4U,QAAQ,GAAG5U,UAAU,CAAC6U,aAAa,GAAG/K,sBAAsB,CAAC9J,UAAU,CAACwB,MAAU,CAAC;EAC9FxB,UAAU,CAACkQ,MAAM,GAAG3O,oBAAoB,CAACvB,UAAU,CAACwB,MAAU,CAAC;AAE/D,EAAA,IAAIsT,CAAC,GAAG9U,UAAU,CAAC+U,KAAK;AACxB,EAAA,IAAIC,CAAC,GAAGhV,UAAU,CAACiV,MAAM;EAEzB,QAAQjV,UAAU,CAACH,IAAI;IACvB,KAAKqV,WAAW,CAACC,KAAK;AAAE,MAAA;AACpBnV,QAAAA,UAAU,CAAC6R,QAAQ,GAAGjQ,cAAc,CAACwT,UAAU;AAE/C,QAAA,IAAMC,OAAO,GAAGjU,GAAG,CAAC0T,CAAC,EAAEE,CAAC,CAAC;AACzB,QAAA,IAAIK,OAAO,GAAGnE,MAAM,CAACoE,YAAY,CAACC,cAAc,EAAE;UAC9C3L,OAAO,CAAC,IAAI,EAAEyL,OAAO,EAAEnE,MAAM,CAACoE,YAAY,CAACC,cAAc,CAAC;AAC7D,QAAA;AAED,QAAA,IAAI,CAACrE,MAAM,CAACsE,gBAAgB,CAACxV,UAAU,CAACwB,MAAM,CAAC,KACtC,CAAC0P,MAAM,CAACgB,UAAU,CAACuD,mBAAmB,IAAIC,SAAS,CAAA,IAAKC,WAAW,CAAC3V,UAAU,CAACwB,MAAM,CAAC,CAACoU,QAAS,EAAE;UACvG5V,UAAU,CAAC6U,aAAa,GAAGxL,8BAA8B,CAACrJ,UAAU,CAACwB,MAAU,CAAC;AAChFxB,UAAAA,UAAU,CAAC6V,cAAc,GAAGpU,EAAE,CAACqU,kBAAkB,EAAE;AACnD,UAAA,IAAI9V,UAAU,CAACiS,IAAI,GAAG,CAAC,EAAE;AACrB,YAAA,IAAId,UAAU,CAAC0E,cAAc,KAAK7V,UAAU,CAAC6V,cAAc,EAAE;cACzDpU,EAAE,CAACsU,gBAAgB,CAACnU,cAAc,CAACoU,YAAY,EAAEhW,UAAU,CAAC6V,cAAc,CAAC;AAC3E1E,cAAAA,UAAU,CAAC0E,cAAc,GAAG7V,UAAU,CAAC6V,cAAc;AACxD,YAAA;AACDpU,YAAAA,EAAE,CAACwU,mBAAmB,CAACrU,cAAc,CAACoU,YAAY,EAAEhW,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,CAAC;AACtF,UAAA;AACJ,QAAA,CAAA,MAAM;AACHhV,UAAAA,UAAU,CAACkW,SAAS,GAAGzU,EAAE,CAAC0U,aAAa,EAAE;AACzC,UAAA,IAAInW,UAAU,CAACiS,IAAI,GAAG,CAAC,EAAE;YACrB,IAAMmE,SAAS,GAAGjF,UAAU,CAACkF,UAAU,CAAClF,UAAU,CAACmF,OAAO,CAAC;AAE3D,YAAA,IAAIF,SAAS,CAACF,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;cAC9CzU,EAAE,CAAC8U,WAAW,CAAC3U,cAAc,CAACwT,UAAU,EAAEpV,UAAU,CAACkW,SAAS,CAAC;AAC/DE,cAAAA,SAAS,CAACF,SAAS,GAAGlW,UAAU,CAACkW,SAAS;AAC7C,YAAA;YAED,IAAIP,WAAW,CAAC3V,UAAU,CAACwB,MAAM,CAAC,CAACgV,YAAY,EAAE;AAC7C,cAAA,KAAK,IAAIjX,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,CAAC,EAAE;AAC1C,gBAAA,IAAMmX,OAAO,GAAGC,UAAU,CAAC3W,UAAU,CAACwB,MAAM,EAAEsT,CAAC,EAAEE,CAAC,EAAE,CAAC,CAAC;AACtD,gBAAA,IAAM4B,IAAgB,GAAG,IAAIC,UAAU,CAACH,OAAO,CAAC;gBAChDjV,EAAE,CAACqV,oBAAoB,CAAClV,cAAc,CAACwT,UAAU,EAAE7V,CAAC,EAAES,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,EAAE,CAAC,EAAE4B,IAAI,CAAC;gBAC9F9B,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;gBAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,cAAA;AACJ,YAAA,CAAA,MAAM;AACH,cAAA,KAAK,IAAIzV,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,EAAC,EAAE;AAC1CkC,gBAAAA,EAAE,CAACsV,UAAU,CAACnV,cAAc,CAACwT,UAAU,EAAE7V,EAAC,EAAES,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,EAAE,CAAC,EAAEhV,UAAU,CAAC4U,QAAQ,EAAE5U,UAAU,CAACkQ,MAAM,EAAE,IAAI,CAAC;gBAC5H4E,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;gBAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,cAAA;AACJ,YAAA;YAED,IAAIhV,UAAU,CAACgX,UAAU,EAAE;AACvBhX,cAAAA,UAAU,CAACiX,OAAO,GAAGrV,cAAc,CAACsV,MAAM;AAC1ClX,cAAAA,UAAU,CAACmX,OAAO,GAAGvV,cAAc,CAACsV,MAAM;AAC7C,YAAA,CAAA,MAAM;AACHlX,cAAAA,UAAU,CAACiX,OAAO,GAAGrV,cAAc,CAACwV,aAAa;AACjDpX,cAAAA,UAAU,CAACmX,OAAO,GAAGvV,cAAc,CAACwV,aAAa;AACpD,YAAA;AACDpX,YAAAA,UAAU,CAACqX,WAAW,GAAGzV,cAAc,CAAC0V,MAAM;AAC9CtX,YAAAA,UAAU,CAACuX,WAAW,GAAG3V,cAAc,CAAC0V,MAAM;AAE9C7V,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC6V,cAAc,EAAEzX,UAAU,CAACiX,OAAO,CAAC;AACxFxV,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC8V,cAAc,EAAE1X,UAAU,CAACmX,OAAO,CAAC;AACxF1V,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC+V,kBAAkB,EAAE3X,UAAU,CAACqX,WAAW,CAAC;AAChG5V,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAACgW,kBAAkB,EAAE5X,UAAU,CAACuX,WAAW,CAAC;AACnG,UAAA;AACJ,QAAA;AAED,QAAA;AACH,MAAA;IACD,KAAKrC,WAAW,CAAC2C,IAAI;AAAE,MAAA;AACnB7X,QAAAA,UAAU,CAAC6R,QAAQ,GAAGjQ,cAAc,CAACkW,gBAAgB;AAErD,QAAA,IAAMzC,QAAO,GAAGjU,GAAG,CAAC0T,CAAC,EAAEE,CAAC,CAAC;AACzB,QAAA,IAAIK,QAAO,GAAGnE,MAAM,CAACoE,YAAY,CAACyC,qBAAqB,EAAE;UACrDnO,OAAO,CAAC,IAAI,EAAEyL,QAAO,EAAEnE,MAAM,CAACoE,YAAY,CAACC,cAAc,CAAC;AAC7D,QAAA;AAEDvV,QAAAA,UAAU,CAACkW,SAAS,GAAGzU,EAAE,CAAC0U,aAAa,EAAE;AACzC,QAAA,IAAInW,UAAU,CAACiS,IAAI,GAAG,CAAC,EAAE;UACrB,IAAMmE,UAAS,GAAGjF,UAAU,CAACkF,UAAU,CAAClF,UAAU,CAACmF,OAAO,CAAC;AAE3D,UAAA,IAAIF,UAAS,CAACF,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;YAC9CzU,EAAE,CAAC8U,WAAW,CAAC3U,cAAc,CAACkW,gBAAgB,EAAE9X,UAAU,CAACkW,SAAS,CAAC;AACrEE,YAAAA,UAAS,CAACF,SAAS,GAAGlW,UAAU,CAACkW,SAAS;AAC7C,UAAA;UAED,IAAIP,WAAW,CAAC3V,UAAU,CAACwB,MAAM,CAAC,CAACgV,YAAY,EAAE;YAC7C,KAAK,IAAIwB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAE,EAAEA,CAAC,EAAE;cACxBlD,CAAC,GAAG9U,UAAU,CAAC+U,KAAK;cACpBC,CAAC,GAAGhV,UAAU,CAACiV,MAAM;AACrB,cAAA,KAAK,IAAI1V,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,GAAC,EAAE;AAC1C,gBAAA,IAAMmX,QAAO,GAAGC,UAAU,CAAC3W,UAAU,CAACwB,MAAM,EAAEsT,CAAC,EAAEE,CAAC,EAAE,CAAC,CAAC;AACtD,gBAAA,IAAM4B,KAAgB,GAAG,IAAIC,UAAU,CAACH,QAAO,CAAC;gBAChDjV,EAAE,CAACqV,oBAAoB,CAAClV,cAAc,CAACqW,2BAA2B,GAAGD,CAAC,EAAEzY,GAAC,EAAES,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,EAAE,CAAC,EAAE4B,KAAI,CAAC;gBACnH9B,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;gBAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,cAAA;AACJ,YAAA;AACJ,UAAA,CAAA,MAAM;YACH,KAAK,IAAIgD,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAG,CAAC,EAAE,EAAEA,EAAC,EAAE;cACxBlD,CAAC,GAAG9U,UAAU,CAAC+U,KAAK;cACpBC,CAAC,GAAGhV,UAAU,CAACiV,MAAM;AACrB,cAAA,KAAK,IAAI1V,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,GAAC,EAAE;AAC1CkC,gBAAAA,EAAE,CAACsV,UAAU,CACTnV,cAAc,CAACqW,2BAA2B,GAAGD,EAAC,EAC9CzY,GAAC,EACDS,UAAU,CAAC6U,aAAa,EACxBC,CAAC,EACDE,CAAC,EACD,CAAC,EACDhV,UAAU,CAAC4U,QAAQ,EACnB5U,UAAU,CAACkQ,MAAM,EACjB,IAAI,CACP;gBACD4E,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;gBAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,cAAA;AACJ,YAAA;AACJ,UAAA;UAED,IAAIhV,UAAU,CAACgX,UAAU,EAAE;AACvBhX,YAAAA,UAAU,CAACiX,OAAO,GAAGrV,cAAc,CAACsV,MAAM;AAC1ClX,YAAAA,UAAU,CAACmX,OAAO,GAAGvV,cAAc,CAACsV,MAAM;AAC7C,UAAA,CAAA,MAAM;AACHlX,YAAAA,UAAU,CAACiX,OAAO,GAAGrV,cAAc,CAACwV,aAAa;AACjDpX,YAAAA,UAAU,CAACmX,OAAO,GAAGvV,cAAc,CAACwV,aAAa;AACpD,UAAA;AACDpX,UAAAA,UAAU,CAACqX,WAAW,GAAGzV,cAAc,CAAC0V,MAAM;AAC9CtX,UAAAA,UAAU,CAACuX,WAAW,GAAG3V,cAAc,CAAC0V,MAAM;AAE9C7V,UAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC6V,cAAc,EAAEzX,UAAU,CAACiX,OAAO,CAAC;AACxFxV,UAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC8V,cAAc,EAAE1X,UAAU,CAACmX,OAAO,CAAC;AACxF1V,UAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC+V,kBAAkB,EAAE3X,UAAU,CAACqX,WAAW,CAAC;AAChG5V,UAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAACgW,kBAAkB,EAAE5X,UAAU,CAACuX,WAAW,CAAC;AACnG,QAAA;AAED,QAAA;AACH,MAAA;AACD,IAAA;AAAS,MAAA;QACL3N,OAAO,CAAC,KAAK,CAAC;AACd5J,QAAAA,UAAU,CAACH,IAAI,GAAGqV,WAAW,CAACC,KAAK;AACnCnV,QAAAA,UAAU,CAAC6R,QAAQ,GAAGjQ,cAAc,CAACwT,UAAU;AAClD,MAAA;AACA;AACL;AAEM,SAAU8C,0BAA0BA,CAAEhH,MAAmB,EAAElR,UAA4B,EAAO;AAChG,EAAA,IAAQyB,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;EACtB,IAAInR,UAAU,CAACkW,SAAS,EAAE;AACtB,IAAA,IAAMG,UAAU,GAAGlF,UAAU,CAACkF,UAAU;AACxC,IAAA,IAAIC,OAAO,GAAGnF,UAAU,CAACmF,OAAO;AAChC7U,IAAAA,EAAE,CAAC0W,aAAa,CAACnY,UAAU,CAACkW,SAAS,CAAC;AACtC,IAAA,KAAK,IAAI3W,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG8W,UAAU,CAAC7W,MAAM,EAAED,CAAC,EAAE,EAAE;MACxC,IAAI8W,UAAU,CAAC9W,CAAC,CAAC,CAAC2W,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;QAClDzU,EAAE,CAAC2W,aAAa,CAACxW,cAAc,CAACyW,QAAQ,GAAG9Y,CAAC,CAAC;AAC7C+W,QAAAA,OAAO,GAAG/W,CAAC;QACXkC,EAAE,CAAC8U,WAAW,CAACvW,UAAU,CAAC6R,QAAQ,EAAE,IAAI,CAAC;AACzCwE,QAAAA,UAAU,CAAC9W,CAAC,CAAC,CAAC2W,SAAS,GAAG,IAAI;AACjC,MAAA;AACJ,IAAA;IACD/E,UAAU,CAACmF,OAAO,GAAGA,OAAO;IAC5BtW,UAAU,CAACkW,SAAS,GAAG,IAAI;AAC9B,EAAA;EAED,IAAIlW,UAAU,CAAC6V,cAAc,EAAE;AAC3B,IAAA,IAAMA,cAAc,GAAG1E,UAAU,CAAC0E,cAAc;AAChDpU,IAAAA,EAAE,CAAC6W,kBAAkB,CAACtY,UAAU,CAAC6V,cAAc,CAAC;AAChD,IAAA,IAAIA,cAAc,KAAK7V,UAAU,CAAC6V,cAAc,EAAE;MAC9CpU,EAAE,CAACsU,gBAAgB,CAACnU,cAAc,CAACoU,YAAY,EAAE,IAAI,CAAC;MACtD7E,UAAU,CAAC0E,cAAc,GAAG,IAAI;AACnC,IAAA;IACD7V,UAAU,CAAC6V,cAAc,GAAG,IAAI;AACnC,EAAA;AACL;AAEM,SAAU0C,yBAAyBA,CAAErH,MAAmB,EAAElR,UAA4B,EAAO;AAC/F,EAAA,IAAI,CAACA,UAAU,CAACiS,IAAI,EAAE;AAEtB,EAAA,IAAQxQ,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;AAEtB,EAAA,IAAI2D,CAAC,GAAG9U,UAAU,CAAC+U,KAAK;AACxB,EAAA,IAAIC,CAAC,GAAGhV,UAAU,CAACiV,MAAM;EAEzB,QAAQjV,UAAU,CAACH,IAAI;IACvB,KAAKqV,WAAW,CAACC,KAAK;AAAE,MAAA;AACpBnV,QAAAA,UAAU,CAAC6R,QAAQ,GAAGjQ,cAAc,CAACwT,UAAU;AAE/C,QAAA,IAAMC,OAAO,GAAGjU,GAAG,CAAC0T,CAAC,EAAEE,CAAC,CAAC;AACzB,QAAA,IAAIK,OAAO,GAAGnE,MAAM,CAACoE,YAAY,CAACC,cAAc,EAAE;UAC9C3L,OAAO,CAAC,IAAI,EAAEyL,OAAO,EAAEnE,MAAM,CAACoE,YAAY,CAACC,cAAc,CAAC;AAC7D,QAAA;QAED,IAAIvV,UAAU,CAAC6V,cAAc,EAAE;AAC3B,UAAA,IAAI1E,UAAU,CAAC0E,cAAc,KAAK7V,UAAU,CAAC6V,cAAc,EAAE;YACzDpU,EAAE,CAACsU,gBAAgB,CAACnU,cAAc,CAACoU,YAAY,EAAEhW,UAAU,CAAC6V,cAAc,CAAC;AAC3E1E,YAAAA,UAAU,CAAC0E,cAAc,GAAG7V,UAAU,CAAC6V,cAAc;AACxD,UAAA;AACDpU,UAAAA,EAAE,CAACwU,mBAAmB,CAACrU,cAAc,CAACoU,YAAY,EAAEhW,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,CAAC;AACtF,QAAA,CAAA,MAAM,IAAIhV,UAAU,CAACkW,SAAS,EAAE;UAC7B,IAAME,SAAS,GAAGjF,UAAU,CAACkF,UAAU,CAAClF,UAAU,CAACmF,OAAO,CAAC;AAE3D,UAAA,IAAIF,SAAS,CAACF,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;YAC9CzU,EAAE,CAAC8U,WAAW,CAAC3U,cAAc,CAACwT,UAAU,EAAEpV,UAAU,CAACkW,SAAS,CAAC;AAC/DE,YAAAA,SAAS,CAACF,SAAS,GAAGlW,UAAU,CAACkW,SAAS;AAC7C,UAAA;UAED,IAAIP,WAAW,CAAC3V,UAAU,CAACwB,MAAM,CAAC,CAACgV,YAAY,EAAE;AAC7C,YAAA,KAAK,IAAIjX,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,CAAC,EAAE;AAC1C,cAAA,IAAMmX,OAAO,GAAGC,UAAU,CAAC3W,UAAU,CAACwB,MAAM,EAAEsT,CAAC,EAAEE,CAAC,EAAE,CAAC,CAAC;AACtD,cAAA,IAAM4B,IAAgB,GAAG,IAAIC,UAAU,CAACH,OAAO,CAAC;cAChDjV,EAAE,CAACqV,oBAAoB,CAAClV,cAAc,CAACwT,UAAU,EAAE7V,CAAC,EAAES,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,EAAE,CAAC,EAAE4B,IAAI,CAAC;cAC9F9B,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;cAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,YAAA;AACJ,UAAA,CAAA,MAAM;AACH,YAAA,KAAK,IAAIzV,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,GAAC,EAAE;AAC1CkC,cAAAA,EAAE,CAACsV,UAAU,CAACnV,cAAc,CAACwT,UAAU,EAAE7V,GAAC,EAAES,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,EAAE,CAAC,EAAEhV,UAAU,CAAC4U,QAAQ,EAAE5U,UAAU,CAACkQ,MAAM,EAAE,IAAI,CAAC;cAC5H4E,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;cAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,YAAA;AACJ,UAAA;AACJ,QAAA;AACD,QAAA;AACH,MAAA;IACD,KAAKE,WAAW,CAAC2C,IAAI;AAAE,MAAA;AACnB7X,QAAAA,UAAU,CAAC6R,QAAQ,GAAGjQ,cAAc,CAACkW,gBAAgB;AAErD,QAAA,IAAMzC,SAAO,GAAGjU,GAAG,CAAC0T,CAAC,EAAEE,CAAC,CAAC;AACzB,QAAA,IAAIK,SAAO,GAAGnE,MAAM,CAACoE,YAAY,CAACyC,qBAAqB,EAAE;UACrDnO,OAAO,CAAC,IAAI,EAAEyL,SAAO,EAAEnE,MAAM,CAACoE,YAAY,CAACC,cAAc,CAAC;AAC7D,QAAA;QAED,IAAMa,WAAS,GAAGjF,UAAU,CAACkF,UAAU,CAAClF,UAAU,CAACmF,OAAO,CAAC;AAE3D,QAAA,IAAIF,WAAS,CAACF,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;UAC9CzU,EAAE,CAAC8U,WAAW,CAAC3U,cAAc,CAACkW,gBAAgB,EAAE9X,UAAU,CAACkW,SAAS,CAAC;AACrEE,UAAAA,WAAS,CAACF,SAAS,GAAGlW,UAAU,CAACkW,SAAS;AAC7C,QAAA;QAED,IAAIP,WAAW,CAAC3V,UAAU,CAACwB,MAAM,CAAC,CAACgV,YAAY,EAAE;UAC7C,KAAK,IAAIwB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,EAAE,EAAEA,CAAC,EAAE;YACxBlD,CAAC,GAAG9U,UAAU,CAAC+U,KAAK;YACpBC,CAAC,GAAGhV,UAAU,CAACiV,MAAM;AACrB,YAAA,KAAK,IAAI1V,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,GAAC,EAAE;AAC1C,cAAA,IAAMmX,SAAO,GAAGC,UAAU,CAAC3W,UAAU,CAACwB,MAAM,EAAEsT,CAAC,EAAEE,CAAC,EAAE,CAAC,CAAC;AACtD,cAAA,IAAM4B,MAAgB,GAAG,IAAIC,UAAU,CAACH,SAAO,CAAC;cAChDjV,EAAE,CAACqV,oBAAoB,CAAClV,cAAc,CAACqW,2BAA2B,GAAGD,CAAC,EAAEzY,GAAC,EAAES,UAAU,CAAC6U,aAAa,EAAEC,CAAC,EAAEE,CAAC,EAAE,CAAC,EAAE4B,MAAI,CAAC;cACnH9B,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;cAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,YAAA;AACJ,UAAA;AACJ,QAAA,CAAA,MAAM;UACH,KAAK,IAAIgD,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAG,CAAC,EAAE,EAAEA,GAAC,EAAE;YACxBlD,CAAC,GAAG9U,UAAU,CAAC+U,KAAK;YACpBC,CAAC,GAAGhV,UAAU,CAACiV,MAAM;AACrB,YAAA,KAAK,IAAI1V,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGS,UAAU,CAACyW,QAAQ,EAAE,EAAElX,GAAC,EAAE;AAC1CkC,cAAAA,EAAE,CAACsV,UAAU,CACTnV,cAAc,CAACqW,2BAA2B,GAAGD,GAAC,EAC9CzY,GAAC,EACDS,UAAU,CAAC6U,aAAa,EACxBC,CAAC,EACDE,CAAC,EACD,CAAC,EACDhV,UAAU,CAAC4U,QAAQ,EACnB5U,UAAU,CAACkQ,MAAM,EACjB,IAAI,CACP;cACD4E,CAAC,GAAG1T,GAAG,CAAC,CAAC,EAAE0T,CAAC,IAAI,CAAC,CAAC;cAClBE,CAAC,GAAG5T,GAAG,CAAC,CAAC,EAAE4T,CAAC,IAAI,CAAC,CAAC;AACrB,YAAA;AACJ,UAAA;AACJ,QAAA;AACD,QAAA;AACH,MAAA;AACD,IAAA;AAAS,MAAA;QACLpL,OAAO,CAAC,KAAK,CAAC;AACd5J,QAAAA,UAAU,CAACH,IAAI,GAAGqV,WAAW,CAACC,KAAK;AACnCnV,QAAAA,UAAU,CAAC6R,QAAQ,GAAGjQ,cAAc,CAACwT,UAAU;AAClD,MAAA;AACA;AACL;AAEM,SAAUoD,6BAA6BA,CAAEtH,MAAmB,EAAEuH,cAAoC,EAAO;AAC3G,EAAA,KAAK,IAAIlZ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkZ,cAAc,CAACC,gBAAgB,CAAClZ,MAAM,EAAE,EAAED,CAAC,EAAE;AAC7D,IAAA,IAAMoZ,GAAG,GAAGF,cAAc,CAACC,gBAAgB,CAACnZ,CAAC,CAAC;IAC9C,IAAIoZ,GAAG,CAACC,kBAAkB,EAAE;MACxBH,cAAc,CAACI,WAAW,GAAG,KAAK;AAClC,MAAA;AACH,IAAA;AACJ,EAAA;AAED,EAAA,IAAQpX,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;EACtB,IAAM2H,WAAqB,GAAG,EAAE;AAEhC,EAAA,IAAMC,aAAa,GAAGtX,EAAE,CAACuX,iBAAiB,EAAE;AAC5C,EAAA,IAAID,aAAa,EAAE;IACfN,cAAc,CAACM,aAAa,GAAGA,aAAa;AAE5C,IAAA,IAAI5H,UAAU,CAAC4H,aAAa,KAAKN,cAAc,CAACM,aAAa,EAAE;MAC3DtX,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAET,cAAc,CAACM,aAAa,CAAC;AAC/E,IAAA;AAED,IAAA,KAAK,IAAIxZ,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkZ,cAAc,CAACC,gBAAgB,CAAClZ,MAAM,EAAE,EAAED,GAAC,EAAE;AAC7D,MAAA,IAAMS,UAAU,GAAGyY,cAAc,CAACC,gBAAgB,CAACnZ,GAAC,CAAC;AACrD,MAAA,IAAIS,UAAU,EAAE;QACZ,IAAIA,UAAU,CAACkW,SAAS,EAAE;UACtBzU,EAAE,CAAC0X,oBAAoB,CACnBvX,cAAc,CAACsX,WAAW,EAC1BtX,cAAc,CAACwX,iBAAiB,GAAG7Z,GAAC,EACpCS,UAAU,CAAC6R,QAAQ,EACnB7R,UAAU,CAACkW,SAAS,EACpB,CAAC,CACJ;AACJ,QAAA,CAAA,MAAM;UACHzU,EAAE,CAAC4X,uBAAuB,CACtBzX,cAAc,CAACsX,WAAW,EAC1BtX,cAAc,CAACwX,iBAAiB,GAAG7Z,GAAC,EACpCqC,cAAc,CAACoU,YAAY,EAC3BhW,UAAU,CAAC6V,cAAc,CAC5B;AACJ,QAAA;QAEDiD,WAAW,CAAC5Y,IAAI,CAAC0B,cAAc,CAACwX,iBAAiB,GAAG7Z,GAAC,CAAC;AACtDkZ,QAAAA,cAAc,CAAC1D,KAAK,GAAGzT,GAAG,CAACmX,cAAc,CAAC1D,KAAK,EAAE/U,UAAU,CAAC+U,KAAK,CAAC;AAClE0D,QAAAA,cAAc,CAACxD,MAAM,GAAG3T,GAAG,CAACmX,cAAc,CAACxD,MAAM,EAAEjV,UAAU,CAACiV,MAAM,CAAC;AACxE,MAAA;AACJ,IAAA;AAED,IAAA,IAAMqE,GAAG,GAAGb,cAAc,CAACc,sBAAsB;AACjD,IAAA,IAAID,GAAG,EAAE;AACL,MAAA,IAAME,YAAY,GAAG7D,WAAW,CAAC2D,GAAG,CAAC9X,MAAM,CAAC,CAACiY,UAAU,GAAG7X,cAAc,CAAC8X,wBAAwB,GAAG9X,cAAc,CAAC+X,gBAAgB;MACnI,IAAIL,GAAG,CAACpD,SAAS,EAAE;AACfzU,QAAAA,EAAE,CAAC0X,oBAAoB,CACnBvX,cAAc,CAACsX,WAAW,EAC1BM,YAAY,EACZF,GAAG,CAACzH,QAAQ,EACZyH,GAAG,CAACpD,SAAS,EACb,CAAC,CACJ;AACJ,MAAA,CAAA,MAAM;AACHzU,QAAAA,EAAE,CAAC4X,uBAAuB,CACtBzX,cAAc,CAACsX,WAAW,EAC1BM,YAAY,EACZ5X,cAAc,CAACoU,YAAY,EAC3BsD,GAAG,CAACzD,cAAc,CACrB;AACJ,MAAA;AACD4C,MAAAA,cAAc,CAAC1D,KAAK,GAAGzT,GAAG,CAACmX,cAAc,CAAC1D,KAAK,EAAEuE,GAAG,CAACvE,KAAK,CAAC;AAC3D0D,MAAAA,cAAc,CAACxD,MAAM,GAAG3T,GAAG,CAACmX,cAAc,CAACxD,MAAM,EAAEqE,GAAG,CAACrE,MAAM,CAAC;AACjE,IAAA;AAED,IAAA,IAAI/D,MAAM,CAACgB,UAAU,CAAC0H,kBAAkB,EAAE;MACtC1I,MAAM,CAACgB,UAAU,CAAC0H,kBAAkB,CAACC,gBAAgB,CAACf,WAAW,CAAC;AACrE,IAAA;IAED,IAAMgB,MAAM,GAAGrY,EAAE,CAACsY,sBAAsB,CAACnY,cAAc,CAACsX,WAAW,CAAC;AACpE,IAAA,IAAIY,MAAM,KAAKlY,cAAc,CAACoY,oBAAoB,EAAE;AAChD,MAAA,QAAQF,MAAM;QACd,KAAKlY,cAAc,CAACqY,iCAAiC;AAAE,UAAA;YACnDrQ,OAAO,CAAC,KAAK,CAAC;AACd,YAAA;AACH,UAAA;QACD,KAAKhI,cAAc,CAACsY,yCAAyC;AAAE,UAAA;YAC3DtQ,OAAO,CAAC,KAAK,CAAC;AACd,YAAA;AACH,UAAA;QACD,KAAKhI,cAAc,CAACuY,iCAAiC;AAAE,UAAA;YACnDvQ,OAAO,CAAC,KAAK,CAAC;AACd,YAAA;AACH,UAAA;QACD,KAAKhI,cAAc,CAACwY,uBAAuB;AAAE,UAAA;YACzCxQ,OAAO,CAAC,KAAK,CAAC;AACd,YAAA;AACH,UAAA;AAEA;AACJ,IAAA;AAED,IAAA,IAAIuH,UAAU,CAAC4H,aAAa,KAAKN,cAAc,CAACM,aAAa,EAAE;MAC3DtX,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAE/H,UAAU,CAAC4H,aAAa,CAAC;AAC3E,IAAA;AACJ,EAAA;AACL;AAEM,SAAUsB,8BAA8BA,CAAEnJ,MAAmB,EAAEuH,cAAoC,EAAO;AAC5G,EAAA,IAAQhX,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;EACtB,IAAIsH,cAAc,CAACM,aAAa,EAAE;AAC9BtX,IAAAA,EAAE,CAAC6Y,iBAAiB,CAAC7B,cAAc,CAACM,aAAa,CAAC;AAClD,IAAA,IAAI5H,UAAU,CAAC4H,aAAa,KAAKN,cAAc,CAACM,aAAa,EAAE;MAC3DtX,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAE,IAAI,CAAC;MACpD/H,UAAU,CAAC4H,aAAa,GAAG,IAAI;AAClC,IAAA;IACDN,cAAc,CAACM,aAAa,GAAG,IAAI;AACtC,EAAA;AACL;AAEM,SAAUwB,wBAAwBA,CAAErJ,MAAmB,EAAEsJ,SAA0B,EAAO;AAC5F,EAAA,IAAQ/Y,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;EAAY,IAAAsJ,KAAA,GAAA,SAAAA,KAAAA,GAEmB;AACjD,MAAA,IAAMC,QAAQ,GAAGF,SAAS,CAACG,SAAS,CAACC,CAAC,CAAC;MAEvC,IAAIC,YAAoB,GAAG,CAAC;MAC5B,IAAIC,aAAa,GAAG,EAAE;MACtB,IAAIC,UAAU,GAAG,CAAC;MAElB,QAAQL,QAAQ,CAAC7a,IAAI;QACrB,KAAKmb,kBAAkB,CAACpJ,MAAM;AAAE,UAAA;AAC5BkJ,YAAAA,aAAa,GAAG,cAAc;YAC9BD,YAAY,GAAGjZ,cAAc,CAACqZ,aAAa;AAC3C,YAAA;AACH,UAAA;QACD,KAAKD,kBAAkB,CAACE,QAAQ;AAAE,UAAA;AAC9BJ,YAAAA,aAAa,GAAG,gBAAgB;YAChCD,YAAY,GAAGjZ,cAAc,CAACuZ,eAAe;AAC7C,YAAA;AACH,UAAA;AACD,QAAA;AAAS,UAAA;YACLvR,OAAO,CAAC,KAAK,CAAC;AAAC,YAAA,OAAA;cAAAwR,CAAA,EAAA;AAAA,aAAA;AAElB,UAAA;AACA;AAED,MAAA,IAAMC,QAAQ,GAAG5Z,EAAE,CAAC6Z,YAAY,CAACT,YAAY,CAAC;AAC9C,MAAA,IAAIQ,QAAQ,EAAE;QACVX,QAAQ,CAACW,QAAQ,GAAGA,QAAQ;QAC5B5Z,EAAE,CAAC8Z,YAAY,CAACb,QAAQ,CAACW,QAAQ,EAAEX,QAAQ,CAACc,MAAM,CAAC;AACnD/Z,QAAAA,EAAE,CAACga,aAAa,CAACf,QAAQ,CAACW,QAAQ,CAAC;AAEnC,QAAA,IAAI,CAAC5Z,EAAE,CAACia,kBAAkB,CAAChB,QAAQ,CAACW,QAAQ,EAAEzZ,cAAc,CAAC+Z,cAAc,CAAC,EAAE;UAC1E/R,OAAO,CAAC,KAAK,EAAEkR,aAAa,EAAEN,SAAS,CAACoB,IAAI,CAAC;UAC7ChS,OAAO,CAAC,KAAK,EAAE8Q,QAAQ,CAACc,MAAM,CAACK,OAAO,CAAC,OAAO,EAAE,YAAA;AAAA,YAAA,OAAA,IAAA,GAAmBd,UAAU,EAAE,GAAA,GAAA;AAAA,UAAA,CAAG,CAAC,CAAC;UACpFe,KAAK,CAACra,EAAE,CAACsa,gBAAgB,CAACrB,QAAQ,CAACW,QAAQ,CAAC,CAAC;AAE7C,UAAA,KAAK,IAAIW,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGxB,SAAS,CAACG,SAAS,CAACnb,MAAM,EAAEwc,CAAC,EAAE,EAAE;AACjD,YAAA,IAAMC,KAAK,GAAGzB,SAAS,CAACG,SAAS,CAACC,CAAC,CAAC;YACpC,IAAIqB,KAAK,CAACZ,QAAQ,EAAE;AAChB5Z,cAAAA,EAAE,CAACya,YAAY,CAACD,KAAK,CAACZ,QAAQ,CAAC;cAC/BY,KAAK,CAACZ,QAAQ,GAAG,IAAI;AACxB,YAAA;AACJ,UAAA;AAAA,UAAA,OAAA;YAAAD,CAAA,EAAA;AAAA,WAAA;AAEJ,QAAA;AACJ,MAAA;IACJ,CAAA;IAAAe,IAAA;AA7CD,EAAA,KAAK,IAAIvB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,SAAS,CAACG,SAAS,CAACnb,MAAM,EAAEob,CAAC,EAAE,EAAA;AAAAuB,IAAAA,IAAA,GAAA1B,KAAA,EAAA;AAAA,IAAA,IAAA0B,IAAA,EAAA,OAAAA,IAAA,CAAAf,CAAA;AAAA,EAAA;AA+CnD,EAAA,IAAMgB,SAAS,GAAG3a,EAAE,CAAC4a,aAAa,EAAE;EACpC,IAAI,CAACD,SAAS,EAAE;AACZ,IAAA;AACH,EAAA;EAED5B,SAAS,CAAC4B,SAAS,GAAGA,SAAS;AAG/B,EAAA,KAAK,IAAIxB,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGJ,SAAS,CAACG,SAAS,CAACnb,MAAM,EAAEob,EAAC,EAAE,EAAE;AACjD,IAAA,IAAMF,QAAQ,GAAGF,SAAS,CAACG,SAAS,CAACC,EAAC,CAAC;IACvCnZ,EAAE,CAAC6a,YAAY,CAAC9B,SAAS,CAAC4B,SAAS,EAAE1B,QAAQ,CAACW,QAAS,CAAC;AAC3D,EAAA;AAED5Z,EAAAA,EAAE,CAAC8a,WAAW,CAAC/B,SAAS,CAAC4B,SAAS,CAAC;AAGnC,EAAA,IAAIlL,MAAM,CAACgB,UAAU,CAACsK,yBAAyB,EAAE;AAC7C,IAAA,KAAK,IAAI5B,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGJ,SAAS,CAACG,SAAS,CAACnb,MAAM,EAAEob,GAAC,EAAE,EAAE;AACjD,MAAA,IAAMF,SAAQ,GAAGF,SAAS,CAACG,SAAS,CAACC,GAAC,CAAC;MACvC,IAAIF,SAAQ,CAACW,QAAQ,EAAE;QACnB5Z,EAAE,CAACgb,YAAY,CAACjC,SAAS,CAAC4B,SAAS,EAAE1B,SAAQ,CAACW,QAAQ,CAAC;AACvD5Z,QAAAA,EAAE,CAACya,YAAY,CAACxB,SAAQ,CAACW,QAAQ,CAAC;QAClCX,SAAQ,CAACW,QAAQ,GAAG,IAAI;AAC3B,MAAA;AACJ,IAAA;AACJ,EAAA;AAED,EAAA,IAAI5Z,EAAE,CAACib,mBAAmB,CAAClC,SAAS,CAAC4B,SAAS,EAAExa,cAAc,CAAC+a,WAAW,CAAC,EAAE;AACzEC,IAAAA,OAAO,CAAC,KAAK,EAAEpC,SAAS,CAACoB,IAAI,CAAC;AACjC,EAAA,CAAA,MAAM;AACHhS,IAAAA,OAAO,CAAC,KAAK,EAAE4Q,SAAS,CAACoB,IAAI,CAAC;IAC9BE,KAAK,CAACra,EAAE,CAACob,iBAAiB,CAACrC,SAAS,CAAC4B,SAAS,CAAC,CAAC;AAChD,IAAA;AACH,EAAA;AAGD,EAAA,IAAMU,iBAAyB,GAAGrb,EAAE,CAACib,mBAAmB,CAAClC,SAAS,CAAC4B,SAAS,EAAExa,cAAc,CAACmb,iBAAiB,CAAC;AAC/GvC,EAAAA,SAAS,CAACwC,QAAQ,GAAG,IAAI9d,KAAK,CAAiB4d,iBAAiB,CAAC;EAEjE,KAAK,IAAIvd,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGud,iBAAiB,EAAE,EAAEvd,CAAC,EAAE;IACxC,IAAM0d,UAAU,GAAGxb,EAAE,CAACyb,eAAe,CAAC1C,SAAS,CAAC4B,SAAS,EAAE7c,CAAC,CAAC;AAC7D,IAAA,IAAI0d,UAAU,EAAE;AACZ,MAAA,IAAcE,UAAU,GAAyCF,UAAU,CAAnEpd,IAAI;QAAoBud,UAAU,GAAuBH,UAAU,CAAjDrB,IAAI;QAAoByB,UAAU,GAAKJ,UAAU,CAA/BhL,IAAI;AAChD,MAAA,IAAIqL,OAAe,GAAA,MAAA;AACnB,MAAA,IAAMC,UAAU,GAAGH,UAAU,CAACI,OAAO,CAAC,GAAG,CAAC;AAC1C,MAAA,IAAID,UAAU,KAAK,EAAE,EAAE;QACnBD,OAAO,GAAGF,UAAU,CAACK,SAAS,CAAC,CAAC,EAAEF,UAAU,CAAC;AAChD,MAAA,CAAA,MAAM;AACHD,QAAAA,OAAO,GAAGF,UAAU;AACvB,MAAA;MAED,IAAMM,KAAK,GAAGjc,EAAE,CAACkc,iBAAiB,CAACnD,SAAS,CAAC4B,SAAS,EAAEkB,OAAO,CAAC;AAChE,MAAA,IAAMM,OAAO,GAAG3N,kBAAkB,CAACkN,UAAc,CAAC;AAClD,MAAA,IAAMU,MAAM,GAAG1N,gBAAgB,CAACgN,UAAc,CAAC;AAE/C3C,MAAAA,SAAS,CAACwC,QAAQ,CAACzd,CAAC,CAAC,GAAG;AACpBE,QAAAA,OAAO,EAAEie,KAAK;AACd9B,QAAAA,IAAI,EAAE0B,OAAO;AACbzd,QAAAA,IAAI,EAAE+d,OAAO;AACbC,QAAAA,MAAM,EAANA,MAAM;AACNle,QAAAA,KAAK,EAAE0d,UAAU;QACjBpL,IAAI,EAAE4L,MAAM,GAAGR,UAAU;AAEzBnN,QAAAA,MAAM,EAAEiN,UAAU;AAClBO,QAAAA,KAAK,EAALA;OACH;AACJ,IAAA;AACJ,EAAA;AAGD,EAAA,IAAIlD,SAAS,CAACsD,MAAM,CAACte,MAAM,GAAG,CAAC,EAAE;IAC7Bgb,SAAS,CAACuD,QAAQ,GAAG,IAAI7e,KAAK,CAAwBsb,SAAS,CAACsD,MAAM,CAACte,MAAM,CAAC;AAC9E,IAAA,KAAK,IAAID,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGib,SAAS,CAACsD,MAAM,CAACte,MAAM,EAAE,EAAED,GAAC,EAAE;AAC9C,MAAA,IAAMye,KAAK,GAAGxD,SAAS,CAACsD,MAAM,CAACve,GAAC,CAAC;AAEjC,MAAA,IAAM0e,OAA8B,GAAG;QACnCpK,GAAG,EAAEmK,KAAK,CAACnK,GAAG;QACdpU,OAAO,EAAEue,KAAK,CAACve,OAAO;QACtBmc,IAAI,EAAEoC,KAAK,CAACpC,IAAI;AAChB3J,QAAAA,IAAI,EAAE,CAAC;QACPiM,UAAU,EAAE,IAAIhf,KAAK,CAAmB8e,KAAK,CAACG,OAAO,CAAC3e,MAAM,CAAC;AAC7D4e,QAAAA,gBAAgB,EAAE;OACrB;AAED5D,MAAAA,SAAS,CAACuD,QAAQ,CAACxe,GAAC,CAAC,GAAG0e,OAAO;AAE/B,MAAA,KAAK,IAAII,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGL,KAAK,CAACG,OAAO,CAAC3e,MAAM,EAAE,EAAE6e,CAAC,EAAE;AAC3C,QAAA,IAAMC,OAAO,GAAGN,KAAK,CAACG,OAAO,CAACE,CAAC,CAAC;QAChC,IAAMnO,MAAM,GAAGpC,kBAAkB,CAACwQ,OAAO,CAACze,IAAQ,CAAC;AACnD,QAAA,IAAMge,OAAM,GAAG1N,gBAAgB,CAACD,MAAU,CAAC;AAC3C,QAAA,IAAM+B,IAAI,GAAG4L,OAAM,GAAGS,OAAO,CAAC3e,KAAK;AAEnCse,QAAAA,OAAO,CAACC,UAAU,CAACG,CAAC,CAAC,GAAG;UACpB5e,OAAO,EAAE,EAAE;UACXmc,IAAI,EAAE0C,OAAO,CAAC1C,IAAI;UAClB/b,IAAI,EAAEye,OAAO,CAACze,IAAI;AAClBge,UAAAA,MAAM,EAANA,OAAM;UACNle,KAAK,EAAE2e,OAAO,CAAC3e,KAAK;AACpBsS,UAAAA,IAAI,EAAJA,IAAI;AACJyB,UAAAA,MAAM,EAAE,CAAC;AAETxD,UAAAA,MAAM,EAANA,MAAM;AACNwN,UAAAA,KAAK,EAAE,IAAK;AACZa,UAAAA,KAAK,EAAE;SACV;AACJ,MAAA;AACJ,IAAA;AACJ,EAAA;AAGD,EAAA,KAAK,IAAIhf,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGib,SAAS,CAACgE,aAAa,CAAChf,MAAM,EAAE,EAAED,GAAC,EAAE;AACrD,IAAA,IAAMkf,YAAY,GAAGjE,SAAS,CAACgE,aAAa,CAACjf,GAAC,CAAC;AAC/Cib,IAAAA,SAAS,CAACkE,eAAe,CAACxe,IAAI,CAC1B,IAAIye,qBAAqB,CAACF,YAAY,CAAC5K,GAAG,EAAE4K,YAAY,CAAChf,OAAO,EAAEgf,YAAY,CAAC7C,IAAI,EAAE7N,IAAI,CAAC2B,SAAS,EAAE+O,YAAY,CAAC9e,KAAK,CAAC,CAC3H;AACJ,EAAA;AAGD,EAAA,IAAI6a,SAAS,CAACkE,eAAe,CAAClf,MAAM,GAAG,CAAC,EAAE;IACtCgb,SAAS,CAACoE,iBAAiB,GAAG,IAAI1f,KAAK,CAAiCsb,SAAS,CAACkE,eAAe,CAAClf,MAAM,CAAC;AAEzG,IAAA,KAAK,IAAID,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGib,SAAS,CAACkE,eAAe,CAAClf,MAAM,EAAE,EAAED,GAAC,EAAE;AACvD,MAAA,IAAMsf,OAAO,GAAGrE,SAAS,CAACkE,eAAe,CAACnf,GAAC,CAAC;AAC5Cib,MAAAA,SAAS,CAACoE,iBAAiB,CAACrf,GAAC,CAAC,GAAG;QAC7BsU,GAAG,EAAEgL,OAAO,CAAChL,GAAG;QAChBpU,OAAO,EAAEof,OAAO,CAACpf,OAAO;QACxBmc,IAAI,EAAEiD,OAAO,CAACjD,IAAI;QAClB/b,IAAI,EAAEgf,OAAO,CAAChf,IAAI;QAClBF,KAAK,EAAEkf,OAAO,CAAClf,KAAK;AACpBmf,QAAAA,KAAK,EAAE,EAAE;AACTC,QAAAA,OAAO,EAAE,IAAK;QACd7O,MAAM,EAAEpC,kBAAkB,CAAC+Q,OAAO,CAAChf,IAAQ,CAAC;AAC5C6d,QAAAA,KAAK,EAAE;OACV;AACJ,IAAA;AACJ,EAAA;AAGD,EAAA,IAAMsB,kBAAkB,GAAGvd,EAAE,CAACib,mBAAmB,CAAClC,SAAS,CAAC4B,SAAS,EAAExa,cAAc,CAACqd,eAAe,CAAC;EAEtG,KAAK,IAAI1f,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGyf,kBAAkB,EAAE,EAAEzf,GAAC,EAAE;IACzC,IAAM2f,WAAW,GAAGzd,EAAE,CAAC0d,gBAAgB,CAAC3E,SAAS,CAAC4B,SAAS,EAAE7c,GAAC,CAAC;AAC/D,IAAA,IAAI2f,WAAW,EAAE;AACb,MAAA,IAAME,SAAS,GAAIF,WAAW,CAACrf,IAAI,KAAK+B,cAAc,CAAC+N,UAAU,IACzDuP,WAAW,CAACrf,IAAI,KAAK+B,cAAc,CAACgO,YAAa;MAEzD,IAAI,CAACwP,SAAS,EAAE;AACZ,QAAA,IAAM1B,MAAK,GAAGjc,EAAE,CAAC4d,kBAAkB,CAAC7E,SAAS,CAAC4B,SAAS,EAAE8C,WAAW,CAACtD,IAAI,CAAC;QAC1E,IAAI1K,MAAM,CAACgB,UAAU,CAACoN,gBAAgB,CAAC5B,MAAK,CAAC,EAAE;AAC3C,UAAA,IAAIJ,QAAe,GAAA,MAAA;UACnB,IAAMC,WAAU,GAAG2B,WAAW,CAACtD,IAAI,CAAC4B,OAAO,CAAC,GAAG,CAAC;AAChD,UAAA,IAAID,WAAU,KAAK,EAAE,EAAE;YACnBD,QAAO,GAAG4B,WAAW,CAACtD,IAAI,CAAC6B,SAAS,CAAC,CAAC,EAAEF,WAAU,CAAC;AACtD,UAAA,CAAA,MAAM;YACHD,QAAO,GAAG4B,WAAW,CAACtD,IAAI;AAC7B,UAAA;AAGD,UAAA,KAAK,IAAIlc,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG8a,SAAS,CAACuD,QAAQ,CAACve,MAAM,EAAEE,CAAC,EAAE,EAAE;AAChD,YAAA,IAAMue,QAAO,GAAGzD,SAAS,CAACuD,QAAQ,CAACre,CAAC,CAAC;AAErC,YAAA,KAAK,IAAIkb,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGqD,QAAO,CAACC,UAAU,CAAC1e,MAAM,EAAEob,GAAC,EAAE,EAAE;AAChD,cAAA,IAAM2E,SAAS,GAAGtB,QAAO,CAACC,UAAU,CAACtD,GAAC,CAAC;AACvC,cAAA,IAAI2E,SAAS,CAAC3D,IAAI,KAAK0B,QAAO,EAAE;gBAC5BiC,SAAS,CAAC7B,KAAK,GAAGA,MAAK;AACvB6B,gBAAAA,SAAS,CAAC5f,KAAK,GAAGuf,WAAW,CAACjN,IAAI;gBAClCsN,SAAS,CAACtN,IAAI,GAAGsN,SAAS,CAAC1B,MAAM,GAAG0B,SAAS,CAAC5f,KAAK;AACnD4f,gBAAAA,SAAS,CAAChB,KAAK,GAAG,KAAKzO,uBAAuB,CAACyP,SAAS,CAAC1f,IAAI,CAAC,EAAE0f,SAAS,CAACtN,IAAI,GAAG,CAAC,CAAC;AAEnFgM,gBAAAA,QAAO,CAACG,gBAAgB,CAACle,IAAI,CAACqf,SAAS,CAAC;AACxC,gBAAA;AACH,cAAA;AACJ,YAAA;AACJ,UAAA;AACJ,QAAA;AACJ,MAAA;AACJ,IAAA;AACJ,EAAA;AAKD,EAAA,KAAK,IAAI7f,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAG8a,SAAS,CAACuD,QAAQ,CAACve,MAAM,EAAEE,EAAC,EAAE,EAAE;AAChD,IAAA,IAAMue,SAAO,GAAGzD,SAAS,CAACuD,QAAQ,CAACre,EAAC,CAAC;AACrC,IAAA,KAAK,IAAIkb,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGqD,SAAO,CAACC,UAAU,CAAC1e,MAAM,EAAEob,GAAC,EAAE,EAAE;AAChD,MAAA,IAAM2E,UAAS,GAAGtB,SAAO,CAACC,UAAU,CAACtD,GAAC,CAAC;AACvC2E,MAAAA,UAAS,CAAC7L,MAAM,GAAGuK,SAAO,CAAChM,IAAI,GAAG,CAAC;AACnCgM,MAAAA,SAAO,CAAChM,IAAI,IAAIsN,UAAS,CAACtN,IAAI;AACjC,IAAA;AACJ,EAAA;EAGD,IAAMuN,gBAAkD,GAAG,EAAE;EAC7D,IAAMC,wBAAgD,GAAG,EAAE;AAC3D,EAAA,IAAQC,eAAe,GAAmBxO,MAAM,CAAxCwO,eAAe;IAAEpK,YAAY,GAAKpE,MAAM,CAAvBoE,YAAY;AACrC,EAAA,IAAQqK,eAAe,GAAKzO,MAAM,CAACC,UAAU,CAArCwO,eAAe;AACvB,EAAA,IAAQC,eAAe,GAAKtK,YAAY,CAAhCsK,eAAe;EAEvB,IAAI,EAAEC,QAAQ,CAACC,SAAS,IAAID,QAAQ,CAACC,SAAS,CAACC,kBAAkB,CAAC,EAAE;IAChE,IAAIC,qBAAqB,GAAG,CAAC;AAC7B,IAAA,KAAK,IAAIzgB,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGib,SAAS,CAACsD,MAAM,CAACte,MAAM,EAAE,EAAED,IAAC,EAAE;AAC9C,MAAA,IAAIib,SAAS,CAACsD,MAAM,CAACve,IAAC,CAAC,CAACsU,GAAG,KAAK6L,eAAe,CAACO,WAAW,EAAE;AACzDD,QAAAA,qBAAqB,EAAE;AAC1B,MAAA;AACJ,IAAA;IAED,IAAIE,WAAW,GAAG,CAAC;AACnB,IAAA,KAAK,IAAI3gB,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGib,SAAS,CAACkE,eAAe,CAAClf,MAAM,EAAE,EAAED,IAAC,EAAE;AACvD,MAAA,IAAMsf,QAAO,GAAGrE,SAAS,CAACkE,eAAe,CAACnf,IAAC,CAAC;AAC5C,MAAA,IAAMme,OAAK,GAAGjc,EAAE,CAAC4d,kBAAkB,CAAC7E,SAAS,CAAC4B,SAAS,EAAEyC,QAAO,CAACjD,IAAI,CAAC;MACtE,IAAI1K,MAAM,CAACgB,UAAU,CAACoN,gBAAgB,CAAC5B,OAAK,CAAC,EAAE;QAC3C8B,gBAAgB,CAACtf,IAAI,CAACsa,SAAS,CAACoE,iBAAiB,CAACrf,IAAC,CAAC,CAAC;AACrDkgB,QAAAA,wBAAwB,CAACvf,IAAI,CAACwd,OAAK,CAAC;AACvC,MAAA;MACD,IAAIiC,eAAe,CAACd,QAAO,CAACjD,IAAI,CAAC,KAAKuE,SAAS,EAAE;AAC7C,QAAA,IAAI1gB,OAAO,GAAGof,QAAO,CAACpf,OAAO,GAAGigB,eAAe,CAACU,qBAAqB,CAACvB,QAAO,CAAChL,GAAG,CAAC,GAAGqM,WAAW;AAChG,QAAA,IAAIrB,QAAO,CAAChL,GAAG,KAAK6L,eAAe,CAACO,WAAW,EAAE;AAAExgB,UAAAA,OAAO,IAAIugB,qBAAqB;AAAG,QAAA;QACtFL,eAAe,CAACd,QAAO,CAACjD,IAAI,CAAC,GAAGnc,OAAO,GAAGmgB,eAAe;AACzDM,QAAAA,WAAW,IAAIrB,QAAO,CAAClf,KAAK,GAAG,CAAC;AACnC,MAAA;AACJ,IAAA;AACJ,EAAA,CAAA,MAAM;AACH,IAAA,KAAK,IAAIJ,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGib,SAAS,CAACkE,eAAe,CAAClf,MAAM,EAAE,EAAED,IAAC,EAAE;AACvD,MAAA,IAAMsf,SAAO,GAAGrE,SAAS,CAACkE,eAAe,CAACnf,IAAC,CAAC;AAC5C,MAAA,IAAMme,OAAK,GAAGjc,EAAE,CAAC4d,kBAAkB,CAAC7E,SAAS,CAAC4B,SAAS,EAAEyC,SAAO,CAACjD,IAAI,CAAC;MACtE,IAAI1K,MAAM,CAACgB,UAAU,CAACoN,gBAAgB,CAAC5B,OAAK,CAAC,EAAE;QAC3C8B,gBAAgB,CAACtf,IAAI,CAACsa,SAAS,CAACoE,iBAAiB,CAACrf,IAAC,CAAC,CAAC;AACrDkgB,QAAAA,wBAAwB,CAACvf,IAAI,CAACwd,OAAK,CAAC;AACvC,MAAA;MACD,IAAIiC,eAAe,CAACd,SAAO,CAACjD,IAAI,CAAC,KAAKuE,SAAS,EAAE;QAC7CR,eAAe,CAACd,SAAO,CAACjD,IAAI,CAAC,GAAGiD,SAAO,CAACwB,SAAS,GAAGT,eAAe;AACtE,MAAA;AACJ,IAAA;AACJ,EAAA;EAED,IAAIJ,gBAAgB,CAAChgB,MAAM,EAAE;IACzB,IAAM8gB,YAAuB,GAAG,EAAE;AAElC,IAAA,KAAK,IAAI/gB,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGigB,gBAAgB,CAAChgB,MAAM,EAAE,EAAED,IAAC,EAAE;AAC9C,MAAA,IAAMghB,SAAS,GAAGf,gBAAgB,CAACjgB,IAAC,CAAC;AAErC,MAAA,IAAIihB,UAAU,GAAGb,eAAe,CAACY,SAAS,CAAC3E,IAAI,CAAC;MAChD,IAAI4E,UAAU,KAAKL,SAAS,EAAE;AAC1BI,QAAAA,SAAS,CAAC7C,KAAK,GAAG+B,wBAAwB,CAAClgB,IAAC,CAAC;AAC7C,QAAA,KAAK,IAAIkhB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,SAAS,CAAC5gB,KAAK,EAAE,EAAE8gB,CAAC,EAAE;AACtC,UAAA,OAAOH,YAAY,CAACE,UAAU,CAAC,EAAE;AAC7BA,YAAAA,UAAU,GAAG,CAACA,UAAU,GAAG,CAAC,IAAIZ,eAAe;AAClD,UAAA;AACDW,UAAAA,SAAS,CAACzB,KAAK,CAAC5e,IAAI,CAACsgB,UAAU,CAAC;AAChCF,UAAAA,YAAY,CAACE,UAAU,CAAC,GAAG,IAAI;AAClC,QAAA;AACJ,MAAA;AACJ,IAAA;IAED,IAAIE,OAAO,GAAG,CAAC;AACf,IAAA,KAAK,IAAInhB,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGigB,gBAAgB,CAAChgB,MAAM,EAAE,EAAED,IAAC,EAAE;AAC9C,MAAA,IAAMghB,UAAS,GAAGf,gBAAgB,CAACjgB,IAAC,CAAC;MAErC,IAAI,CAAC2R,MAAM,CAACgB,UAAU,CAACoN,gBAAgB,CAACiB,UAAS,CAAC7C,KAAK,CAAC,EAAE;AACtD6C,QAAAA,UAAS,CAAC7C,KAAK,GAAG+B,wBAAwB,CAAClgB,IAAC,CAAC;AAC7C,QAAA,KAAK,IAAIkhB,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGF,UAAS,CAAC5gB,KAAK,EAAE,EAAE8gB,EAAC,EAAE;AACtC,UAAA,OAAOH,YAAY,CAACI,OAAO,CAAC,EAAE;AAC1BA,YAAAA,OAAO,GAAG,CAACA,OAAO,GAAG,CAAC,IAAId,eAAe;AAC5C,UAAA;UACD,IAAID,eAAe,CAACY,UAAS,CAAC3E,IAAI,CAAC,KAAKuE,SAAS,EAAE;AAC/CR,YAAAA,eAAe,CAACY,UAAS,CAAC3E,IAAI,CAAC,GAAG8E,OAAO;AAC5C,UAAA;AACDH,UAAAA,UAAS,CAACzB,KAAK,CAAC5e,IAAI,CAACwgB,OAAO,CAAC;AAC7BJ,UAAAA,YAAY,CAACI,OAAO,CAAC,GAAG,IAAI;AAC/B,QAAA;AACJ,MAAA;AACJ,IAAA;AAED,IAAA,IAAIvP,UAAU,CAACiL,SAAS,KAAK5B,SAAS,CAAC4B,SAAS,EAAE;AAC9C3a,MAAAA,EAAE,CAACkf,UAAU,CAACnG,SAAS,CAAC4B,SAAS,CAAC;AACrC,IAAA;AAED,IAAA,KAAK,IAAI7c,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGigB,gBAAgB,CAAChgB,MAAM,EAAED,IAAC,EAAE,EAAE;AAC9C,MAAA,IAAMghB,WAAS,GAAGf,gBAAgB,CAACjgB,IAAC,CAAC;MACrCghB,WAAS,CAACxB,OAAO,GAAG,IAAIhP,UAAU,CAACwQ,WAAS,CAACzB,KAAK,CAAC;MACnDrd,EAAE,CAACmf,UAAU,CAACL,WAAS,CAAC7C,KAAK,EAAE6C,WAAS,CAACxB,OAAO,CAAC;AACpD,IAAA;AAED,IAAA,IAAI5N,UAAU,CAACiL,SAAS,KAAK5B,SAAS,CAAC4B,SAAS,EAAE;AAC9C3a,MAAAA,EAAE,CAACkf,UAAU,CAACxP,UAAU,CAACiL,SAAS,CAAC;AACtC,IAAA;AACJ,EAAA;AAGD,EAAA,KAAK,IAAI7c,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGib,SAAS,CAACuD,QAAQ,CAACve,MAAM,GAAG;IAC5C,IAAIgb,SAAS,CAACuD,QAAQ,CAACxe,IAAC,CAAC,CAAC6e,gBAAgB,CAAC5e,MAAM,EAAE;AAC/CD,MAAAA,IAAC,EAAE;AACN,IAAA,CAAA,MAAM;AACHib,MAAAA,SAAS,CAACuD,QAAQ,CAACxe,IAAC,CAAC,GAAGib,SAAS,CAACuD,QAAQ,CAACvD,SAAS,CAACuD,QAAQ,CAACve,MAAM,GAAG,CAAC,CAAC;AACzEgb,MAAAA,SAAS,CAACuD,QAAQ,CAACve,MAAM,EAAE;AAC9B,IAAA;AACJ,EAAA;EAEDgb,SAAS,CAACoE,iBAAiB,GAAGY,gBAAgB;AAClD;AAEM,SAAUqB,yBAAyBA,CAAE3P,MAAmB,EAAEsJ,SAA0B,EAAO;EAC7F,IAAIA,SAAS,CAAC4B,SAAS,EAAE;AACrB,IAAA,IAAQ3a,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;MAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;AACtB,IAAA,IAAI,CAACD,MAAM,CAACgB,UAAU,CAACsK,yBAAyB,EAAE;AAC9C,MAAA,KAAK,IAAI5B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,SAAS,CAACG,SAAS,CAACnb,MAAM,EAAEob,CAAC,EAAE,EAAE;AACjD,QAAA,IAAMF,QAAQ,GAAGF,SAAS,CAACG,SAAS,CAACC,CAAC,CAAC;QACvC,IAAIF,QAAQ,CAACW,QAAQ,EAAE;UACnB5Z,EAAE,CAACgb,YAAY,CAACjC,SAAS,CAAC4B,SAAS,EAAE1B,QAAQ,CAACW,QAAQ,CAAC;AACvD5Z,UAAAA,EAAE,CAACya,YAAY,CAACxB,QAAQ,CAACW,QAAQ,CAAC;UAClCX,QAAQ,CAACW,QAAQ,GAAG,IAAI;AAC3B,QAAA;AACJ,MAAA;AACJ,IAAA;AACD5Z,IAAAA,EAAE,CAACqf,aAAa,CAACtG,SAAS,CAAC4B,SAAS,CAAC;AACrC,IAAA,IAAIjL,UAAU,CAACiL,SAAS,KAAK5B,SAAS,CAAC4B,SAAS,EAAE;AAC9C3a,MAAAA,EAAE,CAACkf,UAAU,CAAC,IAAI,CAAC;MACnBxP,UAAU,CAACiL,SAAS,GAAG,IAAI;AAC9B,IAAA;IACD5B,SAAS,CAAC4B,SAAS,GAAG,IAAI;AAC7B,EAAA;AACL;AAEM,SAAU2E,+BAA+BA,CAAE7P,MAAmB,EAAEsB,iBAA0C,EAAO;AACnH,EAAetB,MAAM,CAAbzP;EAER+Q,iBAAiB,CAACwO,SAAS,GAAG,IAAI9hB,KAAK,CAAesT,iBAAiB,CAACyO,UAAU,CAACzhB,MAAM,CAAC;AAE1F,EAAA,IAAM0hB,OAAO,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAExC,EAAA,KAAK,IAAI3hB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGiT,iBAAiB,CAACyO,UAAU,CAACzhB,MAAM,EAAE,EAAED,CAAC,EAAE;AAC1D,IAAA,IAAM4hB,MAAM,GAAG3O,iBAAiB,CAACyO,UAAU,CAAC1hB,CAAC,CAAC;AAC9C,IAAA,IAAgB6hB,YAAY,GAAuED,MAAM,CAAjG3f,MAAM;MAA8B6f,kBAAkB,GAAqCF,MAAM,CAA3EG,YAAY;MAAmCC,iBAAiB,GAAKJ,MAAM,CAAzCK,WAAW;AAE3E,IAAA,IAAMC,MAAM,GAAGN,MAAM,CAACM,MAAM,KAAKtB,SAAS,GAAGgB,MAAM,CAACM,MAAM,GAAG,CAAC;AAE9D,IAAA,IAAM1hB,SAAS,GAAGyS,iBAAiB,CAACkP,gBAAgB,CAACD,MAAM,CAAC;AAE5D,IAAA,IAAMvR,MAAM,GAAG3O,oBAAoB,CAAC6f,YAAgB,CAAC;AACrD,IAAA,IAAQnP,IAAI,GAAK0D,WAAW,CAACyL,YAAY,CAAC,CAAlCnP,IAAI;AAEZO,IAAAA,iBAAiB,CAACwO,SAAS,CAACzhB,CAAC,CAAC,GAAG;MAC7Bqc,IAAI,EAAEuF,MAAM,CAACvF,IAAI;MACjB7J,QAAQ,EAAEhS,SAAS,CAACgS,QAAQ;AAC5B7B,MAAAA,MAAM,EAANA,MAAM;AACN+B,MAAAA,IAAI,EAAJA,IAAI;AACJtS,MAAAA,KAAK,EAAEgW,WAAW,CAACyL,YAAY,CAAC,CAACzhB,KAAK;MACtCke,MAAM,EAAE9d,SAAS,CAAC8d,MAAM;AACxB8D,MAAAA,cAAc,EAAEvR,sBAAsB,CAACF,MAAU,CAAC;AAClDoR,MAAAA,YAAY,EAAGD,kBAAkB,KAAKlB,SAAS,GAAGkB,kBAAkB,GAAG,KAAM;AAC7EG,MAAAA,WAAW,EAAGD,iBAAiB,KAAKpB,SAAS,GAAGoB,iBAAiB,GAAG,KAAM;MAC1E7N,MAAM,EAAEwN,OAAO,CAACO,MAAM;KACzB;AAEDP,IAAAA,OAAO,CAACO,MAAM,CAAC,IAAIxP,IAAI;AAC1B,EAAA;AACL;AAEM,SAAU2P,iCAAiCA,CAAE1Q,MAAmB,EAAEsB,iBAA0C,EAAO;AACrH,EAAA,IAAQrB,UAAU,GAAKD,MAAM,CAArBC,UAAU;EAClB,IAAM0Q,EAAE,GAAGrP,iBAAiB,CAACsP,MAAM,CAACC,MAAM,EAAE;AAC5C,EAAA,IAAIC,GAAG,GAAGH,EAAE,CAACI,IAAI,EAAE;AACnB,EAAA,IAAM5P,uBAAuB,GAAGnB,MAAM,CAACgB,UAAU,CAACG,uBAAwB;AAC1E,EAAA,IAAID,KAAK,GAAGjB,UAAU,CAACiB,KAAK;AAC5B,EAAA,OAAO,CAAC4P,GAAG,CAACE,IAAI,EAAE;AACd7P,IAAAA,uBAAuB,CAAC8P,oBAAoB,CAACH,GAAG,CAACI,KAAK,CAAC;AACvD,IAAA,IAAIhQ,KAAK,KAAK4P,GAAG,CAACI,KAAK,EAAE;AACrB/P,MAAAA,uBAAuB,CAACC,kBAAkB,CAAC,IAAI,CAAC;AAChDF,MAAAA,KAAK,GAAG,IAAI;AACf,IAAA;AACD4P,IAAAA,GAAG,GAAGH,EAAE,CAACI,IAAI,EAAE;AAClB,EAAA;EACD9Q,UAAU,CAACiB,KAAK,GAAGA,KAAK;AACxBI,EAAAA,iBAAiB,CAACsP,MAAM,CAACO,KAAK,EAAE;AACpC;AAOA,IAAM9P,aAA+B,GAAG;AACpC+P,EAAAA,gBAAgB,EAAE,IAAI;AACtB9P,EAAAA,iBAAiB,EAAE,IAAI;AACvB+P,EAAAA,WAAW,EAAE;CAChB;AAED,IAAMC,cAAc,GAAG,IAAIC,IAAI,EAAE;SACjBC,2BAA2BA,CACvCxR,MAAmB,EACnByR,aAAyC,EACzClK,cAA2C,EAC3CmK,UAA0B,EAC1BC,WAA8B,EAC9BC,UAAkB,EAClBC,YAAoB,EACjB;AACH,EAAA,IAAQthB,EAAE,GAAKyP,MAAM,CAAbzP,EAAE;AACV,EAAA,IAAM6R,KAAK,GAAGpC,MAAM,CAACC,UAAU;EAC/B,IAAI6R,MAAkB,GAAG,CAAC;AAE1B,EAAA,IAAIvK,cAAc,EAAE;AAChB,IAAA,IAAMwK,QAAQ,GAAGxK,cAAc,CAACwK,QAAQ;AACxCT,IAAAA,cAAc,CAACU,CAAC,GAAGN,UAAU,CAACM,CAAC,IAAID,QAAQ;AAC3CT,IAAAA,cAAc,CAACW,CAAC,GAAGP,UAAU,CAACO,CAAC,IAAIF,QAAQ;AAC3CT,IAAAA,cAAc,CAACzN,KAAK,GAAG6N,UAAU,CAAC7N,KAAK,IAAIkO,QAAQ;AACnDT,IAAAA,cAAc,CAACvN,MAAM,GAAG2N,UAAU,CAAC3N,MAAM,IAAIgO,QAAQ;AACxD,EAAA;EAED,IAAIxK,cAAc,IAAIkK,aAAa,EAAE;AACjC,IAAA,IAAMS,iBAAiB,GAAG3K,cAAc,CAACM,aAAa;AACtD,IAAA,IAAWsK,eAAe,GAAmFb,cAAc,CAAnHU,CAAC;MAAsBI,eAAe,GAA+Dd,cAAc,CAA/FW,CAAC;MAA0BI,mBAAmB,GAAmCf,cAAc,CAA3EzN,KAAK;MAA+ByO,oBAAoB,GAAKhB,cAAc,CAA/CvN,MAAM;AAClF,IAAA,IAAI3B,KAAK,CAACyF,aAAa,KAAKqK,iBAAiB,EAAE;MAC3C3hB,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAEkK,iBAAiB,CAAC;MACjE9P,KAAK,CAACyF,aAAa,GAAGqK,iBAAiB;AAC1C,IAAA;AAED,IAAA,IAAMK,aAAa,GAAGnQ,KAAK,CAACoQ,QAAQ;IACpC,IAAID,aAAa,CAACE,IAAI,KAAKN,eAAe,IACnCI,aAAa,CAACG,GAAG,KAAKN,eAAe,IACrCG,aAAa,CAAC1O,KAAK,KAAKwO,mBAAmB,IAC3CE,aAAa,CAACxO,MAAM,KAAKuO,oBAAoB,EAAE;MAClD/hB,EAAE,CAACiiB,QAAQ,CAACL,eAAe,EAAEC,eAAe,EAAEC,mBAAmB,EAAEC,oBAAoB,CAAC;MAExFC,aAAa,CAACE,IAAI,GAAGN,eAAe;MACpCI,aAAa,CAACG,GAAG,GAAGN,eAAe;MACnCG,aAAa,CAAC1O,KAAK,GAAGwO,mBAAmB;MACzCE,aAAa,CAACxO,MAAM,GAAGuO,oBAAoB;AAC9C,IAAA;AAED,IAAA,IAAMK,gBAAgB,GAAGvQ,KAAK,CAACwQ,WAAW;IAC1C,IAAID,gBAAgB,CAACX,CAAC,KAAKG,eAAe,IACnCQ,gBAAgB,CAACV,CAAC,KAAKG,eAAe,IACtCO,gBAAgB,CAAC9O,KAAK,KAAKwO,mBAAmB,IAC9CM,gBAAgB,CAAC5O,MAAM,KAAKuO,oBAAoB,EAAE;MACrD/hB,EAAE,CAACsiB,OAAO,CAACV,eAAe,EAAEC,eAAe,EAAEC,mBAAmB,EAAEC,oBAAoB,CAAC;MAEvFK,gBAAgB,CAACX,CAAC,GAAGG,eAAe;MACpCQ,gBAAgB,CAACV,CAAC,GAAGG,eAAe;MACpCO,gBAAgB,CAAC9O,KAAK,GAAGwO,mBAAmB;MAC5CM,gBAAgB,CAAC5O,MAAM,GAAGuO,oBAAoB;AACjD,IAAA;AAGD,IAAA,IAAIQ,UAAU,GAAGnB,WAAW,CAACrjB,MAAM;AAEnC,IAAA,IAAI,CAAC0R,MAAM,CAACgB,UAAU,CAAC0H,kBAAkB,EAAE;AACvCoK,MAAAA,UAAU,GAAG,CAAC;AACjB,IAAA;AAED,IAAA,IAAMC,QAAQ,GAAG3Q,KAAK,CAAC4Q,GAAG;IAE1B,KAAK,IAAIxkB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGskB,UAAU,EAAE,EAAEtkB,CAAC,EAAE;AACjC,MAAA,IAAMykB,eAAe,GAAGxB,aAAa,CAACyB,gBAAgB,CAAC1kB,CAAC,CAAC;AAEzD,MAAA,IAAIykB,eAAe,CAAC3iB,MAAM,KAAKE,MAAM,CAACmO,OAAO,EAAE;QAC3C,QAAQsU,eAAe,CAACE,MAAM;UAC9B,KAAKC,MAAM,CAACC,IAAI;AAAE,YAAA;UAClB,KAAKD,MAAM,CAACE,KAAK;AAAE,YAAA;AACf,cAAA,IAAIlR,KAAK,CAACmR,EAAE,CAACC,OAAO,CAAC,CAAC,CAAC,CAACC,cAAc,KAAKC,SAAS,CAACC,GAAG,EAAE;gBACtDpjB,EAAE,CAACqjB,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;AACvC,cAAA;AAED,cAAA,IAAMC,UAAU,GAAGlC,WAAW,CAAC,CAAC,CAAC;AACjCphB,cAAAA,EAAE,CAACsjB,UAAU,CAACA,UAAU,CAAC7B,CAAC,EAAE6B,UAAU,CAAC5B,CAAC,EAAE4B,UAAU,CAACC,CAAC,EAAED,UAAU,CAACjQ,CAAC,CAAC;cACrEkO,MAAM,IAAIphB,cAAc,CAACqjB,gBAAgB;AACzC,cAAA;AACH,YAAA;UACD,KAAKX,MAAM,CAACY,OAAO;AAAE,YAAA;AAGjB,cAAA;AACH,YAAA;AAEA;AACJ,MAAA;AACJ,IAAA;IAED,IAAIvC,aAAa,CAACwC,sBAAsB,EAAE;MACtC,IAAIxC,aAAa,CAACwC,sBAAsB,CAAC3jB,MAAM,KAAKE,MAAM,CAACmO,OAAO,EAAE;AAChE,QAAA,QAAQ8S,aAAa,CAACwC,sBAAsB,CAACC,WAAW;UACxD,KAAKd,MAAM,CAACC,IAAI;AAAE,YAAA;UAClB,KAAKD,MAAM,CAACE,KAAK;AAAE,YAAA;AACf,cAAA,IAAI,CAACP,QAAQ,CAACoB,UAAU,EAAE;AACtB5jB,gBAAAA,EAAE,CAAC6jB,SAAS,CAAC,IAAI,CAAC;AACrB,cAAA;AAED7jB,cAAAA,EAAE,CAACqhB,UAAU,CAACA,UAAU,CAAC;cAEzBE,MAAM,IAAIphB,cAAc,CAAC2jB,gBAAgB;AACzC,cAAA;AACH,YAAA;UACD,KAAKjB,MAAM,CAACY,OAAO;AAAE,YAAA;AAGjB,cAAA;AACH,YAAA;AAEA;QAED,IAAIvP,WAAW,CAACgN,aAAa,CAACwC,sBAAsB,CAAC3jB,MAAM,CAAC,CAACiY,UAAU,EAAE;AACrE,UAAA,QAAQkJ,aAAa,CAACwC,sBAAsB,CAACK,aAAa;YAC1D,KAAKlB,MAAM,CAACC,IAAI;AAAE,cAAA;YAClB,KAAKD,MAAM,CAACE,KAAK;AAAE,cAAA;AACf,gBAAA,IAAI,CAACP,QAAQ,CAACwB,qBAAqB,EAAE;kBACjChkB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAAC+jB,KAAK,EAAE,MAAM,CAAC;AACvD,gBAAA;AAED,gBAAA,IAAI,CAAC1B,QAAQ,CAAC2B,oBAAoB,EAAE;kBAChCnkB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAACikB,IAAI,EAAE,MAAM,CAAC;AACtD,gBAAA;AAEDpkB,gBAAAA,EAAE,CAACshB,YAAY,CAACA,YAAY,CAAC;gBAC7BC,MAAM,IAAIphB,cAAc,CAACkkB,kBAAkB;AAC3C,gBAAA;AACH,cAAA;YACD,KAAKxB,MAAM,CAACY,OAAO;AAAE,cAAA;AAGjB,gBAAA;AACH,cAAA;AAEA;AACJ,QAAA;AACJ,MAAA;AACJ,IAAA;AAQD,IAAA,IAAIlC,MAAM,EAAE;AACRvhB,MAAAA,EAAE,CAAC4gB,KAAK,CAACW,MAAM,CAAC;AACnB,IAAA;AAGD,IAAA,IAAIA,MAAM,GAAGphB,cAAc,CAACqjB,gBAAgB,EAAE;MAC1C,IAAMH,SAAS,GAAGxR,KAAK,CAACmR,EAAE,CAACC,OAAO,CAAC,CAAC,CAAC,CAACC,cAAc;AACpD,MAAA,IAAIG,SAAS,KAAKF,SAAS,CAACC,GAAG,EAAE;QAC7B,IAAMkB,CAAC,GAAG,CAACjB,SAAS,GAAGF,SAAS,CAACoB,CAAC,MAAMpB,SAAS,CAAC5R,IAAI;QACtD,IAAMiT,CAAC,GAAG,CAACnB,SAAS,GAAGF,SAAS,CAACsB,CAAC,MAAMtB,SAAS,CAAC5R,IAAI;QACtD,IAAMmT,CAAC,GAAG,CAACrB,SAAS,GAAGF,SAAS,CAACwB,CAAC,MAAMxB,SAAS,CAAC5R,IAAI;QACtD,IAAMqT,CAAC,GAAG,CAACvB,SAAS,GAAGF,SAAS,CAAC0B,CAAC,MAAM1B,SAAS,CAAC5R,IAAI;QACtDvR,EAAE,CAACqjB,SAAS,CAACiB,CAAC,EAAEE,CAAC,EAAEE,CAAC,EAAEE,CAAC,CAAC;AAC3B,MAAA;AACJ,IAAA;IAED,IAAKrD,MAAM,GAAGphB,cAAc,CAAC2jB,gBAAgB,IACtC,CAACtB,QAAQ,CAACoB,UAAU,EAAE;AACzB5jB,MAAAA,EAAE,CAAC6jB,SAAS,CAAC,KAAK,CAAC;AACtB,IAAA;AAED,IAAA,IAAItC,MAAM,GAAGphB,cAAc,CAACkkB,kBAAkB,EAAE;AAC5C,MAAA,IAAI,CAAC7B,QAAQ,CAACwB,qBAAqB,EAAE;QACjChkB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAAC+jB,KAAK,EAAE,CAAC,CAAC;AAClD,MAAA;AAED,MAAA,IAAI,CAAC1B,QAAQ,CAAC2B,oBAAoB,EAAE;QAChCnkB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAACikB,IAAI,EAAE,CAAC,CAAC;AACjD,MAAA;AACJ,IAAA;AACJ,EAAA;AACL;SAEgBU,sBAAsBA,CAClCrV,MAAmB,EACnBoR,gBAA+C,EAC/C9P,iBAAiD,EACjDgU,iBAAqD,EACrDC,cAAkC,EAClCC,aAAsC,EACnC;AACH,EAAA,IAAQjlB,EAAE,GAAKyP,MAAM,CAAbzP,EAAE;AACV,EAAA,IAAM6R,KAAK,GAAGpC,MAAM,CAACC,UAAU;AAC/B,EAAA,IAAM8S,QAAQ,GAAG3Q,KAAK,CAAC4Q,GAAG;AAC1B,EAAA,IAAMyC,OAAO,GAAGrT,KAAK,CAACmR,EAAE;AACxB,EAAA,IAAMjK,SAAS,GAAG8H,gBAAgB,IAAIA,gBAAgB,CAAC9H,SAAS;EAEhE,IAAIoM,eAAe,GAAG,KAAK;AAC3B,EAAA,IAAI3P,OAAe;AACnB,EAAA,IAAIE,OAAe;AACnB,EAAA,IAAIE,WAAmB;AAGvB,EAAA,IAAIiL,gBAAgB,IAAI/P,aAAa,CAAC+P,gBAAgB,KAAKA,gBAAgB,EAAE;IACzE/P,aAAa,CAAC+P,gBAAgB,GAAGA,gBAAgB;AACjD/P,IAAAA,aAAa,CAACgQ,WAAW,GAAGD,gBAAgB,CAACC,WAAW;IAExD,IAAID,gBAAgB,CAAC9H,SAAS,EAAE;AAC5B,MAAA,IAAQ4B,SAAS,GAAKkG,gBAAgB,CAAC9H,SAAS,CAAxC4B,SAAS;AACjB,MAAA,IAAI9I,KAAK,CAAC8I,SAAS,KAAKA,SAAS,EAAE;AAC/B3a,QAAAA,EAAE,CAACkf,UAAU,CAACvE,SAAS,CAAC;QACxB9I,KAAK,CAAC8I,SAAS,GAAGA,SAAS;AAC3BwK,QAAAA,eAAe,GAAG,IAAI;AACzB,MAAA;AACJ,IAAA;AAGD,IAAA,IAAQC,EAAE,GAAKvE,gBAAgB,CAAvBuE,EAAE;AACV,IAAA,IAAMC,OAAO,GAAGxT,KAAK,CAACuT,EAAE;AACxB,IAAA,IAAIA,EAAE,EAAE;AACJ,MAAA,IAAIC,OAAO,CAACC,QAAQ,KAAKF,EAAE,CAACE,QAAQ,EAAE;QAClC,QAAQF,EAAE,CAACE,QAAQ;UACnB,KAAKC,QAAQ,CAAChU,IAAI;AAAE,YAAA;AAChBvR,cAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAACslB,SAAS,CAAC;AACpC,cAAA;AACH,YAAA;UACD,KAAKF,QAAQ,CAACrB,KAAK;AAAE,YAAA;AACjBlkB,cAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACslB,SAAS,CAAC;AACnCzlB,cAAAA,EAAE,CAAC2lB,QAAQ,CAACxlB,cAAc,CAAC+jB,KAAK,CAAC;AACjC,cAAA;AACH,YAAA;UACD,KAAKqB,QAAQ,CAACnB,IAAI;AAAE,YAAA;AAChBpkB,cAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACslB,SAAS,CAAC;AACnCzlB,cAAAA,EAAE,CAAC2lB,QAAQ,CAACxlB,cAAc,CAACikB,IAAI,CAAC;AAChC,cAAA;AACH,YAAA;AAEA;AAEDiB,QAAAA,OAAO,CAACC,QAAQ,GAAGF,EAAE,CAACE,QAAQ;AACjC,MAAA;AAED,MAAA,IAAMM,cAAc,GAAGR,EAAE,CAACQ,cAAc;AACxC,MAAA,IAAIP,OAAO,CAACO,cAAc,KAAKA,cAAc,EAAE;AAC3C5lB,QAAAA,EAAE,CAAC6lB,SAAS,CAACD,cAAc,GAAGzlB,cAAc,CAAC2lB,GAAG,GAAG3lB,cAAc,CAAC4lB,EAAE,CAAC;QACrEV,OAAO,CAACO,cAAc,GAAGA,cAAc;AAC1C,MAAA;AAED,MAAA,IAAKP,OAAO,CAACW,SAAS,KAAKZ,EAAE,CAACY,SAAS,IAC/BX,OAAO,CAACY,aAAa,KAAKb,EAAE,CAACa,aAAc,EAAE;QACjDjmB,EAAE,CAACkmB,aAAa,CAACd,EAAE,CAACY,SAAS,EAAEZ,EAAE,CAACa,aAAa,CAAC;AAChDZ,QAAAA,OAAO,CAACW,SAAS,GAAGZ,EAAE,CAACY,SAAS;AAChCX,QAAAA,OAAO,CAACY,aAAa,GAAGb,EAAE,CAACa,aAAa;AAC3C,MAAA;AAED,MAAA,IAAIZ,OAAO,CAACc,SAAS,KAAKf,EAAE,CAACe,SAAS,EAAE;AACpCnmB,QAAAA,EAAE,CAACmmB,SAAS,CAACf,EAAE,CAACe,SAAS,CAAC;AAC1Bd,QAAAA,OAAO,CAACc,SAAS,GAAGf,EAAE,CAACe,SAAS;AACnC,MAAA;AACJ,IAAA;AAGD,IAAA,IAAQ1D,GAAG,GAAK5B,gBAAgB,CAAxB4B,GAAG;AAEX,IAAA,IAAIA,GAAG,EAAE;AACL,MAAA,IAAID,QAAQ,CAAC4D,SAAS,KAAK3D,GAAG,CAAC2D,SAAS,EAAE;QACtC,IAAI3D,GAAG,CAAC2D,SAAS,EAAE;AACfpmB,UAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACkmB,UAAU,CAAC;AACvC,QAAA,CAAA,MAAM;AACHrmB,UAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAACkmB,UAAU,CAAC;AACxC,QAAA;AACD7D,QAAAA,QAAQ,CAAC4D,SAAS,GAAG3D,GAAG,CAAC2D,SAAS;AACrC,MAAA;AAED,MAAA,IAAI5D,QAAQ,CAACoB,UAAU,KAAKnB,GAAG,CAACmB,UAAU,EAAE;AACxC5jB,QAAAA,EAAE,CAAC6jB,SAAS,CAACpB,GAAG,CAACmB,UAAU,CAAC;AAC5BpB,QAAAA,QAAQ,CAACoB,UAAU,GAAGnB,GAAG,CAACmB,UAAU;AACvC,MAAA;AAED,MAAA,IAAIpB,QAAQ,CAAC8D,SAAS,KAAK7D,GAAG,CAAC6D,SAAS,EAAE;QACtCtmB,EAAE,CAACsmB,SAAS,CAAC1X,aAAa,CAAC6T,GAAG,CAAC6D,SAAS,CAAC,CAAC;AAC1C9D,QAAAA,QAAQ,CAAC8D,SAAS,GAAG7D,GAAG,CAAC6D,SAAS;AACrC,MAAA;AAGD,MAAA,IAAK9D,QAAQ,CAAC+D,gBAAgB,KAAK9D,GAAG,CAAC8D,gBAAgB,IAC/C/D,QAAQ,CAACgE,eAAe,KAAK/D,GAAG,CAAC+D,eAAgB,EAAE;AACvD,QAAA,IAAI/D,GAAG,CAAC8D,gBAAgB,IAAI9D,GAAG,CAAC+D,eAAe,EAAE;AAC7CxmB,UAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACsmB,YAAY,CAAC;AACzC,QAAA,CAAA,MAAM;AACHzmB,UAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAACsmB,YAAY,CAAC;AAC1C,QAAA;AACDjE,QAAAA,QAAQ,CAAC+D,gBAAgB,GAAG9D,GAAG,CAAC8D,gBAAgB;AAChD/D,QAAAA,QAAQ,CAACgE,eAAe,GAAG/D,GAAG,CAAC+D,eAAe;AACjD,MAAA;MAED,IAAKhE,QAAQ,CAACkE,gBAAgB,KAAKjE,GAAG,CAACiE,gBAAgB,IAC/ClE,QAAQ,CAACmE,eAAe,KAAKlE,GAAG,CAACkE,eAAgB,IACjDnE,QAAQ,CAACoE,oBAAoB,KAAKnE,GAAG,CAACmE,oBAAqB,EAAE;QACjE5mB,EAAE,CAAC6mB,mBAAmB,CAClB1mB,cAAc,CAAC+jB,KAAK,EACpBtV,aAAa,CAAC6T,GAAG,CAACiE,gBAAgB,CAAC,EACnCjE,GAAG,CAACkE,eAAe,EACnBlE,GAAG,CAACmE,oBAAoB,CAC3B;AAEDpE,QAAAA,QAAQ,CAACkE,gBAAgB,GAAGjE,GAAG,CAACiE,gBAAgB;AAChDlE,QAAAA,QAAQ,CAACmE,eAAe,GAAGlE,GAAG,CAACkE,eAAe;AAC9CnE,QAAAA,QAAQ,CAACoE,oBAAoB,GAAGnE,GAAG,CAACmE,oBAAoB;AAC3D,MAAA;MAED,IAAKpE,QAAQ,CAACsE,kBAAkB,KAAKrE,GAAG,CAACqE,kBAAkB,IACnDtE,QAAQ,CAACuE,mBAAmB,KAAKtE,GAAG,CAACsE,mBAAoB,IACzDvE,QAAQ,CAACwE,kBAAkB,KAAKvE,GAAG,CAACuE,kBAAmB,EAAE;QAC7DhnB,EAAE,CAACinB,iBAAiB,CAChB9mB,cAAc,CAAC+jB,KAAK,EACpB7U,eAAe,CAACoT,GAAG,CAACqE,kBAAkB,CAAC,EACvCzX,eAAe,CAACoT,GAAG,CAACsE,mBAAmB,CAAC,EACxC1X,eAAe,CAACoT,GAAG,CAACuE,kBAAkB,CAAC,CAC1C;AAEDxE,QAAAA,QAAQ,CAACsE,kBAAkB,GAAGrE,GAAG,CAACqE,kBAAkB;AACpDtE,QAAAA,QAAQ,CAACuE,mBAAmB,GAAGtE,GAAG,CAACsE,mBAAmB;AACtDvE,QAAAA,QAAQ,CAACwE,kBAAkB,GAAGvE,GAAG,CAACuE,kBAAkB;AACvD,MAAA;AAED,MAAA,IAAIxE,QAAQ,CAACwB,qBAAqB,KAAKvB,GAAG,CAACuB,qBAAqB,EAAE;QAC9DhkB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAAC+jB,KAAK,EAAEzB,GAAG,CAACuB,qBAAqB,CAAC;AACvExB,QAAAA,QAAQ,CAACwB,qBAAqB,GAAGvB,GAAG,CAACuB,qBAAqB;AAC7D,MAAA;MAGD,IAAKxB,QAAQ,CAAC0E,eAAe,KAAKzE,GAAG,CAACyE,eAAe,IAC7C1E,QAAQ,CAAC2E,cAAc,KAAK1E,GAAG,CAAC0E,cAAe,IAC/C3E,QAAQ,CAAC4E,mBAAmB,KAAK3E,GAAG,CAAC2E,mBAAoB,EAAE;QAC/DpnB,EAAE,CAAC6mB,mBAAmB,CAClB1mB,cAAc,CAACikB,IAAI,EACnBxV,aAAa,CAAC6T,GAAG,CAACyE,eAAe,CAAC,EAClCzE,GAAG,CAAC0E,cAAc,EAClB1E,GAAG,CAAC2E,mBAAmB,CAC1B;AAED5E,QAAAA,QAAQ,CAAC0E,eAAe,GAAGzE,GAAG,CAACyE,eAAe;AAC9C1E,QAAAA,QAAQ,CAAC2E,cAAc,GAAG1E,GAAG,CAAC0E,cAAc;AAC5C3E,QAAAA,QAAQ,CAAC4E,mBAAmB,GAAG3E,GAAG,CAAC2E,mBAAmB;AACzD,MAAA;MAED,IAAK5E,QAAQ,CAAC6E,iBAAiB,KAAK5E,GAAG,CAAC4E,iBAAiB,IACjD7E,QAAQ,CAAC8E,kBAAkB,KAAK7E,GAAG,CAAC6E,kBAAmB,IACvD9E,QAAQ,CAAC+E,iBAAiB,KAAK9E,GAAG,CAAC8E,iBAAkB,EAAE;QAC3DvnB,EAAE,CAACinB,iBAAiB,CAChB9mB,cAAc,CAACikB,IAAI,EACnB/U,eAAe,CAACoT,GAAG,CAAC4E,iBAAiB,CAAC,EACtChY,eAAe,CAACoT,GAAG,CAAC6E,kBAAkB,CAAC,EACvCjY,eAAe,CAACoT,GAAG,CAAC8E,iBAAiB,CAAC,CACzC;AAED/E,QAAAA,QAAQ,CAAC6E,iBAAiB,GAAG5E,GAAG,CAAC4E,iBAAiB;AAClD7E,QAAAA,QAAQ,CAAC8E,kBAAkB,GAAG7E,GAAG,CAAC6E,kBAAkB;AACpD9E,QAAAA,QAAQ,CAAC+E,iBAAiB,GAAG9E,GAAG,CAAC8E,iBAAiB;AACrD,MAAA;AAED,MAAA,IAAI/E,QAAQ,CAAC2B,oBAAoB,KAAK1B,GAAG,CAAC0B,oBAAoB,EAAE;QAC5DnkB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAACikB,IAAI,EAAE3B,GAAG,CAAC0B,oBAAoB,CAAC;AACrE3B,QAAAA,QAAQ,CAAC2B,oBAAoB,GAAG1B,GAAG,CAAC0B,oBAAoB;AAC3D,MAAA;AACJ,IAAA;AAGD,IAAA,IAAQnB,EAAE,GAAKnC,gBAAgB,CAAvBmC,EAAE;AAEV,IAAA,IAAIA,EAAE,EAAE;AACJ,MAAA,IAAIkC,OAAO,CAACsC,KAAK,KAAKxE,EAAE,CAACwE,KAAK,EAAE;QAC5B,IAAIxE,EAAE,CAACwE,KAAK,EAAE;AACVxnB,UAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACsnB,wBAAwB,CAAC;AACrD,QAAA,CAAA,MAAM;AACHznB,UAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAACsnB,wBAAwB,CAAC;AACtD,QAAA;AACDvC,QAAAA,OAAO,CAACsC,KAAK,GAAGxE,EAAE,CAACwE,KAAK;AAC3B,MAAA;MAED,IAAKtC,OAAO,CAACwC,UAAU,CAACjG,CAAC,KAAKuB,EAAE,CAAC0E,UAAU,CAACjG,CAAC,IACrCyD,OAAO,CAACwC,UAAU,CAAChG,CAAC,KAAKsB,EAAE,CAAC0E,UAAU,CAAChG,CAAE,IACzCwD,OAAO,CAACwC,UAAU,CAACnE,CAAC,KAAKP,EAAE,CAAC0E,UAAU,CAACnE,CAAE,IACzC2B,OAAO,CAACwC,UAAU,CAACrU,CAAC,KAAK2P,EAAE,CAAC0E,UAAU,CAACrU,CAAE,EAAE;QAC/CrT,EAAE,CAAC0nB,UAAU,CAAC1E,EAAE,CAAC0E,UAAU,CAACjG,CAAC,EAAEuB,EAAE,CAAC0E,UAAU,CAAChG,CAAC,EAAEsB,EAAE,CAAC0E,UAAU,CAACnE,CAAC,EAAEP,EAAE,CAAC0E,UAAU,CAACrU,CAAC,CAAC;QAEjF6R,OAAO,CAACwC,UAAU,CAACjG,CAAC,GAAGuB,EAAE,CAAC0E,UAAU,CAACjG,CAAC;QACtCyD,OAAO,CAACwC,UAAU,CAAChG,CAAC,GAAGsB,EAAE,CAAC0E,UAAU,CAAChG,CAAC;QACtCwD,OAAO,CAACwC,UAAU,CAACnE,CAAC,GAAGP,EAAE,CAAC0E,UAAU,CAACnE,CAAC;QACtC2B,OAAO,CAACwC,UAAU,CAACrU,CAAC,GAAG2P,EAAE,CAAC0E,UAAU,CAACrU,CAAC;AACzC,MAAA;AAED,MAAA,IAAMsU,OAAO,GAAG3E,EAAE,CAACC,OAAO,CAAC,CAAC,CAAC;AAC7B,MAAA,IAAM2E,YAAY,GAAG1C,OAAO,CAACjC,OAAO,CAAC,CAAC,CAAC;AAEvC,MAAA,IAAI2E,YAAY,CAACC,KAAK,KAAKF,OAAO,CAACE,KAAK,EAAE;QACtC,IAAIF,OAAO,CAACE,KAAK,EAAE;AACf7nB,UAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAAC2nB,KAAK,CAAC;AAClC,QAAA,CAAA,MAAM;AACH9nB,UAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAAC2nB,KAAK,CAAC;AACnC,QAAA;AACDF,QAAAA,YAAY,CAACC,KAAK,GAAGF,OAAO,CAACE,KAAK;AACrC,MAAA;AAED,MAAA,IAAKD,YAAY,CAACG,OAAO,KAAKJ,OAAO,CAACI,OAAO,IACrCH,YAAY,CAACI,YAAY,KAAKL,OAAO,CAACK,YAAa,EAAE;AACzDhoB,QAAAA,EAAE,CAACioB,qBAAqB,CAAC3Y,aAAa,CAACqY,OAAO,CAACI,OAAO,CAAC,EAAEzY,aAAa,CAACqY,OAAO,CAACK,YAAY,CAAC,CAAC;AAC7FJ,QAAAA,YAAY,CAACG,OAAO,GAAGJ,OAAO,CAACI,OAAO;AACtCH,QAAAA,YAAY,CAACI,YAAY,GAAGL,OAAO,CAACK,YAAY;AACnD,MAAA;AAED,MAAA,IAAKJ,YAAY,CAACM,QAAQ,KAAKP,OAAO,CAACO,QAAQ,IACvCN,YAAY,CAACO,QAAQ,KAAKR,OAAO,CAACQ,QAAS,IAC3CP,YAAY,CAACQ,aAAa,KAAKT,OAAO,CAACS,aAAc,IACrDR,YAAY,CAACS,aAAa,KAAKV,OAAO,CAACU,aAAc,EAAE;AAC3DroB,QAAAA,EAAE,CAACsoB,iBAAiB,CAChB/Y,iBAAiB,CAACoY,OAAO,CAACO,QAAQ,CAAC,EACnC3Y,iBAAiB,CAACoY,OAAO,CAACQ,QAAQ,CAAC,EACnC5Y,iBAAiB,CAACoY,OAAO,CAACS,aAAa,CAAC,EACxC7Y,iBAAiB,CAACoY,OAAO,CAACU,aAAa,CAAC,CAC3C;AAEDT,QAAAA,YAAY,CAACM,QAAQ,GAAGP,OAAO,CAACO,QAAQ;AACxCN,QAAAA,YAAY,CAACO,QAAQ,GAAGR,OAAO,CAACQ,QAAQ;AACxCP,QAAAA,YAAY,CAACQ,aAAa,GAAGT,OAAO,CAACS,aAAa;AAClDR,QAAAA,YAAY,CAACS,aAAa,GAAGV,OAAO,CAACU,aAAa;AACrD,MAAA;AAED,MAAA,IAAIT,YAAY,CAAC1E,cAAc,KAAKyE,OAAO,CAACzE,cAAc,EAAE;QACxDljB,EAAE,CAACqjB,SAAS,CACR,CAACsE,OAAO,CAACzE,cAAc,GAAGC,SAAS,CAACoB,CAAC,MAAMpB,SAAS,CAAC5R,IAAI,EACzD,CAACoW,OAAO,CAACzE,cAAc,GAAGC,SAAS,CAACsB,CAAC,MAAMtB,SAAS,CAAC5R,IAAI,EACzD,CAACoW,OAAO,CAACzE,cAAc,GAAGC,SAAS,CAACwB,CAAC,MAAMxB,SAAS,CAAC5R,IAAI,EACzD,CAACoW,OAAO,CAACzE,cAAc,GAAGC,SAAS,CAAC0B,CAAC,MAAM1B,SAAS,CAAC5R,IAAI,CAC5D;AAEDqW,QAAAA,YAAY,CAAC1E,cAAc,GAAGyE,OAAO,CAACzE,cAAc;AACvD,MAAA;AACJ,IAAA;AACJ,EAAA;AAGD,EAAA,IAAIrC,gBAAgB,IAAIA,gBAAgB,CAAC0H,iBAAiB,IAAIxP,SAAS,EAAE;AACrE,IAAA,IAAMyP,QAAQ,GAAGzP,SAAS,CAACuD,QAAQ,CAACve,MAAM;AAC1C,IAAA,IAAQ0qB,oBAAoB,GAAK5H,gBAAgB,CAAC0H,iBAAiB,CAA3DE,oBAAoB;IAE5B,KAAK,IAAIxqB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuqB,QAAQ,EAAEvqB,CAAC,EAAE,EAAE;AAC/B,MAAA,IAAMue,OAAO,GAAGzD,SAAS,CAACuD,QAAQ,CAACre,CAAC,CAAC;AACrC,MAAA,IAAMyqB,gBAAgB,GAAG3D,iBAAiB,CAACvI,OAAO,CAACpK,GAAG,CAAC;MACvD,IAAMuW,aAAa,GAAGD,gBAAgB,IAAIA,gBAAgB,CAACprB,iBAAiB,CAACkf,OAAO,CAACxe,OAAO,CAAC;MAC7F,IAAMG,aAAa,GAAGwqB,aAAa,IAAI,CAAC,IAAID,gBAAgB,CAAC7qB,cAAc,CAAC8qB,aAAa,CAAC;MAC1F,IAAInX,IAAyB,GAAG,IAAI;MAAE,IAAIS,MAAM,GAAG,CAAC;AAEpD,MAAA,IAAI9T,aAAa,IAAIA,aAAa,CAACG,SAAS,EAAE;AAC1C,QAAA,IAAQA,SAAS,GAAKH,aAAa,CAA3BG,SAAS;AACjB,QAAA,IAAMsqB,qBAAqB,GAAGH,oBAAoB,CAACjM,OAAO,CAACpK,GAAG,CAAC;QAC/D,IAAMyW,kBAAkB,GAAGD,qBAAqB,IAAIA,qBAAqB,CAACpM,OAAO,CAACxe,OAAO,CAAC;QAC1F,IAAI6qB,kBAAkB,IAAI,CAAC,EAAE;AAAE5W,UAAAA,MAAM,GAAG+S,cAAc,CAAC6D,kBAAkB,CAAC;AAAG,QAAA;QAE7E,IAAI,MAAM,IAAIvqB,SAAS,EAAE;UACrBkT,IAAI,GAAGlT,SAAS,CAACkT,IAAI;AACxB,QAAA,CAAA,MAAM;UACHS,MAAM,IAAI3T,SAAS,CAAC2T,MAAM;AAC1BT,UAAAA,IAAI,GAAGlT,SAAS,CAACA,SAAS,CAACkT,IAAI;AAClC,QAAA;AACDS,QAAAA,MAAM,KAAK,CAAC;AACf,MAAA;MAED,IAAI,CAACT,IAAI,EAAE;AAEP,QAAA;AACH,MAAA;AAED,MAAA,IAAMsX,UAAU,GAAGtM,OAAO,CAACG,gBAAgB,CAAC5e,MAAM;MAClD,KAAK,IAAIwc,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuO,UAAU,EAAEvO,CAAC,EAAE,EAAE;AACjC,QAAA,IAAMuD,SAAS,GAAGtB,OAAO,CAACG,gBAAgB,CAACpC,CAAC,CAAC;QAC7C,QAAQuD,SAAS,CAACrP,MAAM;UACxB,KAAKtO,cAAc,CAACoM,IAAI;UACxB,KAAKpM,cAAc,CAACiB,GAAG;AAAE,YAAA;AACrB,cAAA,KAAK,IAAIwb,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,CAAC,EAAE;gBAC7C,IAAMmM,GAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,CAAC;gBACzC,IAAIpL,IAAI,CAACuX,GAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,CAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,CAAC,GAAGpM,CAAC,EAAEqM,CAAC,GAAGF,GAAG,EAAEC,CAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,CAAC,EAAE,EAAEC,CAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,CAAC,CAAC,GAAGxX,IAAI,CAACyX,CAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACmf,UAAU,CAACrB,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAmB,CAAC;AAC7D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAACsM,SAAS;UAC7B,KAAKtM,cAAc,CAAC4M,QAAQ;AAAE,YAAA;AAC1B,cAAA,KAAK,IAAI6P,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,EAAC,EAAE;gBAC7C,IAAMmM,IAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,EAAC;gBACzC,IAAIpL,IAAI,CAACuX,IAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,EAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,EAAC,GAAGpM,EAAC,EAAEqM,EAAC,GAAGF,IAAG,EAAEC,EAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,EAAC,EAAE,EAAEC,EAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,EAAC,CAAC,GAAGxX,IAAI,CAACyX,EAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACkpB,UAAU,CAACpL,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAmB,CAAC;AAC7D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAACwM,SAAS;UAC7B,KAAKxM,cAAc,CAAC8M,QAAQ;AAAE,YAAA;AAC1B,cAAA,KAAK,IAAI2P,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACmpB,UAAU,CAACrL,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAmB,CAAC;AAC7D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAAC0M,SAAS;UAC7B,KAAK1M,cAAc,CAACgN,QAAQ;AAAE,YAAA;AAC1B,cAAA,KAAK,IAAIyP,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACopB,UAAU,CAACtL,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAmB,CAAC;AAC7D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAACa,KAAK;AAAE,YAAA;AACvB,cAAA,KAAK,IAAI4b,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACqpB,UAAU,CAACvL,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAqB,CAAC;AAC/D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAACmN,UAAU;AAAE,YAAA;AAC5B,cAAA,KAAK,IAAIsP,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACspB,UAAU,CAACxL,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAqB,CAAC;AAC/D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAACqN,UAAU;AAAE,YAAA;AAC5B,cAAA,KAAK,IAAIoP,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACupB,UAAU,CAACzL,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAqB,CAAC;AAC/D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAACuN,UAAU;AAAE,YAAA;AAC5B,cAAA,KAAK,IAAIkP,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;kBACDjpB,EAAE,CAACwpB,UAAU,CAAC1L,SAAS,CAAC7B,KAAK,EAAE6B,SAAS,CAAChB,KAAqB,CAAC;AAC/D,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAACyN,UAAU;AAAE,YAAA;AAC5B,cAAA,KAAK,IAAIgP,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;AACDjpB,kBAAAA,EAAE,CAACypB,gBAAgB,CAAC3L,SAAS,CAAC7B,KAAK,EAAE,KAAK,EAAE6B,SAAS,CAAChB,KAAqB,CAAC;AAC5E,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAAC2N,UAAU;AAAE,YAAA;AAC5B,cAAA,KAAK,IAAI8O,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;AACDjpB,kBAAAA,EAAE,CAAC0pB,gBAAgB,CAAC5L,SAAS,CAAC7B,KAAK,EAAE,KAAK,EAAE6B,SAAS,CAAChB,KAAqB,CAAC;AAC5E,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;UACD,KAAK3c,cAAc,CAAC6N,UAAU;AAAE,YAAA;AAC5B,cAAA,KAAK,IAAI4O,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkB,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAE6e,GAAC,EAAE;gBAC7C,IAAMmM,KAAG,GAAGjL,SAAS,CAAC7L,MAAM,GAAGA,MAAM,GAAG2K,GAAC;gBACzC,IAAIpL,IAAI,CAACuX,KAAG,CAAC,KAAKjL,SAAS,CAAChB,KAAK,CAACF,GAAC,CAAC,EAAE;kBAClC,KAAK,IAAIoM,GAAC,GAAGpM,GAAC,EAAEqM,GAAC,GAAGF,KAAG,EAAEC,GAAC,GAAGlL,SAAS,CAAChB,KAAK,CAAC/e,MAAM,EAAE,EAAEirB,GAAC,EAAE,EAAEC,GAAC,EAAE;oBAC3DnL,SAAS,CAAChB,KAAK,CAACkM,GAAC,CAAC,GAAGxX,IAAI,CAACyX,GAAC,CAAC;AAC/B,kBAAA;AACDjpB,kBAAAA,EAAE,CAAC2pB,gBAAgB,CAAC7L,SAAS,CAAC7B,KAAK,EAAE,KAAK,EAAE6B,SAAS,CAAChB,KAAqB,CAAC;AAC5E,kBAAA;AACH,gBAAA;AACJ,cAAA;AACD,cAAA;AACH,YAAA;AAEA;AACJ,MAAA;AACD,MAAA;AACH,IAAA;AAED,IAAA,IAAM8M,UAAU,GAAG7Q,SAAS,CAACoE,iBAAiB,CAACpf,MAAM;IACrD,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG8rB,UAAU,EAAE9rB,CAAC,EAAE,EAAE;AACjC,MAAA,IAAMghB,SAAS,GAAG/F,SAAS,CAACoE,iBAAiB,CAACrf,CAAC,CAAC;AAChD,MAAA,IAAM4qB,iBAAgB,GAAG3D,iBAAiB,CAACjG,SAAS,CAAC1M,GAAG,CAAC;MACzD,IAAIyX,eAAe,GAAGnB,iBAAgB,IAAIA,iBAAgB,CAACprB,iBAAiB,CAACwhB,SAAS,CAAC9gB,OAAO,CAAC;MAC/F,IAAIG,cAAa,GAAG0rB,eAAe,IAAI,CAAC,IAAInB,iBAAgB,CAAC7qB,cAAc,CAACgsB,eAAe,CAAC;AAE5F,MAAA,IAAMC,UAAU,GAAGhL,SAAS,CAACzB,KAAK,CAACtf,MAAM;MACzC,KAAK,IAAIwc,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGuP,UAAU,EAAEvP,EAAC,EAAE,EAAE;AACjC,QAAA,IAAM1F,OAAO,GAAGiK,SAAS,CAACzB,KAAK,CAAC9C,EAAC,CAAC;AAElC,QAAA,IAAI,CAACpc,cAAa,IAAI,CAACA,cAAa,CAACK,UAAU,EAAE;AAE7C,UAAA;AACH,QAAA;QAED,IAAIL,cAAa,CAACI,UAAU,IAAIJ,cAAa,CAACI,UAAU,CAACiS,IAAI,GAAG,CAAC,EAAE;UAC/D,IAAAuZ,eAAA,GAAuB5rB,cAAa;YAA5BI,UAAU,GAAAwrB,eAAA,CAAVxrB,UAAU;AAClB,UAAA,IAAMoW,SAAS,GAAG9C,KAAK,CAAC+C,UAAU,CAACC,OAAO,CAAC;AAE3C,UAAA,IAAIF,SAAS,CAACF,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;AAC9C,YAAA,IAAI5C,KAAK,CAACgD,OAAO,KAAKA,OAAO,EAAE;cAC3B7U,EAAE,CAAC2W,aAAa,CAACxW,cAAc,CAACyW,QAAQ,GAAG/B,OAAO,CAAC;cACnDhD,KAAK,CAACgD,OAAO,GAAGA,OAAO;AAC1B,YAAA;YACD,IAAItW,UAAU,CAACkW,SAAS,EAAE;cACtBzU,EAAE,CAAC8U,WAAW,CAACvW,UAAU,CAAC6R,QAAQ,EAAE7R,UAAU,CAACkW,SAAS,CAAC;AAC5D,YAAA,CAAA,MAAM;AACHzU,cAAAA,EAAE,CAAC8U,WAAW,CAACvW,UAAU,CAAC6R,QAAQ,EAAEX,MAAM,CAACua,SAAS,CAACzrB,UAAU,CAACkW,SAAS,CAAC;AAC7E,YAAA;AACDE,YAAAA,SAAS,CAACF,SAAS,GAAGlW,UAAU,CAACkW,SAAS;AAC7C,UAAA;UAED,IAAAwV,eAAA,GAAuB9rB,cAAa;YAA5BK,UAAU,GAAAyrB,eAAA,CAAVzrB,UAAU;UAClB,IAAID,UAAU,CAACgX,UAAU,EAAE;YACvBC,OAAO,GAAGhX,UAAU,CAACgX,OAAO;YAC5BE,OAAO,GAAGlX,UAAU,CAACkX,OAAO;AAC/B,UAAA,CAAA,MAAM;YACHF,OAAO,GAAGrV,cAAc,CAACwV,aAAa;YACtCD,OAAO,GAAGvV,cAAc,CAACwV,aAAa;AACzC,UAAA;UAED,IAAIpX,UAAU,CAACgX,UAAU,EAAE;YACvB,IAAIhX,UAAU,CAACyW,QAAQ,IAAI,CAAC,KACpBxW,UAAU,CAACoX,WAAW,KAAKzV,cAAc,CAAC+pB,qBAAqB,IAChE1rB,UAAU,CAACoX,WAAW,KAAKzV,cAAc,CAACgqB,oBAAoB,CAAC,EAAE;cACpEvU,WAAW,GAAGzV,cAAc,CAAC0V,MAAM;AACtC,YAAA,CAAA,MAAM;cACHD,WAAW,GAAGpX,UAAU,CAACoX,WAAW;AACvC,YAAA;UACJ,CAAA,MAAM,IAAIpX,UAAU,CAACoX,WAAW,KAAKzV,cAAc,CAAC0V,MAAM,IAChDrX,UAAU,CAACoX,WAAW,KAAKzV,cAAc,CAAC+pB,qBAAqB,IAC/D1rB,UAAU,CAACoX,WAAW,KAAKzV,cAAc,CAACgqB,oBAAoB,EAAE;YACvEvU,WAAW,GAAGzV,cAAc,CAAC0V,MAAM;AACtC,UAAA,CAAA,MAAM;YACHD,WAAW,GAAGzV,cAAc,CAACiqB,OAAO;AACvC,UAAA;AAED,UAAA,IAAI7rB,UAAU,CAACiX,OAAO,KAAKA,OAAO,EAAE;AAChC,YAAA,IAAI3D,KAAK,CAACgD,OAAO,KAAKA,OAAO,EAAE;cAC3B7U,EAAE,CAAC2W,aAAa,CAACxW,cAAc,CAACyW,QAAQ,GAAG/B,OAAO,CAAC;cACnDhD,KAAK,CAACgD,OAAO,GAAGA,OAAO;AAC1B,YAAA;AACD7U,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC6V,cAAc,EAAER,OAAO,CAAC;YAC7EjX,UAAU,CAACiX,OAAO,GAAGA,OAAO;AAC/B,UAAA;AAED,UAAA,IAAIjX,UAAU,CAACmX,OAAO,KAAKA,OAAO,EAAE;AAChC,YAAA,IAAI7D,KAAK,CAACgD,OAAO,KAAKA,OAAO,EAAE;cAC3B7U,EAAE,CAAC2W,aAAa,CAACxW,cAAc,CAACyW,QAAQ,GAAG/B,OAAO,CAAC;cACnDhD,KAAK,CAACgD,OAAO,GAAGA,OAAO;AAC1B,YAAA;AACD7U,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC8V,cAAc,EAAEP,OAAO,CAAC;YAC7EnX,UAAU,CAACmX,OAAO,GAAGA,OAAO;AAC/B,UAAA;AAED,UAAA,IAAInX,UAAU,CAACqX,WAAW,KAAKA,WAAW,EAAE;AACxC,YAAA,IAAI/D,KAAK,CAACgD,OAAO,KAAKA,OAAO,EAAE;cAC3B7U,EAAE,CAAC2W,aAAa,CAACxW,cAAc,CAACyW,QAAQ,GAAG/B,OAAO,CAAC;cACnDhD,KAAK,CAACgD,OAAO,GAAGA,OAAO;AAC1B,YAAA;AACD7U,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAAC+V,kBAAkB,EAAEN,WAAW,CAAC;YACrFrX,UAAU,CAACqX,WAAW,GAAGA,WAAW;AACvC,UAAA;AAED,UAAA,IAAIrX,UAAU,CAACuX,WAAW,KAAKtX,UAAU,CAACsX,WAAW,EAAE;AACnD,YAAA,IAAIjE,KAAK,CAACgD,OAAO,KAAKA,OAAO,EAAE;cAC3B7U,EAAE,CAAC2W,aAAa,CAACxW,cAAc,CAACyW,QAAQ,GAAG/B,OAAO,CAAC;cACnDhD,KAAK,CAACgD,OAAO,GAAGA,OAAO;AAC1B,YAAA;AACD7U,YAAAA,EAAE,CAAC+V,aAAa,CAACxX,UAAU,CAAC6R,QAAQ,EAAEjQ,cAAc,CAACgW,kBAAkB,EAAE3X,UAAU,CAACsX,WAAW,CAAC;AAChGvX,YAAAA,UAAU,CAACuX,WAAW,GAAGtX,UAAU,CAACsX,WAAW;AAClD,UAAA;AACJ,QAAA;AAED3X,QAAAA,cAAa,GAAGuqB,iBAAgB,CAAC7qB,cAAc,CAAC,EAAEgsB,eAAe,CAAC;AACrE,MAAA;AACJ,IAAA;AACJ,EAAA;AAGD,EAAA,IAAI9Y,iBAAiB,IAAIgI,SAAS,KAC1BoM,eAAe,IAAIrU,aAAa,CAACC,iBAAiB,KAAKA,iBAAiB,CAAC,EAAE;IAC/ED,aAAa,CAACC,iBAAiB,GAAGA,iBAAiB;AACnD,IAAA,IAAMsZ,EAAE,GAAG5a,MAAM,CAACgB,UAAU,CAAC6Z,sBAAsB;AAEnD,IAAA,IAAI7a,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;AAC1B,MAAA,IAAM6Z,GAAG,GAAG9a,MAAM,CAACgB,UAAU,CAACG,uBAAwB;MAGtD,IAAID,KAAK,GAAGI,iBAAiB,CAACsP,MAAM,CAACjhB,GAAG,CAAC2Z,SAAS,CAAC4B,SAAU,CAAC;MAC9D,IAAI,CAAChK,KAAK,EAAE;AACRA,QAAAA,KAAK,GAAG4Z,GAAG,CAACC,oBAAoB,EAAG;QACnCzZ,iBAAiB,CAACsP,MAAM,CAACjO,GAAG,CAAC2G,SAAS,CAAC4B,SAAS,EAAGhK,KAAK,CAAC;AAEzD4Z,QAAAA,GAAG,CAAC1Z,kBAAkB,CAACF,KAAK,CAAC;QAC7B3Q,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE,IAAI,CAAC;QAChDrQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE,IAAI,CAAC;QACxDS,KAAK,CAACb,aAAa,GAAG,IAAI;QAC1Ba,KAAK,CAACR,oBAAoB,GAAG,IAAI;AAEjC,QAAA,IAAIoZ,QAA6B;AACjC,QAAA,IAAMC,QAAQ,GAAG3R,SAAS,CAACwC,QAAQ,CAACxd,MAAM;QAC1C,KAAK,IAAIE,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGysB,QAAQ,EAAEzsB,GAAC,EAAE,EAAE;AAC/B,UAAA,IAAM0sB,OAAO,GAAG5R,SAAS,CAACwC,QAAQ,CAACtd,GAAC,CAAC;AACrCwsB,UAAAA,QAAQ,GAAG,IAAI;AAEf,UAAA,IAAMG,SAAS,GAAG7Z,iBAAiB,CAACwO,SAAS,CAACxhB,MAAM;UACpD,KAAK,IAAIob,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyR,SAAS,EAAEzR,CAAC,EAAE,EAAE;AAChC,YAAA,IAAMuG,MAAM,GAAG3O,iBAAiB,CAACwO,SAAS,CAACpG,CAAC,CAAC;AAC7C,YAAA,IAAIuG,MAAM,CAACvF,IAAI,KAAKwQ,OAAO,CAACxQ,IAAI,EAAE;AAC9BsQ,cAAAA,QAAQ,GAAG/K,MAAM;AACjB,cAAA;AACH,YAAA;AACJ,UAAA;AAED,UAAA,IAAI+K,QAAQ,EAAE;AACV,YAAA,IAAI5Y,KAAK,CAACb,aAAa,KAAKyZ,QAAQ,CAACna,QAAQ,EAAE;cAC3CtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAEoa,QAAQ,CAACna,QAAQ,CAAC;AAC7DuB,cAAAA,KAAK,CAACb,aAAa,GAAGyZ,QAAQ,CAACna,QAAQ;AAC1C,YAAA;AAED,YAAA,KAAK,IAAIua,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,QAAQ,CAACvK,cAAc,EAAE,EAAE2K,CAAC,EAAE;AAC9C,cAAA,IAAM5O,KAAK,GAAG0O,OAAO,CAAC1O,KAAK,GAAG4O,CAAC;cAC/B,IAAMC,YAAY,GAAGL,QAAQ,CAACxY,MAAM,GAAGwY,QAAQ,CAACja,IAAI,GAAGqa,CAAC;AAExD7qB,cAAAA,EAAE,CAAC+qB,uBAAuB,CAAC9O,KAAK,CAAC;AACjCpK,cAAAA,KAAK,CAACmZ,mBAAmB,CAAC/O,KAAK,CAAC,GAAG,IAAI;cAEvCjc,EAAE,CAACirB,mBAAmB,CAAChP,KAAK,EAAEwO,QAAQ,CAACvsB,KAAK,EAAEusB,QAAQ,CAAChc,MAAM,EAAEgc,QAAQ,CAAC5K,YAAY,EAAE4K,QAAQ,CAACrO,MAAM,EAAE0O,YAAY,CAAC;AACpH,cAAA,IAAIT,EAAE,EAAE;AAAEA,gBAAAA,EAAE,CAACa,wBAAwB,CAACjP,KAAK,EAAEwO,QAAQ,CAAC1K,WAAW,GAAG,CAAC,GAAG,CAAC,CAAC;AAAG,cAAA;AAChF,YAAA;AACJ,UAAA;AACJ,QAAA;AAED,QAAA,IAAMzhB,UAAS,GAAGyS,iBAAiB,CAACoa,cAAc;AAClD,QAAA,IAAI7sB,UAAS,EAAE;UACX0B,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE9S,UAAS,CAACgS,QAAQ,CAAC;AACzE,QAAA;AAEDia,QAAAA,GAAG,CAAC1Z,kBAAkB,CAAC,IAAI,CAAC;QAC5B7Q,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAE,IAAI,CAAC;QAChDrQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE,IAAI,CAAC;QACxDS,KAAK,CAACb,aAAa,GAAG,IAAI;QAC1Ba,KAAK,CAACR,oBAAoB,GAAG,IAAI;AACpC,MAAA;AAED,MAAA,IAAIQ,KAAK,CAAClB,KAAK,KAAKA,KAAK,EAAE;AACvB4Z,QAAAA,GAAG,CAAC1Z,kBAAkB,CAACF,KAAK,CAAC;QAC7BkB,KAAK,CAAClB,KAAK,GAAGA,KAAK;AACtB,MAAA;AACJ,IAAA,CAAA,MAAM;AACH,MAAA,KAAK,IAAIiU,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGnV,MAAM,CAACoE,YAAY,CAACuX,mBAAmB,EAAE,EAAExG,CAAC,EAAE;AAC9D/S,QAAAA,KAAK,CAACmZ,mBAAmB,CAACpG,CAAC,CAAC,GAAG,KAAK;AACvC,MAAA;AAED,MAAA,IAAM8F,SAAQ,GAAG3R,SAAS,CAACwC,QAAQ,CAACxd,MAAM;MAC1C,KAAK,IAAIE,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGysB,SAAQ,EAAEzsB,GAAC,EAAE,EAAE;AAC/B,QAAA,IAAM0sB,QAAO,GAAG5R,SAAS,CAACwC,QAAQ,CAACtd,GAAC,CAAC;QACrC,IAAIwsB,SAA6B,GAAG,IAAI;AAExC,QAAA,IAAMG,UAAS,GAAG7Z,iBAAiB,CAACwO,SAAS,CAACxhB,MAAM;QACpD,KAAK,IAAIob,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGyR,UAAS,EAAEzR,GAAC,EAAE,EAAE;AAChC,UAAA,IAAMuG,OAAM,GAAG3O,iBAAiB,CAACwO,SAAS,CAACpG,GAAC,CAAC;AAC7C,UAAA,IAAIuG,OAAM,CAACvF,IAAI,KAAKwQ,QAAO,CAACxQ,IAAI,EAAE;AAC9BsQ,YAAAA,SAAQ,GAAG/K,OAAM;AACjB,YAAA;AACH,UAAA;AACJ,QAAA;AAED,QAAA,IAAI+K,SAAQ,EAAE;AACV,UAAA,IAAI5Y,KAAK,CAACb,aAAa,KAAKyZ,SAAQ,CAACna,QAAQ,EAAE;YAC3CtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACkQ,YAAY,EAAEoa,SAAQ,CAACna,QAAQ,CAAC;AAC7DuB,YAAAA,KAAK,CAACb,aAAa,GAAGyZ,SAAQ,CAACna,QAAQ;AAC1C,UAAA;AAED,UAAA,KAAK,IAAIua,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGJ,SAAQ,CAACvK,cAAc,EAAE,EAAE2K,EAAC,EAAE;AAC9C,YAAA,IAAM5O,OAAK,GAAG0O,QAAO,CAAC1O,KAAK,GAAG4O,EAAC;YAC/B,IAAMC,aAAY,GAAGL,SAAQ,CAACxY,MAAM,GAAGwY,SAAQ,CAACja,IAAI,GAAGqa,EAAC;YAExD,IAAI,CAAChZ,KAAK,CAACwZ,mBAAmB,CAACpP,OAAK,CAAC,IAAIA,OAAK,IAAI,CAAC,EAAE;AACjDjc,cAAAA,EAAE,CAAC+qB,uBAAuB,CAAC9O,OAAK,CAAC;AACjCpK,cAAAA,KAAK,CAACwZ,mBAAmB,CAACpP,OAAK,CAAC,GAAG,IAAI;AAC1C,YAAA;AACDpK,YAAAA,KAAK,CAACmZ,mBAAmB,CAAC/O,OAAK,CAAC,GAAG,IAAI;YAEvCjc,EAAE,CAACirB,mBAAmB,CAAChP,OAAK,EAAEwO,SAAQ,CAACvsB,KAAK,EAAEusB,SAAQ,CAAChc,MAAM,EAAEgc,SAAQ,CAAC5K,YAAY,EAAE4K,SAAQ,CAACrO,MAAM,EAAE0O,aAAY,CAAC;AACpH,YAAA,IAAIT,EAAE,EAAE;AAAEA,cAAAA,EAAE,CAACa,wBAAwB,CAACjP,OAAK,EAAEwO,SAAQ,CAAC1K,WAAW,GAAG,CAAC,GAAG,CAAC,CAAC;AAAG,YAAA;AAChF,UAAA;AACJ,QAAA;AACJ,MAAA;AAED,MAAA,IAAMzhB,WAAS,GAAGyS,iBAAiB,CAACoa,cAAc;AAClD,MAAA,IAAI7sB,WAAS,EAAE;AACX,QAAA,IAAIuT,KAAK,CAACR,oBAAoB,KAAK/S,WAAS,CAACgS,QAAQ,EAAE;UACnDtQ,EAAE,CAACiR,UAAU,CAAC9Q,cAAc,CAACiR,oBAAoB,EAAE9S,WAAS,CAACgS,QAAQ,CAAC;AACtEuB,UAAAA,KAAK,CAACR,oBAAoB,GAAG/S,WAAS,CAACgS,QAAQ;AAClD,QAAA;AACJ,MAAA;AAED,MAAA,KAAK,IAAIsU,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGnV,MAAM,CAACoE,YAAY,CAACuX,mBAAmB,EAAE,EAAExG,EAAC,EAAE;AAC9D,QAAA,IAAI/S,KAAK,CAACwZ,mBAAmB,CAACzG,EAAC,CAAC,KAAK/S,KAAK,CAACmZ,mBAAmB,CAACpG,EAAC,CAAC,EAAE;AAC/D5kB,UAAAA,EAAE,CAACsrB,wBAAwB,CAAC1G,EAAC,CAAC;AAC9B/S,UAAAA,KAAK,CAACwZ,mBAAmB,CAACzG,EAAC,CAAC,GAAG,KAAK;AACvC,QAAA;AACJ,MAAA;AACJ,IAAA;AACJ,EAAA;AAGD,EAAA,IAAI/D,gBAAgB,IAAIA,gBAAgB,CAACoE,aAAa,CAAClnB,MAAM,EAAE;AAC3D,IAAA,IAAMwtB,KAAK,GAAG1K,gBAAgB,CAACoE,aAAa,CAAClnB,MAAM;IACnD,KAAK,IAAIE,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGstB,KAAK,EAAEttB,GAAC,EAAE,EAAE;AAC5B,MAAA,IAAMutB,YAAY,GAAG3K,gBAAgB,CAACoE,aAAa,CAAChnB,GAAC,CAAC;AACtD,MAAA,QAAQutB,YAAY;QACpB,KAAKC,mBAAmB,CAACC,UAAU;AAAE,UAAA;YACjC,IAAI7Z,KAAK,CAACuT,EAAE,CAACe,SAAS,KAAKlB,aAAa,CAACkB,SAAS,EAAE;AAChDnmB,cAAAA,EAAE,CAACmmB,SAAS,CAAClB,aAAa,CAACkB,SAAS,CAAC;AACrCtU,cAAAA,KAAK,CAACuT,EAAE,CAACe,SAAS,GAAGlB,aAAa,CAACkB,SAAS;AAC/C,YAAA;AACD,YAAA;AACH,UAAA;QACD,KAAKsF,mBAAmB,CAACE,UAAU;AAAE,UAAA;AACjC,YAAA,IAAI9Z,KAAK,CAACuT,EAAE,CAACY,SAAS,KAAKf,aAAa,CAAC2G,iBAAiB,IACnD/Z,KAAK,CAACuT,EAAE,CAACa,aAAa,KAAKhB,aAAa,CAAC4G,cAAc,EAAE;cAC5D7rB,EAAE,CAACkmB,aAAa,CAACjB,aAAa,CAAC2G,iBAAiB,EAAE3G,aAAa,CAAC4G,cAAc,CAAC;AAC/Eha,cAAAA,KAAK,CAACuT,EAAE,CAACY,SAAS,GAAGf,aAAa,CAAC2G,iBAAiB;AACpD/Z,cAAAA,KAAK,CAACuT,EAAE,CAACa,aAAa,GAAGhB,aAAa,CAAC4G,cAAc;AACxD,YAAA;AACD,YAAA;AACH,UAAA;QACD,KAAKJ,mBAAmB,CAACK,eAAe;AAAE,UAAA;AACtC,YAAA,IAAMC,aAAa,GAAG9G,aAAa,CAAC8G,aAAa;AACjD,YAAA,IAAK7G,OAAO,CAACwC,UAAU,CAACjG,CAAC,KAAKsK,aAAa,CAACtK,CAAC,IACrCyD,OAAO,CAACwC,UAAU,CAAChG,CAAC,KAAKqK,aAAa,CAACrK,CAAE,IACzCwD,OAAO,CAACwC,UAAU,CAACnE,CAAC,KAAKwI,aAAa,CAACxI,CAAE,IACzC2B,OAAO,CAACwC,UAAU,CAACrU,CAAC,KAAK0Y,aAAa,CAAC1Y,CAAE,EAAE;AAC/CrT,cAAAA,EAAE,CAAC0nB,UAAU,CAACqE,aAAa,CAACtK,CAAC,EAAEsK,aAAa,CAACrK,CAAC,EAAEqK,aAAa,CAACxI,CAAC,EAAEwI,aAAa,CAAC1Y,CAAC,CAAC;AACjF6R,cAAAA,OAAO,CAACwC,UAAU,CAACsE,IAAI,CAACD,aAAa,CAAC;AACzC,YAAA;AACD,YAAA;AACH,UAAA;QACD,KAAKN,mBAAmB,CAACQ,kBAAkB;AAAE,UAAA;AACzC,YAAA,IAAMC,KAAK,GAAGjH,aAAa,CAACkH,kBAAkB;AAC9C,YAAA,IAAMC,IAAI,GAAGnH,aAAa,CAACoH,iBAAiB;AAC5C,YAAA,IAAI7J,QAAQ,CAACwB,qBAAqB,KAAKkI,KAAK,CAACI,SAAS,EAAE;cACpDtsB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAAC+jB,KAAK,EAAEgI,KAAK,CAACI,SAAS,CAAC;AAC7D9J,cAAAA,QAAQ,CAACwB,qBAAqB,GAAGkI,KAAK,CAACI,SAAS;AACnD,YAAA;AACD,YAAA,IAAI9J,QAAQ,CAAC2B,oBAAoB,KAAKiI,IAAI,CAACE,SAAS,EAAE;cAClDtsB,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAACikB,IAAI,EAAEgI,IAAI,CAACE,SAAS,CAAC;AAC3D9J,cAAAA,QAAQ,CAAC2B,oBAAoB,GAAGiI,IAAI,CAACE,SAAS;AACjD,YAAA;AACD,YAAA;AACH,UAAA;QACD,KAAKb,mBAAmB,CAACc,oBAAoB;AAAE,UAAA;AAC3C,YAAA,IAAML,MAAK,GAAGjH,aAAa,CAACkH,kBAAkB;AAC9C,YAAA,IAAMC,KAAI,GAAGnH,aAAa,CAACoH,iBAAiB;AAC5C,YAAA,IAAI7J,QAAQ,CAACmE,eAAe,KAAKuF,MAAK,CAACM,SAAS,IACzChK,QAAQ,CAACoE,oBAAoB,KAAKsF,MAAK,CAACO,WAAW,EAAE;cACxDzsB,EAAE,CAAC6mB,mBAAmB,CAAC1mB,cAAc,CAAC+jB,KAAK,EAAEtV,aAAa,CAAC4T,QAAQ,CAACkE,gBAAgB,CAAC,EAAEwF,MAAK,CAACM,SAAS,EAAEN,MAAK,CAACO,WAAW,CAAC;AAC1HjK,cAAAA,QAAQ,CAACmE,eAAe,GAAGuF,MAAK,CAACM,SAAS;AAC1ChK,cAAAA,QAAQ,CAACoE,oBAAoB,GAAGsF,MAAK,CAACO,WAAW;AACpD,YAAA;AACD,YAAA,IAAIjK,QAAQ,CAAC2E,cAAc,KAAKiF,KAAI,CAACI,SAAS,IACvChK,QAAQ,CAAC4E,mBAAmB,KAAKgF,KAAI,CAACK,WAAW,EAAE;cACtDzsB,EAAE,CAAC6mB,mBAAmB,CAAC1mB,cAAc,CAACikB,IAAI,EAAExV,aAAa,CAAC4T,QAAQ,CAAC0E,eAAe,CAAC,EAAEkF,KAAI,CAACI,SAAS,EAAEJ,KAAI,CAACK,WAAW,CAAC;AACtHjK,cAAAA,QAAQ,CAAC2E,cAAc,GAAGiF,KAAI,CAACI,SAAS;AACxChK,cAAAA,QAAQ,CAAC4E,mBAAmB,GAAGgF,KAAI,CAACK,WAAW;AAClD,YAAA;AACD,YAAA;AACH,UAAA;AAEA;AACJ,IAAA;AACJ,EAAA;AACL;AAEM,SAAUC,gBAAgBA,CAAEjd,MAAmB,EAAEkd,QAA4B,EAAO;AACtF,EAAA,IAAQ3sB,EAAE,GAAKyP,MAAM,CAAbzP,EAAE;AACV,EAAA,IAAA4sB,kBAAA,GAA6Dnd,MAAM,CAACgB,UAAU;IAA9C4Z,EAAE,GAAAuC,kBAAA,CAA1BtC,sBAAsB;IAAwBuC,EAAE,GAAAD,kBAAA,CAApBE,gBAAgB;AACpD,EAAA,IAAQ/b,iBAAiB,GAAkBD,aAAa,CAAhDC,iBAAiB;IAAE+P,WAAW,GAAKhQ,aAAa,CAA7BgQ,WAAW;AAEtC,EAAA,IAAI/P,iBAAiB,EAAE;AACnB,IAAA,IAAMgc,WAAW,GAAGhc,iBAAiB,CAACoa,cAAc;IACpD,IAAIpa,iBAAiB,CAACic,iBAAiB,EAAE;AACrC,MAAA,IAAM1a,SAAS,GAAGvB,iBAAiB,CAACic,iBAAiB,CAAC1a,SAAS;MAC/D,IAAIA,SAAS,CAAC2a,WAAW,EAAE;AACvB,QAAA,KAAK,IAAIhvB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGqU,SAAS,CAAC4a,SAAS,EAAEjvB,CAAC,EAAE,EAAE;AAC1CqU,UAAAA,SAAS,CAAC6a,WAAW,CAAClvB,CAAC,CAAC,GAAGqU,SAAS,CAACmN,OAAO,CAACxhB,CAAC,CAAC,GAAG8uB,WAAW,CAAE3Q,MAAM;AACxE,QAAA;AACD,QAAA,IAAIyQ,EAAE,EAAE;UACJ,IAAIva,SAAS,CAAC8a,aAAa,EAAE;AACzBP,YAAAA,EAAE,CAACQ,+BAA+B,CAC9BvM,WAAW,EACXxO,SAAS,CAACgb,MAAM,EAChB,CAAC,EACDvc,iBAAiB,CAACwc,WAAW,EAC7Bjb,SAAS,CAAC6a,WAAW,EACrB,CAAC,EACD7a,SAAS,CAACkb,SAAS,EACnB,CAAC,EACDlb,SAAS,CAAC4a,SAAS,CACtB;AACJ,UAAA,CAAA,MAAM;YACHL,EAAE,CAACY,sBAAsB,CACrB3M,WAAW,EACXxO,SAAS,CAACgb,MAAM,EAChB,CAAC,EACDvc,iBAAiB,CAACwc,WAAW,EAC7Bjb,SAAS,CAAC6a,WAAW,EACrB,CAAC,EACD7a,SAAS,CAAC4a,SAAS,CACtB;AACJ,UAAA;AACJ,QAAA,CAAA,MAAM;AACH,UAAA,KAAK,IAAIjvB,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGqU,SAAS,CAAC4a,SAAS,EAAEjvB,GAAC,EAAE,EAAE;YAC1C,IAAIqU,SAAS,CAACkb,SAAS,CAACvvB,GAAC,CAAC,IAAIosB,EAAE,EAAE;AAC9BA,cAAAA,EAAE,CAACqD,0BAA0B,CACzB5M,WAAW,EACXxO,SAAS,CAACgb,MAAM,CAACrvB,GAAC,CAAC,EACnB8S,iBAAiB,CAACwc,WAAW,EAC7Bjb,SAAS,CAAC6a,WAAW,CAAClvB,GAAC,CAAC,EACxBqU,SAAS,CAACkb,SAAS,CAACvvB,GAAC,CAAC,CACzB;AACJ,YAAA,CAAA,MAAM;cACH+B,EAAE,CAAC2tB,YAAY,CAAC7M,WAAW,EAAExO,SAAS,CAACgb,MAAM,CAACrvB,GAAC,CAAC,EAAE8S,iBAAiB,CAACwc,WAAW,EAAEjb,SAAS,CAAC6a,WAAW,CAAClvB,GAAC,CAAC,CAAC;AAC7G,YAAA;AACJ,UAAA;AACJ,QAAA;MACJ,CAAA,MAAM,IAAI4uB,EAAE,EAAE;QACX,IAAIva,SAAS,CAAC8a,aAAa,EAAE;UACzBP,EAAE,CAACe,6BAA6B,CAC5B9M,WAAW,EACXxO,SAAS,CAACmN,OAAO,EACjB,CAAC,EACDnN,SAAS,CAACgb,MAAM,EAChB,CAAC,EACDhb,SAAS,CAACkb,SAAS,EACnB,CAAC,EACDlb,SAAS,CAAC4a,SAAS,CACtB;AACJ,QAAA,CAAA,MAAM;UACHL,EAAE,CAACgB,oBAAoB,CACnB/M,WAAW,EACXxO,SAAS,CAACmN,OAAO,EACjB,CAAC,EACDnN,SAAS,CAACgb,MAAM,EAChB,CAAC,EACDhb,SAAS,CAAC4a,SAAS,CACtB;AACJ,QAAA;AACJ,MAAA,CAAA,MAAM;AACH,QAAA,KAAK,IAAIjvB,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGqU,SAAS,CAAC4a,SAAS,EAAEjvB,GAAC,EAAE,EAAE;UAC1C,IAAIqU,SAAS,CAACkb,SAAS,CAACvvB,GAAC,CAAC,IAAIosB,EAAE,EAAE;YAC9BA,EAAE,CAACyD,wBAAwB,CAAChN,WAAW,EAAExO,SAAS,CAACmN,OAAO,CAACxhB,GAAC,CAAC,EAAEqU,SAAS,CAACgb,MAAM,CAACrvB,GAAC,CAAC,EAAEqU,SAAS,CAACkb,SAAS,CAACvvB,GAAC,CAAC,CAAC;AAC9G,UAAA,CAAA,MAAM;AACH+B,YAAAA,EAAE,CAAC+tB,UAAU,CAACjN,WAAW,EAAExO,SAAS,CAACmN,OAAO,CAACxhB,GAAC,CAAC,EAAEqU,SAAS,CAACgb,MAAM,CAACrvB,GAAC,CAAC,CAAC;AACxE,UAAA;AACJ,QAAA;AACJ,MAAA;AACJ,IAAA,CAAA,MAAM,IAAI0uB,QAAQ,CAACqB,aAAa,IAAI3D,EAAE,EAAE;AACrC,MAAA,IAAI0C,WAAW,EAAE;AACb,QAAA,IAAIJ,QAAQ,CAACsB,UAAU,GAAG,CAAC,EAAE;UACzB,IAAMhc,MAAM,GAAG0a,QAAQ,CAACuB,UAAU,GAAGnB,WAAW,CAAC3Q,MAAM;AACvDiO,UAAAA,EAAE,CAACqD,0BAA0B,CACzB5M,WAAW,EACX6L,QAAQ,CAACsB,UAAU,EACnBld,iBAAiB,CAACwc,WAAW,EAC7Btb,MAAM,EACN0a,QAAQ,CAACqB,aAAa,CACzB;AACJ,QAAA;AACJ,MAAA,CAAA,MAAM,IAAIrB,QAAQ,CAACwB,WAAW,GAAG,CAAC,EAAE;AACjC9D,QAAAA,EAAE,CAACyD,wBAAwB,CAAChN,WAAW,EAAE6L,QAAQ,CAACyB,WAAW,EAAEzB,QAAQ,CAACwB,WAAW,EAAExB,QAAQ,CAACqB,aAAa,CAAC;AAC/G,MAAA;IACJ,CAAA,MAAM,IAAIjB,WAAW,EAAE;AACpB,MAAA,IAAIJ,QAAQ,CAACsB,UAAU,GAAG,CAAC,EAAE;QACzB,IAAMhc,OAAM,GAAG0a,QAAQ,CAACuB,UAAU,GAAGnB,WAAW,CAAC3Q,MAAM;AACvDpc,QAAAA,EAAE,CAAC2tB,YAAY,CAAC7M,WAAW,EAAE6L,QAAQ,CAACsB,UAAU,EAAEld,iBAAiB,CAACwc,WAAW,EAAEtb,OAAM,CAAC;AAC3F,MAAA;AACJ,IAAA,CAAA,MAAM,IAAI0a,QAAQ,CAACwB,WAAW,GAAG,CAAC,EAAE;AACjCnuB,MAAAA,EAAE,CAAC+tB,UAAU,CAACjN,WAAW,EAAE6L,QAAQ,CAACyB,WAAW,EAAEzB,QAAQ,CAACwB,WAAW,CAAC;AACzE,IAAA;AACJ,EAAA;AACL;AAEM,SAAUE,kCAAkCA,CAC9C5e,MAAmB,EACnB6e,SAAqC,EACrC/vB,UAA4B,EAC5BgwB,OAAsC,EACnC;AACH,EAAA,IAAQvuB,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;EACtB,IAAMiF,SAAS,GAAGjF,UAAU,CAACkF,UAAU,CAAClF,UAAU,CAACmF,OAAO,CAAC;AAC3D,EAAA,IAAIF,SAAS,CAACF,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;IAC9CzU,EAAE,CAAC8U,WAAW,CAACvW,UAAU,CAAC6R,QAAQ,EAAE7R,UAAU,CAACkW,SAAS,CAAC;AACzDE,IAAAA,SAAS,CAACF,SAAS,GAAGlW,UAAU,CAACkW,SAAS;AAC7C,EAAA;EAED,IAAIuU,CAAC,GAAG,CAAC;EACT,IAAIzS,CAAC,GAAG,CAAC;EAET,QAAQhY,UAAU,CAAC6R,QAAQ;IAC3B,KAAKjQ,cAAc,CAACwT,UAAU;AAAE,MAAA;AAC5B,QAAA,KAAK,IAAI7V,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGywB,OAAO,CAACxwB,MAAM,EAAED,CAAC,EAAE,EAAE;AACrC,UAAA,IAAM0wB,MAAM,GAAGD,OAAO,CAACzwB,CAAC,CAAC;AAEzBkC,UAAAA,EAAE,CAACyuB,aAAa,CACZtuB,cAAc,CAACwT,UAAU,EACzB6a,MAAM,CAACE,SAAS,CAAC1Z,QAAQ,EACzBwZ,MAAM,CAACG,SAAS,CAAClN,CAAC,EAClB+M,MAAM,CAACG,SAAS,CAACjN,CAAC,EAClBnjB,UAAU,CAAC4U,QAAQ,EACnB5U,UAAU,CAACkQ,MAAM,EACjB6f,SAAS,CAACtF,CAAC,EAAE,CAAC,CACjB;AACJ,QAAA;AACD,QAAA;AACH,MAAA;IACD,KAAK7oB,cAAc,CAACkW,gBAAgB;AAAE,MAAA;AAClC,QAAA,KAAK,IAAIvY,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGywB,OAAO,CAACxwB,MAAM,EAAED,IAAC,EAAE,EAAE;AACrC,UAAA,IAAM0wB,OAAM,GAAGD,OAAO,CAACzwB,IAAC,CAAC;AACzB,UAAA,IAAM8wB,eAAe,GAAGJ,OAAM,CAACG,SAAS;AACxC,UAAA,IAAME,eAAe,GAAGL,OAAM,CAACE,SAAS;UAExC,IAAMI,MAAM,GAAGD,eAAe,CAACE,cAAc,GAAGF,eAAe,CAACG,UAAU;AAC1E,UAAA,KAAKzY,CAAC,GAAGsY,eAAe,CAACE,cAAc,EAAExY,CAAC,GAAGuY,MAAM,EAAE,EAAEvY,CAAC,EAAE;AACtDvW,YAAAA,EAAE,CAACyuB,aAAa,CACZtuB,cAAc,CAACqW,2BAA2B,GAAGD,CAAC,EAC9CsY,eAAe,CAAC7Z,QAAQ,EACxB4Z,eAAe,CAACnN,CAAC,EACjBmN,eAAe,CAAClN,CAAC,EACjBnjB,UAAU,CAAC4U,QAAQ,EACnB5U,UAAU,CAACkQ,MAAM,EACjB6f,SAAS,CAACtF,CAAC,EAAE,CAAC,CACjB;AACJ,UAAA;AACJ,QAAA;AACD,QAAA;AACH,MAAA;AACD,IAAA;AAAS,MAAA;QACL7gB,OAAO,CAAC,KAAK,CAAC;AACjB,MAAA;AACA;EAED,IAAK5J,UAAU,CAAC0wB,KAAK,GAAGC,cAAc,CAACC,UAAU,IAC1C5wB,UAAU,CAACgX,UAAU,EAAE;AAC1BvV,IAAAA,EAAE,CAACovB,cAAc,CAAC7wB,UAAU,CAAC6R,QAAQ,CAAC;AACzC,EAAA;AACL;AAEA,IAAIif,aAAa,GAAG,IAAIja,UAAU,CAAC,CAAC,CAAC;AACrC,SAASka,eAAeA,CACpBvwB,MAAuB,EACvBgB,MAAc,EACdkS,MAAc,EACdmK,MAAc,EACdmT,MAAc,EACA;AACd,EAAA,IAAMC,WAAW,GAAGC,eAAe,CAAC1vB,MAAM,CAAC,CAACyT,MAAM;AAElD,EAAA,IAAMkc,UAAU,GAAGxa,UAAU,CAACnV,MAAM,EAAEwvB,MAAM,CAACjc,KAAK,EAAEic,MAAM,CAAC/b,MAAM,EAAE+b,MAAM,CAACI,KAAK,CAAC;AAChF,EAAA,IAAMC,SAAS,GAAG1a,UAAU,CAACnV,MAAM,EAAEqc,MAAM,CAAC9I,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;AACxD,EAAA,IAAMuc,WAAW,GAAG3a,UAAU,CAACnV,MAAM,EAAEqc,MAAM,CAAC9I,KAAK,EAAE8I,MAAM,CAAC5I,MAAM,EAAE,CAAC,CAAC;AACtE,EAAA,IAAMsc,SAAS,GAAG5a,UAAU,CAACnV,MAAM,EAAEwvB,MAAM,CAACjc,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC;EAExD,IAAMyc,eAAsC,GAAGC,wBAAwB,CAAC9b,WAAW,CAACnU,MAAM,CAAC,CAAC;AAE5F,EAAA,IAAIsvB,aAAa,CAACtc,UAAU,GAAG2c,UAAU,EAAE;AACvCL,IAAAA,aAAa,GAAG,IAAIja,UAAU,CAACsa,UAAU,CAAC;AAC7C,EAAA;EAED,IAAIO,UAAU,GAAG,CAAC;EAClB,IAAIC,YAAY,GAAGje,MAAM;AAEzB,EAAA,KAAK,IAAInU,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyxB,MAAM,CAACI,KAAK,EAAE7xB,CAAC,EAAE,EAAE;AACnCoyB,IAAAA,YAAY,GAAGje,MAAM,GAAG4d,WAAW,GAAG/xB,CAAC;AACvC,IAAA,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGsxB,MAAM,CAAC/b,MAAM,EAAEvV,CAAC,IAAIuxB,WAAW,EAAE;MACjDH,aAAa,CAACc,QAAQ,CAACF,UAAU,EAAEA,UAAU,GAAGH,SAAS,CAAC,CAAC1d,GAAG,CAC1D,IAAIgD,UAAU,CAACrW,MAAM,CAACA,MAAM,EAAEA,MAAM,CAACqxB,UAAU,GAAGF,YAAY,EAAEJ,SAAS,CAAC,CAC7E;AACDG,MAAAA,UAAU,IAAIH,SAAS;AACvBI,MAAAA,YAAY,IAAIN,SAAS;AAC5B,IAAA;AACJ,EAAA;AACD,EAAA,IAAM7xB,MAAM,GAAG2xB,UAAU,GAAGK,eAAe,CAAC1d,iBAAiB;EAC7Dge,QAAQ,CAACC,MAAM,CAACC,SAAS,CAACxyB,MAAM,CAAC,EAAE,IAAI,CAAC;EACxC,OAAO,IAAIgyB,eAAe,CAACV,aAAa,CAACtwB,MAAM,EAAE,CAAC,EAAEhB,MAAM,CAAC;AAC/D;AAEM,SAAUyyB,gCAAgCA,CAC5C/gB,MAAmB,EACnBghB,OAAoC,EACpClyB,UAA4B,EAC5BgwB,OAAsC,EACnC;AACH,EAAA,IAAQvuB,EAAE,GAAiByP,MAAM,CAAzBzP,EAAE;IAAE0P,UAAU,GAAKD,MAAM,CAArBC,UAAU;EACtB,IAAMiF,SAAS,GAAGjF,UAAU,CAACkF,UAAU,CAAClF,UAAU,CAACmF,OAAO,CAAC;AAC3D,EAAA,IAAIF,SAAS,CAACF,SAAS,KAAKlW,UAAU,CAACkW,SAAS,EAAE;IAC9CzU,EAAE,CAAC8U,WAAW,CAACvW,UAAU,CAAC6R,QAAQ,EAAE7R,UAAU,CAACkW,SAAS,CAAC;AACzDE,IAAAA,SAAS,CAACF,SAAS,GAAGlW,UAAU,CAACkW,SAAS;AAC7C,EAAA;EAED,IAAIuU,CAAC,GAAG,CAAC;EACT,IAAIzS,CAAC,GAAG,CAAC;AACT,EAAA,IAAMma,OAAmB,GAAGxc,WAAW,CAAC3V,UAAU,CAACwB,MAAM,CAAC;AAC1D,EAAA,IAAMgwB,eAAsC,GAAGC,wBAAwB,CAACU,OAAO,CAAC;AAChF,EAAA,IAAQ3b,YAAY,GAAK2b,OAAO,CAAxB3b,YAAY;AAEpB,EAAA,IAAM4b,SAAS,GAAGlB,eAAe,CAAClxB,UAAU,CAACwB,MAAM,CAAC;AAEpD,EAAA,IAAMwvB,MAAc,GAAG,IAAIqB,MAAM,EAAE;AACnC,EAAA,IAAM3e,MAAc,GAAG,IAAI4e,MAAM,EAAE;AACnC,EAAA,IAAMzU,MAAc,GAAG,IAAIwU,MAAM,EAAE;EAEnC,QAAQryB,UAAU,CAAC6R,QAAQ;IAC3B,KAAKjQ,cAAc,CAACwT,UAAU;AAAE,MAAA;AAC5B,QAAA,KAAK,IAAI7V,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGywB,OAAO,CAACxwB,MAAM,EAAED,CAAC,EAAE,EAAE;AACrC,UAAA,IAAM0wB,MAAM,GAAGD,OAAO,CAACzwB,CAAC,CAAC;AACzB,UAAA,IAAMkX,QAAQ,GAAGwZ,MAAM,CAACE,SAAS,CAAC1Z,QAAQ;AAE1C,UAAA,IAAM4Z,eAAe,GAAGJ,MAAM,CAACG,SAAS;AACxC,UAAA,IAAMmC,eAAe,GAAGtC,MAAM,CAACuC,SAAS;AACxC,UAAA,IAAMC,oBAAoB,GAAGF,eAAe,CAACxd,KAAK;AAClD,UAAA,IAAM2d,qBAAqB,GAAGH,eAAe,CAACtd,MAAM;AACpD,UAAA,IAAM0d,cAAc,GAAGP,SAAS,CAACrd,KAAK;AACtC,UAAA,IAAM6d,eAAe,GAAGR,SAAS,CAACnd,MAAM;AACxC,UAAA,IAAM4d,gBAAgB,GAAG5C,MAAM,CAAC6C,UAAU;AAE1Cpf,UAAAA,MAAM,CAACwP,CAAC,GAAImN,eAAe,CAACnN,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG6P,OAAO,CAAC1C,eAAe,CAACnN,CAAC,EAAEyP,cAAc,CAAC;AACpFjf,UAAAA,MAAM,CAACyP,CAAC,GAAIkN,eAAe,CAAClN,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG4P,OAAO,CAAC1C,eAAe,CAAClN,CAAC,EAAEyP,eAAe,CAAC;AACrF5B,UAAAA,MAAM,CAACjc,KAAK,GAAG0d,oBAAoB,GAAGE,cAAc,GAAGF,oBAAoB,GAAGM,OAAO,CAACN,oBAAoB,EAAEE,cAAc,CAAC;AAC3H3B,UAAAA,MAAM,CAAC/b,MAAM,GAAGyd,qBAAqB,GAAGE,eAAe,GAAGH,oBAAoB,GACxEM,OAAO,CAACL,qBAAqB,EAAEE,eAAe,CAAC;UACrD/U,MAAM,CAAC9I,KAAK,GAAG8d,gBAAgB,GAAG,CAAC,GAAIA,gBAAgB,GAAG7B,MAAM,CAACjc,KAAK;AACtE8I,UAAAA,MAAM,CAAC5I,MAAM,GAAGgb,MAAM,CAAC+C,aAAa,GAAG,CAAC,GAAG/C,MAAM,CAAC+C,aAAa,GAAGhC,MAAM,CAAC/b,MAAM;AAE/E,UAAA,IAAMge,SAAS,GAAKR,oBAAoB,GAAG/e,MAAM,CAACwP,CAAC,KAAMljB,UAAU,CAAC+U,KAAK,IAAI0B,QAAS,GAAIgc,oBAAoB,GAAGzB,MAAM,CAACjc,KAAK;AAC7H,UAAA,IAAMme,UAAU,GAAIR,qBAAqB,GAAGhf,MAAM,CAACyP,CAAC,KAAMnjB,UAAU,CAACiV,MAAM,IAAIwB,QAAS,GAAIic,qBAAqB,GAAG1B,MAAM,CAAC/b,MAAM;AAEjI,UAAA,IAAIke,MAAuB,GAAA,MAAA;AAC3B,UAAA,IAAM3yB,MAAM,GAAG0xB,OAAO,CAACzH,CAAC,EAAE,CAAC;AAC3B,UAAA,IAAI5M,MAAM,CAAC9I,KAAK,KAAKic,MAAM,CAACjc,KAAK,IAAI8I,MAAM,CAAC5I,MAAM,KAAK+b,MAAM,CAAC/b,MAAM,EAAE;AAClE,YAAA,IAAMzV,MAAM,GAAGmX,UAAU,CAAC3W,UAAU,CAACwB,MAAM,EAAEyxB,SAAS,EAAEC,UAAU,EAAE,CAAC,CAAC,GAAG1B,eAAe,CAAC1d,iBAAiB;YAC1Gge,QAAQ,CAACC,MAAM,CAACC,SAAS,CAACxyB,MAAM,CAAC,EAAE,IAAI,CAAC;AACxC2zB,YAAAA,MAAM,GAAG,IAAI3B,eAAe,CAAChxB,MAAM,CAACA,MAAM,EAAEA,MAAM,CAACqxB,UAAU,GAAG5B,MAAM,CAACmD,UAAU,EAAE5zB,MAAM,CAAC;AAC7F,UAAA,CAAA,MAAM;AACH2zB,YAAAA,MAAM,GAAGpC,eAAe,CAACvwB,MAAM,EAAER,UAAU,CAACwB,MAAM,EAAEyuB,MAAM,CAACmD,UAAU,EAAEvV,MAAM,EAAEmT,MAAM,CAAC;AACzF,UAAA;UAED,IAAI,CAACxa,YAAY,EAAE;AACf/U,YAAAA,EAAE,CAACyuB,aAAa,CACZtuB,cAAc,CAACwT,UAAU,EACzBqB,QAAQ,EACR/C,MAAM,CAACwP,CAAC,EACRxP,MAAM,CAACyP,CAAC,EACR8P,SAAS,EACTC,UAAU,EACVlzB,UAAU,CAAC4U,QAAQ,EACnB5U,UAAU,CAACkQ,MAAM,EACjBijB,MAAM,CACT;AACJ,UAAA,CAAA,MAAM,IAAInzB,UAAU,CAAC6U,aAAa,KAAM9T,QAAQ,CAACkK,yBAAoC,IAAI,CAACiG,MAAM,CAACgB,UAAU,CAACmhB,yBAAyB,EAAE;YACpI5xB,EAAE,CAAC6xB,uBAAuB,CACtB1xB,cAAc,CAACwT,UAAU,EACzBqB,QAAQ,EACR/C,MAAM,CAACwP,CAAC,EACRxP,MAAM,CAACyP,CAAC,EACR8P,SAAS,EACTC,UAAU,EACVlzB,UAAU,CAAC4U,QAAQ,EACnBue,MAAM,CACT;AACJ,UAAA,CAAA,MAAM;YACH1xB,EAAE,CAACqV,oBAAoB,CACnBlV,cAAc,CAACwT,UAAU,EACzBqB,QAAQ,EACRzW,UAAU,CAAC6U,aAAa,EACxBoe,SAAS,EACTC,UAAU,EACV,CAAC,EACDC,MAAM,CACT;AACJ,UAAA;AACJ,QAAA;AACD,QAAA;AACH,MAAA;IACD,KAAKvxB,cAAc,CAACkW,gBAAgB;AAAE,MAAA;AAClC,QAAA,KAAK,IAAIvY,IAAC,GAAG,CAAC,EAAEA,IAAC,GAAGywB,OAAO,CAACxwB,MAAM,EAAED,IAAC,EAAE,EAAE;AACrC,UAAA,IAAM0wB,QAAM,GAAGD,OAAO,CAACzwB,IAAC,CAAC;AACzB,UAAA,IAAMkX,SAAQ,GAAGwZ,QAAM,CAACE,SAAS,CAAC1Z,QAAQ;AAE1C,UAAA,IAAM4Z,gBAAe,GAAGJ,QAAM,CAACG,SAAS;AACxC,UAAA,IAAMmC,gBAAe,GAAGtC,QAAM,CAACuC,SAAS;AACxC,UAAA,IAAMlC,eAAe,GAAGL,QAAM,CAACE,SAAS;AACxC,UAAA,IAAMsC,qBAAoB,GAAGF,gBAAe,CAACxd,KAAK;AAClD,UAAA,IAAM2d,sBAAqB,GAAGH,gBAAe,CAACtd,MAAM;AACpD,UAAA,IAAM0d,eAAc,GAAGP,SAAS,CAACrd,KAAK;AACtC,UAAA,IAAM6d,gBAAe,GAAGR,SAAS,CAACnd,MAAM;AAExCvB,UAAAA,MAAM,CAACwP,CAAC,GAAImN,gBAAe,CAACnN,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG6P,OAAO,CAAC1C,gBAAe,CAACnN,CAAC,EAAEyP,eAAc,CAAC;AACpFjf,UAAAA,MAAM,CAACyP,CAAC,GAAIkN,gBAAe,CAAClN,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG4P,OAAO,CAAC1C,gBAAe,CAAClN,CAAC,EAAEyP,gBAAe,CAAC;AACrF5B,UAAAA,MAAM,CAACjc,KAAK,GAAG0d,qBAAoB,GAAGE,eAAc,GAAGF,qBAAoB,GAAGM,OAAO,CAACN,qBAAoB,EAAEE,eAAc,CAAC;AAC3H3B,UAAAA,MAAM,CAAC/b,MAAM,GAAGyd,sBAAqB,GAAGE,gBAAe,GAAGH,qBAAoB,GACxEM,OAAO,CAACL,sBAAqB,EAAEE,gBAAe,CAAC;AACrD/U,UAAAA,MAAM,CAAC9I,KAAK,GAAGkb,QAAM,CAAC6C,UAAU,GAAG,CAAC,GAAI7C,QAAM,CAAC6C,UAAU,GAAG9B,MAAM,CAACjc,KAAK;AACxE8I,UAAAA,MAAM,CAAC5I,MAAM,GAAGgb,QAAM,CAAC+C,aAAa,GAAG,CAAC,GAAG/C,QAAM,CAAC+C,aAAa,GAAGhC,MAAM,CAAC/b,MAAM;AAE/E,UAAA,IAAMge,UAAS,GAAKR,qBAAoB,GAAG/e,MAAM,CAACwP,CAAC,KAAMljB,UAAU,CAAC+U,KAAK,IAAI0B,SAAS,GAAIgc,qBAAoB,GAAGzB,MAAM,CAACjc,KAAK;AAC7H,UAAA,IAAMme,WAAU,GAAIR,sBAAqB,GAAGhf,MAAM,CAACyP,CAAC,KAAMnjB,UAAU,CAACiV,MAAM,IAAIwB,SAAS,GAAIic,sBAAqB,GAAG1B,MAAM,CAAC/b,MAAM;UAEjI,IAAMsb,MAAM,GAAGD,eAAe,CAACE,cAAc,GAAGF,eAAe,CAACG,UAAU;AAC1E,UAAA,KAAKzY,CAAC,GAAGsY,eAAe,CAACE,cAAc,EAAExY,CAAC,GAAGuY,MAAM,EAAE,EAAEvY,CAAC,EAAE;AACtD,YAAA,IAAImb,OAAuB,GAAA,MAAA;AAC3B,YAAA,IAAM3yB,OAAM,GAAG0xB,OAAO,CAACzH,CAAC,EAAE,CAAC;AAC3B,YAAA,IAAI5M,MAAM,CAAC9I,KAAK,KAAKic,MAAM,CAACjc,KAAK,IAAI8I,MAAM,CAAC5I,MAAM,KAAK+b,MAAM,CAAC/b,MAAM,EAAE;AAClE,cAAA,IAAMzV,OAAM,GAAGmX,UAAU,CAAC3W,UAAU,CAACwB,MAAM,EAAEyxB,UAAS,EAAEC,WAAU,EAAE,CAAC,CAAC,GAAG1B,eAAe,CAAC1d,iBAAiB;cAC1Gge,QAAQ,CAACC,MAAM,CAACC,SAAS,CAACxyB,OAAM,CAAC,EAAE,IAAI,CAAC;AACxC2zB,cAAAA,OAAM,GAAG,IAAI3B,eAAe,CAAChxB,OAAM,CAACA,MAAM,EAAEA,OAAM,CAACqxB,UAAU,GAAG5B,QAAM,CAACmD,UAAU,EAAE5zB,OAAM,CAAC;AAC7F,YAAA,CAAA,MAAM;AACH2zB,cAAAA,OAAM,GAAGpC,eAAe,CAACvwB,OAAM,EAAER,UAAU,CAACwB,MAAM,EAAEyuB,QAAM,CAACmD,UAAU,EAAEvV,MAAM,EAAEmT,MAAM,CAAC;AACzF,YAAA;YAED,IAAI,CAACxa,YAAY,EAAE;AACf/U,cAAAA,EAAE,CAACyuB,aAAa,CACZtuB,cAAc,CAACqW,2BAA2B,GAAGD,CAAC,EAC9CvB,SAAQ,EACR/C,MAAM,CAACwP,CAAC,EACRxP,MAAM,CAACyP,CAAC,EACR8P,UAAS,EACTC,WAAU,EACVlzB,UAAU,CAAC4U,QAAQ,EACnB5U,UAAU,CAACkQ,MAAM,EACjBijB,OAAM,CACT;AACJ,YAAA,CAAA,MAAM,IAAInzB,UAAU,CAAC6U,aAAa,KAAM9T,QAAQ,CAACkK,yBAAoC,IAC/E,CAACiG,MAAM,CAACgB,UAAU,CAACmhB,yBAAyB,EAAE;AACjD5xB,cAAAA,EAAE,CAAC6xB,uBAAuB,CACtB1xB,cAAc,CAACqW,2BAA2B,GAAGD,CAAC,EAC9CvB,SAAQ,EACR/C,MAAM,CAACwP,CAAC,EACRxP,MAAM,CAACyP,CAAC,EACR8P,UAAS,EACTC,WAAU,EACVlzB,UAAU,CAAC4U,QAAQ,EACnBue,OAAM,CACT;AACJ,YAAA,CAAA,MAAM;cACH1xB,EAAE,CAACqV,oBAAoB,CACnBlV,cAAc,CAACqW,2BAA2B,GAAGD,CAAC,EAC9CvB,SAAQ,EACRzW,UAAU,CAAC6U,aAAa,EACxBoe,UAAS,EACTC,WAAU,EACV,CAAC,EACDC,OAAM,CACT;AACJ,YAAA;AACJ,UAAA;AACJ,QAAA;AACD,QAAA;AACH,MAAA;AACD,IAAA;AAAS,MAAA;QACLvpB,OAAO,CAAC,KAAK,CAAC;AACjB,MAAA;AACA;AAED,EAAA,IAAI5J,UAAU,CAAC0wB,KAAK,GAAGC,cAAc,CAACC,UAAU,EAAE;AAC9CnvB,IAAAA,EAAE,CAACovB,cAAc,CAAC7wB,UAAU,CAAC6R,QAAQ,CAAC;AACzC,EAAA;AACL;AAEM,SAAU0hB,gCAAgCA,CAC5CriB,MAAmB,EACnBlR,UAA4B,EAC5BkyB,OAAoC,EACpClC,OAAsC,EACnC;AACH,EAAA,IAAQvuB,EAAE,GAAKyP,MAAM,CAAbzP,EAAE;AACV,EAAA,IAAM6R,KAAK,GAAGpC,MAAM,CAACC,UAAU;AAE/B,EAAA,IAAMqiB,WAAW,GAAG/xB,EAAE,CAACuX,iBAAiB,EAAE;EAC1CvX,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAEsa,WAAW,CAAC;EAC3D,IAAItQ,CAAC,GAAG,CAAC;EACT,IAAIC,CAAC,GAAG,CAAC;EACT,IAAIrO,CAAC,GAAG,CAAC;EACT,IAAIE,CAAC,GAAG,CAAC;EAET,QAAQhV,UAAU,CAAC6R,QAAQ;IAC3B,KAAKjQ,cAAc,CAACwT,UAAU;AAAE,MAAA;AAC5B,QAAA,KAAK,IAAIwF,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGoV,OAAO,CAACxwB,MAAM,EAAEob,CAAC,EAAE,EAAE;AACrC,UAAA,IAAMqV,MAAM,GAAGD,OAAO,CAACpV,CAAC,CAAC;UACzBnZ,EAAE,CAAC0X,oBAAoB,CACnBvX,cAAc,CAACsX,WAAW,EAC1BtX,cAAc,CAACwX,iBAAiB,EAChCpZ,UAAU,CAAC6R,QAAQ,EACnB7R,UAAU,CAACkW,SAAS,EACpB+Z,MAAM,CAACE,SAAS,CAAC1Z,QAAQ,CAC5B;AACDyM,UAAAA,CAAC,GAAG+M,MAAM,CAACG,SAAS,CAAClN,CAAC;AACtBC,UAAAA,CAAC,GAAG8M,MAAM,CAACG,SAAS,CAACjN,CAAC;AACtBrO,UAAAA,CAAC,GAAGmb,MAAM,CAACuC,SAAS,CAACzd,KAAK;AAC1BC,UAAAA,CAAC,GAAGib,MAAM,CAACuC,SAAS,CAACvd,MAAM;UAC3BxT,EAAE,CAACgyB,UAAU,CAACvQ,CAAC,EAAEC,CAAC,EAAErO,CAAC,EAAEE,CAAC,EAAEhV,UAAU,CAAC4U,QAAQ,EAAE5U,UAAU,CAACkQ,MAAM,EAAEgiB,OAAO,CAACtX,CAAC,CAAC,CAAC;AAChF,QAAA;AACD,QAAA;AACH,MAAA;AACD,IAAA;AAAS,MAAA;QACLhR,OAAO,CAAC,KAAK,CAAC;AACjB,MAAA;AACA;EACDnI,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAE,IAAI,CAAC;EACpD5F,KAAK,CAACyF,aAAa,GAAG,IAAI;AAC1BtX,EAAAA,EAAE,CAAC6Y,iBAAiB,CAACkZ,WAAW,CAAC;AACrC;AAEM,SAAUE,uBAAuBA,CACnCxiB,MAAmB,EACnByiB,UAAsC,EACtCC,UAA4B,EAC5B5D,OAAiC,EACjC6D,MAAc,EACX;AAEH3iB,EAAAA,MAAM,CAAC4iB,WAAW,CAACC,IAAI,CAACJ,UAAU,EAAEC,UAAU,EAAE5D,OAAO,EAAmB6D,MAAM,CAAC;AACrF;;ACxyFA,SAASG,gBAAgBA,CAAEC,QAAgB,EAAa;AACpD,EAAA,OAAO,IAAIlkB,UAAU,CAACkkB,QAAQ,CAAC;AACnC;AAGA,IAAaC,sBAAsB,GAAA,YAAA;AAa/B,EAAA,SAAAA,yBAAA;IAAA,IAAA,CATOvF,SAAS,GAAG,CAAC;IAAA,IAAA,CACbD,WAAW,GAAG,KAAK;IAAA,IAAA,CACnBG,aAAa,GAAG,KAAK;IAAA,IAAA,CAKpBsF,SAAS,GAAG,CAAC;IAGjB,IAAI,CAACpF,MAAM,GAAGiF,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;IAC9C,IAAI,CAACjT,OAAO,GAAG8S,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;IAC/C,IAAI,CAAClF,SAAS,GAAI+E,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;IAClD,IAAI,CAACvF,WAAW,GAAGoF,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;AACvD,EAAA;AAAC,EAAA,IAAA71B,MAAA,GAAA41B,sBAAA,CAAA31B,SAAA;AAAAD,EAAAA,MAAA,CAEM0V,UAAU,GAAjB,SAAOA,UAAUA,GAAS;IACtB,IAAI,CAAC2a,SAAS,GAAG,CAAC;IAClB,IAAI,CAACD,WAAW,GAAG,KAAK;IACxB,IAAI,CAACG,aAAa,GAAG,KAAK;EAC9B,CAAC;EAAAvwB,MAAA,CAEM4V,WAAW,GAAlB,SAAOA,WAAWA,CAAEsW,GAAW,EAAE/rB,IAAwB,EAAO;AAC5D,IAAA,IAAI,CAAC21B,eAAe,CAAC5J,GAAG,CAAC;AACzB,IAAA,IAAI,CAACkE,WAAW,GAAGjwB,IAAI,CAACixB,UAAU,GAAG,CAAC;AACtC,IAAA,IAAI,CAACb,aAAa,GAAG,CAAC,CAACpwB,IAAI,CAACgxB,aAAa;AACzC,IAAA,IAAI,CAACd,SAAS,GAAGttB,IAAI,CAACD,GAAG,CAACopB,GAAG,GAAG,CAAC,EAAE,IAAI,CAACmE,SAAS,CAAC;IAElD,IAAI,IAAI,CAACD,WAAW,EAAE;MAClB,IAAI,CAACK,MAAM,CAACvE,GAAG,CAAC,GAAG/rB,IAAI,CAACixB,UAAU;MAClC,IAAI,CAACxO,OAAO,CAACsJ,GAAG,CAAC,GAAG/rB,IAAI,CAACkxB,UAAU;AACtC,IAAA,CAAA,MAAM;MACH,IAAI,CAACZ,MAAM,CAACvE,GAAG,CAAC,GAAG/rB,IAAI,CAACmxB,WAAW;MACnC,IAAI,CAAC1O,OAAO,CAACsJ,GAAG,CAAC,GAAG/rB,IAAI,CAACoxB,WAAW;AACvC,IAAA;AACD,IAAA,IAAI,CAACZ,SAAS,CAACzE,GAAG,CAAC,GAAGnpB,IAAI,CAACD,GAAG,CAAC,CAAC,EAAE3C,IAAI,CAACgxB,aAAa,CAAC;EACzD,CAAC;AAAAnxB,EAAAA,MAAA,CAEO81B,eAAe,GAAvB,SAAQA,eAAeA,CAAEC,MAAc,EAAO;AAC1C,IAAA,IAAI,IAAI,CAACF,SAAS,GAAGE,MAAM,EAAE;AAC7B,IAAA,IAAI,CAACF,SAAS,GAAGG,QAAQ,CAACD,MAAM,CAAC;AAEjC,IAAA,IAAMtF,MAAM,GAAGiF,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;AAC/C,IAAA,IAAMjT,OAAO,GAAG8S,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;AAChD,IAAA,IAAMlF,SAAS,GAAG+E,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;IAClD,IAAI,CAACvF,WAAW,GAAGoF,gBAAgB,CAAC,IAAI,CAACG,SAAS,CAAC;AAEnDpF,IAAAA,MAAM,CAAClb,GAAG,CAAC,IAAI,CAACkb,MAAM,CAAC;AACvB7N,IAAAA,OAAO,CAACrN,GAAG,CAAC,IAAI,CAACqN,OAAO,CAAC;AACzB+N,IAAAA,SAAS,CAACpb,GAAG,CAAC,IAAI,CAACob,SAAS,CAAC;IAE7B,IAAI,CAACF,MAAM,GAAGA,MAAM;IACpB,IAAI,CAAC7N,OAAO,GAAGA,OAAO;IACtB,IAAI,CAAC+N,SAAS,GAAGA,SAAS;EAC9B,CAAC;AAAA,EAAA,OAAAiF,sBAAA;AAAA,CAAA,EAAA;AAyPL,IAAaK,iBAAiB,GAAA,YAAA;AAiB1B,EAAA,SAAAA,oBAAA;IAAA,IAAA,CAhBQC,UAAU,GAA2B,IAAI;IAAA,IAAA,CACzCC,uBAAuB,GAAwC,IAAI;IAAA,IAAA,CACnEC,kBAAkB,GAAmC,IAAI;IAAA,IAAA,CACzDC,iBAAiB,GAAkC,IAAI;IAAA,IAAA,CAEvDC,gBAAgB,GAA2B,IAAI;IAAA,IAAA,CAC/CC,kBAAkB,GAAmC,IAAI;IAAA,IAAA,CACzDC,gBAAgB,GAA4B,IAAI;IAAA,IAAA,CAChDC,iBAAiB,GAA4B,IAAI;IAAA,IAAA,CACjD32B,iBAAiB,GAAkC,IAAI;IAAA,IAAA,CACvD42B,iBAAiB,GAA2B,IAAI;IAAA,IAAA,CAChDC,SAAS,GAAoB,IAAI;IAAA,IAAA,CACjCC,cAAc,GAA4B,IAAI;IAAA,IAAA,CAE9CC,cAAc,GAAwB,IAAI;AAG9C,IAAA,IAAMjkB,MAAM,GAAGlQ,kBAAkB,CAACE,QAAQ;IAC1C,IAAMk0B,aAAa,GAAGlkB,MAAM,CAACmkB,kBAAkB,CAACC,cAAc,CAAC,CAAC,CAAC;IAEjE,IAAI,CAACd,UAAU,GAAG;AACd5Y,MAAAA,IAAI,EAAE,WAAW;AACjBkC,MAAAA,MAAM,EAAE,CACJ,IAAIyX,YAAY,CACZ,CAAC,EACD,CAAC,EAAA,YAAA,EAED,CACI,IAAIC,OAAO,CAAA,iBAAA,EAAoBznB,IAAI,CAACmB,MAAM,EAAE,CAAC,CAAC,EAC9C,IAAIsmB,OAAO,oBAAoBznB,IAAI,CAACmB,MAAM,EAAE,CAAC,CAAC,CACjD,EACD,CAAC,CACJ,CACJ;AACDwP,MAAAA,eAAe,EAAE,CAAC,IAAIC,qBAAqB,CAAC,CAAC,EAAEyW,aAAa,EAAE,YAAY,EAAErnB,IAAI,CAAC2B,SAAS,EAAE,CAAC,CAAC,CAAC;AAC/F8O,MAAAA,aAAa,EAAE,EAAE;AACjB7D,MAAAA,SAAS,EAAE,CACP;QACI9a,IAAI,EAAEmb,kBAAkB,CAACpJ,MAAM;AAC/B4J,QAAAA,MAAM,EAAA,+WAUxB;AACkBH,QAAAA,QAAQ,EAAE;AAAM,OAAA,EACpB;QACIxb,IAAI,EAAEmb,kBAAkB,CAACE,QAAQ;AACjCM,QAAAA,MAAM,EAAA,8JAMxB;AACkBH,QAAAA,QAAQ,EAAE;AAAM,OAAA,CAEvB;AACDe,MAAAA,SAAS,EAAE,IAAI;AACfY,MAAAA,QAAQ,EAAE,EAAE;AACZkB,MAAAA,UAAU,EAAE,EAAE;AACdH,MAAAA,QAAQ,EAAE,EAAE;AACZa,MAAAA,iBAAiB,EAAE;KACtB;IACDrE,wBAAwB,CAACvZ,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACszB,UAAU,CAAC;IAEtE,IAAI,CAACC,uBAAuB,GAAG;AAC3B31B,MAAAA,QAAQ,EAAE,CACN,IAAI22B,0BAA0B,CAAC,CAAC,EAAEC,cAAc,CAACC,cAAc,EAAE,CAAC,EAAE3a,kBAAkB,CAACpJ,MAAM,CAAC,EAC9F,IAAI6jB,0BAA0B,CAACL,aAAa,EAAEM,cAAc,CAACE,eAAe,EAAE,CAAC,EAAE5a,kBAAkB,CAACE,QAAQ,CAAC,CAChH;AACD2a,MAAAA,eAAe,EAAE,EAAE;AACnB92B,MAAAA,iBAAiB,EAAE,EAAE;MACrBC,eAAe,EAAEo2B,aAAa,GAAG;KACpC;IACD,KAAK,IAAI71B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG61B,aAAa,EAAE71B,CAAC,EAAE,EAAE;MACpC,IAAI,CAACk1B,uBAAuB,CAAC11B,iBAAiB,CAACQ,CAAC,CAAC,GAAG,CAAC;AACxD,IAAA;IACD,IAAI,CAACk1B,uBAAuB,CAAC11B,iBAAiB,CAACmB,IAAI,CAAC,CAAC,CAAC;IAEtD,IAAI,CAACw0B,kBAAkB,GAAG;AACtBoB,MAAAA,aAAa,EAAE,CAAC,IAAI,CAACrB,uBAAuB,CAAC;AAC7CsB,MAAAA,kBAAkB,EAAE,CAAC;MACrBC,oBAAoB,EAAE,CAAC,CAAC,CAAC;MACzB9L,oBAAoB,EAAE,CAAC,EAAE;KAC5B;IAED,IAAI,CAACyK,iBAAiB,GAAG;MACrBpS,WAAW,EAAE3gB,cAAc,CAACq0B,cAAc;MAC1Czb,SAAS,EAAE,IAAI,CAACga,UAAU;MAC1BxK,iBAAiB,EAAE,IAAI,CAAC0K,kBAAkB;AAC1C7N,MAAAA,EAAE,EAAE,IAAK;AACT3C,MAAAA,GAAG,EAAE,IAAIgS,iBAAiB,CAAC,KAAK,EAAE,KAAK,CAAC;AACxCzR,MAAAA,EAAE,EAAE,IAAK;AACTiC,MAAAA,aAAa,EAAE,EAAE;AACjB/D,MAAAA,aAAa,EAAE;KAClB;IAED,IAAI,CAACiS,gBAAgB,GAAG;MACpBljB,KAAK,EAAEC,cAAc,CAACC,MAAM;MAC5BP,QAAQ,EAAEC,cAAc,CAAC6kB,MAAM;AAC/BlkB,MAAAA,IAAI,EAAE,EAAE,GAAGjC,YAAY,CAAC8D,iBAAiB;AACzC+J,MAAAA,MAAM,EAAE,CAAC,GAAG7N,YAAY,CAAC8D,iBAAiB;AAC1CtT,MAAAA,MAAM,EAAE,IAAI;AACZyS,MAAAA,IAAI,EAAE,IAAI;AACVc,MAAAA,SAAS,EAAE,IAAImgB,sBAAsB,EAAE;AACvCriB,MAAAA,QAAQ,EAAE,CAAC;AACXE,MAAAA,QAAQ,EAAE;KACb;IACDd,wBAAwB,CAACjQ,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC0zB,gBAAgB,CAAC;IAC5E5zB,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAI,IAAI,CAACyD,gBAAgB,CAAC3iB,IAAI;AACjF,IAAA,IAAMokB,IAAI,GAAI,IAAIrmB,YAAY,CAC1B,CAAC,EAAI,EAAE,EAAI,EAAE,GAAG,EAAE,GAAG,EACjB,GAAG,EAAE,EAAI,EAAE,GAAG,EAAE,GAAG,EACnB,EAAI,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EACnB,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAC1B;AACDyD,IAAAA,wBAAwB,CAACzS,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC0zB,gBAAgB,EAAEyB,IAAI,EAAE,CAAC,EAAEA,IAAI,CAAC72B,MAAM,CAAC;IAElG,IAAI,CAACq1B,kBAAkB,GAAG;AACtB5T,MAAAA,UAAU,EAAE,CAAC,IAAIqV,SAAS,CAAA,YAAA,EAAe50B,MAAM,CAAC2B,KAAK,CAAC,EAAE,IAAIizB,SAAS,CAAA,YAAA,EAAe50B,MAAM,CAAC2B,KAAK,CAAC,CAAC;AAClGqe,MAAAA,gBAAgB,EAAE,CAAC,IAAI,CAACkT,gBAAgB,CAAC;AACzChI,MAAAA,cAAc,EAAE,IAAI;AACpB6B,MAAAA,iBAAiB,EAAE,IAAI;AAEvBzN,MAAAA,SAAS,EAAE,EAAE;AACbgO,MAAAA,WAAW,EAAE,CAAC;MACdlN,MAAM,EAAE,IAAIyU,GAAG;KAClB;IACDxV,+BAA+B,CAAC/f,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC2zB,kBAAkB,CAAC;IAErF,IAAI,CAACC,gBAAgB,GAAG;AACpBzd,MAAAA,WAAW,EAAE,MAAM;AACnBE,MAAAA,WAAW,EAAE,MAAM;AACnBN,MAAAA,OAAO,EAAE,MAAM;AACfE,MAAAA,OAAO,EAAE,MAAM;AACfqf,MAAAA,OAAO,EAAE;KACZ;IAED,IAAI,CAACzB,iBAAiB,GAAG;AACrB1d,MAAAA,WAAW,EAAE,MAAM;AACnBE,MAAAA,WAAW,EAAE,MAAM;AACnBN,MAAAA,OAAO,EAAE,MAAM;AACfE,MAAAA,OAAO,EAAE,MAAM;AACfqf,MAAAA,OAAO,EAAE;KACZ;AAED,IAAA,IAAI,CAACrB,cAAc,GAAG,IAAInlB,YAAY,CAAC,CAAC,CAAC;IACzC,IAAI,CAACglB,iBAAiB,GAAG;MACrBtjB,KAAK,EAAEC,cAAc,CAACoB,OAAO;MAC7B1B,QAAQ,EAAEC,cAAc,CAAC6kB,MAAM;AAC/BlkB,MAAAA,IAAI,EAAE,CAAC,GAAGjC,YAAY,CAAC8D,iBAAiB;AACxC+J,MAAAA,MAAM,EAAE,CAAC,GAAG7N,YAAY,CAAC8D,iBAAiB;MAC1CtT,MAAM,EAAE,IAAI,CAAC20B,cAAc;AAC3BliB,MAAAA,IAAI,EAAE,IAAI;AACVc,MAAAA,SAAS,EAAE,IAAImgB,sBAAsB,EAAE;AACvCriB,MAAAA,QAAQ,EAAE,CAAC;AACXE,MAAAA,QAAQ,EAAE;KACb;IACDd,wBAAwB,CAACjQ,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC8zB,iBAAiB,CAAC;IAC7Eh0B,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAI,IAAI,CAAC6D,iBAAiB,CAAC/iB,IAAI;IAElF,IAAI,CAAC7T,iBAAiB,GAAG;AACrBkB,MAAAA,cAAc,EAAE,CACZ;QAAEO,IAAI,EAAE61B,cAAc,CAACC,cAAc;QAAE51B,SAAS,EAAE,IAAI,CAACi1B,iBAAiB;AAAEh1B,QAAAA,UAAU,EAAE,IAAI;AAAEC,QAAAA,UAAU,EAAE;AAAI,OAAE,EAC9G;QAAEJ,IAAI,EAAE61B,cAAc,CAACE,eAAe;AAAE71B,QAAAA,SAAS,EAAE,IAAI;AAAEC,QAAAA,UAAU,EAAE,IAAI;AAAEC,QAAAA,UAAU,EAAE;AAAI,OAAE,CAAC;AAClGlB,MAAAA,iBAAiB,EAAE,IAAI,CAAC01B,uBAAuB,CAAC11B;KACnD;AAED,IAAA,IAAI,CAACk2B,SAAS,GAAG,IAAIwB,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IAClD,IAAI,CAACvB,cAAc,GAAGl0B,kBAAkB,CAACE,QAAQ,CAACO,EAAE,CAACuX,iBAAiB,EAAE;AAC5E,EAAA;AAAC,EAAA,IAAA0d,OAAA,GAAAnC,iBAAA,CAAAh2B,SAAA;AAAAm4B,EAAAA,OAAA,CAEMv2B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAI,IAAI,CAAC+0B,cAAc,EAAE;MACrBl0B,kBAAkB,CAACE,QAAQ,CAACO,EAAE,CAAC6Y,iBAAiB,CAAC,IAAI,CAAC4a,cAAc,CAAC;MACrE,IAAI,CAACA,cAAc,GAAG,IAAI;AAC7B,IAAA;IACD,IAAI,IAAI,CAACN,gBAAgB,EAAE;MACvB5zB,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAI,IAAI,CAACyD,gBAAgB,CAAC3iB,IAAI;MACjFoB,yBAAyB,CAACrS,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC0zB,gBAAgB,CAAC;AAChF,IAAA;IACD,IAAI,IAAI,CAACI,iBAAiB,EAAE;MACxBh0B,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAI,IAAI,CAAC6D,iBAAiB,CAAC/iB,IAAI;MAClFoB,yBAAyB,CAACrS,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC8zB,iBAAiB,CAAC;AACjF,IAAA;IACD,IAAI,IAAI,CAACR,UAAU,EAAE;MACjB3T,yBAAyB,CAAC7f,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACszB,UAAU,CAAC;AAC1E,IAAA;IACD,IAAI,IAAI,CAACK,kBAAkB,EAAE;MACzBjT,iCAAiC,CAAC5gB,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC2zB,kBAAkB,CAAC;AAC1F,IAAA;EACL,CAAC;AAAA6B,EAAAA,OAAA,CAEM3C,IAAI,GAAX,SAAOA,IAAIA,CAAE4C,aAA+B,EAAEC,aAA+B,EAAE5G,OAAsB,EAAE6D,MAAc,EAAO;AACxH,IAAA,IAAM3iB,MAAM,GAAGlQ,kBAAkB,CAACE,QAAQ;AAC1C,IAAA,IAAQO,EAAE,GAAKyP,MAAM,CAAbzP,EAAE;AACV,IAAA,IAAM0P,UAAU,GAAGD,MAAM,CAACC,UAAU;AACpC,IAAA,IAAM0lB,eAAe,GAAG1lB,UAAU,CAAC4H,aAAa;AAEhDtX,IAAAA,EAAE,CAACiiB,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAEkT,aAAa,CAAC7hB,KAAK,EAAE6hB,aAAa,CAAC3hB,MAAM,CAAC;AAC5DxT,IAAAA,EAAE,CAACsiB,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE6S,aAAa,CAAC7hB,KAAK,EAAE6hB,aAAa,CAAC3hB,MAAM,CAAC;AAE3D,IAAA,IAAI,CAAC,IAAI,CAACkgB,cAAc,IAAI,CAAC,IAAI,CAACH,iBAAiB,IAAI,CAAC,IAAI,CAACL,iBAAiB,IACvE,CAAC,IAAI,CAACE,kBAAkB,IAAI,CAAC,IAAI,CAACz2B,iBAAiB,IAAI,CAAC,IAAI,CAAC62B,SAAS,EAAE;AAC3E,MAAA;AACH,IAAA;IAED,IAAM6B,UAAU,GAAG,IAAI,CAAC14B,iBAAiB,CAACkB,cAAc,CAAC,CAAC,CAAC;IAC3Dw3B,UAAU,CAAC92B,UAAU,GAAG22B,aAAa;AACrCG,IAAAA,UAAU,CAAC72B,UAAU,GAAG4zB,MAAM,KAAKkD,MAAM,CAACC,KAAK,GAAG,IAAI,CAAClC,gBAAgB,GAAG,IAAI,CAACC,iBAAiB;AAEhG,IAAA,IAAMkC,UAAU,GAAGthB,WAAW,CAACihB,aAAa,CAACp1B,MAAM,CAAC;AACpD,IAAA,IAAI01B,UAAkB,GAAGt1B,cAAc,CAACwX,iBAAiB;IACzD,IAAI6d,UAAU,CAACxd,UAAU,EAAE;MACvByd,UAAU,GAAGt1B,cAAc,CAAC8X,wBAAwB;AACvD,IAAA,CAAA,MAAM,IAAIud,UAAU,CAACrhB,QAAQ,EAAE;MAC5BshB,UAAU,GAAGt1B,cAAc,CAAC+X,gBAAgB;AAC/C,IAAA;IAED,IAAMwd,aAAa,GAAGnH,OAAO,CAACoH,GAAG,CAAC,UAACC,CAAC,EAAE93B,CAAC,EAAA;AAAA,MAAA,OAAaA,CAAC;IAAA,CAAA,CAAC;AACtD43B,IAAAA,aAAa,CAACG,IAAI,CAAC,UAACjR,CAAC,EAAEF,CAAC,EAAA;AAAA,MAAA,OAAa6J,OAAO,CAAC3J,CAAC,CAAC,CAACkR,SAAS,CAAC9gB,QAAQ,GAAGuZ,OAAO,CAAC7J,CAAC,CAAC,CAACoR,SAAS,CAAC9gB,QAAQ;IAAA,CAAA,CAAC;AAEnG,IAAA,IAAItF,UAAU,CAAC4H,aAAa,KAAK,IAAI,CAACmc,cAAc,EAAE;MAClDzzB,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAE,IAAI,CAACgc,cAAc,CAAC;AACnE/jB,MAAAA,UAAU,CAAC4H,aAAa,GAAG,IAAI,CAACmc,cAAc;AACjD,IAAA;IAED,IAAIze,QAAQ,GAAGuZ,OAAO,CAAC,CAAC,CAAC,CAACwH,SAAS,CAAC/gB,QAAQ;IAC5C,IAAImgB,aAAa,CAAC1gB,SAAS,EAAE;AACzBzU,MAAAA,EAAE,CAAC0X,oBAAoB,CAACvX,cAAc,CAACsX,WAAW,EAAEge,UAAU,EAAEN,aAAa,CAAC/kB,QAAQ,EAAE+kB,aAAa,CAAC1gB,SAAS,EAAEO,QAAQ,CAAC;AAC7H,IAAA,CAAA,MAAM;AACHhV,MAAAA,EAAE,CAAC4X,uBAAuB,CAACzX,cAAc,CAACsX,WAAW,EAAEge,UAAU,EAAEt1B,cAAc,CAACoU,YAAY,EAAE4gB,aAAa,CAAC/gB,cAAc,CAAC;AAChI,IAAA;AAED,IAAA,KAAK,IAAItW,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG43B,aAAa,CAAC33B,MAAM,EAAE,EAAED,CAAC,EAAE;MAC3C,IAAM0wB,MAAM,GAAGD,OAAO,CAACmH,aAAa,CAAC53B,CAAC,CAAC,CAAC;MAExC,IAAIo3B,aAAa,CAACzgB,SAAS,IAAIO,QAAQ,KAAKwZ,MAAM,CAACsH,SAAS,CAAC9gB,QAAQ,EAAE;AACnEA,QAAAA,QAAQ,GAAGwZ,MAAM,CAACsH,SAAS,CAAC9gB,QAAQ;AACpChV,QAAAA,EAAE,CAAC0X,oBAAoB,CAACvX,cAAc,CAACsX,WAAW,EAAEge,UAAU,EAAEN,aAAa,CAAC/kB,QAAQ,EAAE+kB,aAAa,CAAC1gB,SAAS,EAAEO,QAAQ,CAAC;AAC7H,MAAA;AAED,MAAA,IAAMghB,QAAQ,GAAGd,aAAa,CAAC5hB,KAAK;AACpC,MAAA,IAAM2iB,SAAS,GAAGf,aAAa,CAAC1hB,MAAM;AACtC,MAAA,IAAM0iB,QAAQ,GAAGf,aAAa,CAAC7hB,KAAK;AACpC,MAAA,IAAM6iB,SAAS,GAAGhB,aAAa,CAAC3hB,MAAM;AAEtC,MAAA,IAAI,CAACkgB,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC4H,SAAS,CAAC9iB,KAAK,GAAG0iB,QAAQ;AAC1D,MAAA,IAAI,CAACtC,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC4H,SAAS,CAAC5iB,MAAM,GAAGyiB,SAAS;AAC5D,MAAA,IAAI,CAACvC,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC6H,SAAS,CAAC5U,CAAC,GAAGuU,QAAQ;AACtD,MAAA,IAAI,CAACtC,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC6H,SAAS,CAAC3U,CAAC,GAAGuU,SAAS;AACvD,MAAA,IAAI,CAACvC,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC8H,SAAS,CAAChjB,KAAK,GAAG4iB,QAAQ;AAC1D,MAAA,IAAI,CAACxC,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC8H,SAAS,CAAC9iB,MAAM,GAAG2iB,SAAS;AAC5D,MAAA,IAAI,CAACzC,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC+H,SAAS,CAAC9U,CAAC,GAAGyU,QAAQ;AACtD,MAAA,IAAI,CAACxC,cAAc,CAAC,CAAC,CAAC,GAAGlF,MAAM,CAAC+H,SAAS,CAAC7U,CAAC,GAAGyU,SAAS;MAEvDnkB,wBAAwB,CACpBvC,MAAM,EACN,IAAI,CAAC8jB,iBAAiB,EACtB,IAAI,CAACG,cAAc,EACnB,CAAC,EACD,IAAI,CAACA,cAAc,CAAC31B,MAAM,GAAGwQ,YAAY,CAAC8D,iBAAiB,CAC9D;MACDyS,sBAAsB,CAACrV,MAAM,EAAE,IAAI,CAACyjB,iBAAiB,EAAE,IAAI,CAACE,kBAAkB,EAAE,CAAC,IAAI,CAACz2B,iBAAiB,CAAC,EAAE,EAAE,EAAE,IAAK,CAAC;AACpH+vB,MAAAA,gBAAgB,CAACjd,MAAM,EAAE,IAAI,CAAC+jB,SAAS,CAAC;AAC3C,IAAA;AAGD,IAAA,IAAI9jB,UAAU,CAAC4H,aAAa,KAAK8d,eAAe,EAAE;MAC9Cp1B,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAE2d,eAAe,CAAC;MAC/D1lB,UAAU,CAAC4H,aAAa,GAAG8d,eAAe;AAC7C,IAAA;AAED,IAAA,IAAMoB,YAAY,GAAG9mB,UAAU,CAACuS,QAAQ;AACxCjiB,IAAAA,EAAE,CAACiiB,QAAQ,CAACuU,YAAY,CAACtU,IAAI,EAAEsU,YAAY,CAACrU,GAAG,EAAEqU,YAAY,CAACljB,KAAK,EAAEkjB,YAAY,CAAChjB,MAAM,CAAC;AAEzF,IAAA,IAAMijB,WAAW,GAAG/mB,UAAU,CAAC2S,WAAW;AAC1CriB,IAAAA,EAAE,CAACsiB,OAAO,CAACmU,WAAW,CAAChV,CAAC,EAAEgV,WAAW,CAAC/U,CAAC,EAAE+U,WAAW,CAACnjB,KAAK,EAAEmjB,WAAW,CAACjjB,MAAM,CAAC;EACnF,CAAC;AAAA,EAAA,OAAAsf,iBAAA;AAAA,CAAA,EAAA;;ACxlBL,IAAa4D,WAAY,aAAAC,OAAA,EAAA;AAarB,EAAA,SAAAD,cAAA;AAAA,IAAA,IAAAj6B,KAAA;AACIA,IAAAA,KAAA,GAAAk6B,OAAA,CAAAj6B,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CALJm6B,UAAU,GAA2B,IAAI;IAAAn6B,KAAA,CACzCo6B,cAAc,GAA+B,IAAI;IAAAp6B,KAAA,CACjDi3B,cAAc,GAAsB,IAAI;AAAA,IAAA,OAAAj3B,KAAA;AAIhD,EAAA;EAACG,cAAA,CAAA85B,WAAA,EAAAC,OAAA,CAAA;AAAA,EAAA,IAAA95B,MAAA,GAAA65B,WAAA,CAAA55B,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAAqD,EAAO;IAC3E,IAAI,QAAQ,IAAIA,IAAI,EAAE;MAClB,IAAI,CAAC85B,aAAa,GAAG,IAAI;AAEzB,MAAA,IAAM/3B,MAAM,GAAG/B,IAAI,CAAC+B,MAAqB;AAEzC,MAAA,IAAI,CAACg4B,MAAM,GAAGh4B,MAAM,CAACkR,KAAK;AAC1B,MAAA,IAAI,CAAC+mB,SAAS,GAAGj4B,MAAM,CAAC6Q,QAAQ;MAChC,IAAI,CAACqnB,KAAK,GAAG,IAAI,CAACC,OAAO,GAAGl6B,IAAI,CAACm6B,KAAK;MACtC,IAAI,CAACC,MAAM,GAAG,CAAC;AACf,MAAA,IAAI,CAACC,MAAM,GAAGt4B,MAAM,CAACkwB,KAAK;MAE1B,IAAI,CAAC4H,cAAc,GAAG;QAClBv4B,SAAS,EAAES,MAAM,CAACT,SAAS;QAC3B2T,MAAM,EAAEjV,IAAI,CAACiV,MAAM;QACnBklB,KAAK,EAAEn6B,IAAI,CAACm6B;OACf;AACJ,IAAA,CAAA,MAAM;AACH,MAAA,IAAI,CAACJ,MAAM,GAAG/5B,IAAI,CAACiT,KAAK;AACxB,MAAA,IAAI,CAAC+mB,SAAS,GAAGh6B,IAAI,CAAC4S,QAAQ;AAC9B,MAAA,IAAI,CAACqnB,KAAK,GAAGj6B,IAAI,CAACwT,IAAI;AACtB,MAAA,IAAI,CAAC0mB,OAAO,GAAGt3B,IAAI,CAACD,GAAG,CAAC3C,IAAI,CAACof,MAAM,IAAI,IAAI,CAAC6a,KAAK,EAAE,CAAC,CAAC;MACrD,IAAI,CAACG,MAAM,GAAG,IAAI,CAACH,KAAK,GAAG,IAAI,CAACC,OAAO;AACvC,MAAA,IAAI,CAACG,MAAM,GAAGr6B,IAAI,CAACiyB,KAAK;AAExB,MAAA,IAAK,IAAI,CAAC8H,MAAM,GAAG7mB,cAAc,CAACoB,OAAO,IAAK,IAAI,CAAC2lB,KAAK,GAAG,CAAC,EAAE;QAC1D,IAAI,CAACvD,cAAc,GAAG,IAAIte,UAAU,CAAC,IAAI,CAAC6hB,KAAK,CAAC;AACnD,MAAA;MAED,IAAI,CAACL,UAAU,GAAG;QACd3mB,KAAK,EAAE,IAAI,CAAC8mB,MAAM;QAClBnnB,QAAQ,EAAE,IAAI,CAAConB,SAAS;QACxBxmB,IAAI,EAAE,IAAI,CAACymB,KAAK;QAChB7a,MAAM,EAAE,IAAI,CAAC8a,OAAO;AACpBn4B,QAAAA,MAAM,EAAE,IAAI;AACZyS,QAAAA,IAAI,EAAE,IAAI;AACVc,QAAAA,SAAS,EAAE,IAAImgB,sBAAsB,EAAE;AACvCriB,QAAAA,QAAQ,EAAE,CAAC;AACXE,QAAAA,QAAQ,EAAE;OACb;AAED,MAAA,IAAI,IAAI,CAACymB,MAAM,GAAG7mB,cAAc,CAACoB,OAAO,EAAE;AACtC,QAAA,IAAI,CAACslB,UAAU,CAAC73B,MAAM,GAAG,IAAI,CAAC20B,cAAc;AAC/C,MAAA;MAEDlkB,wBAAwB,CAACjQ,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACm3B,UAAU,CAAC;MAEtEr3B,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAI,IAAI,CAACuH,KAAK;AACpE,IAAA;EACL,CAAC;AAAAp6B,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAI,IAAI,CAACk4B,UAAU,EAAE;MACjBhlB,yBAAyB,CAACrS,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACm3B,UAAU,CAAC;MACvEr3B,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAI,IAAI,CAACuH,KAAK;MACjE,IAAI,CAACL,UAAU,GAAG,IAAI;AACzB,IAAA;IAED,IAAI,IAAI,CAACC,cAAc,EAAE;MACrB,IAAI,CAACA,cAAc,GAAG,IAAI;AAC7B,IAAA;EACL,CAAC;AAAAh6B,EAAAA,MAAA,CAEMy6B,MAAM,GAAb,SAAOA,MAAMA,CAAE9mB,IAAY,EAAO;IAC9B,IAAI,IAAI,CAACsmB,aAAa,EAAE;MACpBS,MAAM,CAAC,KAAK,CAAC;AACb,MAAA;AACH,IAAA;AAED,IAAA,IAAMC,OAAO,GAAG,IAAI,CAACP,KAAK;IAC1B,IAAIO,OAAO,KAAKhnB,IAAI,EAAE;AAAE,MAAA;AAAS,IAAA;IAEjC,IAAI,CAACymB,KAAK,GAAGzmB,IAAI;IACjB,IAAI,CAAC4mB,MAAM,GAAG,IAAI,CAACH,KAAK,GAAG,IAAI,CAACC,OAAO;IAEvC,IAAI,IAAI,CAACxD,cAAc,EAAE;AACrB,MAAA,IAAI,CAACA,cAAc,GAAG,IAAIte,UAAU,CAAC5E,IAAI,CAAC;AAC7C,IAAA;IAED,IAAI,IAAI,CAAComB,UAAU,EAAE;MACjB,IAAI,IAAI,CAAClD,cAAc,EAAE;AACrB,QAAA,IAAI,CAACkD,UAAU,CAAC73B,MAAM,GAAG,IAAI,CAAC20B,cAAc;AAC/C,MAAA;AAED,MAAA,IAAI,CAACkD,UAAU,CAACpmB,IAAI,GAAGA,IAAI;MAC3B,IAAIA,IAAI,GAAG,CAAC,EAAE;QACVuB,wBAAwB,CAACxS,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACm3B,UAAU,CAAC;AACtEr3B,QAAAA,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAI8H,OAAO;AAC9Dj4B,QAAAA,kBAAkB,CAACE,QAAQ,CAACk1B,YAAY,CAACjF,UAAU,IAAIlf,IAAI;AAC9D,MAAA;AACJ,IAAA;EACL,CAAC;EAAA3T,MAAA,CAEM8B,MAAM,GAAb,SAAOA,MAAMA,CAAEI,MAA8B,EAAEyR,IAAa,EAAO;IAC/D,IAAI,IAAI,CAACsmB,aAAa,EAAE;MACpBS,MAAM,CAAC,KAAK,CAAC;AACb,MAAA;AACH,IAAA;AAED,IAAA,IAAIE,QAAgB;IACpB,IAAIjnB,IAAI,KAAKkO,SAAS,EAAE;AACpB+Y,MAAAA,QAAQ,GAAGjnB,IAAI;IAClB,CAAA,MAAM,IAAI,IAAI,CAACumB,MAAM,GAAG7mB,cAAc,CAACuB,QAAQ,EAAE;AAC9CgmB,MAAAA,QAAQ,GAAG,CAAC;AACf,IAAA,CAAA,MAAM;MACHA,QAAQ,GAAI14B,MAAM,CAAiBgU,UAAU;AAChD,IAAA;AAEDf,IAAAA,wBAAwB,CACpBzS,kBAAkB,CAACE,QAAQ,EAC3B,IAAI,CAACm3B,UAAU,EACf73B,MAAM,EACN,CAAC,EACD04B,QAAQ,CACX;EACL,CAAC;EAAA,OAAAv4B,YAAA,CAAAw3B,WAAA,EAAA,CAAA;IAAAv3B,GAAA,EAAA,WAAA;IAAAC,GAAA,EAnID,SAAAA,GAAAA,GAAiC;MAC7B,OAAQ,IAAI,CAACw3B,UAAU;AAC3B,IAAA;AAAC,GAAA,EAAA;IAAAz3B,GAAA,EAAA,eAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAyC;MACrC,OAAQ,IAAI,CAACy3B,cAAc;AAC/B,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAP4Ba,MAAM,CAAA;;ACOvC,IAAaC,kBAAmB,aAAAC,cAAA,EAAA;AAS5B,EAAA,SAAAD,qBAAA;AAAA,IAAA,IAAAl7B,KAAA;AACIA,IAAAA,KAAA,GAAAm7B,cAAA,CAAAl7B,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CATFo7B,eAAe,GAAG,KAAK;IAAAp7B,KAAA,CACvBq7B,oBAAoB,GAAkC,IAAI;IAAAr7B,KAAA,CAC1Ds7B,qBAAqB,GAAmC,IAAI;IAAAt7B,KAAA,CAC5Du7B,qBAAqB,GAA6B,EAAE;IAAAv7B,KAAA,CACpDw7B,kBAAkB,GAAax6B,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;AAAAjB,IAAAA,KAAA,CAC/Cy7B,iBAAiB,GAAkB,IAAIC,aAAa,EAAE;IAAA17B,KAAA,CACtD27B,gBAAgB,GAAG,KAAK;AAAA,IAAA,OAAA37B,KAAA;AAIlC,EAAA;EAACG,cAAA,CAAA+6B,kBAAA,EAAAC,cAAA,CAAA;AAAA,EAAA,IAAA/6B,MAAA,GAAA86B,kBAAA,CAAA76B,SAAA;AAAAD,EAAAA,MAAA,CAEeE,UAAU,GAA1B,SAAgBA,UAAUA,CAAEC,IAAiC,EAAO;AAChE,IAAA,IAAI,CAACq7B,KAAK,GAAGr7B,IAAI,CAACoB,IAAI;AACtB,IAAA,IAAI,CAACk6B,MAAM,GAAGt7B,IAAI,CAACu7B,KAAK;IAExB,IAAMC,QAAQ,GAAGj5B,kBAAkB,CAACE,QAAQ,CAACwe,eAAe,CAACwa,YAAY,CAAC16B,MAAM;IAChF,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG06B,QAAQ,EAAE16B,CAAC,EAAE,EAAE;AAC/B,MAAA,IAAI,CAACk6B,qBAAqB,CAACv5B,IAAI,CAAC,IAAK,CAAC;AACzC,IAAA;EACL,CAAC;EAAA5B,MAAA,CAEe6B,OAAO,GAAvB,SAAgBA,OAAOA,GAAS,CAChC,CAAC;EAAA7B,MAAA,CAEe67B,KAAK,GAArB,SAAgBA,KAAKA,CAAEC,UAAuB,EAAEC,OAAgB,EAAEC,WAAyB,EAAO;IAC9F,IAAI,CAACf,oBAAoB,GAAG,IAAI;IAChC,IAAI,CAACC,qBAAqB,GAAG,IAAI;AACjC,IAAA,IAAI,CAACC,qBAAqB,CAACj6B,MAAM,GAAG,CAAC;IACrC,IAAI,CAAC+6B,aAAa,GAAG,CAAC;IACtB,IAAI,CAACC,aAAa,GAAG,CAAC;IACtB,IAAI,CAACC,QAAQ,GAAG,CAAC;EACrB,CAAC;AAAAn8B,EAAAA,MAAA,CAEeo8B,GAAG,GAAnB,SAAgBA,GAAGA,GAAS;IACxB,IAAI,IAAI,CAACb,gBAAgB,EAAE;MACvB,IAAI,CAACc,UAAU,EAAE;AACpB,IAAA;IAED,IAAI,CAACrB,eAAe,GAAG,KAAK;EAChC,CAAC;AAAAh7B,EAAAA,MAAA,CAEes8B,eAAe,GAA/B,SAAgBA,eAAeA,CAC3BR,UAAsB,EACtB5G,WAAwB,EACxB5Q,UAA0B,EAC1BC,WAA8B,EAC9BC,UAAkB,EAClBC,YAAoB,EACjB;IACHnZ,OAAO,CAAC,KAAK,CAAC;IACd,IAAI,CAAC0vB,eAAe,GAAG,IAAI;EAC/B,CAAC;AAAAh7B,EAAAA,MAAA,CAEeu8B,aAAa,GAA7B,SAAgBA,aAAaA,GAAS;IAClC,IAAI,CAACvB,eAAe,GAAG,KAAK;EAChC,CAAC;AAAAh7B,EAAAA,MAAA,CAEew8B,iBAAiB,GAAjC,SAAgBA,iBAAiBA,CAAEC,aAA4B,EAAO;AAClE,IAAA,IAAMzY,gBAAgB,GAAIyY,aAAa,CAAwBzY,gBAAgB;AAC/E,IAAA,IAAIA,gBAAgB,KAAK,IAAI,CAACiX,oBAAoB,EAAE;MAChD,IAAI,CAACA,oBAAoB,GAAGjX,gBAAgB;MAC5C,IAAI,CAACuX,gBAAgB,GAAG,IAAI;AAC/B,IAAA;EACL,CAAC;EAAAv7B,MAAA,CAEe08B,iBAAiB,GAAjC,SAAgBA,iBAAiBA,CAAEnnB,GAAW,EAAEonB,aAA4B,EAAExU,cAAmC,EAAO;AACpH,IAAA,IAAM0D,gBAAgB,GAAI8Q,aAAa,CAAwB9Q,gBAAgB;IAC/E,IAAIA,gBAAgB,KAAK,IAAI,CAACsP,qBAAqB,CAAC5lB,GAAG,CAAC,EAAE;AACtD,MAAA,IAAI,CAAC4lB,qBAAqB,CAAC5lB,GAAG,CAAC,GAAGsW,gBAAgB;MAClD,IAAI,CAAC0P,gBAAgB,GAAG,IAAI;AAC/B,IAAA;AACD,IAAA,IAAIpT,cAAc,EAAE;AAAA,MAAA,IAAAyU,qBAAA;MAChB,IAAMlR,iBAAiB,GAAA,CAAAkR,qBAAA,GAAG,IAAI,CAAC3B,oBAAoB,KAAA,IAAA,GAAA,MAAA,GAAzB2B,qBAAA,CAA2BlR,iBAAiB;AACtE,MAAA,IAAIA,iBAAiB,EAAE;AACnB,QAAA,IAAM9I,OAAO,GAAG,IAAI,CAACwY,kBAAkB;AACvC,QAAA,IAAMlP,GAAG,GAAGR,iBAAiB,CAACgM,oBAAoB,CAACniB,GAAG,CAAC;QACvD,KAAK,IAAItU,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGknB,cAAc,CAACjnB,MAAM,EAAED,CAAC,EAAE,EAAE2hB,OAAO,CAACsJ,GAAG,GAAGjrB,CAAC,CAAC,GAAGknB,cAAc,CAAClnB,CAAC,CAAC;QACpF,IAAI,CAACs6B,gBAAgB,GAAG,IAAI;AAC/B,MAAA;AACJ,IAAA;EACL,CAAC;AAAAv7B,EAAAA,MAAA,CAEe68B,kBAAkB,GAAlC,SAAgBA,kBAAkBA,CAAEC,cAA8B,EAAO;AACrE,IAAA,IAAM5oB,iBAAiB,GAAI4oB,cAAc,CAAyBC,oBAAoB,EAAE;IACxF,IAAI,CAAC7B,qBAAqB,GAAGhnB,iBAAiB;IAC9C,IAAI,CAACqnB,gBAAgB,GAAG,IAAI;EAChC,CAAC;AAAAv7B,EAAAA,MAAA,CAEeg9B,WAAW,GAA3B,SAAgBA,WAAWA,CAAE5X,QAA4B,EAAO;AAC5D,IAAA,IAAMpQ,KAAK,GAAG,IAAI,CAACqmB,iBAAiB,CAACjW,QAAQ;IAC7C,IAAIpQ,KAAK,CAACqQ,IAAI,KAAKD,QAAQ,CAACC,IAAI,IACzBrQ,KAAK,CAACsQ,GAAG,KAAKF,QAAQ,CAACE,GAAG,IAC1BtQ,KAAK,CAACyB,KAAK,KAAK2O,QAAQ,CAAC3O,KAAK,IAC9BzB,KAAK,CAAC2B,MAAM,KAAKyO,QAAQ,CAACzO,MAAM,IAChC3B,KAAK,CAACioB,QAAQ,KAAK7X,QAAQ,CAAC6X,QAAQ,IACpCjoB,KAAK,CAACkoB,QAAQ,KAAK9X,QAAQ,CAAC8X,QAAQ,EAAE;AACzCloB,MAAAA,KAAK,CAACqQ,IAAI,GAAGD,QAAQ,CAACC,IAAI;AAC1BrQ,MAAAA,KAAK,CAACsQ,GAAG,GAAGF,QAAQ,CAACE,GAAG;AACxBtQ,MAAAA,KAAK,CAACyB,KAAK,GAAG2O,QAAQ,CAAC3O,KAAK;AAC5BzB,MAAAA,KAAK,CAAC2B,MAAM,GAAGyO,QAAQ,CAACzO,MAAM;AAC9B3B,MAAAA,KAAK,CAACioB,QAAQ,GAAG7X,QAAQ,CAAC6X,QAAQ;AAClCjoB,MAAAA,KAAK,CAACkoB,QAAQ,GAAG9X,QAAQ,CAAC8X,QAAQ;MAClC,IAAI,CAAC3B,gBAAgB,GAAG,IAAI;AAC/B,IAAA;EACL,CAAC;AAAAv7B,EAAAA,MAAA,CAEem9B,UAAU,GAA1B,SAAgBA,UAAUA,CAAE1X,OAAuB,EAAO;AACtD,IAAA,IAAMzQ,KAAK,GAAG,IAAI,CAACqmB,iBAAiB,CAAC5V,OAAO;AAC5C,IAAA,IAAIzQ,KAAK,CAAC4P,CAAC,KAAKa,OAAO,CAACb,CAAC,IAClB5P,KAAK,CAAC6P,CAAC,KAAKY,OAAO,CAACZ,CAAC,IACrB7P,KAAK,CAACyB,KAAK,KAAKgP,OAAO,CAAChP,KAAK,IAC7BzB,KAAK,CAAC2B,MAAM,KAAK8O,OAAO,CAAC9O,MAAM,EAAE;AACpC3B,MAAAA,KAAK,CAAC4P,CAAC,GAAGa,OAAO,CAACb,CAAC;AACnB5P,MAAAA,KAAK,CAAC6P,CAAC,GAAGY,OAAO,CAACZ,CAAC;AACnB7P,MAAAA,KAAK,CAACyB,KAAK,GAAGgP,OAAO,CAAChP,KAAK;AAC3BzB,MAAAA,KAAK,CAAC2B,MAAM,GAAG8O,OAAO,CAAC9O,MAAM;MAC7B,IAAI,CAAC4kB,gBAAgB,GAAG,IAAI;AAC/B,IAAA;EACL,CAAC;AAAAv7B,EAAAA,MAAA,CAEeo9B,YAAY,GAA5B,SAAgBA,YAAYA,CAAE9T,SAAiB,EAAO;AAClD,IAAA,IAAI,IAAI,CAAC+R,iBAAiB,CAAC/R,SAAS,KAAKA,SAAS,EAAE;AAChD,MAAA,IAAI,CAAC+R,iBAAiB,CAAC/R,SAAS,GAAGA,SAAS;MAC5C,IAAI,CAACiS,gBAAgB,GAAG,IAAI;AAC/B,IAAA;EACL,CAAC;EAAAv7B,MAAA,CAEeq9B,YAAY,GAA5B,SAAgBA,YAAYA,CAAEC,uBAA+B,EAAEC,cAAsB,EAAEC,oBAA4B,EAAO;AACtH,IAAA,IAAMxoB,KAAK,GAAG,IAAI,CAACqmB,iBAAiB;AACpC,IAAA,IAAIrmB,KAAK,CAAC+Z,iBAAiB,KAAKuO,uBAAuB,IAChDtoB,KAAK,CAACuoB,cAAc,KAAKA,cAAc,IACvCvoB,KAAK,CAACga,cAAc,KAAKwO,oBAAoB,EAAE;MAClDxoB,KAAK,CAAC+Z,iBAAiB,GAAGuO,uBAAuB;MACjDtoB,KAAK,CAACuoB,cAAc,GAAGA,cAAc;MACrCvoB,KAAK,CAACga,cAAc,GAAGwO,oBAAoB;MAC3C,IAAI,CAACjC,gBAAgB,GAAG,IAAI;AAC/B,IAAA;EACL,CAAC;AAAAv7B,EAAAA,MAAA,CAEey9B,iBAAiB,GAAjC,SAAgBA,iBAAiBA,CAAEC,cAA+B,EAAO;AACrE,IAAA,IAAM1oB,KAAK,GAAG,IAAI,CAACqmB,iBAAiB,CAACnM,aAAa;AAClD,IAAA,IAAIla,KAAK,CAAC4P,CAAC,KAAK8Y,cAAc,CAAC9Y,CAAC,IACzB5P,KAAK,CAAC6P,CAAC,KAAK6Y,cAAc,CAAC7Y,CAAC,IAC5B7P,KAAK,CAAC0R,CAAC,KAAKgX,cAAc,CAAChX,CAAC,IAC5B1R,KAAK,CAACwB,CAAC,KAAKknB,cAAc,CAAClnB,CAAC,EAAE;AACjCxB,MAAAA,KAAK,CAACma,IAAI,CAACuO,cAAc,CAAC;MAC1B,IAAI,CAACnC,gBAAgB,GAAG,IAAI;AAC/B,IAAA;EACL,CAAC;EAAAv7B,MAAA,CAEe29B,aAAa,GAA7B,SAAgBA,aAAaA,CAAEC,cAAsB,EAAEC,cAAsB,EAAO;AAChF,IAAA,IAAM7oB,KAAK,GAAG,IAAI,CAACqmB,iBAAiB;IACpC,IAAIrmB,KAAK,CAAC8oB,cAAc,KAAKF,cAAc,IACpC5oB,KAAK,CAAC+oB,cAAc,KAAKF,cAAc,EAAE;MAC5C7oB,KAAK,CAAC8oB,cAAc,GAAGF,cAAc;MACrC5oB,KAAK,CAAC+oB,cAAc,GAAGF,cAAc;MACrC,IAAI,CAACtC,gBAAgB,GAAG,IAAI;AAC/B,IAAA;EACL,CAAC;EAAAv7B,MAAA,CAEeg+B,mBAAmB,GAAnC,SAAgBA,mBAAmBA,CAAEC,IAAiB,EAAExO,SAAiB,EAAO;AAC5E,IAAA,IAAMJ,KAAK,GAAG,IAAI,CAACgM,iBAAiB,CAAC/L,kBAAkB;AACvD,IAAA,IAAMC,IAAI,GAAG,IAAI,CAAC8L,iBAAiB,CAAC7L,iBAAiB;AACrD,IAAA,IAAIyO,IAAI,GAAGC,WAAW,CAAC7W,KAAK,EAAE;AAC1B,MAAA,IAAIgI,KAAK,CAACI,SAAS,KAAKA,SAAS,EAAE;QAC/BJ,KAAK,CAACI,SAAS,GAAGA,SAAS;QAC3B,IAAI,CAAC8L,gBAAgB,GAAG,IAAI;AAC/B,MAAA;AACJ,IAAA;AACD,IAAA,IAAI0C,IAAI,GAAGC,WAAW,CAAC3W,IAAI,EAAE;AACzB,MAAA,IAAIgI,IAAI,CAACE,SAAS,KAAKA,SAAS,EAAE;QAC9BF,IAAI,CAACE,SAAS,GAAGA,SAAS;QAC1B,IAAI,CAAC8L,gBAAgB,GAAG,IAAI;AAC/B,MAAA;AACJ,IAAA;EACL,CAAC;EAAAv7B,MAAA,CAEem+B,qBAAqB,GAArC,SAAgBA,qBAAqBA,CAAEF,IAAiB,EAAEtO,SAAiB,EAAEC,WAAmB,EAAO;AACnG,IAAA,IAAMP,KAAK,GAAG,IAAI,CAACgM,iBAAiB,CAAC/L,kBAAkB;AACvD,IAAA,IAAMC,IAAI,GAAG,IAAI,CAAC8L,iBAAiB,CAAC7L,iBAAiB;AACrD,IAAA,IAAIyO,IAAI,GAAGC,WAAW,CAAC7W,KAAK,EAAE;MAC1B,IAAIgI,KAAK,CAACO,WAAW,KAAKA,WAAW,IAC9BP,KAAK,CAACM,SAAS,KAAKA,SAAS,EAAE;QAClCN,KAAK,CAACM,SAAS,GAAGA,SAAS;QAC3BN,KAAK,CAACO,WAAW,GAAGA,WAAW;QAC/B,IAAI,CAAC2L,gBAAgB,GAAG,IAAI;AAC/B,MAAA;AACJ,IAAA;AACD,IAAA,IAAI0C,IAAI,GAAGC,WAAW,CAAC3W,IAAI,EAAE;MACzB,IAAIgI,IAAI,CAACK,WAAW,KAAKA,WAAW,IAC7BL,IAAI,CAACI,SAAS,KAAKA,SAAS,EAAE;QACjCJ,IAAI,CAACI,SAAS,GAAGA,SAAS;QAC1BJ,IAAI,CAACK,WAAW,GAAGA,WAAW;QAC9B,IAAI,CAAC2L,gBAAgB,GAAG,IAAI;AAC/B,MAAA;AACJ,IAAA;EACL,CAAC;AAAAv7B,EAAAA,MAAA,CAEey1B,IAAI,GAApB,SAAgBA,IAAIA,CAAE2I,eAA8D,EAAO;IACvF9yB,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC;EAAAtL,MAAA,CAEeq+B,YAAY,GAA5B,SAAgBA,YAAYA,CAAEn8B,MAAc,EAAE61B,IAA4B,EAAEpkB,IAAa,EAAO;IAC5FrI,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC;EAAAtL,MAAA,CAEes+B,oBAAoB,GAApC,SAAgBA,oBAAoBA,CAAE1K,OAAoC,EAAE2K,OAAgB,EAAE7M,OAAsC,EAAO;IACvIpmB,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC;EAAAtL,MAAA,CAEew+B,OAAO,GAAvB,SAAgBA,OAAOA,CAAEC,QAAmC,EAAEp9B,KAAa,EAAO;IAC9EiK,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC;AAAAtL,EAAAA,MAAA,CAEe0+B,eAAe,GAA/B,SAAgBA,eAAeA,CAC3BC,cAAwC,EACxCC,cAA0C,EAC1ChL,OAA4B,EAC5BiL,eAA4C,EAC5CC,QAA8B,EAC3B,CAEP,CAAC;AAAA9+B,EAAAA,MAAA,CAESq8B,UAAU,GAApB,SAAUA,UAAUA,GAAS;IACzB/wB,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC;AAAAtL,EAAAA,MAAA,CAEe++B,WAAW,GAA3B,SAAgBA,WAAWA,CAAE1J,UAA6B,EAAEC,UAAmB,EAAE5D,OAAiC,EAAE6D,MAAc,EAAO;IACrIjqB,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC;AAAA,EAAA,OAAAwvB,kBAAA;AAAA,CAAA,CAxOmCkE,aAAa,CAAA;;ACXrD,IAAaC,gBAAiB,aAAAC,YAAA,EAAA;AAS1B,EAAA,SAAAD,mBAAA;AAAA,IAAA,IAAAr/B,KAAA;AACIA,IAAAA,KAAA,GAAAs/B,YAAA,CAAAr/B,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CALJu/B,eAAe,GAAgC,IAAI;IAAAv/B,KAAA,CACnDw/B,iBAAiB,GAA4B,EAAE;AAAAx/B,IAAAA,KAAA,CAC/Cy/B,uBAAuB,GAAA,MAAA;AAAA,IAAA,OAAAz/B,KAAA;AAI/B,EAAA;EAACG,cAAA,CAAAk/B,gBAAA,EAAAC,YAAA,CAAA;AAAA,EAAA,IAAAl/B,MAAA,GAAAi/B,gBAAA,CAAAh/B,SAAA;AAAAD,EAAAA,MAAA,CAVDs/B,iBAAiB,GAAjB,SAAAA,iBAAiBA,GAAyB;IACtC,OAAQ,IAAI,CAACH,eAAe;EAChC,CAAC;AAAAn/B,EAAAA,MAAA,CA0BeE,UAAU,GAA1B,SAAgBA,UAAUA,CAAEC,IAA+B,EAAO;AAAA,IAAA,IAAAo/B,MAAA,GAAA,IAAA;MAAAC,qBAAA;AAC9D,IAAA,IAAI,CAACC,WAAW,GAAGt/B,IAAI,CAAC27B,UAAU;AAClC,IAAA,IAAI,CAAC4D,cAAc,GAAGv/B,IAAI,CAACw/B,aAAa,IAAI,EAAE;IAC9C,IAAMC,mBAAmC,GAAG,IAAI,CAACC,oBAAoB,GAAG1/B,IAAI,CAACy/B,mBAAmB,IAAuB,IAAI;IAE3H,IAAIjb,QAAQ,GAAG,CAAC;IAEhB,IAAMvK,gBAAoC,GAAG,EAAE;AAC/C,IAAA,KAAK,IAAInZ,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGd,IAAI,CAACw/B,aAAa,CAACz+B,MAAM,EAAE,EAAED,CAAC,EAAE;AAChD,MAAA,IAAM6+B,YAAY,GAAG3/B,IAAI,CAACw/B,aAAa,CAAC1+B,CAAC,CAAmB;AAC5D,MAAA,IAAI6+B,YAAY,EAAE;AACd1lB,QAAAA,gBAAgB,CAACxY,IAAI,CAACk+B,YAAY,CAACp+B,UAAU,CAAC;QAC9CijB,QAAQ,GAAGmb,YAAY,CAACnb,QAAQ;AACnC,MAAA;AACJ,IAAA;IAED,IAAI1J,sBAA+C,GAAG,IAAI;AAC1D,IAAA,IAAI2kB,mBAAmB,EAAE;MACrB3kB,sBAAsB,GAAG2kB,mBAAmB,CAACl+B,UAAU;MACvDijB,QAAQ,GAAGib,mBAAmB,CAACjb,QAAQ;AAC1C,IAAA;AAED,IAAA,IAAIlO,KAAK,GAAGgd,MAAM,CAACsM,gBAAgB;AACnC,IAAA,IAAIppB,MAAM,GAAG8c,MAAM,CAACsM,gBAAgB;IACpC,IAAI,CAACZ,eAAe,GAAG;AACnB9a,MAAAA,aAAa,EAAGlkB,IAAI,CAAC27B,UAAU,CAAqBzX,aAAa;AACjEjK,MAAAA,gBAAgB,EAAhBA,gBAAgB;AAChBa,MAAAA,sBAAsB,EAAtBA,sBAAsB;AACtBR,MAAAA,aAAa,EAAE,IAAI;AACnBF,MAAAA,WAAW,EAAE,IAAI;MACjB,IAAI9D,KAAKA,GAAW;AAChB,QAAA,IAAI,IAAI,CAAC2D,gBAAgB,CAAClZ,MAAM,GAAG,CAAC,EAAE;AAClC,UAAA,OAAO,IAAI,CAACkZ,gBAAgB,CAAC,CAAC,CAAC,CAAC3D,KAAK;AACxC,QAAA,CAAA,MAAM,IAAI,IAAI,CAACwE,sBAAsB,EAAE;AACpC,UAAA,OAAO,IAAI,CAACA,sBAAsB,CAACxE,KAAK;AAC3C,QAAA;AACD,QAAA,OAAOA,KAAK;MAChB,CAAC;MACD,IAAIA,KAAKA,CAAEupB,GAAG,EAAA;AACVvpB,QAAAA,KAAK,GAAGupB,GAAG;MACf,CAAC;MACD,IAAIrpB,MAAMA,GAAW;AACjB,QAAA,IAAI,IAAI,CAACyD,gBAAgB,CAAClZ,MAAM,GAAG,CAAC,EAAE;AAClC,UAAA,OAAO,IAAI,CAACkZ,gBAAgB,CAAC,CAAC,CAAC,CAACzD,MAAM;AACzC,QAAA,CAAA,MAAM,IAAI,IAAI,CAACsE,sBAAsB,EAAE;AACpC,UAAA,OAAO,IAAI,CAACA,sBAAsB,CAACtE,MAAM;AAC5C,QAAA;AACD,QAAA,OAAOA,MAAM;MACjB,CAAC;MACD,IAAIA,MAAMA,CAAEqpB,GAAG,EAAA;AACXrpB,QAAAA,MAAM,GAAGqpB,GAAG;MAChB,CAAC;AACDrb,MAAAA,QAAQ,EAARA;KACH;IAEDzK,6BAA6B,CAACxX,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACu8B,eAAe,CAAC;IAChF,IAAI,CAACA,eAAe,CAAC/kB,gBAAgB,CAAC6lB,OAAO,CAAC,UAAC5lB,GAAG,EAAA;MAAA,OAAKklB,MAAI,CAACH,iBAAiB,CAACx9B,IAAI,CAACyY,GAAG,CAACzC,SAAS,CAAC;IAAA,CAAA,CAAC;AAClG,IAAA,IAAI,CAACynB,uBAAuB,GAAA,CAAAG,qBAAA,GAAG,IAAI,CAACL,eAAe,CAAClkB,sBAAsB,KAAA,IAAA,GAAA,MAAA,GAA3CukB,qBAAA,CAA6C5nB,SAAS;AACrF,IAAA,IAAI,CAACsoB,MAAM,GAAG,IAAI,CAACf,eAAe,CAAC1oB,KAAK;AACxC,IAAA,IAAI,CAAC0pB,OAAO,GAAG,IAAI,CAAChB,eAAe,CAACxoB,MAAM;EAC9C,CAAC;AAAA3W,EAAAA,MAAA,CAEe6B,OAAO,GAAvB,SAAgBA,OAAOA,GAAS;IAC5B,IAAI,IAAI,CAACs9B,eAAe,EAAE;MACtBpjB,8BAA8B,CAACrZ,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACu8B,eAAe,CAAC;MACjF,IAAI,CAACA,eAAe,GAAG,IAAI;AAC3B,MAAA,IAAI,CAACC,iBAAiB,CAACl+B,MAAM,GAAG,CAAC;MACjC,IAAI,CAACm+B,uBAAuB,GAAG,IAAI;AACtC,IAAA;EACL,CAAC;EAAA,OAAAh9B,YAAA,CAAA48B,gBAAA,EAAA,CAAA;IAAA38B,GAAA,EAAA,aAAA;IAAAC,GAAA,EArFD,SAAAA,GAAAA,GAA2B;AACvB,MAAA,IAAM4X,cAAc,GAAG,IAAI,CAACglB,eAAe;AAC3C,MAAA,IAAIhlB,cAAc,EAAE;AAAA,QAAA,IAAAimB,qBAAA;AAChB,QAAA,KAAK,IAAIn/B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkZ,cAAc,CAACC,gBAAgB,CAAClZ,MAAM,EAAED,CAAC,EAAE,EAAE;AAC7D,UAAA,IAAIkZ,cAAc,CAACC,gBAAgB,CAACnZ,CAAC,CAAC,CAAC2W,SAAS,KAAK,IAAI,CAACwnB,iBAAiB,CAACn+B,CAAC,CAAC,EAAE;AAC5E,YAAA,OAAO,IAAI;AACd,UAAA;AACJ,QAAA;AACD,QAAA,IAAI,CAAA,CAAAm/B,qBAAA,GAAAjmB,cAAc,CAACc,sBAAsB,KAAA,IAAA,GAAA,MAAA,GAArCmlB,qBAAA,CAAuCxoB,SAAS,MAAK,IAAI,CAACynB,uBAAuB,EAAE;AACnF,UAAA,OAAO,IAAI;AACd,QAAA;AACJ,MAAA;AAED,MAAA,OAAO,KAAK;AAChB,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CA3BiCgB,WAAW,CAAA;;ACDjD,IAAaC,mBAAoB,aAAAC,eAAA,EAAA;AAO7B,EAAA,SAAAD,sBAAA;AAAA,IAAA,IAAA1gC,KAAA;AACIA,IAAAA,KAAA,GAAA2gC,eAAA,CAAA1gC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAHJ22B,kBAAkB,GAAmC,IAAI;AAAA,IAAA,OAAA32B,KAAA;AAIjE,EAAA;EAACG,cAAA,CAAAugC,mBAAA,EAAAC,eAAA,CAAA;AAAA,EAAA,IAAAvgC,MAAA,GAAAsgC,mBAAA,CAAArgC,SAAA;AAAAD,EAAAA,MAAA,CARD+8B,oBAAoB,GAApB,SAAAA,oBAAoBA,GAA4B;IAC5C,OAAQ,IAAI,CAACxG,kBAAkB;EACnC,CAAC;AAAAv2B,EAAAA,MAAA,CAQeE,UAAU,GAA1B,SAAgBA,UAAUA,CAAEC,IAAkC,EAAO;AACjE,IAAA,IAAIA,IAAI,CAACqgC,aAAa,CAACt/B,MAAM,KAAK,CAAC,EAAE;MACjCoK,OAAO,CAAC,KAAK,CAAC;AACd,MAAA;AACH,IAAA;AAED,IAAA,IAAI,CAACm1B,WAAW,GAAGtgC,IAAI,CAACwiB,UAAU;AAClC,IAAA,IAAI,CAAC+d,eAAe,GAAG,IAAI,CAACC,qBAAqB,EAAE;AACnD,IAAA,IAAI,CAACC,cAAc,GAAGzgC,IAAI,CAACqgC,aAAa;IAExC,IAAIrgC,IAAI,CAAC+vB,WAAW,EAAE;AAClB,MAAA,IAAI,CAAC2Q,YAAY,GAAG1gC,IAAI,CAAC+vB,WAAW;AACpC,MAAA,IAAI,CAACyG,SAAS,CAACvF,UAAU,GAAG,IAAI,CAACyP,YAAY,CAACltB,IAAI,GAAG,IAAI,CAACktB,YAAY,CAACthB,MAAM;AAC7E,MAAA,IAAI,CAACoX,SAAS,CAACtF,UAAU,GAAG,CAAC;AAChC,IAAA,CAAA,MAAM;AACH,MAAA,IAAMyP,QAAQ,GAAG,IAAI,CAACF,cAAc,CAAC,CAAC,CAAC;MACvC,IAAI,CAACjK,SAAS,CAACrF,WAAW,GAAGwP,QAAQ,CAACntB,IAAI,GAAGmtB,QAAQ,CAACvhB,MAAM;AAC5D,MAAA,IAAI,CAACoX,SAAS,CAACpF,WAAW,GAAG,CAAC;AAC9B,MAAA,IAAI,CAACoF,SAAS,CAACoK,YAAY,GAAG,CAAC;AAClC,IAAA;AACD,IAAA,IAAI,CAACpK,SAAS,CAACxF,aAAa,GAAG,CAAC;AAChC,IAAA,IAAI,CAACwF,SAAS,CAACqK,aAAa,GAAG,CAAC;AAEhC,IAAA,IAAI,CAACC,eAAe,GAAG9gC,IAAI,CAAC+gC,cAAc,IAAI,IAAI;IAElD,IAAM9d,gBAAmC,GAAG,IAAIxiB,KAAK,CAAkBT,IAAI,CAACqgC,aAAa,CAACt/B,MAAM,CAAC;AACjG,IAAA,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGd,IAAI,CAACqgC,aAAa,CAACt/B,MAAM,EAAE,EAAED,CAAC,EAAE;AAChD,MAAA,IAAMkgC,EAAE,GAAGhhC,IAAI,CAACqgC,aAAa,CAACv/B,CAAC,CAAgB;MAC/C,IAAIkgC,EAAE,CAAC1/B,SAAS,EAAE;AACd2hB,QAAAA,gBAAgB,CAACniB,CAAC,CAAC,GAAGkgC,EAAE,CAAC1/B,SAAS;AACrC,MAAA;AACJ,IAAA;IAED,IAAI6sB,cAAsC,GAAG,IAAI;IACjD,IAAIoC,WAAW,GAAG,CAAC;IACnB,IAAIvwB,IAAI,CAAC+vB,WAAW,EAAE;AAClB5B,MAAAA,cAAc,GAAInuB,IAAI,CAAC+vB,WAAW,CAAiBzuB,SAAS;AAC5D,MAAA,IAAI6sB,cAAc,EAAE;QAChB,QAAQA,cAAc,CAAC/O,MAAM;AAC7B,UAAA,KAAK,CAAC;AAAEmR,YAAAA,WAAW,GAAG,MAAM;AAAE,YAAA;AAC9B,UAAA,KAAK,CAAC;AAAEA,YAAAA,WAAW,GAAG,MAAM;AAAE,YAAA;AAC9B,UAAA,KAAK,CAAC;AAAEA,YAAAA,WAAW,GAAG,MAAM;AAAE,YAAA;AAC9B,UAAA;AAAS,YAAA;cACLplB,OAAO,CAAC,KAAK,CAAC;AACjB,YAAA;AACA;AACJ,MAAA;AACJ,IAAA;IAED,IAAI6kB,iBAAyC,GAAG,IAAI;IACpD,IAAIhwB,IAAI,CAAC+gC,cAAc,EAAE;AACrB/Q,MAAAA,iBAAiB,GAAIhwB,IAAI,CAAC+gC,cAAc,CAAiBz/B,SAAS;AACrE,IAAA;IAED,IAAI,CAAC80B,kBAAkB,GAAG;MACtB5T,UAAU,EAAExiB,IAAI,CAACwiB,UAAU;AAC3BS,MAAAA,gBAAgB,EAAhBA,gBAAgB;AAChBkL,MAAAA,cAAc,EAAdA,cAAc;AACd6B,MAAAA,iBAAiB,EAAjBA,iBAAiB;AAEjBzN,MAAAA,SAAS,EAAE,EAAE;AACbgO,MAAAA,WAAW,EAAXA,WAAW;MACXlN,MAAM,EAAE,IAAIyU,GAAG;KAClB;IAEDxV,+BAA+B,CAAC/f,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAAC2zB,kBAAkB,CAAC;EACzF,CAAC;AAAAv2B,EAAAA,MAAA,CAEe6B,OAAO,GAAvB,SAAgBA,OAAOA,GAAS;AAC5B,IAAA,IAAM+Q,MAAM,GAAGlQ,kBAAkB,CAACE,QAAQ;IAC1C,IAAI,IAAI,CAAC2zB,kBAAkB,IAAI3jB,MAAM,CAACgB,UAAU,CAACC,MAAM,EAAE;AACrDyP,MAAAA,iCAAiC,CAAC1Q,MAAM,EAAE,IAAI,CAAC2jB,kBAAkB,CAAC;AACrE,IAAA;IACD,IAAI,CAACA,kBAAkB,GAAG,IAAI;EAClC,CAAC;AAAA,EAAA,OAAA+J,mBAAA;AAAA,CAAA,CArFoCc,cAAc,CAAA;;ACJvD,IAAaC,wBAAyB,aAAAC,oBAAA,EAAA;AAKlC,EAAA,SAAAD,2BAAA;AAAA,IAAA,IAAAzhC,KAAA;AACIA,IAAAA,KAAA,GAAA0hC,oBAAA,CAAAzhC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAHJu2B,uBAAuB,GAAwC,IAAI;AAAA,IAAA,OAAAv2B,KAAA;AAI3E,EAAA;EAACG,cAAA,CAAAshC,wBAAA,EAAAC,oBAAA,CAAA;AAAA,EAAA,IAAAthC,MAAA,GAAAqhC,wBAAA,CAAAphC,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAAuC,EAAO;AAC7DS,IAAAA,KAAK,CAACX,SAAS,CAAC2B,IAAI,CAAC2/B,KAAK,CAAC,IAAI,CAACC,SAAS,EAAErhC,IAAI,CAACK,QAAQ,CAAC;IAEzD,IAAIE,eAAe,GAAG,CAAC;IAAE,IAAI+gC,UAAU,GAAG,EAAE;IAC5C,IAAMC,gBAA0B,GAAG,EAAE;AACrC,IAAA,KAAK,IAAIzgC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACugC,SAAS,CAACtgC,MAAM,EAAED,CAAC,EAAE,EAAE;AAC5C,MAAA,IAAME,OAAO,GAAG,IAAI,CAACqgC,SAAS,CAACvgC,CAAC,CAAC;AACjCygC,MAAAA,gBAAgB,CAAC9/B,IAAI,CAAClB,eAAe,CAAC;MACtCA,eAAe,IAAIS,OAAO,CAACE,KAAK;MAChC,IAAIF,OAAO,CAACA,OAAO,GAAGsgC,UAAU,EAAEA,UAAU,GAAGtgC,OAAO,CAACA,OAAO;AACjE,IAAA;AAED,IAAA,IAAI,CAACwgC,eAAe,GAAG/gC,KAAK,CAAC6gC,UAAU,GAAG,CAAC,CAAC,CAAC5gC,IAAI,CAAC,EAAE,CAAC;AACrD,IAAA,IAAMJ,iBAAiB,GAAG,IAAI,CAACmhC,kBAAkB,GAAGhhC,KAAK,CAAC6gC,UAAU,GAAG,CAAC,CAAC,CAAC5gC,IAAI,CAAC,EAAE,CAAC;AAClF,IAAA,KAAK,IAAII,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAG,IAAI,CAACugC,SAAS,CAACtgC,MAAM,EAAED,EAAC,EAAE,EAAE;AAC5C,MAAA,IAAME,QAAO,GAAG,IAAI,CAACqgC,SAAS,CAACvgC,EAAC,CAAC;MACjC,IAAI,CAAC0gC,eAAe,CAACxgC,QAAO,CAACA,OAAO,CAAC,GAAGF,EAAC;MACzCR,iBAAiB,CAACU,QAAO,CAACA,OAAO,CAAC,GAAGugC,gBAAgB,CAACzgC,EAAC,CAAC;AAC3D,IAAA;IAED,IAAMs2B,eAAyB,GAAG,EAAE;AACpC,IAAA,KAAK,IAAIt2B,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAG,IAAI,CAACugC,SAAS,CAACtgC,MAAM,EAAED,GAAC,EAAE,EAAE;AAC5C,MAAA,IAAME,SAAO,GAAG,IAAI,CAACqgC,SAAS,CAACvgC,GAAC,CAAC;AACjC,MAAA,IAAIE,SAAO,CAACK,cAAc,GAAGqgC,uBAAuB,EAAE;AAClD,QAAA,KAAK,IAAIzgC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,SAAO,CAACE,KAAK,EAAED,CAAC,EAAE,EAAE;AACpCm2B,UAAAA,eAAe,CAAC31B,IAAI,CAACT,SAAO,CAACA,OAAO,CAAC;AACxC,QAAA;AACJ,MAAA;AACJ,IAAA;IAED,IAAI,CAACg1B,uBAAuB,GAAG;MAC3B31B,QAAQ,EAAE,IAAI,CAACghC,SAAS;AACxBjK,MAAAA,eAAe,EAAfA,eAAe;AACf92B,MAAAA,iBAAiB,EAAjBA,iBAAiB;AACjBC,MAAAA,eAAe,EAAfA;KACH;EACL,CAAC;AAAAV,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;AACnB,IAAA,IAAI,CAAC2/B,SAAS,CAACtgC,MAAM,GAAG,CAAC;EAC7B,CAAC;EAAA,OAAAmB,YAAA,CAAAg/B,wBAAA,EAAA,CAAA;IAAA/+B,GAAA,EAAA,wBAAA;IAAAC,GAAA,EAhDD,SAAAA,GAAAA,GAA2D;MAAG,OAAO,IAAI,CAAC4zB,uBAAuB;AAAG,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAD3D2L,mBAAmB,CAAA;;ACCjE,IAAaC,mBAAoB,aAAAC,eAAA,EAAA;AAI7B,EAAA,SAAAD,sBAAA;AAAA,IAAA,IAAAniC,KAAA;AACIA,IAAAA,KAAA,GAAAoiC,eAAA,CAAAniC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAFJw2B,kBAAkB,GAAmC,IAAI;AAAA,IAAA,OAAAx2B,KAAA;AAGjE,EAAA;EAACG,cAAA,CAAAgiC,mBAAA,EAAAC,eAAA,CAAA;AAAA,EAAA,IAAAhiC,MAAA,GAAA+hC,mBAAA,CAAA9hC,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAAkC,EAAO;AACxDS,IAAAA,KAAK,CAACX,SAAS,CAAC2B,IAAI,CAAC2/B,KAAK,CAAC,IAAI,CAACU,WAAW,EAAE9hC,IAAI,CAAC+hC,UAAU,CAAC;IAE7D,IAAMtW,oBAAgC,GAAG,EAAE;IAE3C,IAAM4L,aAA6C,GAAG,EAAE;IACxD,IAAIC,kBAAkB,GAAG,CAAC;IAC1B,IAAMC,oBAA8B,GAAG,EAAE;AACzC,IAAA,KAAK,IAAIz2B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACghC,WAAW,CAAC/gC,MAAM,EAAED,CAAC,EAAE,EAAE;AAC9C,MAAA,IAAMkhC,SAAS,GAAG,IAAI,CAACF,WAAW,CAAChhC,CAAC,CAA6B;AACjE,MAAA,IAAMs2B,eAAe,GAAG4K,SAAS,CAAC5hC,sBAAsB,CAACg3B,eAAe;AACxE,MAAA,IAAM6K,OAAO,GAAGxhC,KAAK,CAASuhC,SAAS,CAACE,cAAc,CAACnhC,MAAM,CAAC,CAACL,IAAI,CAAC,EAAE,CAAC;AACvE,MAAA,KAAK,IAAIO,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGm2B,eAAe,CAACr2B,MAAM,EAAEE,CAAC,EAAE,EAAE;AAC7C,QAAA,IAAMD,OAAO,GAAGo2B,eAAe,CAACn2B,CAAC,CAAC;AAClC,QAAA,IAAIghC,OAAO,CAACjhC,OAAO,CAAC,GAAG,CAAC,EAAEihC,OAAO,CAACjhC,OAAO,CAAC,GAAGs2B,kBAAkB,GAAGr2B,CAAC;AACtE,MAAA;AAEDo2B,MAAAA,aAAa,CAAC51B,IAAI,CAACugC,SAAS,CAAC5hC,sBAAsB,CAAC;AACpDqrB,MAAAA,oBAAoB,CAAChqB,IAAI,CAACwgC,OAAO,CAAC;AAClC1K,MAAAA,oBAAoB,CAAC91B,IAAI,CAAC61B,kBAAkB,CAAC;MAC7CA,kBAAkB,IAAIF,eAAe,CAACr2B,MAAM;AAC/C,IAAA;IAED,IAAI,CAACk1B,kBAAkB,GAAG;AACtBoB,MAAAA,aAAa,EAAbA,aAAa;AACb5L,MAAAA,oBAAoB,EAApBA,oBAAoB;AACpB6L,MAAAA,kBAAkB,EAAlBA,kBAAkB;AAClBC,MAAAA,oBAAoB,EAApBA;KACH;EACL,CAAC;AAAA13B,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;AACnB,IAAA,IAAI,CAACogC,WAAW,CAAC/gC,MAAM,GAAG,CAAC;EAC/B,CAAC;EAAA,OAAAmB,YAAA,CAAA0/B,mBAAA,EAAA,CAAA;IAAAz/B,GAAA,EAAA,mBAAA;IAAAC,GAAA,EAxCD,SAAAA,GAAAA,GAAiD;MAAG,OAAO,IAAI,CAAC6zB,kBAAkB;AAAG,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CADjDkM,cAAc,CAAA;;ACCvD,IAAMC,eAAyB,GAAG,CAC9B,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,CACT;AAGD,IAAaC,kBAAmB,aAAAC,cAAA,EAAA;AAO5B,EAAA,SAAAD,qBAAA;AAAA,IAAA,IAAA5iC,KAAA;AACIA,IAAAA,KAAA,GAAA6iC,cAAA,CAAA5iC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAHJy2B,iBAAiB,GAAkC,IAAI;AAAA,IAAA,OAAAz2B,KAAA;AAI/D,EAAA;EAACG,cAAA,CAAAyiC,kBAAA,EAAAC,cAAA,CAAA;AAAA,EAAA,IAAAziC,MAAA,GAAAwiC,kBAAA,CAAAviC,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAAiC,EAAO;AACvD,IAAA,IAAI,CAACuiC,UAAU,GAAGviC,IAAI,CAACwiC,SAAS;AAChC,IAAA,IAAI,CAACC,OAAO,GAAGziC,IAAI,CAAC0iC,MAAM;AAC1B,IAAA,IAAI,CAACC,eAAe,GAAG3iC,IAAI,CAAC4iC,cAAc;AAC1C,IAAA,IAAM5c,EAAE,GAAG,IAAI,CAAC6c,GAAG;IACnB,IAAI7iC,IAAI,CAAC8iC,UAAU,EAAE;AACjB,MAAA,IAAMC,MAAM,GAAG/iC,IAAI,CAAC8iC,UAAU;AAC9B,MAAA,IAAQ7c,OAAO,GAAK8c,MAAM,CAAlB9c,OAAO;AACf,MAAA,IAAIA,OAAO,EAAE;AACTA,QAAAA,OAAO,CAAC6Z,OAAO,CAAC,UAAC9d,CAAC,EAAElhB,CAAC,EAAU;AAC3BklB,UAAAA,EAAE,CAACgd,SAAS,CAACliC,CAAC,EAAEkhB,CAAC,CAAC;AACtB,QAAA,CAAC,CAAC;AACL,MAAA;AAED,MAAA,IAAI+gB,MAAM,CAACvY,KAAK,KAAK9I,SAAS,EAAE;AAAEsE,QAAAA,EAAE,CAACwE,KAAK,GAAGuY,MAAM,CAACvY,KAAK;AAAG,MAAA;AAC5D,MAAA,IAAIuY,MAAM,CAACE,UAAU,KAAKvhB,SAAS,EAAE;AAAEsE,QAAAA,EAAE,CAACid,UAAU,GAAGF,MAAM,CAACE,UAAU;AAAG,MAAA;AAC3E,MAAA,IAAIF,MAAM,CAACrY,UAAU,KAAKhJ,SAAS,EAAE;AAAEsE,QAAAA,EAAE,CAAC0E,UAAU,GAAGqY,MAAM,CAACrY,UAAU;AAAG,MAAA;AAC9E,IAAA;IACDwY,MAAM,CAACC,MAAM,CAAC,IAAI,CAACC,GAAG,EAAEpjC,IAAI,CAACqjC,eAAe,CAAC;IAC7CH,MAAM,CAACC,MAAM,CAAC,IAAI,CAACG,IAAI,EAAEtjC,IAAI,CAACujC,iBAAiB,CAAC;AAChD,IAAA,IAAI,CAACC,GAAG,GAAGxjC,IAAI,CAACyjC,UAAU;AAC1B,IAAA,IAAI,CAACnE,WAAW,GAAGt/B,IAAI,CAAC27B,UAAU;AAClC,IAAA,IAAI,CAAC+H,cAAc,GAAG1jC,IAAI,CAACioB,aAAa;IAExC,IAAMA,aAAoC,GAAG,EAAE;IAC/C,KAAK,IAAInnB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE;AACzB,MAAA,IAAI,IAAI,CAAC4iC,cAAc,GAAI,CAAC,IAAI5iC,CAAE,EAAE;AAChCmnB,QAAAA,aAAa,CAACxmB,IAAI,CAAC,CAAC,IAAIX,CAAC,CAAC;AAC7B,MAAA;AACJ,IAAA;IAED,IAAI,CAACo1B,iBAAiB,GAAG;AACrBpS,MAAAA,WAAW,EAAEse,eAAe,CAACpiC,IAAI,CAACwiC,SAAS,CAAC;AAC5CzmB,MAAAA,SAAS,EAAG/b,IAAI,CAAC0iC,MAAM,CAAiB3mB,SAAS;AACjDwP,MAAAA,iBAAiB,EAAGvrB,IAAI,CAAC4iC,cAAc,CAAyBrX,iBAAiB;MACjFnD,EAAE,EAAEpoB,IAAI,CAACqjC,eAAe;MACxB5d,GAAG,EAAEzlB,IAAI,CAACujC,iBAAiB;MAC3Bvd,EAAE,EAAEhmB,IAAI,CAAC8iC,UAAU;AACnB5e,MAAAA,aAAa,EAAGlkB,IAAI,CAAC27B,UAAU,CAAqBzX,aAAa;AACjE+D,MAAAA,aAAa,EAAbA;KACH;EACL,CAAC;AAAApoB,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAI,CAACw0B,iBAAiB,GAAG,IAAI;EACjC,CAAC;EAAA,OAAAh0B,YAAA,CAAAmgC,kBAAA,EAAA,CAAA;IAAAlgC,GAAA,EAAA,kBAAA;IAAAC,GAAA,EAvDD,SAAAA,GAAAA,GAA+C;MAC3C,OAAQ,IAAI,CAAC8zB,iBAAiB;AAClC,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAHmCyN,aAAa,CAAA;;ACLrD,IAAaC,yBAA0B,aAAAC,mBAAA,EAAA;AAAA,EAAA,SAAAD,yBAAAA,GAAA;AAAA,IAAA,OAAAC,mBAAA,CAAAzC,KAAA,CAAA,IAAA,EAAA0C,SAAA,CAAA,IAAA,IAAA;AAAA,EAAA;EAAAlkC,cAAA,CAAAgkC,yBAAA,EAAAC,mBAAA,CAAA;AAAA,EAAA,IAAAhkC,MAAA,GAAA+jC,yBAAA,CAAA9jC,SAAA;AAAAD,EAAAA,MAAA,CACnBs8B,eAAe,GAA/B,SAAgBA,eAAeA,CAC3BR,UAAsB,EACtB5G,WAAwB,EACxB5Q,UAA0B,EAC1BC,WAA8B,EAC9BC,UAAkB,EAClBC,YAAoB,EACjB;IACHL,2BAA2B,CACvB1hB,kBAAkB,CAACE,QAAQ,EAC1Bk5B,UAAU,CAAqBzX,aAAa,EAC5C6Q,WAAW,CAAsBoK,iBAAiB,EAAE,EACrDhb,UAAU,EACVC,WAAW,EACXC,UAAU,EACVC,YAAY,CACf;IACD,IAAI,CAACuW,eAAe,GAAG,IAAI;EAC/B,CAAC;AAAAh7B,EAAAA,MAAA,CAEey1B,IAAI,GAApB,SAAgBA,IAAIA,CAAE2I,eAA0C,EAAO;IACnE,IAAI,IAAI,CAACpD,eAAe,EAAE;MACtB,IAAI,IAAI,CAACO,gBAAgB,EAAE;QACvB,IAAI,CAACc,UAAU,EAAE;AACpB,MAAA;MAED,IAAMl8B,IAAI,GAAG,UAAU,IAAIi+B,eAAe,GAAGA,eAAe,CAACtO,QAAQ,GAAGsO,eAAe;AAEvFvO,MAAAA,gBAAgB,CAACntB,kBAAkB,CAACE,QAAQ,EAAEzC,IAAI,CAAC;MAEnD,EAAE,IAAI,CAAC87B,aAAa;AACpB,MAAA,IAAI,CAACC,aAAa,IAAI/7B,IAAI,CAACgxB,aAAa;MACxC,IAAMC,UAAU,GAAGjxB,IAAI,CAACixB,UAAU,IAAIjxB,IAAI,CAACmxB,WAAW;MACtD,IAAI,IAAI,CAAC2J,oBAAoB,EAAE;AAC3B,QAAA,IAAMhX,WAAW,GAAG,IAAI,CAACgX,oBAAoB,CAAChX,WAAW;AACzD,QAAA,QAAQA,WAAW;UACnB,KAAK3gB,cAAc,CAAC4gC,SAAS;AAAE,YAAA;AAC3B,cAAA,IAAI,CAAC/H,QAAQ,IAAI/K,UAAU,GAAG,CAAC,GAAGruB,IAAI,CAACD,GAAG,CAAC3C,IAAI,CAACgxB,aAAa,EAAE,CAAC,CAAC;AACjE,cAAA;AACH,YAAA;UACD,KAAK7tB,cAAc,CAACq0B,cAAc;UAClC,KAAKr0B,cAAc,CAAC6gC,YAAY;AAAE,YAAA;AAC9B,cAAA,IAAI,CAAChI,QAAQ,IAAI,CAAC/K,UAAU,GAAG,CAAC,IAAIruB,IAAI,CAACD,GAAG,CAAC3C,IAAI,CAACgxB,aAAa,EAAE,CAAC,CAAC;AACnE,cAAA;AACH,YAAA;AAEA;AACJ,MAAA;AACJ,IAAA,CAAA,MAAM;MACH7lB,OAAO,CAAC,KAAK,CAAC;AACjB,IAAA;EACL,CAAC;AAAAtL,EAAAA,MAAA,CAEeg9B,WAAW,GAA3B,SAAgBA,WAAWA,CAAE5X,QAA4B,EAAO;AAC5D,IAAA,IAAAgf,qBAAA,GAAkC1hC,kBAAkB,CAACE,QAAQ;MAAzCoS,KAAK,GAAAovB,qBAAA,CAAjBvxB,UAAU;MAAS1P,EAAE,GAAAihC,qBAAA,CAAFjhC,EAAE;AAE7B,IAAA,IAAI6R,KAAK,CAACoQ,QAAQ,CAACC,IAAI,KAAKD,QAAQ,CAACC,IAAI,IAClCrQ,KAAK,CAACoQ,QAAQ,CAACE,GAAG,KAAKF,QAAQ,CAACE,GAAG,IACnCtQ,KAAK,CAACoQ,QAAQ,CAAC3O,KAAK,KAAK2O,QAAQ,CAAC3O,KAAK,IACvCzB,KAAK,CAACoQ,QAAQ,CAACzO,MAAM,KAAKyO,QAAQ,CAACzO,MAAM,EAAE;AAC9CxT,MAAAA,EAAE,CAACiiB,QAAQ,CAACA,QAAQ,CAACC,IAAI,EAAED,QAAQ,CAACE,GAAG,EAAEF,QAAQ,CAAC3O,KAAK,EAAE2O,QAAQ,CAACzO,MAAM,CAAC;AAEzE3B,MAAAA,KAAK,CAACoQ,QAAQ,CAACC,IAAI,GAAGD,QAAQ,CAACC,IAAI;AACnCrQ,MAAAA,KAAK,CAACoQ,QAAQ,CAACE,GAAG,GAAGF,QAAQ,CAACE,GAAG;AACjCtQ,MAAAA,KAAK,CAACoQ,QAAQ,CAAC3O,KAAK,GAAG2O,QAAQ,CAAC3O,KAAK;AACrCzB,MAAAA,KAAK,CAACoQ,QAAQ,CAACzO,MAAM,GAAGyO,QAAQ,CAACzO,MAAM;AAC1C,IAAA;EACL,CAAC;AAAA3W,EAAAA,MAAA,CAEem9B,UAAU,GAA1B,SAAgBA,UAAUA,CAAE1X,OAAuB,EAAO;AACtD,IAAA,IAAA4e,sBAAA,GAAkC3hC,kBAAkB,CAACE,QAAQ;MAAzCoS,KAAK,GAAAqvB,sBAAA,CAAjBxxB,UAAU;MAAS1P,EAAE,GAAAkhC,sBAAA,CAAFlhC,EAAE;AAE7B,IAAA,IAAI6R,KAAK,CAACwQ,WAAW,CAACZ,CAAC,KAAKa,OAAO,CAACb,CAAC,IAC9B5P,KAAK,CAACwQ,WAAW,CAACX,CAAC,KAAKY,OAAO,CAACZ,CAAC,IACjC7P,KAAK,CAACwQ,WAAW,CAAC/O,KAAK,KAAKgP,OAAO,CAAChP,KAAK,IACzCzB,KAAK,CAACwQ,WAAW,CAAC7O,MAAM,KAAK8O,OAAO,CAAC9O,MAAM,EAAE;AAChDxT,MAAAA,EAAE,CAACsiB,OAAO,CAACA,OAAO,CAACb,CAAC,EAAEa,OAAO,CAACZ,CAAC,EAAEY,OAAO,CAAChP,KAAK,EAAEgP,OAAO,CAAC9O,MAAM,CAAC;AAE/D3B,MAAAA,KAAK,CAACwQ,WAAW,CAACZ,CAAC,GAAGa,OAAO,CAACb,CAAC;AAC/B5P,MAAAA,KAAK,CAACwQ,WAAW,CAACX,CAAC,GAAGY,OAAO,CAACZ,CAAC;AAC/B7P,MAAAA,KAAK,CAACwQ,WAAW,CAAC/O,KAAK,GAAGgP,OAAO,CAAChP,KAAK;AACvCzB,MAAAA,KAAK,CAACwQ,WAAW,CAAC7O,MAAM,GAAG8O,OAAO,CAAC9O,MAAM;AAC5C,IAAA;EACL,CAAC;EAAA3W,MAAA,CAEeq+B,YAAY,GAA5B,SAAgBA,YAAYA,CAAEn8B,MAAc,EAAE61B,IAA4B,EAAEpkB,IAAa,EAAO;AAC5F,IAAA,IAAI,CAAC,IAAI,CAACqnB,eAAe,EAAE;AACvB,MAAA,IAAMv5B,SAAS,GAAIS,MAAM,CAAiBT,SAAS;AACnD,MAAA,IAAIA,SAAS,EAAE;AACX,QAAA,IAAIm5B,QAAgB;QACpB,IAAIjnB,IAAI,KAAKkO,SAAS,EAAE;AACpB+Y,UAAAA,QAAQ,GAAGjnB,IAAI;QAClB,CAAA,MAAM,IAAIzR,MAAM,CAACkR,KAAK,GAAGC,cAAc,CAACuB,QAAQ,EAAE;AAC/CgmB,UAAAA,QAAQ,GAAG,CAAC;AACf,QAAA,CAAA,MAAM;UACHA,QAAQ,GAAI7C,IAAI,CAAiB7hB,UAAU;AAC9C,QAAA;AAEDf,QAAAA,wBAAwB,CAACzS,kBAAkB,CAACE,QAAQ,EAAEnB,SAAS,EAAEs2B,IAAI,EAAiB,CAAC,EAAE6C,QAAQ,CAAC;AACrG,MAAA;AACJ,IAAA,CAAA,MAAM;MACHtvB,OAAO,CAAC,KAAK,CAAC;AACjB,IAAA;EACL,CAAC;EAAAtL,MAAA,CAEes+B,oBAAoB,GAApC,SAAgBA,oBAAoBA,CAAE1K,OAAoC,EAAE2K,OAAgB,EAAE7M,OAAsC,EAAO;AACvI,IAAA,IAAI,CAAC,IAAI,CAACsJ,eAAe,EAAE;AACvB,MAAA,IAAMt5B,UAAU,GAAI68B,OAAO,CAAkB78B,UAAU;AACvD,MAAA,IAAIA,UAAU,EAAE;QACZiyB,gCAAgC,CAACjxB,kBAAkB,CAACE,QAAQ,EAAEgxB,OAAO,EAAElyB,UAAU,EAAEgwB,OAAO,CAAC;AAC9F,MAAA;AACJ,IAAA,CAAA,MAAM;MACHpmB,OAAO,CAAC,KAAK,CAAC;AACjB,IAAA;EACL,CAAC;EAAAtL,MAAA,CAEew+B,OAAO,GAAvB,SAAgBA,OAAOA,CAAEC,QAAmC,EAAEp9B,KAAa,EAAO;IAC9EiK,OAAO,CAAC,KAAK,CAAC;EAClB,CAAC;AAAAtL,EAAAA,MAAA,CAEkBq8B,UAAU,GAA7B,SAAmBA,UAAUA,GAAS;IAClCpU,sBAAsB,CAClBvlB,kBAAkB,CAACE,QAAQ,EAC3B,IAAI,CAACq4B,oBAAoB,EACzB,IAAI,CAACC,qBAAqB,EAC1B,IAAI,CAACC,qBAAqB,EAC1B,IAAI,CAACC,kBAAkB,EACvB,IAAI,CAACC,iBAAiB,CACzB;IACD,IAAI,CAACE,gBAAgB,GAAG,KAAK;EACjC,CAAC;AAAAv7B,EAAAA,MAAA,CAEe++B,WAAW,GAA3B,SAAgBA,WAAWA,CAAE1J,UAA6B,EAAEC,UAAmB,EAAE5D,OAAiC,EAAE6D,MAAc,EAAO;AACrI,IAAA,IAAM8C,aAAa,GAAIhD,UAAU,CAAkB3zB,UAAU;AAC7D,IAAA,IAAM42B,aAAa,GAAIhD,UAAU,CAAkB5zB,UAAU;AAC7D0zB,IAAAA,uBAAuB,CAAC1yB,kBAAkB,CAACE,QAAQ,EAAEy1B,aAAa,EAAEC,aAAa,EAAE5G,OAAO,EAAE6D,MAAM,CAAC;EACvG,CAAC;AAAA,EAAA,OAAAwO,yBAAA;AAAA,CAAA,CAzI0CjJ,kBAAkB,CAAA;;ACfjE,IAAawJ,UAAW,aAAAC,MAAA,EAAA;AAKpB,EAAA,SAAAD,aAAA;AAAA,IAAA,IAAA1kC,KAAA;AACIA,IAAAA,KAAA,GAAA2kC,MAAA,CAAA1kC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CALL4kC,YAAY,GAAG,CAAC;IAAA5kC,KAAA,CAChB6kC,YAAY,GAAG,CAAC;IAAA7kC,KAAA,CAChB8kC,OAAO,GAAG,CAAC;AAAA,IAAA,OAAA9kC,KAAA;AAIlB,EAAA;EAACG,cAAA,CAAAukC,UAAA,EAAAC,MAAA,CAAA;AAAA,EAAA,IAAAvkC,MAAA,GAAAskC,UAAA,CAAArkC,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAAyB,EAAO;AAC/C,IAAA,IAAI,CAACq7B,KAAK,GAAGr7B,IAAI,CAACoB,IAAI;EAC1B,CAAC;EAAAvB,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS,CACvB,CAAC;AAAA7B,EAAAA,MAAA,CAEM2kC,MAAM,GAAb,SAAOA,MAAMA,CAAElG,QAAmC,EAAO;AACrD,IAAA,IAAMmG,GAAG,GAAGnG,QAAQ,CAACv9B,MAAM;IAC3B,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG2jC,GAAG,EAAE3jC,CAAC,EAAE,EAAE;AAC1B,MAAA,IAAM4jC,OAAO,GAAGpG,QAAQ,CAACx9B,CAAC,CAAC;AAE3B,MAAA,IAAI,CAACujC,YAAY,IAAIK,OAAO,CAACL,YAAY;AACzC,MAAA,IAAI,CAACC,YAAY,IAAII,OAAO,CAACJ,YAAY;AACzC,MAAA,IAAI,CAACC,OAAO,IAAIG,OAAO,CAACH,OAAO;AAClC,IAAA;EACL,CAAC;AAAA1kC,EAAAA,MAAA,CAEM+jB,KAAK,GAAZ,SAAOA,KAAKA,GAAS;IACjB,IAAI,CAACygB,YAAY,GAAG,CAAC;IACrB,IAAI,CAACC,YAAY,GAAG,CAAC;IACrB,IAAI,CAACC,OAAO,GAAG,CAAC;EACpB,CAAC;AAAA,EAAA,OAAAJ,UAAA;AAAA,CAAA,CA/B2BQ,KAAK,CAAA;;ACArC,IAAaC,eAAgB,aAAAC,WAAA,EAAA;AAOzB,EAAA,SAAAD,kBAAA;AAAA,IAAA,IAAAnlC,KAAA;AACIA,IAAAA,KAAA,GAAAolC,WAAA,CAAAnlC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAHJqlC,cAAc,GAA+B,IAAI;AAAA,IAAA,OAAArlC,KAAA;AAIzD,EAAA;EAACG,cAAA,CAAAglC,eAAA,EAAAC,WAAA,CAAA;AAAA,EAAA,IAAAhlC,MAAA,GAAA+kC,eAAA,CAAA9kC,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAA8B,EAAO;AACpD,IAAA,IAAI,CAAC+kC,WAAW,GAAG/kC,IAAI,CAAC2lB,gBAAgB;AACxC,IAAA,IAAI,CAACqf,iBAAiB,GAAGhlC,IAAI,CAAC0mB,sBAAsB;AACpD,IAAA,IAAI,CAACue,UAAU,GAAGjlC,IAAI,CAACklC,SAAS;IAEhC,IAAI,CAACJ,cAAc,GAAG;MAClBnf,gBAAgB,EAAE,IAAI,CAACof,WAAW;MAClCre,sBAAsB,EAAE,IAAI,CAACse;KAChC;AAED,IAAA,IAAI,CAACG,KAAK,GAAG,IAAI,CAACC,WAAW,EAAE;EACnC,CAAC;AAAAvlC,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAI,CAACojC,cAAc,GAAG,IAAI;EAC9B,CAAC;EAAA,OAAA5iC,YAAA,CAAA0iC,eAAA,EAAA,CAAA;IAAAziC,GAAA,EAAA,eAAA;IAAAC,GAAA,EAzBD,SAAAA,GAAAA,GAAgD;MAC5C,OAAQ,IAAI,CAAC0iC,cAAc;AAC/B,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAHgCO,UAAU,CAAA;;ACA/C,IAAMC,UAAoB,GAAG,CACzB,MAAM,EACN,MAAM,EACN,MAAM,EACN,MAAM,CACT;AAGD,IAAaC,YAAa,aAAAC,QAAA,EAAA;AAOtB,EAAA,SAAAD,YAAAA,CAAavlC,IAA2B,EAAEylC,IAAY,EAAA;AAAA,IAAA,IAAAhmC,KAAA;IAClDA,KAAA,GAAA+lC,QAAA,CAAA9lC,IAAA,OAAMM,IAAI,EAAEylC,IAAI,CAAC,IAAA,IAAA;IAAChmC,KAAA,CAHdimC,WAAW,GAA4B,IAAI;IAK/C,IAAI9sB,WAAW,GAAG,CAAC;IACnB,IAAIE,WAAW,GAAG,CAAC;AAEnB,IAAA,IAAM6sB,SAAS,GAAGlmC,KAAA,CAAKmmC,KAAK,CAACD,SAAS;AACtC,IAAA,IAAME,SAAS,GAAGpmC,KAAA,CAAKmmC,KAAK,CAACC,SAAS;AACtC,IAAA,IAAMC,SAAS,GAAGrmC,KAAA,CAAKmmC,KAAK,CAACE,SAAS;IAEtC,IAAIH,SAAS,KAAKrN,MAAM,CAACzf,MAAM,IAAI8sB,SAAS,KAAKrN,MAAM,CAACyN,WAAW,EAAE;MACjE,IAAID,SAAS,KAAKxN,MAAM,CAACzf,MAAM,IAAIitB,SAAS,KAAKxN,MAAM,CAACyN,WAAW,EAAE;QACjEntB,WAAW,GAAGzV,cAAc,CAACgqB,oBAAoB;AACpD,MAAA,CAAA,MAAM,IAAI2Y,SAAS,KAAKxN,MAAM,CAACC,KAAK,EAAE;QACnC3f,WAAW,GAAGzV,cAAc,CAAC+pB,qBAAqB;AACrD,MAAA,CAAA,MAAM;QACHtU,WAAW,GAAGzV,cAAc,CAAC0V,MAAM;AACtC,MAAA;AACJ,IAAA,CAAA,MAAM,IAAIitB,SAAS,KAAKxN,MAAM,CAACzf,MAAM,IAAIitB,SAAS,KAAKxN,MAAM,CAACyN,WAAW,EAAE;MACxEntB,WAAW,GAAGzV,cAAc,CAAC6iC,qBAAqB;AACrD,IAAA,CAAA,MAAM,IAAIF,SAAS,KAAKxN,MAAM,CAACC,KAAK,EAAE;MACnC3f,WAAW,GAAGzV,cAAc,CAAC8iC,sBAAsB;AACtD,IAAA,CAAA,MAAM;MACHrtB,WAAW,GAAGzV,cAAc,CAACiqB,OAAO;AACvC,IAAA;IAED,IAAIyY,SAAS,KAAKvN,MAAM,CAACzf,MAAM,IAAIgtB,SAAS,KAAKvN,MAAM,CAACyN,WAAW,EAAE;MACjEjtB,WAAW,GAAG3V,cAAc,CAAC0V,MAAM;AACtC,IAAA,CAAA,MAAM;MACHC,WAAW,GAAG3V,cAAc,CAACiqB,OAAO;AACvC,IAAA;IAED,IAAM5U,OAAO,GAAG8sB,UAAU,CAAC7lC,KAAA,CAAKmmC,KAAK,CAACM,QAAQ,CAAC;IAC/C,IAAMxtB,OAAO,GAAG4sB,UAAU,CAAC7lC,KAAA,CAAKmmC,KAAK,CAACO,QAAQ,CAAC;IAC/C,IAAMpO,OAAO,GAAGuN,UAAU,CAAC7lC,KAAA,CAAKmmC,KAAK,CAACQ,QAAQ,CAAC;IAE/C3mC,KAAA,CAAKimC,WAAW,GAAG;AACf9sB,MAAAA,WAAW,EAAXA,WAAW;AACXE,MAAAA,WAAW,EAAXA,WAAW;AACXN,MAAAA,OAAO,EAAPA,OAAO;AACPE,MAAAA,OAAO,EAAPA,OAAO;AACPqf,MAAAA,OAAO,EAAPA;KACH;AAAC,IAAA,OAAAt4B,KAAA;AACN,EAAA;EAACG,cAAA,CAAA2lC,YAAA,EAAAC,QAAA,CAAA;EAAA,OAAAtjC,YAAA,CAAAqjC,YAAA,EAAA,CAAA;IAAApjC,GAAA,EAAA,YAAA;IAAAC,GAAA,EAjDD,SAAAA,GAAAA,GAA0C;MACtC,OAAQ,IAAI,CAACsjC,WAAW;AAC5B,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAH6BW,OAAO,CAAA;;ACNzC,IAAaC,WAAY,aAAAC,OAAA,EAAA;AAUrB,EAAA,SAAAD,cAAA;AAAA,IAAA,IAAA7mC,KAAA;AACIA,IAAAA,KAAA,GAAA8mC,OAAA,CAAA7mC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAHJs2B,UAAU,GAA2B,IAAI;AAAA,IAAA,OAAAt2B,KAAA;AAIjD,EAAA;EAACG,cAAA,CAAA0mC,WAAA,EAAAC,OAAA,CAAA;AAAA,EAAA,IAAA1mC,MAAA,GAAAymC,WAAA,CAAAxmC,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAA0B,EAAO;AAChD,IAAA,IAAI,CAACwmC,KAAK,GAAGxmC,IAAI,CAACmd,IAAI;AACtB,IAAA,IAAI,CAACspB,OAAO,GAAGzmC,IAAI,CAAC0mC,MAAM;AAC1B,IAAA,IAAI,CAACpG,WAAW,GAAGtgC,IAAI,CAACwiB,UAAU;AAClC,IAAA,IAAI,CAACmkB,OAAO,GAAG3mC,IAAI,CAACqf,MAAM;AAC1B,IAAA,IAAI,CAACze,SAAS,GAAGZ,IAAI,CAAC4mC,QAAQ;IAE9B,IAAI,CAAC7Q,UAAU,GAAG;MACd5Y,IAAI,EAAEnd,IAAI,CAACmd,IAAI;AACfkC,MAAAA,MAAM,EAAErf,IAAI,CAACqf,MAAM,CAACpJ,KAAK,EAAE;AAC3BgK,MAAAA,eAAe,EAAEjgB,IAAI,CAACigB,eAAe,CAAChK,KAAK,EAAE;AAC7C8J,MAAAA,aAAa,EAAE/f,IAAI,CAAC+f,aAAa,CAAC9J,KAAK,EAAE;MAEzCiG,SAAS,EAAE,IAAIzb,KAAK,CAAuBT,IAAI,CAAC0mC,MAAM,CAAC3lC,MAAM,CAAC;AAC9D4c,MAAAA,SAAS,EAAE,IAAI;AACfY,MAAAA,QAAQ,EAAE,EAAE;AACZkB,MAAAA,UAAU,EAAE,EAAE;AACdH,MAAAA,QAAQ,EAAE,EAAE;AACZa,MAAAA,iBAAiB,EAAE;KACtB;AAED,IAAA,KAAK,IAAIrf,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGd,IAAI,CAAC0mC,MAAM,CAAC3lC,MAAM,EAAE,EAAED,CAAC,EAAE;AACzC,MAAA,IAAM0c,KAAK,GAAGxd,IAAI,CAAC0mC,MAAM,CAAC5lC,CAAC,CAAC;AAC5B,MAAA,IAAI,CAACi1B,UAAU,CAAC7Z,SAAS,CAACpb,CAAC,CAAC,GAAG;QAC3BM,IAAI,EAAEoc,KAAK,CAACA,KAAK;QACjBT,MAAM,EAAES,KAAK,CAACT,MAAM;AACpBH,QAAAA,QAAQ,EAAE;OACb;AACJ,IAAA;EACL,CAAC;AAAA/c,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAI,IAAI,CAACq0B,UAAU,EAAE;MACjB3T,yBAAyB,CAAC7f,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACszB,UAAU,CAAC;MACvE,IAAI,CAACA,UAAU,GAAG,IAAI;AACzB,IAAA;EACL,CAAC;EAAA,OAAA7zB,YAAA,CAAAokC,WAAA,EAAA,CAAA;IAAAnkC,GAAA,EAAA,WAAA;IAAAC,GAAA,EAjDD,SAAAA,GAAAA,GAAiC;AAC7B,MAAA,IAAI,IAAI,CAAC2zB,UAAU,CAAEpY,SAAS,KAAK,IAAI,EAAE;QACrC7B,wBAAwB,CAACvZ,kBAAkB,CAACE,QAAQ,EAAE,IAAI,CAACszB,UAAW,CAAC;AAC1E,MAAA;MACD,OAAO,IAAI,CAACA,UAAU;AAC1B,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAN4B8Q,MAAM,CAAA;;ACEvC,IAAaC,eAAe,GAAA,YAAA;AAAA,EAAA,SAAAA,eAAAA,GAAA;IAAA,IAAA,CACjB9yB,aAAa,GAAuB,IAAI;IAAA,IAAA,CACxCK,oBAAoB,GAAuB,IAAI;IAAA,IAAA,CAC/CV,KAAK,GAAqC,IAAI;IAAA,IAAA,CAC9CkE,OAAO,GAAG,CAAC;IAAA,IAAA,CACXD,UAAU,GAAoB,EAAE;IAAA,IAAA,CAChCR,cAAc,GAA6B,IAAI;IAAA,IAAA,CAC/CkD,aAAa,GAA4B,IAAI;AAAA,IAAA,IAAA,CAC7C2K,QAAQ,GAAG,IAAI8hB,QAAQ,EAAE;AAAA,IAAA,IAAA,CACzB1hB,WAAW,GAAG,IAAIrB,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;AAAA,IAAA,IAAA,CAClCoE,EAAE,GAAG,IAAI4e,eAAe,EAAE;AAAA,IAAA,IAAA,CAC1BvhB,GAAG,GAAG,IAAIgS,iBAAiB,EAAE;AAAA,IAAA,IAAA,CAC7BzR,EAAE,GAAG,IAAIihB,UAAU,EAAE;IAAA,IAAA,CACrBtpB,SAAS,GAAwB,IAAI;IAAA,IAAA,CACrC0Q,mBAAmB,GAAc,EAAE;IAAA,IAAA,CACnCL,mBAAmB,GAAc,EAAE;IAAA,IAAA,CACnC9M,eAAe,GAA2B,EAAE;AAAA,EAAA;AAAA,EAAA,IAAArhB,MAAA,GAAAinC,eAAA,CAAAhnC,SAAA;EAAAD,MAAA,CAEnDE,UAAU,GAAV,SAAAA,UAAUA,CAAE8X,OAAe,EAAEqvB,gBAAwB,EAAO;IACxD,KAAK,IAAIpmC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+W,OAAO,EAAE,EAAE/W,CAAC,EAAE;AAC9B,MAAA,IAAM6W,SAAwB,GAAG;AAAEF,QAAAA,SAAS,EAAE;OAAM;AACpD,MAAA,IAAI,CAACG,UAAU,CAACnW,IAAI,CAACkW,SAAS,CAAC;AAClC,IAAA;AAED,IAAA,IAAI,CAAC0W,mBAAmB,CAACttB,MAAM,GAAGmmC,gBAAgB;AAClD,IAAA,IAAI,CAAC7Y,mBAAmB,CAAC3tB,IAAI,CAAC,KAAK,CAAC;AAEpC,IAAA,IAAI,CAACstB,mBAAmB,CAACjtB,MAAM,GAAGmmC,gBAAgB;AAClD,IAAA,IAAI,CAAClZ,mBAAmB,CAACttB,IAAI,CAAC,KAAK,CAAC;EACxC,CAAC;AAAA,EAAA,OAAAomC,eAAA;AAAA,CAAA,EAAA;;AC/BL,IAAaK,YAAa,aAAAC,QAAA,EAAA;AAYtB,EAAA,SAAAD,eAAA;AAAA,IAAA,IAAA1nC,KAAA;AACIA,IAAAA,KAAA,GAAA2nC,QAAA,CAAA1nC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAJJ4nC,WAAW,GAA4B,IAAI;IAAA5nC,KAAA,CAC3C6nC,SAAS,GAAG,CAAC;AAAA,IAAA,OAAA7nC,KAAA;AAIrB,EAAA;EAACG,cAAA,CAAAunC,YAAA,EAAAC,QAAA,CAAA;AAAA,EAAA,IAAAvnC,MAAA,GAAAsnC,YAAA,CAAArnC,SAAA;EAAAD,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAAuD,EAAEma,kBAA4B,EAAO;IAC3G,IAAMotB,IAAI,GAAG,IAAI;AACjB,IAAA,IAAQ9kC,QAAQ,GAAKF,kBAAkB,CAA/BE,QAAQ;IAChB,IAAI+kC,OAAO,GAAGxnC,IAA6B;IAC3C,IAAMynC,QAAQ,GAAGznC,IAAiC;IAElD,IAAI,SAAS,IAAIA,IAAI,EAAE;AACnBwnC,MAAAA,OAAO,GAAGC,QAAQ,CAACrJ,OAAO,CAACp+B,IAAI;MAC/BunC,IAAI,CAACG,cAAc,GAAG,IAAI;AAC7B,IAAA;AACD,IAAA,IAAMC,eAAe,GAAGJ,IAAI,CAAC3B,KAAK;AAClC+B,IAAAA,eAAe,CAAC3Y,IAAI,CAACwY,OAAO,CAAC;AAE7B,IAAA,IAAMI,YAAY,GAAGL,IAAI,CAACM,SAAS;AAEnCN,IAAAA,IAAI,CAACO,WAAW,GAAGC,UAAU,CAACJ,eAAe,CAACrxB,KAAK,CAAC,IAAIyxB,UAAU,CAACJ,eAAe,CAACnxB,MAAM,CAAC;AAC1F+wB,IAAAA,IAAI,CAACtN,KAAK,GAAG+N,iBAAiB,CAC1BL,eAAe,CAAC5kC,MAAM,EACtBwkC,IAAI,CAACjxB,KAAK,EACVixB,IAAI,CAAC/wB,MAAM,EACX+wB,IAAI,CAAC5U,KAAK,EACVgV,eAAe,CAACM,UAAU,CAC7B,GAAGN,eAAe,CAAC3V,UAAU;AAE9B,IAAA,IAAI,CAACuV,IAAI,CAACG,cAAc,EAAE;MACtBH,IAAI,CAACF,WAAW,GAAG;QACfjmC,IAAI,EAAEomC,OAAO,CAACpmC,IAAI;QAClB2B,MAAM,EAAEykC,OAAO,CAACzkC,MAAM;QACtBkQ,KAAK,EAAEu0B,OAAO,CAACv0B,KAAK;QACpBqD,KAAK,EAAEkxB,OAAO,CAAClxB,KAAK;QACpBE,MAAM,EAAEgxB,OAAO,CAAChxB,MAAM;QACtBmc,KAAK,EAAE6U,OAAO,CAAC7U,KAAK;QACpBnf,IAAI,EAAE+zB,IAAI,CAACtN,KAAK;QAChBiO,UAAU,EAAEV,OAAO,CAACxV,UAAU;QAC9Bha,QAAQ,EAAEwvB,OAAO,CAACS,UAAU;QAC5BE,OAAO,EAAEX,OAAO,CAACW,OAAO;QACxBlW,KAAK,EAAEuV,OAAO,CAACvV,KAAK;QACpB1Z,UAAU,EAAEgvB,IAAI,CAACO,WAAW;AAE5B10B,QAAAA,QAAQ,EAAE,CAAC;AACXgD,QAAAA,aAAa,EAAE,CAAC;AAChBD,QAAAA,QAAQ,EAAE,CAAC;AACX1E,QAAAA,MAAM,EAAE,CAAC;AACTkB,QAAAA,OAAO,EAAE,CAAC;AACV8E,QAAAA,SAAS,EAAE,IAAI;AACfL,QAAAA,cAAc,EAAE,IAAI;AACpBoB,QAAAA,OAAO,EAAE,CAAC;AACVE,QAAAA,OAAO,EAAE,CAAC;AACVE,QAAAA,WAAW,EAAE,CAAC;AACdE,QAAAA,WAAW,EAAE,CAAC;QAEdqB,kBAAkB,EAAEA,kBAAkB,IAAI;OAC7C;AAED,MAAA,IAAI,CAACotB,IAAI,CAACF,WAAW,CAACltB,kBAAkB,EAAE;AACtCjE,QAAAA,yBAAyB,CAACzT,QAAQ,EAAE8kC,IAAI,CAACF,WAAW,CAAC;AACrD5kC,QAAAA,QAAQ,CAACk1B,YAAY,CAACyQ,WAAW,IAAIb,IAAI,CAACtN,KAAK;AAClD,MAAA;MAED2N,YAAY,CAACxJ,OAAO,GAAGmJ,IAAI;AAC3BK,MAAAA,YAAY,CAACxmC,IAAI,GAAGpB,IAAI,CAACoB,IAAI;AAC7BwmC,MAAAA,YAAY,CAAC7kC,MAAM,GAAG/C,IAAI,CAAC+C,MAAM;MACjC6kC,YAAY,CAACS,SAAS,GAAG,CAAC;AAC1BT,MAAAA,YAAY,CAACK,UAAU,GAAGjoC,IAAI,CAACioC,UAAU;MACzCL,YAAY,CAACU,SAAS,GAAG,CAAC;AAC1BV,MAAAA,YAAY,CAAC5V,UAAU,GAAGhyB,IAAI,CAACgyB,UAAU;AAC5C,IAAA,CAAA,MAAM;AACH4V,MAAAA,YAAY,CAAC5Y,IAAI,CAACyY,QAAQ,CAAC;AAC3BF,MAAAA,IAAI,CAACD,SAAS,GAAGG,QAAQ,CAACY,SAAS;AACnCd,MAAAA,IAAI,CAACF,WAAW,GAAII,QAAQ,CAACrJ,OAAO,CAAkBiJ,WAAW;AACpE,IAAA;EACL,CAAC;AAAAxnC,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAM6lC,IAAI,GAAG,IAAI;AACjB,IAAA,IAAQ9kC,QAAQ,GAAKF,kBAAkB,CAA/BE,QAAQ;IAChB,IAAI,CAAC8kC,IAAI,CAACG,cAAc,IAAIH,IAAI,CAACF,WAAW,EAAE;AAC1C5tB,MAAAA,0BAA0B,CAAChX,QAAQ,EAAE8kC,IAAI,CAACF,WAAW,CAAC;AACtD5kC,MAAAA,QAAQ,CAACk1B,YAAY,CAACyQ,WAAW,IAAIb,IAAI,CAACtN,KAAK;MAC/CsN,IAAI,CAACF,WAAW,GAAG,IAAI;AAC1B,IAAA;EACL,CAAC;AAAAxnC,EAAAA,MAAA,CAEM0oC,gBAAgB,GAAvB,SAAOA,gBAAgBA,GAAW;AAC9B,IAAA,IAAMhnC,UAAU,GAAG,IAAI,CAAC8lC,WAAW;IACnC,IAAI,CAAC9lC,UAAU,EAAE;AACb,MAAA,OAAO,CAAC;AACX,IAAA;IAED,IAAIA,UAAU,CAACkW,SAAS,EAAE;MACtB,OAAOlW,UAAU,CAACkW,SAAS;AAC9B,IAAA,CAAA,MAAM,IAAIlW,UAAU,CAAC6V,cAAc,EAAE;MAClC,OAAO7V,UAAU,CAAC6V,cAAc;AACnC,IAAA;AAED,IAAA,OAAO,CAAC;EACZ,CAAC;EAAAvX,MAAA,CAEMy6B,MAAM,GAAb,SAAOA,MAAMA,CAAEhkB,KAAa,EAAEE,MAAc,EAAO;IAC/C,IAAM+wB,IAAI,GAAG,IAAI;AACjB,IAAA,IAAQ9kC,QAAQ,GAAKF,kBAAkB,CAA/BE,QAAQ;AAChB,IAAA,IAAMklC,eAAe,GAAGJ,IAAI,CAAC3B,KAAK;IAClC,IAAI+B,eAAe,CAACrxB,KAAK,KAAKA,KAAK,IAAIqxB,eAAe,CAACnxB,MAAM,KAAKA,MAAM,EAAE;AACtE,MAAA;AACH,IAAA;AAED,IAAA,IAAImxB,eAAe,CAACM,UAAU,KAAKd,YAAY,CAACqB,aAAa,CAACb,eAAe,CAACrxB,KAAK,EAAEqxB,eAAe,CAACnxB,MAAM,CAAC,EAAE;MAC1GmxB,eAAe,CAACM,UAAU,GAAGd,YAAY,CAACqB,aAAa,CAAClyB,KAAK,EAAEE,MAAM,CAAC;AACzE,IAAA,CAAA,MAAM,IAAImxB,eAAe,CAACM,UAAU,GAAG,CAAC,EAAE;AACvCN,MAAAA,eAAe,CAACM,UAAU,GAAGrlC,IAAI,CAACC,GAAG,CAAC8kC,eAAe,CAACM,UAAU,EAAEd,YAAY,CAACqB,aAAa,CAAClyB,KAAK,EAAEE,MAAM,CAAC,CAAC;AAC/G,IAAA;AAED,IAAA,IAAMgkB,OAAO,GAAG+M,IAAI,CAACtN,KAAK;IAC1B0N,eAAe,CAACrxB,KAAK,GAAGA,KAAK;IAC7BqxB,eAAe,CAACnxB,MAAM,GAAGA,MAAM;AAE/B+wB,IAAAA,IAAI,CAACtN,KAAK,GAAG+N,iBAAiB,CAC1BL,eAAe,CAAC5kC,MAAM,EACtBwkC,IAAI,CAACjxB,KAAK,EACVixB,IAAI,CAAC/wB,MAAM,EACX+wB,IAAI,CAAC5U,KAAK,EACVgV,eAAe,CAACM,UAAU,CAC7B,GAAGN,eAAe,CAAC3V,UAAU;AAE9B,IAAA,IAAMyW,cAAc,GAAGlB,IAAI,CAACF,WAAW;AACvC,IAAA,IAAI,CAACE,IAAI,CAACG,cAAc,IAAIe,cAAc,EAAE;MACxCA,cAAc,CAACnyB,KAAK,GAAGA,KAAK;MAC5BmyB,cAAc,CAACjyB,MAAM,GAAGA,MAAM;AAC9BiyB,MAAAA,cAAc,CAACj1B,IAAI,GAAG+zB,IAAI,CAACtN,KAAK;AAChC,MAAA,IAAI,CAACwO,cAAc,CAACtuB,kBAAkB,EAAE;AACpCL,QAAAA,yBAAyB,CAACrX,QAAQ,EAAEgmC,cAAc,CAAC;AACnDhmC,QAAAA,QAAQ,CAACk1B,YAAY,CAACyQ,WAAW,IAAI5N,OAAO;AAC5C/3B,QAAAA,QAAQ,CAACk1B,YAAY,CAACyQ,WAAW,IAAIb,IAAI,CAACtN,KAAK;AAClD,MAAA;AACJ,IAAA;EACL,CAAC;AAAAp6B,EAAAA,MAAA,CAOM6oC,sBAAsB,GAA7B,SAAOA,sBAAsBA,CAAE1oC,IAAqC,EAAO;AACvE,IAAA,IAAMwnC,OAAO,GAAG,IAAImB,WAAW,EAAE;AACjCnB,IAAAA,OAAO,CAACzkC,MAAM,GAAG/C,IAAI,CAAC+C,MAAM;AAC5BykC,IAAAA,OAAO,CAACv0B,KAAK,GAAGiE,WAAW,CAAClX,IAAI,CAAC+C,MAAM,CAAC,CAACoU,QAAQ,GAAGyxB,eAAe,CAAC3tB,wBAAwB,GAAG2tB,eAAe,CAACC,gBAAgB;AAC/HrB,IAAAA,OAAO,CAAClxB,KAAK,GAAGtW,IAAI,CAACsW,KAAK;AAC1BkxB,IAAAA,OAAO,CAAChxB,MAAM,GAAGxW,IAAI,CAACwW,MAAM;AAC5B,IAAA,IAAI,CAACzW,UAAU,CAACynC,OAAO,EAAE,IAAI,CAAC;EAClC,CAAC;EAAA,OAAAtlC,YAAA,CAAAilC,YAAA,EAAA,CAAA;IAAAhlC,GAAA,EAAA,YAAA;IAAAC,GAAA,EApKD,SAAAA,GAAAA,GAAmC;MAC/B,OAAO,IAAI,CAACilC,WAAW;AAC3B,IAAA;AAAC,GAAA,EAAA;IAAAllC,GAAA,EAAA,UAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAuB;MACnB,OAAO,IAAI,CAACklC,SAAS;AACzB,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAP6BwB,OAAO,CAAA;;ACOzC,IAAMC,qBAAqB,GAAG,kBAAkB;AAEhD,SAASC,UAAUA,CAAEhmC,EAAyB,EAAO;AACjDA,EAAAA,EAAE,CAAC2W,aAAa,CAACxW,cAAc,CAACyW,QAAQ,CAAC;EACzC5W,EAAE,CAACimC,WAAW,CAAC9lC,cAAc,CAAC+lC,cAAc,EAAE,CAAC,CAAC;EAChDlmC,EAAE,CAACimC,WAAW,CAAC9lC,cAAc,CAACgmC,gBAAgB,EAAE,CAAC,CAAC;EAClDnmC,EAAE,CAACimC,WAAW,CAAC9lC,cAAc,CAACimC,mBAAmB,EAAE,KAAK,CAAC;EAEzDpmC,EAAE,CAACwX,eAAe,CAACrX,cAAc,CAACsX,WAAW,EAAE,IAAI,CAAC;AAGpDzX,EAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACkmC,YAAY,CAAC;AACtCrmC,EAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACslB,SAAS,CAAC;AACnCzlB,EAAAA,EAAE,CAAC2lB,QAAQ,CAACxlB,cAAc,CAACikB,IAAI,CAAC;AAChCpkB,EAAAA,EAAE,CAAC6lB,SAAS,CAAC1lB,cAAc,CAAC2lB,GAAG,CAAC;AAChC9lB,EAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAACmmC,mBAAmB,CAAC;AAC9CtmC,EAAAA,EAAE,CAACkmB,aAAa,CAAC,GAAG,EAAE,GAAG,CAAC;AAG1BlmB,EAAAA,EAAE,CAAC0lB,MAAM,CAACvlB,cAAc,CAACkmB,UAAU,CAAC;AACpCrmB,EAAAA,EAAE,CAAC6jB,SAAS,CAAC,IAAI,CAAC;AAClB7jB,EAAAA,EAAE,CAACsmB,SAAS,CAACnmB,cAAc,CAAC2O,IAAI,CAAC;AACjC9O,EAAAA,EAAE,CAACumC,UAAU,CAAC,GAAG,EAAE,GAAG,CAAC;AAEvBvmC,EAAAA,EAAE,CAAC6mB,mBAAmB,CAAC1mB,cAAc,CAAC+jB,KAAK,EAAE/jB,cAAc,CAACiP,MAAM,EAAE,CAAC,EAAE,MAAM,CAAC;AAC9EpP,EAAAA,EAAE,CAACinB,iBAAiB,CAAC9mB,cAAc,CAAC+jB,KAAK,EAAE/jB,cAAc,CAACqmC,IAAI,EAAErmC,cAAc,CAACqmC,IAAI,EAAErmC,cAAc,CAACqmC,IAAI,CAAC;EACzGxmC,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAAC+jB,KAAK,EAAE,MAAM,CAAC;AACpDlkB,EAAAA,EAAE,CAAC6mB,mBAAmB,CAAC1mB,cAAc,CAACikB,IAAI,EAAEjkB,cAAc,CAACiP,MAAM,EAAE,CAAC,EAAE,MAAM,CAAC;AAC7EpP,EAAAA,EAAE,CAACinB,iBAAiB,CAAC9mB,cAAc,CAACikB,IAAI,EAAEjkB,cAAc,CAACqmC,IAAI,EAAErmC,cAAc,CAACqmC,IAAI,EAAErmC,cAAc,CAACqmC,IAAI,CAAC;EACxGxmC,EAAE,CAACikB,mBAAmB,CAAC9jB,cAAc,CAACikB,IAAI,EAAE,MAAM,CAAC;AAEnDpkB,EAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAACsmB,YAAY,CAAC;AAGvCzmB,EAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAACsnB,wBAAwB,CAAC;AACnDznB,EAAAA,EAAE,CAACwlB,OAAO,CAACrlB,cAAc,CAAC2nB,KAAK,CAAC;EAChC9nB,EAAE,CAACioB,qBAAqB,CAAC9nB,cAAc,CAACsmC,QAAQ,EAAEtmC,cAAc,CAACsmC,QAAQ,CAAC;AAC1EzmC,EAAAA,EAAE,CAACsoB,iBAAiB,CAACnoB,cAAc,CAACumC,GAAG,EAAEvmC,cAAc,CAACwmC,IAAI,EAAExmC,cAAc,CAACumC,GAAG,EAAEvmC,cAAc,CAACwmC,IAAI,CAAC;EACtG3mC,EAAE,CAACqjB,SAAS,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;EACpCrjB,EAAE,CAAC0nB,UAAU,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;AACrC;AAEA,SAASkf,YAAYA,CAAE5mC,EAAyB,EAAE6mC,GAAW,EAAM;EAC/D,IAAMC,QAAQ,GAAG,CAAC,EAAE,EAAE,SAAS,EAAE,MAAM,CAAC;AACxC,EAAA,KAAK,IAAIhpC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgpC,QAAQ,CAAC/oC,MAAM,EAAE,EAAED,CAAC,EAAE;AACtC,IAAA,IAAMipC,IAAI,GAAG/mC,EAAE,CAAC4mC,YAAY,CAACE,QAAQ,CAAChpC,CAAC,CAAC,GAAG+oC,GAAG,CAAC;AAC/C,IAAA,IAAIE,IAAI,EAAE;AACN,MAAA,OAAOA,IAAI;AACd,IAAA;AACJ,EAAA;AACD,EAAA,OAAO,IAAI;AACf;SAEgBC,aAAaA,CAAEhnC,EAAyB,EAAmB;AACvE,EAAA,IAAMugB,GAAqB,GAAG;AAC1B0mB,IAAAA,8BAA8B,EAAEL,YAAY,CAAC5mC,EAAE,EAAE,gCAAgC,CAAC;AAClFknC,IAAAA,gBAAgB,EAAEN,YAAY,CAAC5mC,EAAE,EAAE,kBAAkB,CAAC;AACtDmnC,IAAAA,cAAc,EAAEP,YAAY,CAAC5mC,EAAE,EAAE,gBAAgB,CAAC;AAClDonC,IAAAA,sBAAsB,EAAER,YAAY,CAAC5mC,EAAE,EAAE,wBAAwB,CAAC;AAClEqnC,IAAAA,QAAQ,EAAET,YAAY,CAAC5mC,EAAE,EAAE,UAAU,CAAC;AACtC4Q,IAAAA,uBAAuB,EAAEg2B,YAAY,CAAC5mC,EAAE,EAAE,yBAAyB,CAAC;AACpEsnC,IAAAA,2BAA2B,EAAEV,YAAY,CAAC5mC,EAAE,EAAE,6BAA6B,CAAC;AAC5EunC,IAAAA,wBAAwB,EAAEX,YAAY,CAAC5mC,EAAE,EAAE,0BAA0B,CAAC;AACtEwnC,IAAAA,6BAA6B,EAAEZ,YAAY,CAAC5mC,EAAE,EAAE,+BAA+B,CAAC;AAChFynC,IAAAA,4BAA4B,EAAEb,YAAY,CAAC5mC,EAAE,EAAE,8BAA8B,CAAC;AAC9E0nC,IAAAA,8BAA8B,EAAEd,YAAY,CAAC5mC,EAAE,EAAE,gCAAgC,CAAC;AAClF2nC,IAAAA,6BAA6B,EAAEf,YAAY,CAAC5mC,EAAE,EAAE,+BAA+B,CAAC;AAChF4nC,IAAAA,kCAAkC,EAAEhB,YAAY,CAAC5mC,EAAE,EAAE,oCAAoC,CAAC;AAC1F6nC,IAAAA,mBAAmB,EAAEjB,YAAY,CAAC5mC,EAAE,EAAE,qBAAqB,CAAC;AAC5DmY,IAAAA,kBAAkB,EAAEyuB,YAAY,CAAC5mC,EAAE,EAAE,oBAAoB,CAAC;AAC1D8nC,IAAAA,kBAAkB,EAAElB,YAAY,CAAC5mC,EAAE,EAAE,oBAAoB,CAAC;AAC1DgU,IAAAA,mBAAmB,EAAE4yB,YAAY,CAAC5mC,EAAE,EAAE,qBAAqB,CAAC;AAC5D+nC,IAAAA,sBAAsB,EAAEnB,YAAY,CAAC5mC,EAAE,EAAE,wBAAwB,CAAC;AAClEgoC,IAAAA,6BAA6B,EAAEpB,YAAY,CAAC5mC,EAAE,EAAE,+BAA+B,CAAC;AAChFioC,IAAAA,iBAAiB,EAAErB,YAAY,CAAC5mC,EAAE,EAAE,mBAAmB,CAAC;AACxDkoC,IAAAA,wBAAwB,EAAEtB,YAAY,CAAC5mC,EAAE,EAAE,0BAA0B,CAAC;AACtEmoC,IAAAA,wBAAwB,EAAEvB,YAAY,CAAC5mC,EAAE,EAAE,0BAA0B,CAAC;AACtEooC,IAAAA,sBAAsB,EAAExB,YAAY,CAAC5mC,EAAE,EAAE,wBAAwB,CAAC;AAClEsqB,IAAAA,sBAAsB,EAAEsc,YAAY,CAAC5mC,EAAE,EAAE,wBAAwB,CAAC;AAClEqoC,IAAAA,yBAAyB,EAAEzB,YAAY,CAAC5mC,EAAE,EAAE,2BAA2B,CAAC;AACxE8sB,IAAAA,gBAAgB,EAAE,IAAI;AACtBwb,IAAAA,6BAA6B,EAAE,IAAI;AACnCvtB,IAAAA,yBAAyB,EAAE,IAAI;AAC/B6W,IAAAA,yBAAyB,EAAE,KAAK;AAChC/T,IAAAA,gBAAgB,EAAE,SAAlBA,gBAAgBA,CAAG5B,KAAc,EAAA;MAAA,OAAoC,CAAC,CAACA,KAAK;AAAA,IAAA,CAAA;AAC5EvL,IAAAA,MAAM,EAAE;GACX;AAID,EAAA;AAEI,IAAA,IAAIiC,UAAU,CAACC,EAAE,KAAKC,EAAE,CAACC,GAAG,IAAIH,UAAU,CAAC41B,aAAa,KAAK,EAAE,IAAI,CAAC51B,UAAU,CAAC61B,SAAS,EAAE;MACtFjoB,GAAG,CAAC+nB,6BAA6B,GAAG1B,YAAY,CAAC5mC,EAAE,EAAE,+BAA+B,CAAC;AACxF,IAAA;AAGD,IAAA,IAAI2S,UAAU,CAACC,EAAE,KAAKC,EAAE,CAAC41B,OAAO,IAAI91B,UAAU,CAACC,EAAE,KAAKC,EAAE,CAACC,GAAG,EAAE;MAC1DyN,GAAG,CAACuM,gBAAgB,GAAG8Z,YAAY,CAAC5mC,EAAE,EAAE,kBAAkB,CAAC;AAC9D,IAAA;AAGD,IAAA,IAAI2S,UAAU,CAAC+1B,WAAW,KAAKC,WAAW,CAACC,EAAE,EAAE;MAC3CroB,GAAG,CAAC+J,sBAAsB,GAAG,IAAI;AACpC,IAAA;IAeD,IAAK3X,UAAU,CAACC,EAAE,KAAKC,EAAE,CAACC,GAAG,IAAIH,UAAU,CAAC41B,aAAa,IAAI,EAAE,IACvD,CAAWM,mBAAmB,CAAkC,EAAE;MACtEtoB,GAAG,CAACxF,yBAAyB,GAAG,KAAK;AACxC,IAAA;AA0BJ,EAAA;EAED,IAAIwF,GAAG,CAAC3P,uBAAuB,EAAE;IAC7B2P,GAAG,CAAC7P,MAAM,GAAG,IAAI;AACpB,EAAA;AAED,EAAA,OAAO6P,GAAG;AACd;AAEM,SAAUuoB,UAAUA,CAAEC,MAAyB,EAA+B;EAChF,IAAIC,OAAqC,GAAG,IAAI;EAChD,IAAI;AACA,IAAA,IAAMC,eAAuC,GAAG;MAC5CC,KAAK,EAAEC,KAAK,CAACC,yBAAyB;AACtCC,MAAAA,SAAS,EAAEC,MAAM,IAAIH,KAAK,CAACI,sBAAsB;AACjD5Z,MAAAA,KAAK,EAAE,IAAI;AACX6Z,MAAAA,OAAO,EAAE,IAAI;AACbC,MAAAA,kBAAkB,EAAE,KAAK;AACzBC,MAAAA,qBAAqB,EAAE,KAAK;AAC5BC,MAAAA,eAAe,EAAE,SAAS;AAC1BC,MAAAA,4BAA4B,EAAE;KACjC;IAEDZ,OAAO,GAAGD,MAAM,CAACD,UAAU,CAAC,OAAO,EAAEG,eAAe,CAAC;EACxD,CAAA,CAAC,OAAOY,GAAG,EAAE;AACV,IAAA,OAAO,IAAI;AACd,EAAA;AAED,EAAA,OAAOb,OAAO;AAClB;AAGA,IAAac,cAAe,aAAAC,UAAA,EAAA;AAkBxB,EAAA,SAAAD,iBAAA;AAAA,IAAA,IAAArtC,KAAA;AACIA,IAAAA,KAAA,GAAAstC,UAAA,CAAArtC,IAAA,MAAO,IAAA,IAAA;AAACD,IAAAA,KAAA,CAVLiT,UAAU,GAAoB,IAAIo0B,eAAe,EAAE;IAAArnC,KAAA,CACnDutB,SAAS,GAAiB,IAAI;IAAAvtB,KAAA,CAC9ButC,WAAW,GAAiB,IAAI;IAAAvtC,KAAA,CAE/BwtC,OAAO,GAA6B,IAAI;IAAAxtC,KAAA,CACxCytC,wBAAwB,GAAoC,IAAI;IAAAztC,KAAA,CAChE0tC,WAAW,GAA4B,IAAI;IAAA1tC,KAAA,CAC3C2tC,YAAY,GAA6B,IAAI;AAAA,IAAA,OAAA3tC,KAAA;AAIrD,EAAA;EAACG,cAAA,CAAAktC,cAAA,EAAAC,UAAA,CAAA;AAAA,EAAA,IAAAltC,MAAA,GAAAitC,cAAA,CAAAhtC,SAAA;AAAAD,EAAAA,MAAA,CAEME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAA6B,EAAO;IACnD,IAAMunC,IAAI,GAAG,IAAI;AACjBA,IAAAA,IAAI,CAAC0F,OAAO,GAAGjtC,IAAI,CAACqtC,YAAY;IAEhC9F,IAAI,CAAC2F,wBAAwB,GAAG3F,IAAI,CAAC+F,mBAAmB,CAACC,IAAI,CAAChG,IAAI,CAAC;IACnEA,IAAI,CAAC0F,OAAO,CAACO,gBAAgB,CAACzE,qBAAqB,EAAExB,IAAI,CAAC2F,wBAAwB,CAAC;AAEnF,IAAA,IAAQzqC,QAAQ,GAAKF,kBAAkB,CAA/BE,QAAQ;AAChB,IAAA,IAAQO,EAAE,GAAmBP,QAAQ,CAA7BO,EAAE;MAAE6T,YAAY,GAAKpU,QAAQ,CAAzBoU,YAAY;AAExB0wB,IAAAA,IAAI,CAAC70B,UAAU,CAAC3S,UAAU,CAAC8W,YAAY,CAACsK,eAAe,EAAEtK,YAAY,CAACuX,mBAAmB,CAAC;AAE1FmZ,IAAAA,IAAI,CAAC4F,WAAW,GAAGnD,aAAa,CAAChnC,EAAE,CAAC;IAGpCgmC,UAAU,CAAChmC,EAAE,CAAC;AAEd,IAAA,IAAMyqC,QAAQ,GAAGxqC,MAAM,CAAC0C,KAAK;AAC7B,IAAA,IAAI+nC,eAAe,GAAGzqC,MAAM,CAACgE,aAAa;IAE1C,IAAI0mC,SAAS,GAAG3qC,EAAE,CAAC4qC,YAAY,CAACzqC,cAAc,CAAC0qC,UAAU,CAAC;IAC1D,IAAMC,WAAW,GAAG9qC,EAAE,CAAC4qC,YAAY,CAACzqC,cAAc,CAAC4qC,YAAY,CAAC;AAMhE,IAAA,IAAIJ,SAAS,IAAIG,WAAW,EAAEJ,eAAe,GAAGzqC,MAAM,CAACgE,aAAa,CAAC,KAChE,IAAI0mC,SAAS,EAAED,eAAe,GAAGzqC,MAAM,CAAC+D,KAAK;AAElDugC,IAAAA,IAAI,CAACyG,aAAa,GAAG,IAAI7G,YAAY,EAAE;AACvCI,IAAAA,IAAI,CAACyG,aAAa,CAACtF,sBAAsB,CAAC;AACtCuF,MAAAA,SAAS,EAAE1G,IAAI;AACfxkC,MAAAA,MAAM,EAAE0qC,QAAQ;MAChBn3B,KAAK,EAAEtW,IAAI,CAACsW,KAAK;MACjBE,MAAM,EAAExW,IAAI,CAACwW;AAChB,KAAA,CAAC;AAEF+wB,IAAAA,IAAI,CAAC7H,oBAAoB,GAAG,IAAIyH,YAAY,EAAE;AAC9CI,IAAAA,IAAI,CAAC7H,oBAAoB,CAACgJ,sBAAsB,CAAC;AAC7CuF,MAAAA,SAAS,EAAE1G,IAAI;AACfxkC,MAAAA,MAAM,EAAE2qC,eAAe;MACvBp3B,KAAK,EAAEtW,IAAI,CAACsW,KAAK;MACjBE,MAAM,EAAExW,IAAI,CAACwW;AAChB,KAAA,CAAC;AAGF+wB,IAAAA,IAAI,CAACva,SAAS,GAAGvqB,QAAQ,CAACiV,aAAa,CAAC,IAAIixB,WAAW,CACnDlyB,WAAW,CAACC,KAAK,EACjBkyB,eAAe,CAACsF,OAAO,EACvBjrC,MAAM,CAAC0C,KAAK,EACZ,CAAC,EACD,CAAC,EACDusB,cAAc,CAACC,UAAU,CAC5B,CAAiB;AAElBoV,IAAAA,IAAI,CAACyF,WAAW,GAAGvqC,QAAQ,CAACiV,aAAa,CAAC,IAAIixB,WAAW,CACrDlyB,WAAW,CAAC2C,IAAI,EAChBwvB,eAAe,CAACsF,OAAO,EACvBjrC,MAAM,CAAC0C,KAAK,EACZ,CAAC,EACD,CAAC,EACDusB,cAAc,CAACC,UAAU,EACzB,CAAC,CACJ,CAAiB;AAElB,IAAA,IAAMgc,aAAa,GAAG,IAAIC,iBAAiB,EAAE;AAC7CD,IAAAA,aAAa,CAACpa,SAAS,CAACzd,KAAK,GAAG,CAAC;AACjC63B,IAAAA,aAAa,CAACpa,SAAS,CAACvd,MAAM,GAAG,CAAC;IAElC,IAAM63B,WAAW,GAAG,IAAIj2B,UAAU,CAACmvB,IAAI,CAACva,SAAS,CAACxZ,IAAI,CAAC;AACvD66B,IAAAA,WAAW,CAAC3tC,IAAI,CAAC,CAAC,CAAC;AACnB+B,IAAAA,QAAQ,CAAC07B,oBAAoB,CAAC,CAACkQ,WAAW,CAAC,EAAE9G,IAAI,CAACva,SAAS,EAAE,CAACmhB,aAAa,CAAC,CAAC;AAE7EA,IAAAA,aAAa,CAACzc,SAAS,CAACM,UAAU,GAAG,CAAC;IACtCvvB,QAAQ,CAAC07B,oBAAoB,CACzB,CAACkQ,WAAW,EAAEA,WAAW,EAAEA,WAAW,EAAEA,WAAW,EAAEA,WAAW,EAAEA,WAAW,CAAC,EAC9E9G,IAAI,CAACyF,WAAW,EAChB,CAACmB,aAAa,CAAC,CAClB;AACD5G,IAAAA,IAAI,CAAC6F,YAAY,GAAG,IAAItX,iBAAiB,EAAE;EAC/C,CAAC;AAAAj2B,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAM6lC,IAAI,GAAG,IAAI;AACjB,IAAA,IAAIA,IAAI,CAAC0F,OAAO,IAAI1F,IAAI,CAAC2F,wBAAwB,EAAE;MAC/C3F,IAAI,CAAC0F,OAAO,CAACqB,mBAAmB,CAACvF,qBAAqB,EAAExB,IAAI,CAAC2F,wBAAwB,CAAC;MACtF3F,IAAI,CAAC2F,wBAAwB,GAAG,IAAI;AACvC,IAAA;IAED,IAAI3F,IAAI,CAACva,SAAS,EAAE;AAChBua,MAAAA,IAAI,CAACva,SAAS,CAACtrB,OAAO,EAAE;MACxB6lC,IAAI,CAACva,SAAS,GAAG,IAAK;AACzB,IAAA;IAED,IAAIua,IAAI,CAACyF,WAAW,EAAE;AAClBzF,MAAAA,IAAI,CAACyF,WAAW,CAACtrC,OAAO,EAAE;MAC1B6lC,IAAI,CAACyF,WAAW,GAAG,IAAK;AAC3B,IAAA;IAED,IAAIzF,IAAI,CAAC6F,YAAY,EAAE;AACnB7F,MAAAA,IAAI,CAAC6F,YAAY,CAAC1rC,OAAO,EAAE;MAC3B6lC,IAAI,CAAC6F,YAAY,GAAG,IAAK;AAC5B,IAAA;IAED7F,IAAI,CAAC4F,WAAW,GAAG,IAAI;IACvB5F,IAAI,CAAC0F,OAAO,GAAG,IAAI;EACvB,CAAC;EAAAptC,MAAA,CAEMy6B,MAAM,GAAb,SAAOA,MAAMA,CAAEhkB,KAAa,EAAEE,MAAc,EAAE+3B,gBAAkC,EAAO;IACnF,IAAMhH,IAAI,GAAG,IAAI;AACjB,IAAA,IAAIA,IAAI,CAACyG,aAAa,CAAC13B,KAAK,KAAKA,KAAK,IAAIixB,IAAI,CAACyG,aAAa,CAACx3B,MAAM,KAAKA,MAAM,EAAE;AAC5Eg4B,MAAAA,KAAK,CAAA,sBAAA,GAAwBl4B,KAAK,GAAA,GAAA,GAAIE,MAAQ,CAAC;AAC/C+wB,MAAAA,IAAI,CAAC0F,OAAO,CAAE32B,KAAK,GAAGA,KAAK;AAC3BixB,MAAAA,IAAI,CAAC0F,OAAO,CAAEz2B,MAAM,GAAGA,MAAM;MAC7B+wB,IAAI,CAACyG,aAAa,CAAC1T,MAAM,CAAChkB,KAAK,EAAEE,MAAM,CAAC;MACxC+wB,IAAI,CAAC7H,oBAAoB,CAACpF,MAAM,CAAChkB,KAAK,EAAEE,MAAM,CAAC;AAClD,IAAA;EACL,CAAC;AAAA3W,EAAAA,MAAA,CAEOytC,mBAAmB,GAA3B,SAAQA,mBAAmBA,CAAEmB,KAAY,EAAO;IAC5ClU,MAAM,CAAC,KAAK,CAAC;IACbmU,IAAI,CAACD,KAAK,CAAC;EAGf,CAAC;EAAA,OAAAvsC,YAAA,CAAA4qC,cAAA,EAAA,CAAA;IAAA3qC,GAAA,EAAA,YAAA;IAAAC,GAAA,EAlJD,SAAAA,GAAAA,GAAmC;MAC/B,OAAO,IAAI,CAAC+qC,WAAW;AAC3B,IAAA;AAAC,GAAA,EAAA;IAAAhrC,GAAA,EAAA,aAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAqC;MACjC,OAAO,IAAI,CAACgrC,YAAY;AAC5B,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAP+BuB,SAAS,CAAA;;ACpJ7C,SAASC,gBAAgBA,CAAEC,cAA+B,EAAEC,UAAoB,EAAEC,OAAsB,EAAO;AAC3G,EAAA,KAAK,IAAIjuC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGguC,UAAU,CAAC/tC,MAAM,EAAE,EAAED,CAAC,EAAE;AACxC+tC,IAAAA,cAAc,CAACC,UAAU,CAAChuC,CAAC,CAAC,CAAC,GAAGiuC,OAAO;AAC1C,EAAA;AACL;AAEA,SAASC,yBAAyBA,CAAEH,cAA+B,EAAEC,UAAoB,EAAEC,OAAsB,EAAO;AACpH,EAAA,KAAK,IAAIjuC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGguC,UAAU,CAAC/tC,MAAM,EAAE,EAAED,CAAC,EAAE;AACxC+tC,IAAAA,cAAc,CAACC,UAAU,CAAChuC,CAAC,CAAC,CAAC,IAAIiuC,OAAO;AAC3C,EAAA;AACL;AAEA,SAASE,mBAAmBA,CAAEl4B,gBAA2B,EAAE+3B,UAAoB,EAAEI,WAAoB,EAAO;AACxG,EAAA,KAAK,IAAIpuC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGguC,UAAU,CAAC/tC,MAAM,EAAE,EAAED,CAAC,EAAE;AACxCiW,IAAAA,gBAAgB,CAAC+3B,UAAU,CAAChuC,CAAC,CAAC,CAAC,GAAGouC,WAAW;AAChD,EAAA;AACL;AAGA,IAAaC,WAAY,aAAAC,OAAA,EAAA;AACrB,EAAA,SAAAD,cAAA;AAAA,IAAA,IAAA1vC,KAAA;AACIA,IAAAA,KAAA,GAAA2vC,OAAA,CAAA1vC,IAAA,MAAO,IAAA,IAAA;IAACD,KAAA,CAmCJ4vC,UAAU,GAA0B,IAAI;IAAA5vC,KAAA,CACxC6vC,QAAQ,GAAiC,IAAI;IAAA7vC,KAAA,CAC7C8vC,gBAAgB,GAAgC,IAAI;IAAA9vC,KAAA,CAElD+vC,iBAAiB,GAAG,IAAI/uC,KAAK,CAAUwC,MAAM,CAACwsC,KAAK,CAAC;AAAA,IAAA,OAAAhwC,KAAA;AAtC9D,EAAA;EAACG,cAAA,CAAAuvC,WAAA,EAAAC,OAAA,CAAA;AAAA,EAAA,IAAAvvC,MAAA,GAAAsvC,WAAA,CAAArvC,SAAA;AAAAD,EAAAA,MAAA,CAwCME,UAAU,GAAjB,SAAOA,UAAUA,CAAEC,IAA0B,EAAU;AACnDuC,IAAAA,kBAAkB,CAACC,WAAW,CAAC,IAAI,CAAC;AACpC,IAAA,IAAI,CAACktC,OAAO,GAAGC,GAAG,CAACC,KAAK;IAExB,IAAMC,OAAO,GAAG,IAAI,CAACC,mBAAmB,GAAG9vC,IAAI,CAAC42B,kBAAkB;IAClE,IAAM6E,YAAsB,GAAG,EAAE;IACjC,IAAM9Z,qBAA+B,GAAG,EAAE;AAC1C,IAAA,IAAMouB,QAAQ,GAAGF,OAAO,CAACG,UAAU,CAAC,CAAC,CAAC;AACtCvU,IAAAA,YAAY,CAACsU,QAAQ,CAAC,GAAG,CAAC;AAC1BpuB,IAAAA,qBAAqB,CAACouB,QAAQ,CAAC,GAAG,CAAC;AACnC,IAAA,KAAK,IAAIjvC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+uC,OAAO,CAACG,UAAU,CAACjvC,MAAM,EAAE,EAAED,CAAC,EAAE;AAChD,MAAA,IAAMmvC,MAAM,GAAGJ,OAAO,CAACG,UAAU,CAAClvC,CAAC,CAAC;MACpC,IAAMovC,OAAO,GAAGL,OAAO,CAACG,UAAU,CAAClvC,CAAC,GAAG,CAAC,CAAC;AAEzC26B,MAAAA,YAAY,CAACwU,MAAM,CAAC,GAAGJ,OAAO,CAAChZ,cAAc,CAACqZ,OAAO,CAAC,GAAGzU,YAAY,CAACyU,OAAO,CAAC;AAC9EvuB,MAAAA,qBAAqB,CAACsuB,MAAM,CAAC,GAAGJ,OAAO,CAACM,uBAAuB,CAACD,OAAO,CAAC,GAAGvuB,qBAAqB,CAACuuB,OAAO,CAAC;AAC5G,IAAA;AACD,IAAA,KAAK,IAAIpvC,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAG+uC,OAAO,CAACG,UAAU,CAACjvC,MAAM,EAAE,EAAED,EAAC,EAAE;AAChD,MAAA,IAAMmvC,OAAM,GAAGJ,OAAO,CAACG,UAAU,CAAClvC,EAAC,CAAC;MAEpC6gB,qBAAqB,CAACsuB,OAAM,CAAC,IAAIJ,OAAO,CAAChZ,cAAc,CAACoZ,OAAM,CAAC;AAClE,IAAA;IACD,IAAI,CAACV,gBAAgB,GAAG;AACpB9T,MAAAA,YAAY,EAAZA,YAAY;AACZ9Z,MAAAA,qBAAqB,EAArBA,qBAAqB;MACrBH,WAAW,EAAEquB,OAAO,CAACG,UAAU,CAACH,OAAO,CAACG,UAAU,CAACjvC,MAAM,GAAG,CAAC;KAChE;IAED,IAAMiC,EAAE,GAAG,IAAI,CAACssC,QAAQ,GAAGxD,UAAU,CAACsE,MAAM,CAACrE,MAAM,CAAC;IAEpD,IAAI,CAAC/oC,EAAE,EAAE;MACLmI,OAAO,CAAC,KAAK,CAAC;AACd,MAAA,OAAO,KAAK;AACf,IAAA;AAGD,IAAA,IAAI,CAACmwB,MAAM,GAAG,IAAI,CAAC+U,WAAW,CAAC,IAAIC,SAAS,CAACC,SAAS,CAACC,QAAQ,CAAC,CAAC;AACjE,IAAA,IAAI,CAACC,QAAQ,GAAG,IAAI,CAACC,mBAAmB,CAAC,IAAIC,iBAAiB,CAAC,IAAI,CAACrV,MAAM,CAAC,CAAC;IAE5E,IAAMsV,cAAc,GAAG5tC,EAAE,CAAC4qC,YAAY,CAACL,IAAI,CAACvqC,EAAE,CAAC;AAE/C,IAAA,IAAM6tC,IAAI,GAAG,IAAI,CAACC,KAAK;IACvBD,IAAI,CAACziB,mBAAmB,GAAGwiB,cAAc,CAACztC,cAAc,CAAC4tC,kBAAkB,CAAC;IAC5EF,IAAI,CAACG,uBAAuB,GAAGJ,cAAc,CAACztC,cAAc,CAAC8tC,0BAA0B,CAAC;IACxFJ,IAAI,CAACK,yBAAyB,GAAGN,cAAc,CAACztC,cAAc,CAACguC,4BAA4B,CAAC;IAC5FN,IAAI,CAAC1vB,eAAe,GAAGyvB,cAAc,CAACztC,cAAc,CAACiuC,uBAAuB,CAAC;IAC7EP,IAAI,CAACQ,qBAAqB,GAAGT,cAAc,CAACztC,cAAc,CAACmuC,8BAA8B,CAAC;IAC1FT,IAAI,CAAC/5B,cAAc,GAAG85B,cAAc,CAACztC,cAAc,CAACouC,gBAAgB,CAAC;IACrEV,IAAI,CAACv3B,qBAAqB,GAAGs3B,cAAc,CAACztC,cAAc,CAACquC,yBAAyB,CAAC;IACrFX,IAAI,CAACY,qBAAqB,GAAG,CAAC;IAC9BZ,IAAI,CAACa,gBAAgB,GAAG,CAAC;IAGzBb,IAAI,CAACc,wBAAwB,GAAG,EAAE;AAElC,IAAA,IAAMl+B,UAAU,GAAGzQ,EAAE,CAAC4uC,sBAAsB,EAAE;IAC9C,IAAIC,MAAM,GAAG,EAAE;AACf,IAAA,IAAIp+B,UAAU,EAAE;AACZA,MAAAA,UAAU,CAACqsB,OAAO,CAAC,UAAC+J,GAAG,EAAI;QACvBgI,MAAM,IAAOhI,GAAG,GAAA,GAAG;AACvB,MAAA,CAAC,CAAC;AACL,IAAA;AAED,IAAA,IAAMiI,IAAI,GAAG9H,aAAa,CAAChnC,EAAE,CAAC;IAE9B,IAAI8uC,IAAI,CAACzG,yBAAyB,EAAE;MAChC,IAAI,CAAC0G,SAAS,GAAGnB,cAAc,CAACkB,IAAI,CAACzG,yBAAyB,CAAC2G,uBAAuB,CAAC;MACvF,IAAI,CAACC,OAAO,GAAGrB,cAAc,CAACkB,IAAI,CAACzG,yBAAyB,CAAC6G,qBAAqB,CAAC;AACtF,IAAA,CAAA,MAAM;MACH,IAAI,CAACH,SAAS,GAAGnB,cAAc,CAACztC,cAAc,CAACgvC,QAAQ,CAAC;MACxD,IAAI,CAACF,OAAO,GAAGrB,cAAc,CAACztC,cAAc,CAACivC,MAAM,CAAC;AACvD,IAAA;AAED,IAAA,IAAMC,OAAe,GAAGzB,cAAc,CAACztC,cAAc,CAACmvC,OAAO,CAAC;AAC9D,IAAA,IAAMC,QAAQ,GAAG,IAAI,CAACC,SAAS;AAC/BD,IAAAA,QAAQ,CAAC7xC,IAAI,CAAC,KAAK,CAAC;AAEpB,IAAA,IAAI,CAAC+xC,kBAAkB,CAACX,IAAI,CAAC;IAE7B,IAAIA,IAAI,CAAC5H,gBAAgB,EAAE;AACvBqI,MAAAA,QAAQ,CAACG,OAAO,CAACC,YAAY,CAAC,GAAG,IAAI;AACxC,IAAA;IAED,IAAIb,IAAI,CAAC1G,sBAAsB,EAAE;AAC7BmH,MAAAA,QAAQ,CAACG,OAAO,CAACE,kBAAkB,CAAC,GAAG,IAAI;AAC9C,IAAA;IAED,IAAId,IAAI,CAACxkB,sBAAsB,EAAE;AAC7BilB,MAAAA,QAAQ,CAACG,OAAO,CAACG,gBAAgB,CAAC,GAAG,IAAI;AAC5C,IAAA;IAED,IAAIf,IAAI,CAAC32B,kBAAkB,EAAE;AACzBo3B,MAAAA,QAAQ,CAACG,OAAO,CAACI,uBAAuB,CAAC,GAAG,IAAI;AACnD,IAAA;IAED,IAAIC,gBAAgB,GAAG,EAAE;IAEzB,IAAI,IAAI,CAACC,iBAAiB,CAAC/vC,MAAM,CAACgF,QAAQ,CAAC,EAAE;AACzC8qC,MAAAA,gBAAgB,IAAI,OAAO;AAC9B,IAAA;IAED,IAAI,IAAI,CAACC,iBAAiB,CAAC/vC,MAAM,CAACiF,SAAS,CAAC,EAAE;AAC1C6qC,MAAAA,gBAAgB,IAAI,OAAO;AAC9B,IAAA;IAED,IAAI,IAAI,CAACC,iBAAiB,CAAC/vC,MAAM,CAACkE,GAAG,CAAC,EAAE;AACpC4rC,MAAAA,gBAAgB,IAAI,MAAM;AAC7B,IAAA;IAED,IAAI,IAAI,CAACC,iBAAiB,CAAC/vC,MAAM,CAACyF,UAAU,CAAC,EAAE;AAC3CqqC,MAAAA,gBAAgB,IAAI,QAAQ;AAC/B,IAAA;IAED,IAAI,IAAI,CAACC,iBAAiB,CAAC/vC,MAAM,CAAC+F,aAAa,CAAC,EAAE;AAC9C+pC,MAAAA,gBAAgB,IAAI,OAAO;AAC9B,IAAA;IAEDvE,KAAK,CAAC,2BAA2B,CAAC;AAClCA,IAAAA,KAAK,CAAA,YAAA,GAAc,IAAI,CAACuD,SAAW,CAAC;AACpCvD,IAAAA,KAAK,CAAA,UAAA,GAAY,IAAI,CAACyD,OAAS,CAAC;IAChCzD,KAAK,CAAA,WAAA,GAAa6D,OAAS,CAAC;IAC5B7D,KAAK,CAAA,qBAAA,GAAuBuE,gBAAkB,CAAC;IAC/CvE,KAAK,CAAA,cAAA,GAAgBqD,MAAQ,CAAC;AAE9B,IAAA,OAAO,IAAI;EACf,CAAC;AAAAhyC,EAAAA,MAAA,CAEM6B,OAAO,GAAd,SAAOA,OAAOA,GAAS;IACnB,IAAI,IAAI,CAAC45B,MAAM,EAAE;AACb,MAAA,IAAI,CAACA,MAAM,CAAC55B,OAAO,EAAE;MACrB,IAAI,CAAC45B,MAAM,GAAG,IAAI;AACrB,IAAA;IAED,IAAI,IAAI,CAACmV,QAAQ,EAAE;AACf,MAAA,IAAI,CAACA,QAAQ,CAAC/uC,OAAO,EAAE;MACvB,IAAI,CAAC+uC,QAAQ,GAAG,IAAI;AACvB,IAAA;IAED,IAAI,CAACpB,UAAU,GAAG,IAAI;EAC1B,CAAC;EAAAxvC,MAAA,CAEMozC,aAAa,GAApB,SAAOA,aAAaA,CAAE3U,QAAyB,EAAO,CAEtD,CAAC;EAAAz+B,MAAA,CAEMqzC,OAAO,GAAd,SAAOA,OAAOA,CAAEC,UAAuB,EAAO,CAE9C,CAAC;AAAAtzC,EAAAA,MAAA,CAEMuzC,OAAO,GAAd,SAAOA,OAAOA,GAAS;AACnB,IAAA,IAAM7X,KAAK,GAAI,IAAI,CAACD,MAAqB;AACzC,IAAA,IAAI,CAACQ,aAAa,GAAGP,KAAK,CAAC8I,YAAY;AACvC,IAAA,IAAI,CAACtI,aAAa,GAAGR,KAAK,CAAC+I,YAAY;AACvC,IAAA,IAAI,CAACtI,QAAQ,GAAGT,KAAK,CAACgJ,OAAO;IAC7BhJ,KAAK,CAAC3X,KAAK,EAAE;EACjB,CAAC;AAAA/jB,EAAAA,MAAA,CAES4yC,kBAAkB,GAA5B,SAAUA,kBAAkBA,CAAEX,IAAsB,EAAO;AACvD,IAAA,IAAMjD,cAAc,GAAG,IAAI,CAACwE,eAAe;AAC3CxE,IAAAA,cAAc,CAACnuC,IAAI,CAAC4yC,gBAAgB,CAAC/+B,IAAI,CAAC;AAE1C,IAAA,IAAMwC,gBAAgB,GAAG,IAAI,CAACy4B,iBAAiB;AAC/Cz4B,IAAAA,gBAAgB,CAACrW,IAAI,CAAC,IAAI,CAAC;AAE3B,IAAA,IAAM6yC,WAA0B,GAAGD,gBAAgB,CAACE,aAAa,GAAGF,gBAAgB,CAACG,eAAe,GAC9FH,gBAAgB,CAACI,aAAa;IAEpC9E,gBAAgB,CAACC,cAAc,EAAE,CAC7B5rC,MAAM,CAAC8B,IAAI,EACX9B,MAAM,CAACqD,MAAM,EACbrD,MAAM,CAAC0C,KAAK,EACZ1C,MAAM,CAAC0D,KAAK,EACZ1D,MAAM,CAACwD,MAAM,CAChB,EAAE8sC,WAAW,CAAC;AAEf3E,IAAAA,gBAAgB,CAACC,cAAc,EAAE,CAC7B5rC,MAAM,CAAC+D,KAAK,EACZ/D,MAAM,CAACgE,aAAa,CACvB,EAAEqsC,gBAAgB,CAACE,aAAa,CAAC;IAElCvE,mBAAmB,CAACl4B,gBAAgB,EAAE,CAClC9T,MAAM,CAACqD,MAAM,EACbrD,MAAM,CAAC0D,KAAK,EACZ1D,MAAM,CAACwD,MAAM,EACbxD,MAAM,CAAC+D,KAAK,EACZ/D,MAAM,CAACgE,aAAa,CACvB,EAAE,KAAK,CAAC;AAET+nC,IAAAA,yBAAyB,CAACH,cAAc,EAAE,CACtC5rC,MAAM,CAACO,GAAG,EACVP,MAAM,CAACuB,IAAI,EACXvB,MAAM,CAACkC,KAAK,EACZlC,MAAM,CAAC8C,MAAM,EAEb9C,MAAM,CAACM,IAAI,EACXN,MAAM,CAACsB,KAAK,EACZtB,MAAM,CAACiC,MAAM,EACbjC,MAAM,CAAC6C,OAAO,EAEd7C,MAAM,CAACO,GAAG,EACVP,MAAM,CAACuB,IAAI,EACXvB,MAAM,CAACkC,KAAK,EACZlC,MAAM,CAAC8C,MAAM,EAEb9C,MAAM,CAACM,IAAI,EACXN,MAAM,CAACsB,KAAK,EACZtB,MAAM,CAACiC,MAAM,EACbjC,MAAM,CAAC6C,OAAO,EAEd7C,MAAM,CAACc,IAAI,EACXd,MAAM,CAAC2B,KAAK,EACZ3B,MAAM,CAACsC,MAAM,EACbtC,MAAM,CAACkD,OAAO,CACjB,EAAEmtC,gBAAgB,CAACK,gBAAgB,CAAC;IAErC,IAAI7B,IAAI,CAACzH,QAAQ,EAAE;AACfwE,MAAAA,cAAc,CAAC5rC,MAAM,CAAC+B,KAAK,CAAC,GAAGuuC,WAAW;AAC1C1E,MAAAA,cAAc,CAAC5rC,MAAM,CAAC2C,QAAQ,CAAC,GAAG2tC,WAAW;AAE7Cx8B,MAAAA,gBAAgB,CAAC9T,MAAM,CAAC2C,QAAQ,CAAC,GAAG,KAAK;AAC5C,IAAA;IAED,IAAIksC,IAAI,CAAC96B,mBAAmB,EAAE;AAC1B63B,MAAAA,cAAc,CAAC5rC,MAAM,CAAC+D,KAAK,CAAC,IAAIusC,WAAW;AAC3C1E,MAAAA,cAAc,CAAC5rC,MAAM,CAACgE,aAAa,CAAC,IAAIssC,WAAW;AACtD,IAAA;IAED,IAAIzB,IAAI,CAACvH,wBAAwB,EAAE;MAC/BsE,cAAc,CAAC5rC,MAAM,CAACsC,MAAM,CAAC,IAAI+tC,gBAAgB,CAACE,aAAa;MAC/D3E,cAAc,CAAC5rC,MAAM,CAACkD,OAAO,CAAC,IAAImtC,gBAAgB,CAACE,aAAa;AAChEz8B,MAAAA,gBAAgB,CAAC9T,MAAM,CAACsC,MAAM,CAAC,GAAG,KAAK;AACvCwR,MAAAA,gBAAgB,CAAC9T,MAAM,CAACkD,OAAO,CAAC,GAAG,KAAK;AAC3C,IAAA;IAED,IAAI2rC,IAAI,CAACxH,2BAA2B,EAAE;MAClCuE,cAAc,CAAC5rC,MAAM,CAACmC,MAAM,CAAC,IAAIkuC,gBAAgB,CAACE,aAAa;MAC/D3E,cAAc,CAAC5rC,MAAM,CAAC+C,OAAO,CAAC,IAAIstC,gBAAgB,CAACE,aAAa;AAChEz8B,MAAAA,gBAAgB,CAAC9T,MAAM,CAACmC,MAAM,CAAC,GAAG,KAAK;AACvC2R,MAAAA,gBAAgB,CAAC9T,MAAM,CAAC+C,OAAO,CAAC,GAAG,KAAK;AAC3C,IAAA;IAED,IAAI8rC,IAAI,CAAC7G,iBAAiB,EAAE;AACxB4D,MAAAA,cAAc,CAAC5rC,MAAM,CAACsC,MAAM,CAAC,IAAI+tC,gBAAgB,CAACE,aAAa,GAAGF,gBAAgB,CAACG,eAAe;AAClG5E,MAAAA,cAAc,CAAC5rC,MAAM,CAACkD,OAAO,CAAC,IAAImtC,gBAAgB,CAACE,aAAa,GAAGF,gBAAgB,CAACG,eAAe;AACtG,IAAA;IAED,IAAI3B,IAAI,CAAC/G,sBAAsB,EAAE;AAC7B8D,MAAAA,cAAc,CAAC5rC,MAAM,CAACmC,MAAM,CAAC,IAAIkuC,gBAAgB,CAACE,aAAa,GAAGF,gBAAgB,CAACG,eAAe;AAClG5E,MAAAA,cAAc,CAAC5rC,MAAM,CAAC+C,OAAO,CAAC,IAAIstC,gBAAgB,CAACE,aAAa,GAAGF,gBAAgB,CAACG,eAAe;AACtG,IAAA;IAED,IAAI3B,IAAI,CAAC5G,wBAAwB,EAAE;MAC/B2D,cAAc,CAAC5rC,MAAM,CAACsC,MAAM,CAAC,IAAI+tC,gBAAgB,CAACI,aAAa;MAC/D7E,cAAc,CAAC5rC,MAAM,CAACkD,OAAO,CAAC,IAAImtC,gBAAgB,CAACI,aAAa;AACnE,IAAA;IAED,IAAI5B,IAAI,CAAC9G,6BAA6B,EAAE;MACpC6D,cAAc,CAAC5rC,MAAM,CAACmC,MAAM,CAAC,IAAIkuC,gBAAgB,CAACI,aAAa;MAC/D7E,cAAc,CAAC5rC,MAAM,CAAC+C,OAAO,CAAC,IAAIstC,gBAAgB,CAACI,aAAa;AACnE,IAAA;IAED,IAAME,iBAAgC,GAAGN,gBAAgB,CAACG,eAAe,GAAGH,gBAAgB,CAACI,aAAa;IAE1G,IAAI5B,IAAI,CAACtH,6BAA6B,EAAE;AACpCqE,MAAAA,cAAc,CAAC5rC,MAAM,CAACgF,QAAQ,CAAC,GAAG2rC,iBAAiB;AACtD,IAAA;IAED,IAAI9B,IAAI,CAACrH,4BAA4B,EAAE;AACnCmE,MAAAA,gBAAgB,CAACC,cAAc,EAAE,CAC7B5rC,MAAM,CAACiF,SAAS,EAChBjF,MAAM,CAAC4J,UAAU,EACjB5J,MAAM,CAACkF,UAAU,EACjBlF,MAAM,CAAC8J,aAAa,EACpB9J,MAAM,CAACmF,YAAY,EACnBnF,MAAM,CAACoF,aAAa,CACvB,EAAEurC,iBAAiB,CAAC;AACxB,IAAA;IAED,IAAI9B,IAAI,CAACnH,6BAA6B,EAAE;AACpCiE,MAAAA,gBAAgB,CAACC,cAAc,EAAE,CAC7B5rC,MAAM,CAACkE,GAAG,EACVlE,MAAM,CAAC8I,SAAS,EAChB9I,MAAM,CAACmE,QAAQ,EACfnE,MAAM,CAACiJ,cAAc,EACrBjJ,MAAM,CAACoE,GAAG,EACVpE,MAAM,CAACqE,QAAQ,EACfrE,MAAM,CAACsE,GAAG,EACVtE,MAAM,CAACuE,QAAQ,CAClB,EAAEosC,iBAAiB,CAAC;AACxB,IAAA;IAED,IAAI9B,IAAI,CAACpH,8BAA8B,EAAE;MACrCsE,yBAAyB,CAACH,cAAc,EAAE,CACtC5rC,MAAM,CAACyF,UAAU,EACjBzF,MAAM,CAAC0F,WAAW,EAClB1F,MAAM,CAAC2F,UAAU,EACjB3F,MAAM,CAAC4F,WAAW,CACrB,EAAE+qC,iBAAiB,CAAC;AACxB,IAAA;IAED,IAAI9B,IAAI,CAACxG,6BAA6B,EAAE;MACpC0D,yBAAyB,CAACH,cAAc,EAAE,CACtC5rC,MAAM,CAAC+F,aAAa,EACpB/F,MAAM,CAACgG,aAAa,EACpBhG,MAAM,CAACiG,aAAa,EACpBjG,MAAM,CAACkG,aAAa,EACpBlG,MAAM,CAACmG,aAAa,EACpBnG,MAAM,CAACoG,aAAa,EACpBpG,MAAM,CAACqG,aAAa,EACpBrG,MAAM,CAACsG,aAAa,EACpBtG,MAAM,CAACuG,cAAc,EACrBvG,MAAM,CAACwG,cAAc,EACrBxG,MAAM,CAACyG,cAAc,EACrBzG,MAAM,CAAC0G,eAAe,EACtB1G,MAAM,CAAC2G,eAAe,EACtB3G,MAAM,CAAC4G,eAAe,EAEtB5G,MAAM,CAAC6G,cAAc,EACrB7G,MAAM,CAAC8G,cAAc,EACrB9G,MAAM,CAAC+G,cAAc,EACrB/G,MAAM,CAACgH,cAAc,EACrBhH,MAAM,CAACiH,cAAc,EACrBjH,MAAM,CAACkH,cAAc,EACrBlH,MAAM,CAACmH,cAAc,EACrBnH,MAAM,CAACoH,cAAc,EACrBpH,MAAM,CAACqH,eAAe,EACtBrH,MAAM,CAACsH,eAAe,EACtBtH,MAAM,CAACuH,eAAe,EACtBvH,MAAM,CAACwH,gBAAgB,EACvBxH,MAAM,CAACyH,gBAAgB,EACvBzH,MAAM,CAAC0H,gBAAgB,CAC1B,EAAEipC,iBAAiB,CAAC;AACxB,IAAA;EACL,CAAC;AAAA/zC,EAAAA,MAAA,CAEM6wC,mBAAmB,GAA1B,SAAOA,mBAAmBA,CAAE1wC,IAAiC,EAAgB;AAEzE,IAAA,IAAM6zC,IAAI,GAAG7zC,IAAI,CAACoB,IAAI,KAAK0yC,iBAAiB,CAACC,OAAO,GAAGnQ,yBAAyB,GAAGjJ,kBAAkB;AACrG,IAAA,IAAM+J,OAAO,GAAG,IAAImP,IAAI,EAAE;AAC1BnP,IAAAA,OAAO,CAAC3kC,UAAU,CAACC,IAAI,CAAC;AACxB,IAAA,OAAO0kC,OAAO;EAClB,CAAC;AAAA7kC,EAAAA,MAAA,CAEMm0C,eAAe,GAAtB,SAAOA,eAAeA,CAAEh0C,IAA6B,EAAY;AAC7D,IAAA,IAAMiuC,SAAS,GAAG,IAAInB,cAAc,EAAE;IACtC,IAAI,CAACuC,UAAU,GAAGpB,SAAS;AAC3BA,IAAAA,SAAS,CAACluC,UAAU,CAACC,IAAI,CAAC;AAC1B,IAAA,OAAOiuC,SAAS;EACpB,CAAC;AAAApuC,EAAAA,MAAA,CAEM0T,YAAY,GAAnB,SAAOA,YAAYA,CAAEvT,IAAqD,EAAS;AAC/E,IAAA,IAAM+B,MAAM,GAAG,IAAI23B,WAAW,EAAE;AAChC33B,IAAAA,MAAM,CAAChC,UAAU,CAACC,IAAI,CAAC;AACvB,IAAA,OAAO+B,MAAM;EACjB,CAAC;AAAAlC,EAAAA,MAAA,CAEM6X,aAAa,GAApB,SAAOA,aAAaA,CAAE1X,IAAuD,EAAU;AACnF,IAAA,IAAMo+B,OAAO,GAAG,IAAI+I,YAAY,EAAE;AAClC/I,IAAAA,OAAO,CAACr+B,UAAU,CAACC,IAAI,CAAC;AACxB,IAAA,OAAOo+B,OAAO;EAClB,CAAC;AAAAv+B,EAAAA,MAAA,CAEMo0C,mBAAmB,GAA1B,SAAOA,mBAAmBA,CAAEj0C,IAAiC,EAAgB;AACzE,IAAA,IAAMw8B,aAAa,GAAG,IAAIj9B,kBAAkB,EAAE;AAC9Ci9B,IAAAA,aAAa,CAACz8B,UAAU,CAACC,IAAI,CAAC;AAC9B,IAAA,OAAOw8B,aAAa;EACxB,CAAC;AAAA38B,EAAAA,MAAA,CAEMgd,YAAY,GAAnB,SAAOA,YAAYA,CAAE7c,IAA0B,EAAS;AACpD,IAAA,IAAM0iC,MAAM,GAAG,IAAI4D,WAAW,EAAE;AAChC5D,IAAAA,MAAM,CAAC3iC,UAAU,CAACC,IAAI,CAAC;AACvB,IAAA,OAAO0iC,MAAM;EACjB,CAAC;AAAA7iC,EAAAA,MAAA,CAEMq0C,oBAAoB,GAA3B,SAAOA,oBAAoBA,CAAEl0C,IAAkC,EAAiB;AAC5E,IAAA,IAAM28B,cAAc,GAAG,IAAIwD,mBAAmB,EAAE;AAChDxD,IAAAA,cAAc,CAAC58B,UAAU,CAACC,IAAI,CAAC;AAC/B,IAAA,OAAO28B,cAAc;EACzB,CAAC;AAAA98B,EAAAA,MAAA,CAEMs0C,gBAAgB,GAAvB,SAAOA,gBAAgBA,CAAEn0C,IAA8B,EAAa;AAChE,IAAA,IAAM27B,UAAU,GAAG,IAAIiJ,eAAe,EAAE;AACxCjJ,IAAAA,UAAU,CAAC57B,UAAU,CAACC,IAAI,CAAC;AAC3B,IAAA,OAAO27B,UAAU;EACrB,CAAC;AAAA97B,EAAAA,MAAA,CAEM0a,iBAAiB,GAAxB,SAAOA,iBAAiBA,CAAEva,IAA+B,EAAc;AACnE,IAAA,IAAM+0B,WAAW,GAAG,IAAI+J,gBAAgB,EAAE;AAC1C/J,IAAAA,WAAW,CAACh1B,UAAU,CAACC,IAAI,CAAC;AAC5B,IAAA,OAAO+0B,WAAW;EACtB,CAAC;AAAAl1B,EAAAA,MAAA,CAEMu0C,yBAAyB,GAAhC,SAAOA,yBAAyBA,CAAEp0C,IAAuC,EAAsB;AAC3F,IAAA,IAAMq0C,mBAAmB,GAAG,IAAInT,wBAAwB,EAAE;AAC1DmT,IAAAA,mBAAmB,CAACt0C,UAAU,CAACC,IAAI,CAAC;AACpC,IAAA,OAAOq0C,mBAAmB;EAC9B,CAAC;AAAAx0C,EAAAA,MAAA,CAEMy0C,oBAAoB,GAA3B,SAAOA,oBAAoBA,CAAEt0C,IAAkC,EAAiB;AAC5E,IAAA,IAAM4iC,cAAc,GAAG,IAAIhB,mBAAmB,EAAE;AAChDgB,IAAAA,cAAc,CAAC7iC,UAAU,CAACC,IAAI,CAAC;AAC/B,IAAA,OAAO4iC,cAAc;EACzB,CAAC;AAAA/iC,EAAAA,MAAA,CAEM00C,mBAAmB,GAA1B,SAAOA,mBAAmBA,CAAEv0C,IAAiC,EAAgB;AACzE,IAAA,IAAMs8B,aAAa,GAAG,IAAI+F,kBAAkB,EAAE;AAC9C/F,IAAAA,aAAa,CAACv8B,UAAU,CAACC,IAAI,CAAC;AAC9B,IAAA,OAAOs8B,aAAa;EACxB,CAAC;AAAAz8B,EAAAA,MAAA,CAEMwwC,WAAW,GAAlB,SAAOA,WAAWA,CAAErwC,IAAyB,EAAQ;AACjD,IAAA,IAAMu7B,KAAK,GAAG,IAAI4I,UAAU,EAAE;AAC9B5I,IAAAA,KAAK,CAACx7B,UAAU,CAACC,IAAI,CAAC;AACtB,IAAA,OAAOu7B,KAAK;EAChB,CAAC;AAAA17B,EAAAA,MAAA,CAEM20C,UAAU,GAAjB,SAAOA,UAAUA,CAAEx0C,IAA2B,EAAU;AACpD,IAAA,IAAMylC,IAAI,GAAGY,OAAO,CAACjB,WAAW,CAACplC,IAAI,CAAC;IACtC,IAAI,CAAC,IAAI,CAACY,SAAS,CAAC6zC,GAAG,CAAChP,IAAI,CAAC,EAAE;AAC3B,MAAA,IAAI,CAAC7kC,SAAS,CAACwU,GAAG,CAACqwB,IAAI,EAAE,IAAIF,YAAY,CAACvlC,IAAI,EAAEylC,IAAI,CAAC,CAAC;AACzD,IAAA;AACD,IAAA,OAAO,IAAI,CAAC7kC,SAAS,CAACwB,GAAG,CAACqjC,IAAI,CAAC;EACnC,CAAC;AAAA5lC,EAAAA,MAAA,CAEM60C,aAAa,GAApB,SAAOA,aAAaA,GAA0B;AAC1C,IAAA,OAAO,CAAC,IAAI,CAACrF,UAAU,CAAc;EACzC,CAAC;AAAAxvC,EAAAA,MAAA,CAEM80C,iBAAiB,GAAxB,SAAOA,iBAAiBA,CAAE30C,IAAkC,EAAiB;AACzE,IAAA,IAAMylC,IAAI,GAAGjH,cAAc,CAAC4G,WAAW,CAACplC,IAAI,CAAC;IAC7C,IAAI,CAAC,IAAI,CAAC40C,iBAAiB,CAACH,GAAG,CAAChP,IAAI,CAAC,EAAE;AACnC,MAAA,IAAI,CAACmP,iBAAiB,CAACx/B,GAAG,CAACqwB,IAAI,EAAE,IAAIjH,cAAc,CAACx+B,IAAI,EAAEylC,IAAI,CAAC,CAAC;AACnE,IAAA;AACD,IAAA,OAAO,IAAI,CAACmP,iBAAiB,CAACxyC,GAAG,CAACqjC,IAAI,CAAC;EAC3C,CAAC;AAAA5lC,EAAAA,MAAA,CAEMg1C,iBAAiB,GAAxB,SAAOA,iBAAiBA,CAAE70C,IAAkC,EAAiB;AACzE,IAAA,IAAMylC,IAAI,GAAGqP,cAAc,CAAC1P,WAAW,CAACplC,IAAI,CAAC;IAC7C,IAAI,CAAC,IAAI,CAAC+0C,gBAAgB,CAACN,GAAG,CAAChP,IAAI,CAAC,EAAE;AAClC,MAAA,IAAI,CAACsP,gBAAgB,CAAC3/B,GAAG,CAACqwB,IAAI,EAAE,IAAIqP,cAAc,CAAC90C,IAAI,EAAEylC,IAAI,CAAC,CAAC;AAClE,IAAA;AACD,IAAA,OAAO,IAAI,CAACsP,gBAAgB,CAAC3yC,GAAG,CAACqjC,IAAI,CAAC;EAC1C,CAAC;AAAA5lC,EAAAA,MAAA,CAEMm1C,gBAAgB,GAAvB,SAAOA,gBAAgBA,CAAEh1C,IAAiC,EAAgB;AACtE,IAAA,IAAMylC,IAAI,GAAGwP,aAAa,CAAC7P,WAAW,CAACplC,IAAI,CAAC;IAC5C,IAAI,CAAC,IAAI,CAACk1C,eAAe,CAACT,GAAG,CAAChP,IAAI,CAAC,EAAE;AACjC,MAAA,IAAI,CAACyP,eAAe,CAAC9/B,GAAG,CAACqwB,IAAI,EAAE,IAAIwP,aAAa,CAACj1C,IAAI,EAAEylC,IAAI,CAAC,CAAC;AAChE,IAAA;AACD,IAAA,OAAO,IAAI,CAACyP,eAAe,CAAC9yC,GAAG,CAACqjC,IAAI,CAAC;EACzC,CAAC;EAAA5lC,MAAA,CAEMs+B,oBAAoB,GAA3B,SAAOA,oBAAoBA,CAAE1K,OAAoC,EAAE2K,OAAgB,EAAE7M,OAAsC,EAAO;IAC9HiC,gCAAgC,CAC5B,IAAI,EACJC,OAAO,EACN2K,OAAO,CAAkB78B,UAAU,EACpCgwB,OAAO,CACV;EACL,CAAC;EAAA1xB,MAAA,CAEMs1C,oBAAoB,GAA3B,SAAOA,oBAAoBA,CAAE/W,OAA0B,EAAE3K,OAA0B,EAAElC,OAAsC,EAAO;IAC9HuD,gCAAgC,CAC5B,IAAI,EACHsJ,OAAO,CAAkB78B,UAAU,EACpCkyB,OAAO,EACPlC,OAAO,CACV;EACL,CAAC;EAAA1xB,MAAA,CAEMu1C,sBAAsB,GAA7B,SAAOA,sBAAsBA,CACzB9jB,SAAqC,EACrC8M,OAAgB,EAChB7M,OAAsC,EACnC;IACHF,kCAAkC,CAC9B,IAAI,EACJC,SAAS,EACR8M,OAAO,CAAkB78B,UAAU,EACpCgwB,OAAO,CACV;EACL,CAAC;EAAA,OAAArvB,YAAA,CAAAitC,WAAA,EAAA,CAAA;IAAAhtC,GAAA,EAAA,IAAA;IAAAC,GAAA,EAvgBD,SAAAA,GAAAA,GAAgC;MAC5B,OAAO,IAAI,CAACktC,QAAQ;AACxB,IAAA;AAAC,GAAA,EAAA;IAAAntC,GAAA,EAAA,YAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAmC;AAC/B,MAAA,OAAO,IAAI,CAACitC,UAAU,CAAE57B,UAAU;AACtC,IAAA;AAAC,GAAA,EAAA;IAAAtR,GAAA,EAAA,YAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAkC;AAC9B,MAAA,OAAO,IAAI,CAACitC,UAAU,CAAE38B,UAAU;AACtC,IAAA;AAAC,GAAA,EAAA;IAAAvQ,GAAA,EAAA,WAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAA8B;AAC1B,MAAA,OAAO,IAAI,CAACitC,UAAU,CAAEriB,SAAS;AACrC,IAAA;AAAC,GAAA,EAAA;IAAA7qB,GAAA,EAAA,aAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAgC;AAC5B,MAAA,OAAO,IAAI,CAACitC,UAAU,CAAErC,WAAW;AACvC,IAAA;AAAC,GAAA,EAAA;IAAA7qC,GAAA,EAAA,kBAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAkC;MAC9B,OAAO,IAAI,CAACotC,iBAAiB;AACjC,IAAA;AAAC,GAAA,EAAA;IAAArtC,GAAA,EAAA,iBAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAA4C;MACxC,OAAO,IAAI,CAACmtC,gBAAgB;AAChC,IAAA;AAAC,GAAA,EAAA;IAAAptC,GAAA,EAAA,aAAA;IAAAC,GAAA,EAED,SAAAA,GAAAA,GAAqC;AACjC,MAAA,OAAO,IAAI,CAACitC,UAAU,CAAEha,WAAW;AACvC,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAnC4B+a,MAAM;;AC5DvCiF,QAAQ,CAAClG,WAAW,GAAGA,WAAW;;;;"}