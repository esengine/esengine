{"version":3,"file":"dragon-bones.js","sources":["../../../cocos/dragon-bones/CCTextureData.ts","../../../cocos/dragon-bones/CCSlot.ts","../../../cocos/dragon-bones/CCArmatureDisplay.ts","../../../cocos/dragon-bones/CCFactory.ts","../../../cocos/dragon-bones/ArmatureCache.ts","../../../cocos/dragon-bones/DragonBonesAsset.ts","../../../cocos/dragon-bones/DragonBonesAtlasAsset.ts","../../../cocos/dragon-bones/AttachUtil.ts","../../../cocos/dragon-bones/ArmatureSystem.ts","../../../cocos/dragon-bones/ArmatureDisplay.ts","../../../cocos/dragon-bones/assembler/simple.ts","../../../cocos/dragon-bones/assembler/index.ts","../../../cocos/dragon-bones/index.ts"],"sourcesContent":["/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { BaseObject, TextureAtlasData, TextureData } from '@cocos/dragonbones-js';\r\nimport { SpriteFrame } from '../2d';\r\nimport { TextureBase } from '../asset/assets/texture-base';\r\nimport { Rect, _decorator } from '../core';\r\n\r\nconst { ccclass } = _decorator;\r\n\r\n/**\r\n * @en The texture atlas of dragonbones.\r\n * @zh 龙骨组件中的纹理图集资源。\r\n */\r\n@ccclass('dragonBones.CCTextureAtlasData')\r\nexport class CCTextureAtlasData extends TextureAtlasData {\r\n    /**\r\n     * @en The texture used for rendering.\r\n     * @zh 实际用于渲染显示的纹理对象。\r\n     */\r\n    get renderTexture (): TextureBase | null {\r\n        return this._renderTexture;\r\n    }\r\n\r\n    set renderTexture (value) {\r\n        this._renderTexture = value;\r\n        if (value) {\r\n            for (const k in this.textures) {\r\n                const textureData = this.textures[k] as CCTextureData;\r\n                if (!textureData.spriteFrame) {\r\n                    let rect: Rect | null = null;\r\n                    if (textureData.rotated) {\r\n                        rect = new Rect(textureData.region.x, textureData.region.y,\r\n                            textureData.region.height, textureData.region.width);\r\n                    } else {\r\n                        rect = new Rect(textureData.region.x, textureData.region.y,\r\n                            textureData.region.width, textureData.region.height);\r\n                        // }\r\n                        // const offset = new Vec2(0, 0);\r\n                        // const size = new Size(rect.width, rect.height);\r\n                        // setTexture(value, rect, false, offset, size);\r\n                        textureData.spriteFrame = new SpriteFrame();\r\n                        textureData.spriteFrame.texture = value;\r\n                        textureData.spriteFrame.rect = rect;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            for (const k in this.textures) {\r\n                const textureData = this.textures[k] as CCTextureData;\r\n                textureData.spriteFrame = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _renderTexture: TextureBase | null = null;\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    static toString (): string {\r\n        return '[class dragonBones.CCTextureAtlasData]';\r\n    }\r\n    /**\r\n     * @en Create texture data, get data from the object pool.\r\n     * @zh 创建纹理数据，从对象池获取。\r\n     */\r\n    createTexture (): CCTextureData {\r\n        return BaseObject.borrowObject(CCTextureData);\r\n    }\r\n    /**\r\n     * @en Clear associated texture resources.\r\n     * @zh 清除关联的纹理。\r\n     */\r\n    _onClear (): void {\r\n        super._onClear();\r\n        this.renderTexture = null;\r\n    }\r\n}\r\n/**\r\n * @en Texture data used in dragonbones.\r\n * @zh 龙骨资源中的纹理数据。\r\n */\r\n@ccclass('dragonBones.CCTextureData')\r\nexport class CCTextureData extends TextureData {\r\n    /**\r\n     * @en SpriteFrame assets.\r\n     * @zh SpriteFrame 资源。\r\n     */\r\n    spriteFrame: SpriteFrame | null = null\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    static toString (): string {\r\n        return '[class dragonBones.CCTextureData]';\r\n    }\r\n    /**\r\n     * @en Clear SpriteFrame assets.\r\n     * @zh 清除关联的SpriteFrame 资源。\r\n     */\r\n    _onClear (): void {\r\n        super._onClear();\r\n        this.spriteFrame = null;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { BoneType, BinaryOffset, Slot } from '@cocos/dragonbones-js';\r\nimport { Texture2D } from '../asset/assets';\r\nimport { Color, Mat4, _decorator } from '../core';\r\nimport { CCTextureData } from './CCTextureData';\r\n\r\nconst { ccclass } = _decorator;\r\n\r\n// @skipLibCheck\r\n/**\r\n * @en Slots attach on bones，to control the display status and attributes of the display object.\r\n * @zh 插槽附着在骨骼上，控制显示对象的显示状态和属性。\r\n*/\r\n@ccclass('dragonBones.CCSlot')\r\nexport class CCSlot extends Slot {\r\n    static toString (): string {\r\n        return '[class dragonBones.CCSlot]';\r\n    }\r\n\r\n    /**\r\n     * @en Vertices in local coordinate system.\r\n     * @zh 局部坐标顶点数据。\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    _localVertices: number[];\r\n\r\n    /**\r\n     * @en Indices array of vertex data.\r\n     * @zh 顶点数组索引。\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    _indices: number[];\r\n\r\n    /**\r\n     * @en Local transformation matrix\r\n     * @zh 局部坐标系变换矩阵\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    _matrix: Mat4;\r\n\r\n    /**\r\n     * @en World transformation matrix\r\n     * @zh 世界坐标系变换矩阵\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _worldMatrix: Mat4;\r\n\r\n    protected _worldMatrixDirty: boolean;\r\n\r\n    /**\r\n     * @en Color setting on a slot\r\n     * @zh 设置在 Slot 上的颜色\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    _color: Color;\r\n\r\n    constructor () {\r\n        super();\r\n        this._localVertices = [];\r\n        this._indices = [];\r\n        this._matrix = new Mat4();\r\n        this._worldMatrix = new Mat4();\r\n        this._worldMatrixDirty = true;\r\n        this._visible = false;\r\n        this._color = new Color();\r\n    }\r\n\r\n    /**\r\n     * @en Get a Texture2D object from _textureData.\r\n     * @zh 获取2D纹理对象。\r\n     * @returns @en A texture instance if _textureData is not null, otherwise returns null.\r\n     *          @zh 若 _textureData 为 null，将返回 null。\r\n     */\r\n    getTexture (): Texture2D | null {\r\n        if (this._textureData) {\r\n            const sp = (this._textureData as any).spriteFrame;\r\n            const tex = sp.texture as Texture2D;\r\n            return tex;\r\n        }\r\n        return null;\r\n    }\r\n    /**\r\n     * @en Calculates world matrix of slot.\r\n     * @zh 计算插槽世界矩阵。\r\n     */\r\n    calculWorldMatrix (): void {\r\n        const parent = this._armature._parent as CCSlot;\r\n        if (parent) {\r\n            this._mulMat(this._worldMatrix, parent._worldMatrix, this._matrix);\r\n            // Mat4.multiply(this._worldMatrix, parent._worldMatrix, this._matrix);\r\n        } else {\r\n            Mat4.copy(this._worldMatrix, this._matrix);\r\n        }\r\n        this._worldMatrixDirty = false;\r\n    }\r\n    /**\r\n     * @en Resets slot data and state.\r\n     * @zh 重置插槽数据和状态。\r\n     */\r\n    _onClear (): void {\r\n        super._onClear();\r\n        this._localVertices.length = 0;\r\n        this._indices.length = 0;\r\n        Mat4.identity(this._matrix);\r\n        Mat4.identity(this._worldMatrix);\r\n        this._worldMatrixDirty = true;\r\n        this._color = new Color();\r\n        this._visible = false;\r\n    }\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _onUpdateDisplay (): void {\r\n    }\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _initDisplay (value): void {\r\n    }\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _addDisplay (): void {\r\n        this._visible = true;\r\n    }\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _replaceDisplay (value): void {\r\n    }\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _removeDisplay (): void {\r\n        this._visible = false;\r\n    }\r\n\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _disposeDisplay (object): void {\r\n    }\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _updateVisible (): void {\r\n        this._visible = this.parent.visible;\r\n    }\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _updateGlueMesh (): void {\r\n\r\n    }\r\n\r\n    /**\r\n     * just for adapt to dragonbones api,no need to do any thing\r\n     * @deprecated Since v3.7.2, this interface that will be removed in the future.\r\n     */\r\n    _updateZOrder (): void {\r\n    }\r\n    /**\r\n     * @en Update the color blending mode of the slot.\r\n     * @zh 更新插槽的颜色混合模式。\r\n     */\r\n    _updateBlendMode (): void {\r\n        if (this._childArmature) {\r\n            const childSlots = this._childArmature.getSlots();\r\n            for (let i = 0, l = childSlots.length; i < l; i++) {\r\n                const slot = childSlots[i] as CCSlot;\r\n                slot._blendMode = this._blendMode;\r\n                slot._updateBlendMode();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @en Update the color of the slot.\r\n     * @zh 更新插槽的颜色。\r\n     */\r\n    _updateColor (): void {\r\n        const c = this._color;\r\n        c.r = this._colorTransform.redMultiplier * 255;\r\n        c.g = this._colorTransform.greenMultiplier * 255;\r\n        c.b = this._colorTransform.blueMultiplier * 255;\r\n        c.a = this._colorTransform.alphaMultiplier * 255;\r\n    }\r\n    /**\r\n     * @en Update one frame of slot vertex data.\r\n     * @zh 更新一帧插槽顶点数据。\r\n     */\r\n    _updateFrame (): void {\r\n        this._indices.length = 0;\r\n        const indices = this._indices;\r\n        const localVertices = this._localVertices;\r\n        let indexOffset = 0;\r\n        let vfOffset = 0;\r\n\r\n        const currentTextureData = this._textureData as CCTextureData;\r\n        if (!this._display || this._displayIndex < 0 || !currentTextureData || !currentTextureData.spriteFrame) return;\r\n\r\n        const texture = currentTextureData.spriteFrame.texture;\r\n        const textureAtlasWidth = texture.width;\r\n        const textureAtlasHeight = texture.height;\r\n        const region = currentTextureData.region;\r\n\r\n        if (textureAtlasWidth === 0 || textureAtlasHeight === 0) {\r\n            console.error(`SpriteFrame ${currentTextureData.spriteFrame.name} incorrect size ${textureAtlasWidth} x ${textureAtlasHeight}`);\r\n            return;\r\n        }\r\n\r\n        const currentVerticesData = (this._deformVertices !== null && this._display === this._meshDisplay) ? this._deformVertices.verticesData : null;\r\n\r\n        if (currentVerticesData) {\r\n            const data = currentVerticesData.data;\r\n            const intArray = data.intArray;\r\n            const floatArray = data.floatArray;\r\n            const vertexCount = intArray[currentVerticesData.offset + BinaryOffset.MeshVertexCount];\r\n            const triangleCount = intArray[currentVerticesData.offset + BinaryOffset.MeshTriangleCount];\r\n            let vertexOffset: number = intArray[currentVerticesData.offset + BinaryOffset.MeshFloatOffset];\r\n\r\n            if (vertexOffset < 0) {\r\n                vertexOffset += 65536; // Fixed out of bouds bug.\r\n            }\r\n\r\n            const uvOffset = vertexOffset + vertexCount * 2;\r\n            const scale = this._armature._armatureData.scale;\r\n\r\n            for (let i = 0, l = vertexCount * 2; i < l; i += 2) {\r\n                localVertices[vfOffset++] = floatArray[vertexOffset + i] * scale;\r\n                localVertices[vfOffset++] = -floatArray[vertexOffset + i + 1] * scale;\r\n\r\n                if (currentVerticesData.rotated) {\r\n                    localVertices[vfOffset++] = (region.x + (1.0 - floatArray[uvOffset + i]) * region.width) / textureAtlasWidth;\r\n                    localVertices[vfOffset++] = (region.y + floatArray[uvOffset + i + 1] * region.height) / textureAtlasHeight;\r\n                } else {\r\n                    localVertices[vfOffset++] = (region.x + floatArray[uvOffset + i] * region.width) / textureAtlasWidth;\r\n                    localVertices[vfOffset++] = (region.y + floatArray[uvOffset + i + 1] * region.height) / textureAtlasHeight;\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < triangleCount * 3; ++i) {\r\n                indices[indexOffset++] = intArray[currentVerticesData.offset + BinaryOffset.MeshVertexIndices + i];\r\n            }\r\n\r\n            localVertices.length = vfOffset;\r\n            indices.length = indexOffset;\r\n\r\n            const isSkinned = !!currentVerticesData.weight;\r\n            if (isSkinned) {\r\n                this._identityTransform();\r\n            }\r\n        } else {\r\n            const l = region.x / textureAtlasWidth;\r\n            const b = (region.y + region.height) / textureAtlasHeight;\r\n            const r = (region.x + region.width) / textureAtlasWidth;\r\n            const t = region.y / textureAtlasHeight;\r\n\r\n            localVertices[vfOffset++] = 0; // 0x\r\n            localVertices[vfOffset++] = 0; // 0y\r\n            localVertices[vfOffset++] = l; // 0u\r\n            localVertices[vfOffset++] = b; // 0v\r\n\r\n            localVertices[vfOffset++] = region.width; // 1x\r\n            localVertices[vfOffset++] = 0; // 1y\r\n            localVertices[vfOffset++] = r; // 1u\r\n            localVertices[vfOffset++] = b; // 1v\r\n\r\n            localVertices[vfOffset++] = 0; // 2x\r\n            localVertices[vfOffset++] = region.height; // 2y\r\n            localVertices[vfOffset++] = l; // 2u\r\n            localVertices[vfOffset++] = t; // 2v\r\n\r\n            localVertices[vfOffset++] = region.width; // 3x\r\n            localVertices[vfOffset++] = region.height; // 3y\r\n            localVertices[vfOffset++] = r; // 3u\r\n            localVertices[vfOffset++] = t; // 3v\r\n\r\n            indices[0] = 0;\r\n            indices[1] = 1;\r\n            indices[2] = 2;\r\n            indices[3] = 1;\r\n            indices[4] = 3;\r\n            indices[5] = 2;\r\n\r\n            localVertices.length = vfOffset;\r\n            indices.length = 6;\r\n        }\r\n\r\n        this._visibleDirty = true;\r\n        this._blendModeDirty = true;\r\n        this._colorDirty = true;\r\n    }\r\n    /**\r\n     * @en Update mesh data of slot.\r\n     * @zh 更新槽点的网格数据。\r\n     */\r\n    _updateMesh (): void {\r\n        const scale = this._armature._armatureData.scale;\r\n        const deformVertices = this._deformVertices.vertices;\r\n        const bones = this._deformVertices.bones;\r\n        const verticesData = this._deformVertices.verticesData;\r\n        const weightData = verticesData.weight;\r\n        const hasDeform = deformVertices.length > 0 && verticesData.inheritDeform;\r\n\r\n        const localVertices = this._localVertices;\r\n        if (weightData) {\r\n            const data = verticesData.data;\r\n            const intArray = data.intArray;\r\n            const floatArray = data.floatArray;\r\n            const vertexCount = intArray[verticesData.offset + BinaryOffset.MeshVertexCount];\r\n            let weightFloatOffset = intArray[weightData.offset + BinaryOffset.WeigthFloatOffset];\r\n\r\n            if (weightFloatOffset < 0) {\r\n                weightFloatOffset += 65536; // Fixed out of bouds bug\r\n            }\r\n\r\n            for (\r\n                let i = 0, iB = weightData.offset + BinaryOffset.WeigthBoneIndices + bones.length, iV = weightFloatOffset, iF = 0, lvi = 0;\r\n                i < vertexCount;\r\n                i++, lvi += 4\r\n            ) {\r\n                const boneCount = intArray[iB++];\r\n                let xG = 0.0;\r\n                let yG = 0.0;\r\n\r\n                for (let j = 0; j < boneCount; ++j) {\r\n                    const boneIndex = intArray[iB++];\r\n                    const bone = bones[boneIndex];\r\n\r\n                    if (bone !== null) {\r\n                        const matrix = bone.globalTransformMatrix;\r\n                        const weight = floatArray[iV++];\r\n                        let xL = floatArray[iV++] * scale;\r\n                        let yL = floatArray[iV++] * scale;\r\n\r\n                        if (hasDeform) {\r\n                            xL += deformVertices[iF++];\r\n                            yL += deformVertices[iF++];\r\n                        }\r\n\r\n                        xG += (matrix.a * xL + matrix.c * yL + matrix.tx) * weight;\r\n                        yG += (matrix.b * xL + matrix.d * yL + matrix.ty) * weight;\r\n                    }\r\n                }\r\n\r\n                localVertices[lvi] = xG;\r\n                localVertices[lvi + 1] = -yG;\r\n            }\r\n        } else if (hasDeform) {\r\n            const isSurface = this._parent._boneData.type !== BoneType.Bone;\r\n            const data = verticesData.data;\r\n            const intArray = data.intArray;\r\n            const floatArray = data.floatArray;\r\n            const vertexCount = intArray[verticesData.offset + BinaryOffset.MeshVertexCount];\r\n            let vertexOffset = intArray[verticesData.offset + BinaryOffset.MeshFloatOffset];\r\n\r\n            if (vertexOffset < 0) {\r\n                vertexOffset += 65536; // Fixed out of bouds bug.\r\n            }\r\n\r\n            for (let i = 0, l = vertexCount, lvi = 0; i < l; i++, lvi += 4) {\r\n                const x: number = floatArray[vertexOffset + i * 2] * scale + deformVertices[i * 2];\r\n                const y: number = floatArray[vertexOffset + i * 2 + 1] * scale + deformVertices[i * 2 + 1];\r\n\r\n                if (isSurface) {\r\n                    const matrix = this._parent._getGlobalTransformMatrix(x, y);\r\n                    localVertices[lvi] = matrix.a * x + matrix.c * y + matrix.tx;\r\n                    localVertices[lvi + 1] = -matrix.b * x + matrix.d * y + matrix.ty;\r\n                } else {\r\n                    localVertices[lvi] = x;\r\n                    localVertices[lvi + 1] = -y;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (weightData) {\r\n            this._identityTransform();\r\n        }\r\n    }\r\n    /**\r\n     * @en Reset current matrix to identity matrix.\r\n     * @zh 重置当前矩阵为单位矩阵。\r\n     */\r\n    _identityTransform (): void {\r\n        const m = this._matrix;\r\n        m.m00 = 1.0;\r\n        m.m01 = 0.0;\r\n        m.m04 = -0.0;\r\n        m.m05 = -1.0;\r\n        m.m12 = 0.0;\r\n        m.m13 = 0.0;\r\n        this._worldMatrixDirty = true;\r\n    }\r\n    /**\r\n     * @en Update transform of slot.\r\n     * @zh 更新插槽的变换。\r\n     */\r\n    _updateTransform (): void {\r\n        const m = this._matrix;\r\n        m.m00 = this.globalTransformMatrix.a;\r\n        m.m01 = this.globalTransformMatrix.b;\r\n        m.m04 = -this.globalTransformMatrix.c;\r\n        m.m05 = -this.globalTransformMatrix.d;\r\n\r\n        if (this._childArmature) {\r\n            m.m12 = this.globalTransformMatrix.tx;\r\n            m.m13 = this.globalTransformMatrix.ty;\r\n        } else {\r\n            m.m12 = this.globalTransformMatrix.tx - (this.globalTransformMatrix.a * this._pivotX - this.globalTransformMatrix.c * this._pivotY);\r\n            m.m13 = this.globalTransformMatrix.ty - (this.globalTransformMatrix.b * this._pivotX - this.globalTransformMatrix.d * this._pivotY);\r\n        }\r\n        this._worldMatrixDirty = true;\r\n    }\r\n    /**\r\n     * @en Update world matrix of slot.\r\n     * @zh 更新插槽的世界矩阵。\r\n     */\r\n    updateWorldMatrix (): void {\r\n        if (!this._armature) return;\r\n\r\n        const parentSlot = this._armature._parent as CCSlot;\r\n        if (parentSlot) {\r\n            parentSlot.updateWorldMatrix();\r\n        }\r\n\r\n        if (this._worldMatrixDirty) {\r\n            this.calculWorldMatrix();\r\n            const childArmature = this.childArmature;\r\n            if (!childArmature) return;\r\n            const slots = childArmature.getSlots();\r\n            for (let i = 0, n = slots.length; i < n; i++) {\r\n                const slot = slots[i] as CCSlot;\r\n                if (slot) {\r\n                    slot._worldMatrixDirty = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    /* protected */ _mulMat (out: Mat4, a: Readonly<Mat4>, b: Readonly<Mat4>): void {\r\n        const aa = a.m00; const ab = a.m01; const ac = a.m04; const ad = a.m05; const atx = a.m12; const aty = a.m13;\r\n        const ba = b.m00; const bb = b.m01; const bc = b.m04; const bd = b.m05; const btx = b.m12; const bty = b.m13;\r\n        if (ab !== 0 || ac !== 0) {\r\n            out.m00 = ba * aa + bb * ac;\r\n            out.m01 = ba * ab + bb * ad;\r\n            out.m04 = bc * aa + bd * ac;\r\n            out.m05 = bc * ab + bd * ad;\r\n            out.m12 = aa * btx + ac * bty + atx;\r\n            out.m13 = ab * btx + ad * bty + aty;\r\n        } else {\r\n            out.m00 = ba * aa;\r\n            out.m01 = bb * ad;\r\n            out.m04 = bc * aa;\r\n            out.m05 = bd * ad;\r\n            out.m12 = aa * btx + atx;\r\n            out.m13 = ad * bty + aty;\r\n        }\r\n    }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-unsafe-return */\r\n/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Armature, DisplayData, IEventDispatcher, Slot } from '@cocos/dragonbones-js';\r\nimport { Vec3, EventTarget, _decorator, warn } from '../core';\r\n// eslint-disable-next-line import/named\r\nimport { CCSlot } from './CCSlot';\r\nimport { ArmatureDisplay } from './ArmatureDisplay';\r\nimport { Node } from '../scene-graph';\r\n\r\nconst { ccclass } = _decorator;\r\n\r\n/**\r\n * @en CCArmatureDisplay contains function about data showing and sending events.\r\n * @zh CCArmatureDisplay 封装了数据显示和事件派发的功能。\r\n */\r\n@ccclass('dragonBones.CCArmatureDisplay')\r\nexport class CCArmatureDisplay extends DisplayData implements IEventDispatcher {\r\n    /**\r\n     * @en Return this.\r\n     * @zh 返回自身。\r\n     */\r\n    get node (): CCArmatureDisplay { return this; }\r\n    /**\r\n     * @deprecated This variable will be removed in the future.\r\n     */\r\n    shouldAdvanced = false;\r\n    /**\r\n     * @en The node contains ArmatureDisplay component.\r\n     * @zh ArmatureDisplay 组件所在的 node。\r\n     */\r\n    _ccNode: Node|null = null;\r\n    /**\r\n     * @en ArmatureDisplay component.\r\n     * @zh ArmatureDisplay 组件。\r\n     */\r\n    _ccComponent: ArmatureDisplay |null = null;\r\n    /**\r\n     * @en EventTarget is an object to which an event is dispatched when something has occurred.\r\n     * @zh 事件目标是具有注册监听器、派发事件能力的对象。\r\n     */\r\n    _eventTarget: EventTarget;\r\n    /**\r\n     * @en The core Armature object.\r\n     * @zh 核心骨架对象。\r\n     */\r\n    _armature: Armature | null = null;\r\n\r\n    constructor () {\r\n        super();\r\n        this._eventTarget = new EventTarget();\r\n    }\r\n    /**\r\n     * @en The funciton is empty and always return false.\r\n     * @zh 方法未实现总返回 false。\r\n     */\r\n    hasEvent (type: string): boolean {\r\n        warn('Method not implemented.');\r\n        return false;\r\n    }\r\n    /**\r\n     * @en The funciton has no realization.\r\n     * @zh 方法未实现。\r\n     */\r\n    addEvent (type: string, listener: any, thisObject: any): void {\r\n        warn('Method not implemented.');\r\n    }\r\n    /**\r\n     * @en The funciton has no realization.\r\n     * @zh 方法未实现。\r\n     */\r\n    removeEvent (type: string, listener: any, thisObject: any): void {\r\n        warn('Method not implemented.');\r\n    }\r\n    /**\r\n     * @en Sets EventTarget object.\r\n     * @zh 设置事件目标。\r\n     */\r\n    setEventTarget (eventTarget: EventTarget): void {\r\n        this._eventTarget = eventTarget;\r\n    }\r\n    /**\r\n     * @en Gets the root display object.\r\n     * @zh 获取顶层的显示容器实例。\r\n     */\r\n    getRootDisplay (): CCArmatureDisplay {\r\n        let parentSlot = this._armature!._parent;\r\n        if (!parentSlot) {\r\n            return this;\r\n        }\r\n\r\n        let slot: Slot;\r\n        while (parentSlot) {\r\n            slot = parentSlot;\r\n            parentSlot = parentSlot._armature._parent;\r\n        }\r\n        return slot!._armature.display;\r\n    }\r\n    /**\r\n     * @en Convert pos to parent slot coordination.\r\n     * @zh 将坐标转换到父插槽的坐标系下。\r\n     */\r\n    convertToRootSpace (pos: Vec3): Vec3 {\r\n        const slot = this._armature!._parent as CCSlot;\r\n        if (!slot) {\r\n            return pos;\r\n        }\r\n        slot.updateWorldMatrix();\r\n\r\n        const worldMatrix = slot._worldMatrix;\r\n        const newPos = new Vec3(0, 0);\r\n        newPos.x = pos.x * worldMatrix.m00 + pos.y * worldMatrix.m04 + worldMatrix.m12;\r\n        newPos.y = pos.x * worldMatrix.m01 + pos.y * worldMatrix.m05 + worldMatrix.m13;\r\n        return newPos;\r\n    }\r\n    /**\r\n     * @en Convert pos to world coordination.\r\n     * @zh 将坐标转换到世界坐标系下。\r\n     */\r\n    convertToWorldSpace (point: Vec3): Vec3 | undefined {\r\n        const newPos = this.convertToRootSpace(point);\r\n        const ccNode = this.getRootNode();\r\n        return ccNode?._getUITransformComp()?.convertToWorldSpaceAR(newPos);\r\n    }\r\n    /**\r\n     * @en Get the node of root ArmatureDisplay component in.\r\n     * @zh 获取顶层 ArmatureDisplay 组件所在的 node。\r\n     */\r\n    getRootNode (): Node | null {\r\n        const rootDisplay = this.getRootDisplay();\r\n        return rootDisplay && rootDisplay._ccNode;\r\n    }\r\n\r\n    /**\r\n     * @en Initialize _armature at start.\r\n     * @zh 初始时设置骨架。\r\n     */\r\n    // dragonbones api\r\n    dbInit (armature: Armature | null): void {\r\n        this._armature = armature;\r\n    }\r\n    /**\r\n     * @en Clears Armature object.\r\n     * @zh 清除骨架对象。\r\n     */\r\n    dbClear (): void {\r\n        this._armature = null;\r\n    }\r\n    /**\r\n     * @en Trigger ArmatureDisplay component to update render data.\r\n     * @zh 触发 ArmatureDisplay 组件更新渲染数据。\r\n     */\r\n    dbUpdate (): void {\r\n        if (this._ccComponent) {\r\n            this._ccComponent._markForUpdateRenderData();\r\n        }\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2.\r\n     * @deprecated This variable will be removed in the future.\r\n     */\r\n    advanceTimeBySelf (on: boolean | number): void {\r\n        this.shouldAdvanced = !!on;\r\n    }\r\n\r\n    hasDBEventListener (type: string): boolean {\r\n        return this._eventTarget.hasEventListener(type);\r\n    }\r\n\r\n    addDBEventListener (type: string, listener, target): void {\r\n        this._eventTarget.on(type, listener, target);\r\n    }\r\n\r\n    removeDBEventListener (type: string, listener, target): void {\r\n        this._eventTarget.off(type, listener, target);\r\n    }\r\n\r\n    dispatchDBEvent (type: string, eventObject): void {\r\n        this._eventTarget.emit(type, eventObject);\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { EDITOR_NOT_IN_PREVIEW } from 'internal:constants';\r\nimport { Armature, BaseObject, Animation, BaseFactory, DragonBones, DragonBonesData, DisplayData } from '@cocos/dragonbones-js';\r\nimport { ISchedulable, Scheduler, System, SystemPriority, _decorator } from '../core';\r\nimport { CCTextureAtlasData } from './CCTextureData';\r\nimport { TextureBase } from '../asset/assets/texture-base';\r\nimport { CCSlot } from './CCSlot';\r\nimport { ArmatureDisplay } from './ArmatureDisplay';\r\nimport { CCArmatureDisplay } from './CCArmatureDisplay';\r\nimport { Node } from '../scene-graph';\r\nimport { director, Game, game } from '../game';\r\n\r\nconst { ccclass } = _decorator;\r\n\r\n/**\r\n * DragonBones factory\r\n * @class CCFactory\r\n * @extends BaseFactory\r\n * @en Usually only one global factory instance is needed. The factory creates\r\n * Armature object by parsing DragonBonesData and TextureAtlasData instances,\r\n * and is responsible for global updating the Dragonbones component animation\r\n * and rendering data.\r\n * @zh 通常只需要一个全局工厂实例，工厂通过解析 DragonBonesData 和 TextureAtlasData\r\n * 实例来创建骨架，并负责全局的龙骨组件动画和渲染数据的更新。\r\n*/\r\n@ccclass('CCFactory')\r\nexport class CCFactory extends BaseFactory implements ISchedulable {\r\n    static _factory: CCFactory | null = null;\r\n\r\n    /**\r\n     * @en\r\n     * Get an CCFactory instance.\r\n     * @zh\r\n     * 获取一个 CCFactory 实例。\r\n     * @method getInstance\r\n     * @returns @en The global CCFactory instance object.\r\n     *          @zh 返回全局的 CCFactory 实例对象。\r\n     * @static\r\n     * @example\r\n     * let factory = CCFactory.getInstance();\r\n    */\r\n    static getInstance (): CCFactory {\r\n        if (!CCFactory._factory) {\r\n            CCFactory._factory = new CCFactory();\r\n        }\r\n        return CCFactory._factory;\r\n    }\r\n    /**\r\n     * @en The id value always 'CCFactory'.\r\n     * @zh 拥有固定值 'CCFactory'。\r\n     */\r\n    id?: string;\r\n    /**\r\n     * @en The uuid value always 'CCFactory'.\r\n     * @zh 拥有固定值 'CCFactory'。\r\n     */\r\n    uuid?: string;\r\n    /**\r\n     * @en Restores the sorted CCSlot objects.\r\n     * @zh 存储已排序好的插槽。\r\n     */\r\n    protected _slots?: CCSlot[];\r\n\r\n    constructor () {\r\n        super();\r\n        const eventManager = new CCArmatureDisplay();\r\n        this._dragonBones = new DragonBones(eventManager);\r\n\r\n        if (director.getScheduler()) {\r\n            game.on(Game.EVENT_RESTART, this.onRestart, this);\r\n            this.initUpdate();\r\n        }\r\n        this.id = this.uuid = 'CCFactory';\r\n    }\r\n    /**\r\n     * @en Sets CCFactory object null when Restart game.\r\n     * @zh 重启时需将工厂实例置空。\r\n     */\r\n    onRestart (): void {\r\n        CCFactory._factory = null;\r\n    }\r\n\r\n    /**\r\n     * @en Initialize update schedule.\r\n     * @zh 初始化更新计划。\r\n     */\r\n    initUpdate (dt?: number): void {\r\n        // director.getScheduler().enableForTarget(this);\r\n        Scheduler.enableForTarget(this);\r\n        director.getScheduler().scheduleUpdate(this, SystemPriority.HIGH, false);\r\n    }\r\n    /**\r\n     * @en Trigger ArmatureDisplay components to update animation and render data.\r\n     * @zh 触发 ArmatureDisplay 组件更新动画和渲染数据。\r\n     */\r\n    update (dt: number): void {\r\n        if (EDITOR_NOT_IN_PREVIEW) return;\r\n        this._dragonBones.advanceTime(dt);\r\n    }\r\n    /**\r\n     * @en Parser raw data to DragonBonesData.\r\n     * @zh 从 raw data 解析出 DragonBonesData 数据。\r\n     */\r\n    getDragonBonesDataByRawData (rawData: any): DragonBonesData | null {\r\n        const dataParser = rawData instanceof ArrayBuffer ? BaseFactory._binaryParser : this._dataParser;\r\n        return dataParser.parseDragonBonesData(rawData, 1.0);\r\n    }\r\n    /**\r\n     * @en Build new armature with a new display.\r\n     * @zh 创建骨架的显示数据。\r\n     */\r\n    // Build new armature with a new display.\r\n    buildArmatureDisplay (armatureName: string, dragonBonesName?: string, skinName?: string, textureAtlasName?: string): DisplayData | null {\r\n        const armature = this.buildArmature(armatureName, dragonBonesName, skinName, textureAtlasName);\r\n        return armature ? armature._display : null;\r\n    }\r\n\r\n    // Build sub armature from an exist armature component.\r\n    // It will share dragonAsset and dragonAtlasAsset.\r\n    // But node can not share,or will cause render error.\r\n    /**\r\n     * @en Create a new node with Dragonbones component.\r\n     * @zh 创建一个附带龙骨组件的 node 节点。\r\n     */\r\n    createArmatureNode (comp: ArmatureDisplay, armatureName: string, node?: Node): ArmatureDisplay {\r\n        node = node || new Node();\r\n        let display = node.getComponent('dragonBones.ArmatureDisplay') as ArmatureDisplay;\r\n        if (!display) {\r\n            display = node.addComponent('dragonBones.ArmatureDisplay') as ArmatureDisplay;\r\n        }\r\n\r\n        node.name = armatureName;\r\n\r\n        display._armatureName = armatureName;\r\n        display._dragonAsset = comp.dragonAsset;\r\n        display._dragonAtlasAsset = comp.dragonAtlasAsset;\r\n        display._init();\r\n\r\n        return display;\r\n    }\r\n\r\n    _buildTextureAtlasData (textureAtlasData: null | CCTextureAtlasData, textureAtlas?: TextureBase): CCTextureAtlasData {\r\n        if (textureAtlasData) {\r\n            textureAtlasData.renderTexture = textureAtlas!;\r\n        } else {\r\n            textureAtlasData = BaseObject.borrowObject(CCTextureAtlasData);\r\n        }\r\n        return textureAtlasData;\r\n    }\r\n\r\n    _sortSlots (): void {\r\n        const slots = this._slots!;\r\n        const sortedSlots: CCSlot[] = [];\r\n        for (let i = 0, l = slots.length; i < l; i++) {\r\n            const slot = slots[i];\r\n            const zOrder = slot._zOrder;\r\n            let inserted = false;\r\n            for (let j = sortedSlots.length - 1; j >= 0; j--) {\r\n                if (zOrder >= sortedSlots[j]._zOrder) {\r\n                    sortedSlots.splice(j + 1, 0, slot);\r\n                    inserted = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (!inserted) {\r\n                sortedSlots.unshift(slot);\r\n            }\r\n        }\r\n        this._slots = sortedSlots;\r\n    }\r\n    _buildArmature (dataPackage): Armature {\r\n        const armature = BaseObject.borrowObject(Armature);\r\n\r\n        armature._skinData = dataPackage.skin;\r\n        armature._animation = BaseObject.borrowObject(Animation);\r\n        armature._animation._armature = armature;\r\n        armature._animation.animations = dataPackage.armature.animations;\r\n\r\n        armature._isChildArmature = false;\r\n\r\n        // fixed dragonbones sort issue\r\n        // armature._sortSlots = this._sortSlots;\r\n\r\n        const display = new CCArmatureDisplay();\r\n\r\n        armature.init(dataPackage.armature, display as any, display, this._dragonBones);\r\n\r\n        return armature;\r\n    }\r\n\r\n    _buildSlot (dataPackage, slotData, displays): CCSlot {\r\n        const slot = BaseObject.borrowObject(CCSlot);\r\n        const display = slot;\r\n        slot.init(slotData, displays, display, display);\r\n        return slot;\r\n    }\r\n    /**\r\n     * @en Gets DragonBonesData object by UUID.\r\n     * @zh 通过 UUID 获取 DragonBonesData object。\r\n     */\r\n    getDragonBonesDataByUUID (uuid): DragonBonesData | null {\r\n        for (const name in this._dragonBonesDataMap) {\r\n            if (name.indexOf(uuid) !== -1) {\r\n                return this._dragonBonesDataMap[name];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    /**\r\n     * @en Remove DragonBonesData object from cache by UUID.\r\n     * @zh 通过 UUID 从缓存移除 DragonBonesData object。\r\n     */\r\n    removeDragonBonesDataByUUID (uuid: string, disposeData?: boolean): void {\r\n        if (disposeData === undefined) { disposeData = true; }\r\n        for (const name in this._dragonBonesDataMap) {\r\n            if (name.indexOf(uuid) === -1) continue;\r\n            if (disposeData) {\r\n                this._dragonBones.bufferObject(this._dragonBonesDataMap[name]);\r\n            }\r\n            delete this._dragonBonesDataMap[name];\r\n        }\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Armature, BlendMode, Matrix } from '@cocos/dragonbones-js';\r\nimport { Texture2D } from '../asset/assets';\r\nimport { Color, Mat4 } from '../core';\r\nimport { CCArmatureDisplay } from './CCArmatureDisplay';\r\nimport { CCFactory } from './CCFactory';\r\nimport { CCSlot } from './CCSlot';\r\n\r\nconst MaxCacheTime = 30;\r\nconst FrameTime = 1 / 60;\r\n\r\nconst _vertices: number[] = [];\r\nconst _indices: number[] = [];\r\nlet _boneInfoOffset = 0;\r\nlet _indexOffset = 0;\r\nlet _vfOffset = 0;\r\nlet _preTexUrl: string | null = null;\r\nlet _preBlendMode: BlendMode | null = null;\r\nlet _segVCount = 0;\r\nlet _segICount = 0;\r\nlet _segOffset = 0;\r\nlet _colorOffset = 0;\r\nlet _preColor = 0;\r\nlet _x: number;\r\nlet _y: number;\r\n// x y u v c1\r\nconst PER_VERTEX_SIZE = 5;\r\n// x y z / u v / r g b a\r\nconst EXPORT_VERTEX_SIZE = 9;\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private interface.\r\n */\r\nexport interface ArmatureInfo {\r\n    curAnimationCache: AnimationCache | null;\r\n    armature: Armature;\r\n    animationsCache: { [key: string]: AnimationCache };\r\n}\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private interface.\r\n */\r\nexport interface ArmatureFrame {\r\n    segments: ArmatureFrameSegment[];\r\n    colors: ArmatureFrameColor[];\r\n    boneInfos: ArmatureFrameBoneInfo[];\r\n    vertices: Float32Array;\r\n    uintVert: Uint32Array;\r\n    indices: Uint16Array;\r\n}\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private interface.\r\n */\r\nexport interface ArmatureFrameBoneInfo {\r\n    globalTransformMatrix: Matrix;\r\n}\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private interface.\r\n */\r\nexport interface ArmatureFrameColor {\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n    a: number;\r\n    vfOffset?: number;\r\n}\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private interface.\r\n */\r\nexport interface ArmatureFrameSegment {\r\n    indexCount: number;\r\n    vfCount: number;\r\n    vertexCount: number;\r\n    tex: Texture2D;\r\n    blendMode: BlendMode;\r\n}\r\n\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private class.\r\n * @en Cache all frames in an animation.\r\n * @zh 缓存所有动画帧。\r\n */\r\nexport class AnimationCache {\r\n    public maxVertexCount = 0;\r\n    public maxIndexCount = 0;\r\n\r\n    _privateMode = false;\r\n    _inited = false;\r\n    _invalid = true;\r\n    _enableCacheAttachedInfo = false;\r\n    frames: SafeArray<ArmatureFrame> = [];\r\n    totalTime = 0;\r\n    isCompleted = false;\r\n    _frameIdx = -1;\r\n\r\n    _armatureInfo: ArmatureInfo | null = null;\r\n    _animationName: string | null = null;\r\n    _tempSegments: ArmatureFrameSegment[] | null = null;\r\n    _tempColors: ArmatureFrameColor[] | null = null;\r\n    _tempBoneInfos: ArmatureFrameBoneInfo[] | null = null;\r\n\r\n    constructor () {\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     * @en Initialization.\r\n     * @zh 初始化。\r\n     * @param armatureInfo @en Armature info. @zh 龙骨信息。\r\n     * @param animationName @en Animation name. @zh 动画名称。\r\n     */\r\n    init (armatureInfo: ArmatureInfo, animationName: string): void {\r\n        this._inited = true;\r\n        this._armatureInfo = armatureInfo;\r\n        this._animationName = animationName;\r\n    }\r\n\r\n    /**\r\n     * @en Clears all animation frames cached.\r\n     * @zh 清除所有缓存动画帧。\r\n     */\r\n    clear (): void {\r\n        this._inited = false;\r\n        for (let i = 0, n = this.frames.length; i < n; i++) {\r\n            const frame = this.frames[i]!;\r\n            frame.segments.length = 0;\r\n        }\r\n        this.invalidAllFrame();\r\n    }\r\n    /**\r\n     * @en Start to play cached frames.\r\n     * @zh 开始播放缓存动画帧。\r\n     */\r\n    begin (): void {\r\n        if (!this._invalid) return;\r\n\r\n        const armatureInfo = this._armatureInfo!;\r\n        const curAnimationCache = armatureInfo.curAnimationCache;\r\n        if (curAnimationCache && curAnimationCache !== this) {\r\n            if (this._privateMode) {\r\n                curAnimationCache.invalidAllFrame();\r\n            } else {\r\n                curAnimationCache.updateToFrame();\r\n            }\r\n        }\r\n        const armature = armatureInfo.armature;\r\n        const animation = armature.animation;\r\n        animation.play(this._animationName, 1);\r\n\r\n        armatureInfo.curAnimationCache = this;\r\n        this._invalid = false;\r\n        this._frameIdx = -1;\r\n        this.totalTime = 0;\r\n        this.isCompleted = false;\r\n    }\r\n    /**\r\n     * @en Complete to play cached frames.\r\n     * @zh 完成播放缓存动画帧。\r\n     */\r\n    end (): void {\r\n        if (!this._needToUpdate()) {\r\n            this._armatureInfo!.curAnimationCache = null;\r\n            this.frames.length = this._frameIdx + 1;\r\n            this.isCompleted = true;\r\n        }\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _needToUpdate (toFrameIdx?: number): boolean {\r\n        const armatureInfo = this._armatureInfo!;\r\n        const armature = armatureInfo.armature;\r\n        const animation = armature.animation;\r\n        return !animation.isCompleted\r\n            && this.totalTime < MaxCacheTime\r\n            && (toFrameIdx === undefined || this._frameIdx < toFrameIdx);\r\n    }\r\n    /**\r\n     * @en Update to specified animation frame.\r\n     * @zh 更新动画到指定帧序列。\r\n     * @param toFrameIdx @en Frame index. @zh 帧序列。\r\n     */\r\n    updateToFrame (toFrameIdx?: number): void {\r\n        if (!this._inited) return;\r\n\r\n        this.begin();\r\n\r\n        if (!this._needToUpdate(toFrameIdx)) return;\r\n\r\n        const armatureInfo = this._armatureInfo!;\r\n        const armature = armatureInfo.armature;\r\n\r\n        do {\r\n            // Solid update frame rate 1/60.\r\n            armature.advanceTime(FrameTime);\r\n            this._frameIdx++;\r\n            this.updateFrame(armature, this._frameIdx);\r\n            this.totalTime += FrameTime;\r\n        } while (this._needToUpdate(toFrameIdx));\r\n\r\n        this.end();\r\n    }\r\n    /**\r\n     * @en Check if initialized or not.\r\n     * @zh 检查是否已初始化。\r\n     * @returns @en True means has been initialized, false means not.\r\n     *          @zh True 表示已初始化完成，false 表示还没初始化。\r\n     */\r\n    isInited (): boolean {\r\n        return this._inited;\r\n    }\r\n    /**\r\n     * @en Check if current state is invalid.\r\n     * @zh 检查当前状态是否为无效。\r\n     * @returns @zh True means invalid, false means valid.\r\n     *          @en True 表示当前数据为无效状态，false 表示当前数据有效。\r\n     */\r\n    isInvalid (): boolean {\r\n        return this._invalid;\r\n    }\r\n    /**\r\n     * @en Mark all cached frames as invalid.\r\n     * @zh 将所有缓存帧标记为无效的。\r\n     */\r\n    invalidAllFrame (): void {\r\n        this.isCompleted = false;\r\n        this._invalid = true;\r\n    }\r\n    /**\r\n     * @en Update all cached frames.\r\n     * @zh 更新所有缓存帧。\r\n     */\r\n    updateAllFrame (): void {\r\n        this.invalidAllFrame();\r\n        this.updateToFrame();\r\n    }\r\n    /**\r\n     * @en Enable attached information.\r\n     * @zh 启用挂载附着信息。\r\n     */\r\n    enableCacheAttachedInfo (): void {\r\n        if (!this._enableCacheAttachedInfo) {\r\n            this._enableCacheAttachedInfo = true;\r\n            this.invalidAllFrame();\r\n        }\r\n    }\r\n    /**\r\n     * @en Update to specified animation frame of armature.\r\n     * @zh 更新龙骨动画到指定帧序列。\r\n     * @param armature @en Armature. @zh 指定骨架。\r\n     * @param index @en Frame index. @zh 帧序列。\r\n     */\r\n    updateFrame (armature, index): void {\r\n        _vfOffset = 0;\r\n        _boneInfoOffset = 0;\r\n        _indexOffset = 0;\r\n        _preTexUrl = null;\r\n        _preBlendMode = null;\r\n        _segVCount = 0;\r\n        _segICount = 0;\r\n        _segOffset = 0;\r\n        _colorOffset = 0;\r\n        _preColor = 0;\r\n\r\n        this.frames[index] = this.frames[index] || {\r\n            segments: [],\r\n            colors: [],\r\n            boneInfos: [],\r\n            vertices: new Float32Array(),\r\n            uintVert: new Uint32Array(),\r\n            indices: new Uint16Array(),\r\n        };\r\n        const frame = this.frames[index]!;\r\n\r\n        const segments = this._tempSegments = frame.segments;\r\n        const colors = this._tempColors = frame.colors;\r\n        const boneInfos = this._tempBoneInfos = frame.boneInfos;\r\n\r\n        this._traverseArmature(armature, 1.0);\r\n        // At last must handle pre color and segment.\r\n        // Because vertex count will right at the end.\r\n        // Handle pre color.\r\n        if (_colorOffset > 0) {\r\n            colors[_colorOffset - 1].vfOffset = _vfOffset;\r\n        }\r\n        colors.length = _colorOffset;\r\n        boneInfos.length = _boneInfoOffset;\r\n\r\n        // Handle pre segment\r\n        const preSegOffset = _segOffset - 1;\r\n        if (preSegOffset >= 0) {\r\n            if (_segICount > 0) {\r\n                const preSegInfo = segments[preSegOffset];\r\n                preSegInfo.indexCount = _segICount;\r\n                preSegInfo.vfCount = _segVCount * EXPORT_VERTEX_SIZE;\r\n                preSegInfo.vertexCount = _segVCount;\r\n                segments.length = _segOffset;\r\n            } else {\r\n                segments.length = _segOffset - 1;\r\n            }\r\n        }\r\n\r\n        // Discard all segments.\r\n        if (segments.length === 0) return;\r\n\r\n        // Fill vertices\r\n        let vertices = frame.vertices;\r\n        const vertexCount = _vfOffset / PER_VERTEX_SIZE;\r\n        const copyOutVerticeSize = vertexCount * EXPORT_VERTEX_SIZE;\r\n        if (!vertices || vertices.length < _vfOffset) {\r\n            vertices = frame.vertices = new Float32Array(copyOutVerticeSize);\r\n        }\r\n        let colorI32: number;\r\n        for (let i = 0, j = 0; i < copyOutVerticeSize;) {\r\n            vertices[i] = _vertices[j++]; // x\r\n            vertices[i + 1] = _vertices[j++]; // y\r\n            vertices[i + 3] = _vertices[j++]; // u\r\n            vertices[i + 4] = _vertices[j++]; // v\r\n            colorI32 = _vertices[j++];\r\n            vertices[i + 5] = (colorI32 & 0xff) / 255.0;\r\n            vertices[i + 6] = ((colorI32 >> 8) & 0xff) / 255.0;\r\n            vertices[i + 7] = ((colorI32 >> 16) & 0xff) / 255.0;\r\n            vertices[i + 8] = ((colorI32 >> 24) & 0xff) / 255.0;\r\n            i += EXPORT_VERTEX_SIZE;\r\n        }\r\n\r\n        // Fill indices\r\n        let indices = frame.indices;\r\n        if (!indices || indices.length < _indexOffset) {\r\n            indices = frame.indices = new Uint16Array(_indexOffset);\r\n        }\r\n\r\n        for (let i = 0; i < _indexOffset; i++) {\r\n            indices[i] = _indices[i];\r\n        }\r\n\r\n        frame.vertices = vertices;\r\n        frame.indices = indices;\r\n\r\n        this.maxVertexCount = vertexCount > this.maxVertexCount ? vertexCount : this.maxVertexCount;\r\n        this.maxIndexCount = indices.length > this.maxIndexCount ? indices.length : this.maxIndexCount;\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _traverseArmature (armature: Armature, parentOpacity): void {\r\n        const colors = this._tempColors!;\r\n        const segments = this._tempSegments!;\r\n        const boneInfos = this._tempBoneInfos!;\r\n        const slots = armature._slots;\r\n        let slotVertices: number[];\r\n        let slotIndices: number[];\r\n        let slot: CCSlot;\r\n        let slotMatrix: Mat4;\r\n        let slotColor: Color;\r\n        let colorVal: number;\r\n        let texture: Texture2D | null;\r\n        let preSegOffset: number;\r\n        let preSegInfo: ArmatureFrameSegment;\r\n        const bones = armature._bones;\r\n\r\n        if (this._enableCacheAttachedInfo) {\r\n            for (let i = 0, l = bones.length; i < l; i++, _boneInfoOffset++) {\r\n                const bone = bones[i];\r\n                let boneInfo = boneInfos[_boneInfoOffset];\r\n                if (!boneInfo) {\r\n                    boneInfo = boneInfos[_boneInfoOffset] = {\r\n                        globalTransformMatrix: new Matrix(),\r\n                    };\r\n                }\r\n                const boneMat = bone.globalTransformMatrix;\r\n                const cacheBoneMat = boneInfo.globalTransformMatrix;\r\n                cacheBoneMat.copyFrom(boneMat);\r\n            }\r\n        }\r\n\r\n        for (let i = 0, l = slots.length; i < l; i++) {\r\n            slot = slots[i] as CCSlot;\r\n            if (!slot._visible || !slot._displayData) continue;\r\n\r\n            slot.updateWorldMatrix();\r\n            slotColor = slot._color;\r\n\r\n            if (slot.childArmature) {\r\n                this._traverseArmature(slot.childArmature, parentOpacity * slotColor.a / 255);\r\n                continue;\r\n            }\r\n\r\n            texture = slot.getTexture();\r\n            if (!texture) continue;\r\n\r\n            if (_preTexUrl !== texture.nativeUrl || _preBlendMode !== slot._blendMode) {\r\n                _preTexUrl = texture.nativeUrl;\r\n                _preBlendMode = slot._blendMode;\r\n                // Handle pre segment.\r\n                preSegOffset = _segOffset - 1;\r\n                if (preSegOffset >= 0) {\r\n                    if (_segICount > 0) {\r\n                        preSegInfo = segments[preSegOffset];\r\n                        preSegInfo.indexCount = _segICount;\r\n                        preSegInfo.vertexCount = _segVCount;\r\n                        preSegInfo.vfCount = _segVCount * EXPORT_VERTEX_SIZE;\r\n                    } else {\r\n                        // Discard pre segment.\r\n                        _segOffset--;\r\n                    }\r\n                }\r\n                // Handle now segment.\r\n                segments[_segOffset] = {\r\n                    tex: texture,\r\n                    blendMode: slot._blendMode,\r\n                    indexCount: 0,\r\n                    vertexCount: 0,\r\n                    vfCount: 0,\r\n                };\r\n                _segOffset++;\r\n                _segICount = 0;\r\n                _segVCount = 0;\r\n            }\r\n\r\n            colorVal = ((slotColor.a * parentOpacity << 24) >>> 0) + (slotColor.b << 16) + (slotColor.g << 8) + slotColor.r;\r\n\r\n            if (_preColor !== colorVal) {\r\n                _preColor = colorVal;\r\n                if (_colorOffset > 0) {\r\n                    colors[_colorOffset - 1].vfOffset = _vfOffset;\r\n                }\r\n                colors[_colorOffset++] = {\r\n                    r: slotColor.r,\r\n                    g: slotColor.g,\r\n                    b: slotColor.b,\r\n                    a: slotColor.a * parentOpacity,\r\n                    vfOffset: 0,\r\n                };\r\n            }\r\n\r\n            slotVertices = slot._localVertices;\r\n            slotIndices = slot._indices;\r\n\r\n            slotMatrix = slot._worldMatrix;\r\n\r\n            for (let j = 0, vl = slotVertices.length; j < vl;) {\r\n                _x = slotVertices[j++];\r\n                _y = slotVertices[j++];\r\n                _vertices[_vfOffset++] = _x * slotMatrix.m00 + _y * slotMatrix.m04 + slotMatrix.m12;\r\n                _vertices[_vfOffset++] = _x * slotMatrix.m01 + _y * slotMatrix.m05 + slotMatrix.m13;\r\n                _vertices[_vfOffset++] = slotVertices[j++];\r\n                _vertices[_vfOffset++] = slotVertices[j++];\r\n                _vertices[_vfOffset++] = colorVal;\r\n            }\r\n\r\n            // This place must use segment vertex count to calculate vertex offset.\r\n            // Assembler will calculate vertex offset again for different segment.\r\n            for (let ii = 0, il = slotIndices.length; ii < il; ii++) {\r\n                _indices[_indexOffset++] = _segVCount + slotIndices[ii];\r\n            }\r\n\r\n            _segICount += slotIndices.length;\r\n            _segVCount += slotVertices.length / 4;\r\n        }\r\n    }\r\n}\r\n/**\r\n * @en Cached data of armature.\r\n * @zh 骨架缓存。\r\n */\r\nexport class ArmatureCache {\r\n    protected _privateMode = false;\r\n    protected _animationPool: Record<string, AnimationCache> = {};\r\n    protected _armatureCache: Record<string, ArmatureInfo> = {};\r\n\r\n    constructor () {\r\n    }\r\n    /**\r\n     * @en Enable private cache mode.\r\n     * @zh 启用私有缓存模式。\r\n     */\r\n    enablePrivateMode (): void {\r\n        this._privateMode = true;\r\n    }\r\n\r\n    /**\r\n     * @en If using private cache mode, all cached data will be destroyed when corresponding dragonbone nodes are destroyed.\r\n     * @zh 如果为私有缓存模式，cache 数据将随组件一起销毁。\r\n     */\r\n    dispose (): void {\r\n        for (const key in this._armatureCache) {\r\n            const armatureInfo = this._armatureCache[key];\r\n            if (armatureInfo) {\r\n                const armature = armatureInfo.armature;\r\n                if (armature) armature.dispose();\r\n            }\r\n        }\r\n        this._armatureCache = {};\r\n        this._animationPool = {};\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _removeArmature (armatureKey: string): void {\r\n        const armatureInfo = this._armatureCache[armatureKey];\r\n        const animationsCache = armatureInfo.animationsCache;\r\n        for (const aniKey in animationsCache) {\r\n            // Clear cache texture, and put cache into pool.\r\n            // No need to create TypedArray next time.\r\n            const animationCache = animationsCache[aniKey];\r\n            if (!animationCache) continue;\r\n            this._animationPool[`${armatureKey}#${aniKey}`] = animationCache;\r\n            animationCache.clear();\r\n        }\r\n\r\n        const armature = armatureInfo.armature;\r\n        if (armature) armature.dispose();\r\n        delete this._armatureCache[armatureKey];\r\n    }\r\n    /**\r\n     * @en When dragonbones assets be destroy, remove armature from dragonbones cache.\r\n     * @zh 当 dragonbones assets 销毁时，从 cache 中移除骨架。\r\n     */\r\n    resetArmature (uuid: string): void {\r\n        for (const armatureKey in this._armatureCache) {\r\n            if (armatureKey.indexOf(uuid) === -1) continue;\r\n            this._removeArmature(armatureKey);\r\n        }\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    getArmatureCache (armatureName: string, armatureKey: string, atlasUUID: string): Armature | null {\r\n        const armatureInfo = this._armatureCache[armatureKey];\r\n        let armature: Armature;\r\n        if (!armatureInfo) {\r\n            const factory = CCFactory.getInstance();\r\n            const proxy = factory.buildArmatureDisplay(armatureName, armatureKey, '', atlasUUID) as CCArmatureDisplay;\r\n            if (!proxy || !proxy._armature) return null;\r\n            armature = proxy._armature;\r\n            // If armature has child armature, can not be cache, because it's\r\n            // animation data can not be precompute.\r\n            if (!ArmatureCache.canCache(armature)) {\r\n                armature.dispose();\r\n                return null;\r\n            }\r\n\r\n            this._armatureCache[armatureKey] = {\r\n                armature,\r\n                // Cache all kinds of animation frame.\r\n                // When armature is dispose, clear all animation cache.\r\n                animationsCache: {},\r\n                curAnimationCache: null,\r\n            };\r\n        } else {\r\n            armature = armatureInfo.armature;\r\n        }\r\n        return armature;\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    getAnimationCache (armatureKey, animationName): AnimationCache | null {\r\n        const armatureInfo = this._armatureCache[armatureKey];\r\n        if (!armatureInfo) return null;\r\n\r\n        const animationsCache = armatureInfo.animationsCache;\r\n        return animationsCache[animationName];\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    initAnimationCache (armatureKey: string, animationName: string): AnimationCache | null {\r\n        if (!animationName) return null;\r\n\r\n        const armatureInfo = this._armatureCache[armatureKey];\r\n        const armature = armatureInfo && armatureInfo.armature;\r\n        if (!armature) return null;\r\n        const animation = armature.animation;\r\n        const hasAni = animation.hasAnimation(animationName);\r\n        if (!hasAni) return null;\r\n\r\n        const animationsCache = armatureInfo.animationsCache;\r\n        let animationCache = animationsCache[animationName];\r\n        if (!animationCache) {\r\n            // If cache exist in pool, then just use it.\r\n            const poolKey = `${armatureKey}#${animationName}`;\r\n            animationCache = this._animationPool[poolKey];\r\n            if (animationCache) {\r\n                delete this._animationPool[poolKey];\r\n            } else {\r\n                animationCache = new AnimationCache();\r\n                animationCache._privateMode = this._privateMode;\r\n            }\r\n            animationCache.init(armatureInfo, animationName);\r\n            animationsCache[animationName] = animationCache;\r\n        }\r\n        return animationCache;\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    invalidAnimationCache (armatureKey: string): void {\r\n        const armatureInfo = this._armatureCache[armatureKey];\r\n        const armature = armatureInfo && armatureInfo.armature;\r\n        if (!armature) return;\r\n\r\n        const animationsCache = armatureInfo.animationsCache;\r\n        for (const aniKey in animationsCache) {\r\n            const animationCache = animationsCache[aniKey];\r\n            animationCache.invalidAllFrame();\r\n        }\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    updateAnimationCache (armatureKey: string, animationName: string): void {\r\n        if (animationName) {\r\n            const animationCache = this.initAnimationCache(armatureKey, animationName);\r\n            if (!animationCache) return;\r\n            animationCache.updateAllFrame();\r\n        } else {\r\n            const armatureInfo = this._armatureCache[armatureKey];\r\n            const armature = armatureInfo && armatureInfo.armature;\r\n            if (!armature) return;\r\n\r\n            const animationsCache = armatureInfo.animationsCache;\r\n            for (const aniKey in animationsCache) {\r\n                const animationCache = animationsCache[aniKey];\r\n                animationCache.updateAllFrame();\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    static canCache (armature: Armature): boolean {\r\n        const slots = armature._slots;\r\n        for (let i = 0, l = slots.length; i < l; i++) {\r\n            const slot = slots[i];\r\n            if (slot.childArmature) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    static FrameTime = FrameTime;\r\n    static sharedCache = new ArmatureCache();\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { EDITOR_NOT_IN_PREVIEW } from 'internal:constants';\r\nimport { Asset } from '../asset/assets';\r\nimport { ArmatureCache } from './ArmatureCache';\r\nimport { Enum, cclegacy, _decorator, warn } from '../core';\r\nimport { CCFactory } from './CCFactory';\r\nimport { Node } from '../scene-graph';\r\n\r\nconst { ccclass, serializable } = _decorator;\r\n\r\n/**\r\n * @en The skeleton data of dragonBones.\r\n * @zh dragonBones 的骨骼数据。\r\n * @class DragonBonesAsset\r\n * @extends Asset\r\n */\r\n@ccclass('dragonBones.DragonBonesAsset')\r\nexport class DragonBonesAsset extends Asset {\r\n    /**\r\n     * @en The string parsed from the DragonBonesAsset data in json format.\r\n     * See http://developer.egret.com/cn/github/egret-docs/DB/dbLibs/dataFormat/index.html\r\n     * @zh Json 格式的 DragonBones 骨骼数据被解析后的字符串。\r\n     * 可查看 DragonBones 官方文档 http://developer.egret.com/cn/github/egret-docs/DB/dbLibs/dataFormat/index.html\r\n     * @property {string} dragonBonesJson\r\n     */\r\n    @serializable\r\n    protected _dragonBonesJson = '';\r\n\r\n    get dragonBonesJson (): string {\r\n        return this._dragonBonesJson;\r\n    }\r\n\r\n    set dragonBonesJson (value) {\r\n        this._dragonBonesJson = value;\r\n        this._dragonBonesJsonData = JSON.parse(value);\r\n        this.reset();\r\n    }\r\n\r\n    private _factory: CCFactory| null = null;\r\n    protected _dragonBonesJsonData?: ArrayBuffer;\r\n\r\n    private _armaturesEnum: any = null;\r\n\r\n    constructor (name?: string) {\r\n        super(name);\r\n        this.reset();\r\n    }\r\n    /**\r\n     * @en Create a new node with Dragonbones component.\r\n     * @zh 创建一个附带龙骨组件的 node 节点。\r\n     */\r\n    createNode (callback: (err: Error | null, node: Node) => void): void {\r\n        const node = new Node(this.name);\r\n        const armatureDisplay = node.addComponent('dragonBones.ArmatureDisplay') as any;\r\n        armatureDisplay.dragonAsset = this;\r\n\r\n        return callback(null, node);\r\n    }\r\n    /**\r\n     * @en Reset DragonBonesAsset data and state.\r\n     * @zh 重置 DragonBonesAsset 数据和状态。\r\n     */\r\n    reset (): void {\r\n        this._clear();\r\n        if (EDITOR_NOT_IN_PREVIEW) {\r\n            this._armaturesEnum = null;\r\n        }\r\n    }\r\n    /**\r\n     * @en Initialize with altas uuid.\r\n     * @zh 使用 uuid 初始化 DragonBonesAsset 资产数据。\r\n     * @param factory   @en The global CCFactory instance object.\r\n     *                  @zh 全局的 CCFactory 对象。\r\n     * @param atlasUUID @en Atlas uuid. @zh Atlas uuid。\r\n     */\r\n    init (factory?: CCFactory, atlasUUID?: string): string {\r\n        this._factory = factory || CCFactory.getInstance();\r\n\r\n        if (!this._dragonBonesJsonData && this.dragonBonesJson) {\r\n            this._dragonBonesJsonData = JSON.parse(this.dragonBonesJson);\r\n        }\r\n\r\n        let rawData: any = null;\r\n        if (this._dragonBonesJsonData) {\r\n            rawData = this._dragonBonesJsonData;\r\n        } else {\r\n            rawData = this._nativeAsset;\r\n        }\r\n\r\n        // If create by manual, uuid is empty.\r\n        if (!this._uuid) {\r\n            const dbData = this._factory.getDragonBonesDataByRawData(rawData);\r\n            if (dbData) {\r\n                this._uuid = dbData.name;\r\n            } else {\r\n                warn('dragonbones name is empty');\r\n            }\r\n        }\r\n\r\n        const armatureKey = `${this._uuid}#${atlasUUID!}`;\r\n        const dragonBonesData = this._factory.getDragonBonesData(armatureKey);\r\n        if (dragonBonesData) return armatureKey;\r\n\r\n        // eslint-disable-next-line max-len\r\n        this._factory.parseDragonBonesData(rawData instanceof ArrayBuffer ? rawData : (rawData.buffer instanceof ArrayBuffer ? rawData.buffer : rawData), armatureKey);\r\n        return armatureKey;\r\n    }\r\n\r\n    // EDITOR\r\n    /**\r\n     * @engineInternal Since v3.7.2, this is an engine private function.\r\n     */\r\n    getArmatureEnum (): any {\r\n        if (this._armaturesEnum) {\r\n            return this._armaturesEnum as unknown as any;\r\n        }\r\n        this.init();\r\n        const dragonBonesData = this._factory!.getDragonBonesDataByUUID(this._uuid);\r\n        if (dragonBonesData) {\r\n            const armatureNames = dragonBonesData.armatureNames;\r\n            const enumDef = {};\r\n            for (let i = 0; i < armatureNames.length; i++) {\r\n                const name = armatureNames[i];\r\n                enumDef[name] = i;\r\n            }\r\n            return this._armaturesEnum = Enum(enumDef);\r\n        }\r\n        return null;\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2, this is an engine private function.\r\n     */\r\n    public getAnimsEnum (armatureName: string): { '<None>': number; } | null {\r\n        this.init();\r\n        const dragonBonesData = this._factory!.getDragonBonesDataByUUID(this._uuid);\r\n        if (dragonBonesData) {\r\n            const armature = dragonBonesData.getArmature(armatureName);\r\n            if (!armature) {\r\n                return null;\r\n            }\r\n\r\n            const enumDef = { '<None>': 0 };\r\n            const anims = armature.animations;\r\n            let i = 0;\r\n            for (const animName in anims) {\r\n                // eslint-disable-next-line no-prototype-builtins\r\n                if (anims.hasOwnProperty(animName)) {\r\n                    enumDef[animName] = i + 1;\r\n                    i++;\r\n                }\r\n            }\r\n            return Enum(enumDef);\r\n        }\r\n        return null;\r\n    }\r\n    /**\r\n     * @en Destroy DragonBonesAsset data.\r\n     * @zh 销毁 DragonBonesAsset 资产数据。\r\n     */\r\n    public destroy (): boolean {\r\n        this._clear();\r\n        return super.destroy();\r\n    }\r\n\r\n    protected _clear (): void {\r\n        if (this._factory) {\r\n            ArmatureCache.sharedCache.resetArmature(this._uuid);\r\n            this._factory.removeDragonBonesDataByUUID(this._uuid, true);\r\n        }\r\n    }\r\n}\r\n\r\ncclegacy.internal.DragonBonesAsset = DragonBonesAsset;\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { JSB } from 'internal:constants';\r\nimport { TextureAtlasData } from '@cocos/dragonbones-js';\r\nimport { ArmatureCache } from './ArmatureCache';\r\nimport { ArmatureDisplay } from './ArmatureDisplay';\r\nimport { CCFactory } from './CCFactory';\r\nimport { cclegacy, _decorator } from '../core';\r\nimport { Asset, Texture2D } from '../asset/assets';\r\nimport { Node } from '../scene-graph';\r\n\r\nconst { ccclass, serializable, type } = _decorator;\r\n\r\n/**\r\n * @en The skeleton atlas data of dragonBones.\r\n * @zh DragonBones 的骨骼纹理数据。\r\n * @class DragonBonesAtlasAsset\r\n * @extends Asset\r\n */\r\n@ccclass('dragonBones.DragonBonesAtlasAsset')\r\nexport class DragonBonesAtlasAsset extends Asset {\r\n    constructor () {\r\n        super();\r\n        this._clear();\r\n    }\r\n    /**\r\n     * @en atlas of json file.\r\n     * @zh 纹理图集的 json 文件。\r\n     */\r\n    @serializable\r\n    _atlasJson = '';\r\n    get atlasJson (): string {\r\n        return this._atlasJson;\r\n    }\r\n    set atlasJson (value) {\r\n        this._atlasJson = value;\r\n        this._atlasJsonData = JSON.parse(this.atlasJson);\r\n        this._clear();\r\n    }\r\n    /**\r\n     * @en 2D Texture.\r\n     * @zh 2D 纹理。\r\n     */\r\n    @serializable\r\n    @type(Texture2D)\r\n    _texture: Texture2D | null = null;\r\n\r\n    /**\r\n     * @en Data with json format for Describing the atlas information.\r\n     * @zh 描述图集信息的 json 数据。\r\n     */\r\n    @serializable\r\n    _atlasJsonData: any = {};\r\n    /**\r\n     * @en Dragonbones instance of CCFactory.\r\n     * @zh Dragonbones 工厂实例。\r\n     */\r\n    _factory: CCFactory| null = null;\r\n    /**\r\n     * @en 2D texture.\r\n     * @zh 2D 纹理。\r\n     * @property {Texture2D} texture\r\n     */\r\n    get texture (): Texture2D | null {\r\n        return this._texture;\r\n    }\r\n    set texture (value) {\r\n        this._texture = value;\r\n        this._clear();\r\n    }\r\n    /**\r\n     * @en The texture atlas data.\r\n     * @zh 贴图集数据。\r\n     */\r\n    @serializable\r\n    _textureAtlasData: TextureAtlasData | null = null;\r\n\r\n    /**\r\n     * @en Create a new node with Dragonbones component.\r\n     * @zh 创建一个附带龙骨组件的 node 节点。\r\n     */\r\n    createNode (callback: (error: Error | null, node: Node) => void): void {\r\n        const node = new Node(this.name);\r\n        const armatureDisplay = node.addComponent('dragonBones.ArmatureDisplay') as ArmatureDisplay;\r\n        armatureDisplay.dragonAtlasAsset = this;\r\n\r\n        return callback(null, node);\r\n    }\r\n\r\n    /**\r\n     * @en Atlas resource initialization. Parse the original atlas data and atlas object into a\r\n     * TextureAtlasData instance, and cache it to the factory.\r\n     * @zh 图集资源初始化。将原始贴图集数据和贴图集对象解析为 TextureAtlasData 实例，并缓存到工厂中。\r\n     */\r\n    init (factory: CCFactory): void {\r\n        this._factory = factory;\r\n\r\n        if (!this._atlasJsonData) {\r\n            this._atlasJsonData = JSON.parse(this.atlasJson);\r\n        }\r\n        const atlasJsonObj = this._atlasJsonData;\r\n\r\n        // If create by manual, uuid is empty.\r\n        this._uuid = this._uuid || atlasJsonObj.name;\r\n\r\n        if (this._textureAtlasData) {\r\n            factory.addTextureAtlasData(this._textureAtlasData, this._uuid);\r\n        } else {\r\n            this._textureAtlasData = factory.parseTextureAtlasData(atlasJsonObj, this.texture, this._uuid);\r\n        }\r\n    }\r\n    /**\r\n     * @en Destroy altas assets.\r\n     * @zh 销毁图集资源。\r\n     */\r\n    destroy (): boolean {\r\n        this._clear();\r\n        return super.destroy();\r\n    }\r\n\r\n    protected _clear (): void {\r\n        if (JSB) return;\r\n        if (this._factory) {\r\n            ArmatureCache.sharedCache.resetArmature(this._uuid);\r\n            this._factory.removeTextureAtlasData(this._uuid, true);\r\n            this._factory.removeDragonBonesDataByUUID(this._uuid, true);\r\n        }\r\n        this._textureAtlasData = null;\r\n    }\r\n}\r\n\r\ncclegacy.internal.DragonBonesAtlasAsset = DragonBonesAtlasAsset;\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Armature, Matrix } from '@cocos/dragonbones-js';\r\nimport { Mat4, Vec3, _decorator } from '../core';\r\nimport { Node } from '../scene-graph';\r\nimport { ArmatureFrameBoneInfo } from './ArmatureCache';\r\nimport { ArmatureDisplay } from './ArmatureDisplay';\r\n\r\nconst _tempMat4 = new Mat4();\r\nconst { ccclass } = _decorator;\r\n\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private class.\r\n * Users no need to call any function in this class.\r\n */\r\n/**\r\n * @en Attach node tool.\r\n * @zh 挂点工具类。\r\n * @class dragonBones.AttachUtil\r\n */\r\n\r\n@ccclass('dragonBones.AttachUtil')\r\nexport class AttachUtil {\r\n    private _inited = false;\r\n    private _armature: Armature | null = null;\r\n    private _armatureNode: Node | null = null;\r\n    private _armatureDisplay: ArmatureDisplay | null = null;\r\n    constructor () {\r\n\r\n    }\r\n    /**\r\n     * @en Initializes parameters.\r\n     * @zh 初始化参数设置。\r\n     */\r\n    init (armatureDisplay: ArmatureDisplay): void {\r\n        this._inited = true;\r\n        this._armature = armatureDisplay._armature;\r\n        this._armatureNode = armatureDisplay.node;\r\n        this._armatureDisplay = armatureDisplay;\r\n    }\r\n    /**\r\n     * @en Resets parameter values.\r\n     * @zh 重置参数设置。\r\n     */\r\n    reset (): void {\r\n        this._inited = false;\r\n        this._armature = null;\r\n        this._armatureNode = null;\r\n        this._armatureDisplay = null;\r\n    }\r\n    /**\r\n     * @en Synchronize transformation of nodes attached to bones.\r\n     * @zh 同步变换附着在骨骼上节点。\r\n     */\r\n    _syncAttachedNode (): void {\r\n        if (!this._inited) return;\r\n        const rootMatrix = this._armatureNode!.worldMatrix;\r\n\r\n        let boneInfos: ArmatureFrameBoneInfo[] | null = null;\r\n        const isCached = this._armatureDisplay!.isAnimationCached();\r\n        if (isCached && this._armatureDisplay) {\r\n            boneInfos = this._armatureDisplay._curFrame && this._armatureDisplay._curFrame.boneInfos;\r\n            if (!boneInfos) return;\r\n        }\r\n\r\n        const sockets = this._armatureDisplay!.sockets;\r\n        const socketNodes = this._armatureDisplay!.socketNodes;\r\n\r\n        const matrixHandle = (node: Node, boneMat: Matrix): void => {\r\n            const tm = _tempMat4;\r\n            tm.m00 = boneMat.a;\r\n            tm.m01 = boneMat.b;\r\n            tm.m04 = -boneMat.c;\r\n            tm.m05 = -boneMat.d;\r\n            tm.m12 = boneMat.tx;\r\n            tm.m13 = boneMat.ty;\r\n            node.matrix = _tempMat4;\r\n        };\r\n\r\n        const bones = this._armature!.getBones();\r\n\r\n        for (let l = sockets.length - 1; l >= 0; l--) {\r\n            const sock = sockets[l];\r\n            const boneNode = sock.target;\r\n\r\n            if (!boneNode) continue;\r\n            // Node has been destroy\r\n            if (!boneNode.isValid) {\r\n                socketNodes.delete(sock.path);\r\n                sockets.splice(l, 1);\r\n                continue;\r\n            }\r\n            // Bone has been destroy\r\n            const bone = isCached ? boneInfos![sock.boneIndex!] : bones[sock.boneIndex as unknown as number];\r\n            if (!bone) continue;\r\n\r\n            // if (!bone) {\r\n            //     boneNode.removeFromParent();\r\n            //     boneNode.destroy();\r\n            //     socketNodes.delete(sock.path);\r\n            //     sockets.splice(l, 1);\r\n            //     continue;\r\n            // }\r\n            matrixHandle(boneNode, bone.globalTransformMatrix);\r\n        }\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { director } from '../game/director';\r\nimport { System, SystemPriority, cclegacy } from '../core';\r\nimport { ArmatureDisplay } from './ArmatureDisplay';\r\n/**\r\n * @en The ArmatureSystem is mainly responsible for triggering and updating the animation uniformly.\r\n * @zh 骨架系统，主要负责统一触发更新骨骼动画。\r\n */\r\nexport class ArmatureSystem extends System {\r\n    /**\r\n     * @en The ID flag of the system.\r\n     * @zh 此系统的 ID 标记。\r\n     */\r\n    static readonly ID = 'ARMATURE';\r\n\r\n    private static _instance: ArmatureSystem;\r\n\r\n    private constructor () {\r\n        super();\r\n    }\r\n\r\n    /**\r\n     * @en Gets the instance of the ArmatureSystem system.\r\n     * @zh 获取 Dragonbones Armature 系统的单例。\r\n     */\r\n    public static getInstance (): ArmatureSystem {\r\n        if (!ArmatureSystem._instance) {\r\n            ArmatureSystem._instance = new ArmatureSystem();\r\n            director.registerSystem(ArmatureSystem.ID, ArmatureSystem._instance, SystemPriority.HIGH);\r\n        }\r\n        return ArmatureSystem._instance;\r\n    }\r\n\r\n    private _armatures = new Set<ArmatureDisplay>();\r\n    /**\r\n     * @en Add the ArmatureDisplay components into ArmatureSystem system.\r\n     * @zh 将龙骨组件添加到系统中。\r\n     */\r\n    public add (armature: ArmatureDisplay | null): void {\r\n        if (!armature) return;\r\n        if (!this._armatures.has(armature)) {\r\n            this._armatures.add(armature);\r\n        }\r\n    }\r\n    /**\r\n     * @en Remove the ArmatureDisplay components from ArmatureSystem system.\r\n     * @zh 将龙骨组件从系统移除。\r\n     */\r\n    public remove (armature: ArmatureDisplay | null): void {\r\n        if (!armature) return;\r\n        if (this._armatures.has(armature)) {\r\n            this._armatures.delete(armature);\r\n        }\r\n    }\r\n    /**\r\n     * @en Trigger animation update of Armature objects.\r\n     * @zh 触发更新龙骨动画。\r\n     */\r\n    postUpdate (dt: number): void {\r\n        if (!this._armatures) {\r\n            return;\r\n        }\r\n        this._armatures.forEach((armature): void => {\r\n            armature.updateAnimation(dt);\r\n            armature.syncAttachedNode();\r\n        });\r\n    }\r\n    /**\r\n     * @en\r\n     * Trigger update of rendering data for all Dragonbone components.\r\n     * @zh\r\n     * 触发标记更新所有龙骨组件的渲染数据。\r\n     */\r\n    public prepareRenderData (): void {\r\n        if (!this._armatures) {\r\n            return;\r\n        }\r\n        this._armatures.forEach((armature): void => {\r\n            armature._markForUpdateRenderData();\r\n        });\r\n    }\r\n}\r\n\r\ncclegacy.internal.ArmatureSystem = ArmatureSystem;\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { EDITOR_NOT_IN_PREVIEW } from 'internal:constants';\r\nimport { Armature, Bone, EventObject, AnimationState } from '@cocos/dragonbones-js';\r\nimport { UIRenderer } from '../2d/framework/ui-renderer';\r\nimport { Color, Enum, ccenum, errorID, RecyclePool, js, EventTarget, cclegacy, _decorator, warn, CCObjectFlags } from '../core';\r\nimport { BlendFactor } from '../gfx';\r\nimport { AnimationCache, ArmatureCache, ArmatureFrame } from './ArmatureCache';\r\nimport { AttachUtil } from './AttachUtil';\r\nimport { CCFactory } from './CCFactory';\r\nimport { DragonBonesAsset } from './DragonBonesAsset';\r\nimport { DragonBonesAtlasAsset } from './DragonBonesAtlasAsset';\r\nimport type { Graphics } from '../2d/components/graphics';\r\nimport { CCArmatureDisplay } from './CCArmatureDisplay';\r\nimport { MaterialInstance } from '../render-scene/core/material-instance';\r\nimport { ArmatureSystem } from './ArmatureSystem';\r\nimport { Batcher2D } from '../2d/renderer/batcher-2d';\r\nimport { RenderEntity, RenderEntityType } from '../2d/renderer/render-entity';\r\nimport { RenderDrawInfo } from '../2d/renderer/render-draw-info';\r\nimport { Material, Texture2D } from '../asset/assets';\r\nimport { Node } from '../scene-graph';\r\nimport { builtinResMgr } from '../asset/asset-manager';\r\nimport { setPropertyEnumType } from '../core/internal-index';\r\nimport type { RenderData } from '../2d/renderer/render-data';\r\n\r\nenum DefaultArmaturesEnum {\r\n    default = -1,\r\n}\r\nccenum(DefaultArmaturesEnum);\r\n\r\nenum DefaultAnimsEnum {\r\n    '<None>' = 0,\r\n}\r\nccenum(DefaultAnimsEnum);\r\n\r\nenum DefaultCacheMode {\r\n    REALTIME = 0,\r\n}\r\nccenum(DefaultCacheMode);\r\n\r\n/**\r\n * @en Control animation speed, should be larger than 0.\r\n * @zh 控制龙骨动画播放速度，数值应大于 0。\r\n */\r\n// eslint-disable-next-line prefer-const,import/no-mutable-exports\r\nexport let timeScale = 1;\r\n\r\n/**\r\n * @en Enum for cache mode type.\r\n * @zh Dragonbones 渲染类型。\r\n * @enum ArmatureDisplay.AnimationCacheMode\r\n */\r\nexport enum AnimationCacheMode {\r\n    /**\r\n     * @en The realtime mode.\r\n     * @zh 实时计算模式。\r\n     * @property {Number} REALTIME\r\n     */\r\n    REALTIME = 0,\r\n    /**\r\n     * @en The shared cache mode.\r\n     * @zh 共享缓存模式。\r\n     * @property {Number} SHARED_CACHE\r\n     */\r\n    SHARED_CACHE = 1,\r\n    /**\r\n     * @en The private cache mode.\r\n     * @zh 私有缓存模式。\r\n     * @property {Number} PRIVATE_CACHE\r\n     */\r\n    PRIVATE_CACHE = 2\r\n}\r\nccenum(AnimationCacheMode);\r\n\r\nconst { ccclass, serializable, editable, type, help, menu, tooltip, visible, displayName, override, displayOrder, executeInEditMode } = _decorator;\r\n\r\n/**\r\n * @en Struct that can store rendering data-related information.\r\n * @zh 用于存储渲染数据相关信息的结构体。\r\n */\r\nexport interface ArmatureDisplayDrawData {\r\n    /**\r\n     * @en A Material instance. @zh 材质实例。\r\n     */\r\n    material: Material | null;\r\n    /**\r\n     * @en 2D Texture. @zh 2D 纹理。\r\n     */\r\n    texture: Texture2D | null;\r\n    /**\r\n     * @en Vertex index offset. @zh 顶点索引偏移。\r\n     */\r\n    indexOffset: number;\r\n    /**\r\n     * @en Vertex index count. @zh 顶点索引数量。\r\n     */\r\n    indexCount: number;\r\n}\r\n\r\n/**\r\n * @en DragonBones Socket. Used to attach components to bone nodes and move them together\r\n * with bone animations. Developers need to specify the bone path that needs to follow the\r\n * movement and which node the motion transformation will be applied to.\r\n * @zh 骨骼挂点。用于将组件挂载在骨骼节点上，随骨骼动画一起运动。\r\n * 用户需指定需要跟随运动的骨骼路径以及运动变换将作用于哪个节点上。\r\n */\r\n@ccclass('dragonBones.ArmatureDisplay.DragonBoneSocket')\r\nexport class DragonBoneSocket {\r\n    /**\r\n     * @en Path of the target joint.\r\n     * @zh 此挂点的目标骨骼路径。\r\n     */\r\n    @serializable\r\n    @editable\r\n    public path = '';\r\n\r\n    /**\r\n     * @en Transform output node.\r\n     * @zh 此挂点的变换信息输出节点。\r\n     */\r\n    @type(Node)\r\n    @editable\r\n    @serializable\r\n    public target: Node | null = null;\r\n\r\n    public boneIndex: number | null = null;\r\n\r\n    constructor (path = '', target: Node | null = null) {\r\n        this.path = path;\r\n        this.target = target;\r\n    }\r\n}\r\n\r\njs.setClassAlias(DragonBoneSocket, 'dragonBones.ArmatureDisplay.DragonBoneSocket');\r\n\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\ninterface BoneIndex extends Number {\r\n    _any: number;\r\n}\r\n\r\n/**\r\n * @en\r\n * The Armature Display of DragonBones <br/>\r\n * <br/>\r\n * Armature Display has a reference to a DragonBonesAsset and stores the state for ArmatureDisplay instance,\r\n * which consists of the current pose's bone SRT, slot colors, and which slot attachments are visible. <br/>\r\n * Multiple Armature Display can use the same DragonBonesAsset which includes all animations, skins, and attachments. <br/>\r\n * Cocos Creator supports DragonBones version to 5.6.300.\r\n * @zh\r\n * DragonBones 骨骼动画 <br/>\r\n * <br/>\r\n * Armature Display 具有对骨骼数据的引用并且存储了骨骼实例的状态，\r\n * 它由当前的骨骼动作，slot 颜色，和可见的 slot attachments 组成。<br/>\r\n * 多个 Armature Display 可以使用相同的骨骼数据，其中包括所有的动画，皮肤和 attachments。<br/>\r\n * Cocos Creator 支持 DragonBones 版本最高到 v5.6.300.\r\n *\r\n * @class ArmatureDisplay\r\n * @extends RenderComponent\r\n */\r\n@ccclass('dragonBones.ArmatureDisplay')\r\n@help('i18n:cc.DragonBones')\r\n@menu('DragonBones/ArmatureDisplay')\r\n@executeInEditMode\r\nexport class ArmatureDisplay extends UIRenderer {\r\n    static AnimationCacheMode = AnimationCacheMode;\r\n\r\n    /**\r\n     * @en\r\n     * The DragonBones data contains the armatures information (bind pose bones, slots, draw order,\r\n     * attachments, skins, etc) and animations but does not hold any state.<br/>\r\n     * Multiple ArmatureDisplay can share the same DragonBones data.\r\n     * @zh\r\n     * 骨骼数据包含了骨骼信息（绑定骨骼动作，slots，渲染顺序，\r\n     * attachments，皮肤等等）和动画但不持有任何状态。<br/>\r\n     * 多个 ArmatureDisplay 可以共用相同的骨骼数据。\r\n     * @property {DragonBonesAsset} dragonAsset\r\n     */\r\n    @editable\r\n    @type(DragonBonesAsset)\r\n    @tooltip('i18n:COMPONENT.dragon_bones.dragon_bones_asset')\r\n    get dragonAsset (): DragonBonesAsset | null {\r\n        return this._dragonAsset;\r\n    }\r\n    set dragonAsset (value) {\r\n        this._dragonAsset = value;\r\n        this.destroyRenderData();\r\n        this._refresh();\r\n        if (EDITOR_NOT_IN_PREVIEW) {\r\n            this._defaultArmatureIndex = 0;\r\n            this._animationIndex = 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The atlas asset for the DragonBones.\r\n     * @zh\r\n     * 骨骼数据所需的 Atlas Texture 数据。\r\n     * @property {DragonBonesAtlasAsset} dragonAtlasAsset\r\n     */\r\n    @editable\r\n    @type(DragonBonesAtlasAsset)\r\n    @tooltip('i18n:COMPONENT.dragon_bones.dragon_bones_atlas_asset')\r\n    get dragonAtlasAsset (): DragonBonesAtlasAsset | null { return this._dragonAtlasAsset; }\r\n    set dragonAtlasAsset (value) {\r\n        this._dragonAtlasAsset = value;\r\n        this._parseDragonAtlasAsset();\r\n        this._refresh();\r\n    }\r\n\r\n    /**\r\n     * @en The name of current armature.\r\n     * @zh 当前的 Armature 名称。\r\n     * @property {String} armatureName\r\n     */\r\n    @visible(false)\r\n    get armatureName (): string { return this._armatureName; }\r\n    set armatureName (name) {\r\n        this._armatureName = name;\r\n        const animNames = this.getAnimationNames(this._armatureName);\r\n\r\n        if (!this.animationName || animNames.indexOf(this.animationName) < 0) {\r\n            if (EDITOR_NOT_IN_PREVIEW) {\r\n                this.animationName = animNames[0];\r\n            } else {\r\n                // Not use default animation name at runtime\r\n                this.animationName = '';\r\n            }\r\n        }\r\n\r\n        if (this._armature && !this.isAnimationCached()) {\r\n            this._factory!._dragonBones.clock.remove(this._armature);\r\n        }\r\n\r\n        this._refresh();\r\n\r\n        if (this._armature && !this.isAnimationCached()) {\r\n            this._factory!._dragonBones.clock.add(this._armature);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en The name of current playing animation.\r\n     * @zh 当前播放的动画名称。\r\n     * @property {String} animationName\r\n     */\r\n    @visible(false)\r\n    get animationName (): string {\r\n        return this._animationName;\r\n    }\r\n    set animationName (value) {\r\n        this._animationName = value;\r\n    }\r\n\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    @displayName('Armature')\r\n    @editable\r\n    @type(DefaultArmaturesEnum)\r\n    @tooltip('i18n:COMPONENT.dragon_bones.armature_name')\r\n    get _defaultArmatureIndex (): DefaultArmaturesEnum {\r\n        return this._defaultArmatureIndexValue;\r\n    }\r\n    set _defaultArmatureIndex (value: DefaultArmaturesEnum) {\r\n        this._defaultArmatureIndexValue = value;\r\n        let armatureName = '';\r\n        if (this.dragonAsset) {\r\n            let armaturesEnum;\r\n            if (this.dragonAsset) {\r\n                armaturesEnum = this.dragonAsset.getArmatureEnum();\r\n            }\r\n            if (!armaturesEnum) {\r\n                errorID(7400, this.name);\r\n                return;\r\n            }\r\n\r\n            armatureName = armaturesEnum[this._defaultArmatureIndex];\r\n        }\r\n\r\n        if (armatureName !== undefined) {\r\n            this.armatureName = armatureName;\r\n        } else {\r\n            errorID(7401, this.name);\r\n        }\r\n        this._markForUpdateRenderData();\r\n    }\r\n\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    @editable\r\n    @type(DefaultAnimsEnum)\r\n    @displayName('Animation')\r\n    @tooltip('i18n:COMPONENT.dragon_bones.animation_name')\r\n    get _animationIndex (): DefaultAnimsEnum {\r\n        return this._animationIndexValue;\r\n    }\r\n    set _animationIndex (value) {\r\n        this._animationIndexValue = value;\r\n\r\n        if (this._animationIndex === 0) {\r\n            this.animationName = '';\r\n            return;\r\n        }\r\n\r\n        let animsEnum;\r\n        if (this.dragonAsset) {\r\n            animsEnum = this.dragonAsset.getAnimsEnum(this.armatureName);\r\n        }\r\n\r\n        if (!animsEnum) {\r\n            return;\r\n        }\r\n\r\n        const animName = animsEnum[this._animationIndex];\r\n        if (animName !== undefined) {\r\n            this.playAnimation(animName, this.playTimes);\r\n        } else {\r\n            errorID(7402, this.name);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    @editable\r\n    @displayName('Animation Cache Mode')\r\n    @tooltip('i18n:COMPONENT.dragon_bones.animation_cache_mode')\r\n    get _defaultCacheMode (): AnimationCacheMode { return this._defaultCacheModeValue; }\r\n    set _defaultCacheMode (value) {\r\n        this._defaultCacheModeValue = value;\r\n\r\n        if (this._defaultCacheMode !== AnimationCacheMode.REALTIME) {\r\n            if (this._armature && !ArmatureCache.canCache(this._armature)) {\r\n                this._defaultCacheMode = AnimationCacheMode.REALTIME;\r\n                warn('Animation cache mode doesn\\'t support skeletal nesting');\r\n                return;\r\n            }\r\n        }\r\n        this.setAnimationCacheMode(this._defaultCacheMode);\r\n    }\r\n    /**\r\n     * @en The time scale of this armature.\r\n     * @zh 当前骨骼中所有动画的时间缩放率。\r\n     * @property {Number} timeScale\r\n     * @default 1\r\n     */\r\n    @editable\r\n    @tooltip('i18n:COMPONENT.dragon_bones.time_scale')\r\n    @serializable\r\n    get timeScale (): number { return this._timeScale; }\r\n    set timeScale (value) {\r\n        this._timeScale = value;\r\n\r\n        if (this._armature && !this.isAnimationCached()) {\r\n            this._armature.animation.timeScale = this.timeScale;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en The play times of the default animation.\r\n     *      -1 means using the value of config file;\r\n     *      0 means repeat for ever\r\n     *      >0 means repeat times\r\n     * @zh 播放默认动画的循环次数\r\n     *      -1 表示使用配置文件中的默认值;\r\n     *      0 表示无限循环\r\n     *      >0 表示循环次数\r\n     * @property {Number} playTimes\r\n     * @default -1\r\n     */\r\n    @tooltip('i18n:COMPONENT.dragon_bones.play_times')\r\n    @editable\r\n    @serializable\r\n    public playTimes = -1;\r\n\r\n    /**\r\n     * @en Indicates whether to enable premultiplied alpha.\r\n     * You should disable this option when image's transparent area appears to have opaque pixels,\r\n     * or enable this option when image's half transparent area appears to be darken.\r\n     * @zh 是否启用贴图预乘。\r\n     * 当图片的透明区域出现色块时需要关闭该选项，当图片的半透明区域颜色变黑时需要启用该选项。\r\n     * @property {Boolean} premultipliedAlpha\r\n     * @default false\r\n     */\r\n    @serializable\r\n    @editable\r\n    @tooltip('i18n:COMPONENT.skeleton.premultipliedAlpha')\r\n    public premultipliedAlpha = false;\r\n\r\n    /**\r\n     * @en Indicates whether open debug bones.\r\n     * @zh 是否显示 bone 的 debug 信息。\r\n     * @property {Boolean} debugBones\r\n     * @default false\r\n     */\r\n    @tooltip('i18n:COMPONENT.dragon_bones.debug_bones')\r\n    @editable\r\n    get debugBones (): boolean { return this._debugBones; }\r\n    set debugBones (value) {\r\n        this._debugBones = value;\r\n        this._updateDebugDraw();\r\n    }\r\n\r\n    /**\r\n     * @en Enabled batch model. If rendering a large number of identical textures and simple\r\n     * skeleton animations, enabling batching can reduce the number of drawcalls and improve\r\n     * rendering efficiency, otherwise it is not necessary to enable it.\r\n     * @zh 开启合批。如果渲染大量相同纹理，且结构简单的龙骨动画，开启合批可以降低 drawcall 数量，\r\n     * 提升渲染效率，否则不需要开启。\r\n    */\r\n    @tooltip('i18n:COMPONENT.dragon_bones.enabled_batch')\r\n    @editable\r\n    get enableBatch (): boolean { return this._enableBatch; }\r\n    set enableBatch (value) {\r\n        if (value !== this._enableBatch) {\r\n            this._enableBatch = value;\r\n            this._updateBatch();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The bone sockets this animation component maintains.<br>\r\n     * Sockets have to be registered here before attaching custom nodes to animated bones.\r\n     * @zh\r\n     * 当前动画组件维护的挂点数组。要挂载自定义节点到受动画驱动的骨骼上，必须先在此注册挂点。\r\n     */\r\n    @type([DragonBoneSocket])\r\n    @tooltip('i18n:animation.sockets')\r\n    get sockets (): DragonBoneSocket[] {\r\n        return this._sockets;\r\n    }\r\n\r\n    set sockets (val: DragonBoneSocket[]) {\r\n        this._verifySockets(val);\r\n        this._sockets = val;\r\n        this._updateSocketBindings();\r\n        // this.attachUtil._syncAttachedNode();\r\n        if (val.length > 0 && this._frameCache) {\r\n            this._frameCache.enableCacheAttachedInfo();\r\n        }\r\n    }\r\n    /**\r\n     * @en Gets the socket nodes. Socket nodes are registered synchronous motion\r\n     * transformation with bones.\r\n     * @zh 获取 socket nodes，socket nodes 被注册到组件上，可以随骨骼做同步运动变换。\r\n     */\r\n    get socketNodes (): Map<string, Node> { return this._socketNodes; }\r\n    /**\r\n     * @en The armature is the core of the skeletal animation system.\r\n     * @zh 骨架是骨骼动画系统的核心。\r\n     */\r\n    _armature: Armature | null = null;\r\n    /**\r\n     * @en The tool for mounting functionality.\r\n     * @zh 挂载工具。\r\n     */\r\n    public attachUtil: AttachUtil;\r\n    /**\r\n     * @en Draw call list.\r\n     * @zh Draw call 列表。\r\n     */\r\n    get drawList (): RecyclePool<ArmatureDisplayDrawData> { return this._drawList; }\r\n    @serializable\r\n    protected _defaultArmatureIndexValue: DefaultArmaturesEnum = DefaultArmaturesEnum.default;\r\n    /**\r\n     * @en The skeleton data of dragonBones.\r\n     * @zh DragonBones 的骨骼数据。\r\n     */\r\n    @serializable\r\n    /* protected */ _dragonAsset: DragonBonesAsset | null = null;\r\n    /**\r\n     * @en The skeleton atlas data of dragonBones.\r\n     * @zh DragonBones 的骨骼纹理数据。\r\n     */\r\n    @serializable\r\n    /* protected */ _dragonAtlasAsset: DragonBonesAtlasAsset | null = null;\r\n    @serializable\r\n    /**\r\n     * @en The armature data name.\r\n     * @zh 骨架数据名称。\r\n     */\r\n    /* protected */ _armatureName = '';\r\n    @serializable\r\n    protected _animationName = '';\r\n    @serializable\r\n    protected _animationIndexValue: DefaultAnimsEnum = 0;\r\n    protected _preCacheMode = -1;\r\n    protected _cacheMode: AnimationCacheMode = AnimationCacheMode.REALTIME;\r\n    @serializable\r\n    protected _defaultCacheModeValue: AnimationCacheMode = AnimationCacheMode.REALTIME;\r\n    @serializable\r\n    protected _timeScale = 1;\r\n    @serializable\r\n    protected _playTimes = -1;\r\n\r\n    @serializable\r\n    protected _debugBones = false;\r\n\r\n    @serializable\r\n    protected _enableBatch = false;\r\n    /**\r\n     * @en The graphics component for debugging.\r\n     * @zh 用于调试的 Graphics 组件。\r\n     */\r\n    /* protected */ _debugDraw: Graphics | null = null;\r\n\r\n    // DragonBones data store key.\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    protected _armatureKey = '';\r\n\r\n    // Below properties will effect when cache mode is SHARED_CACHE or PRIVATE_CACHE.\r\n    // accumulate time\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    protected _accTime = 0;\r\n    // Play times counter\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    protected _playCount = 0;\r\n    // Frame cache\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    protected _frameCache: AnimationCache | null = null;\r\n    // Cur frame\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    public _curFrame: ArmatureFrame | null = null;\r\n    // Playing flag\r\n    protected _playing = false;\r\n    // Armature cache\r\n    protected _armatureCache: ArmatureCache | null = null;\r\n\r\n    protected _eventTarget: EventTarget;\r\n\r\n    protected _factory: CCFactory | null = null;\r\n\r\n    protected _displayProxy: CCArmatureDisplay | null = null;\r\n\r\n    protected _drawIdx = 0;\r\n    protected _drawList = new RecyclePool<ArmatureDisplayDrawData>((): ArmatureDisplayDrawData => ({\r\n        material: null,\r\n        texture: null,\r\n        indexOffset: 0,\r\n        indexCount: 0,\r\n    }), 1);\r\n    /**\r\n    * @engineInternal\r\n    */\r\n    public maxVertexCount = 0;\r\n    /**\r\n    * @engineInternal\r\n    */\r\n    public maxIndexCount = 0;\r\n\r\n    protected _materialCache: { [key: string]: MaterialInstance } = {};\r\n\r\n    protected _enumArmatures: any = Enum({});\r\n    protected _enumAnimations: any = Enum({});\r\n\r\n    protected _socketNodes = new Map<string, Node>();\r\n    protected _cachedSockets = new Map<string, BoneIndex>();\r\n\r\n    @serializable\r\n    protected _sockets: DragonBoneSocket[] = [];\r\n\r\n    private _inited;\r\n    private _drawInfoList: RenderDrawInfo[] = [];\r\n    private requestDrawInfo (idx: number): RenderDrawInfo {\r\n        if (!this._drawInfoList[idx]) {\r\n            this._drawInfoList[idx] = new RenderDrawInfo();\r\n        }\r\n        return this._drawInfoList[idx];\r\n    }\r\n\r\n    constructor () {\r\n        super();\r\n        // Property _materialCache Use to cache material,since dragonBones may use multiple texture,\r\n        // it will clone from the '_material' property,if the dragonbones only have one texture,\r\n        // it will just use the _material,won't clone it.\r\n        // So if invoke getMaterial,it only return _material,if you want to change all materialCache,\r\n        // you can change materialCache directly.\r\n        this._eventTarget = new EventTarget();\r\n        this._inited = false;\r\n        this.attachUtil = new AttachUtil();\r\n        this.initFactory();\r\n        setPropertyEnumType(this, '_animationIndex', this._enumAnimations);\r\n        setPropertyEnumType(this, '_defaultArmatureIndex', this._enumArmatures);\r\n        this._useVertexOpacity = true;\r\n    }\r\n    /**\r\n     * @en Initializes _factory from CCFactory, if golbal factory not exists, will create a new one.\r\n     * @zh 初始化变量 _factory，如果全局工厂实例不存在将新创建一个工厂实列对象。\r\n     */\r\n    initFactory (): void {\r\n        this._factory = CCFactory.getInstance();\r\n    }\r\n\r\n    onLoad (): void {\r\n        super.onLoad();\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    public _requestDrawData (material: Material, texture: Texture2D, indexOffset: number, indexCount: number): ArmatureDisplayDrawData {\r\n        const draw = this._drawList.add();\r\n        draw.material = material;\r\n        draw.texture = texture;\r\n        draw.indexOffset = indexOffset;\r\n        draw.indexCount = indexCount;\r\n        return draw;\r\n    }\r\n    /**\r\n     * @en\r\n     * Destroy render data，will be called when need to rebuild render data or component is destroyed.\r\n     * @zh\r\n     * 销毁渲染数据，一般在重新生成渲染数据时或销毁组件时调用。\r\n     */\r\n    public destroyRenderData (): void {\r\n        this._drawList.reset();\r\n        super.destroyRenderData();\r\n    }\r\n\r\n    private getMaterialTemplate (): Material {\r\n        if (this.customMaterial !== null) return this.customMaterial;\r\n        if (this.material) return this.material;\r\n        this.updateMaterial();\r\n        return this.material!;\r\n    }\r\n\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    public getMaterialForBlend (src: BlendFactor, dst: BlendFactor): MaterialInstance {\r\n        const key = `${src}/${dst}`;\r\n        let inst = this._materialCache[key];\r\n        if (inst) {\r\n            return inst;\r\n        }\r\n        const material = this.getMaterialTemplate();\r\n        const matInfo = {\r\n            parent: material,\r\n            subModelIdx: 0,\r\n            owner: this,\r\n        };\r\n\r\n        inst = new MaterialInstance(matInfo);\r\n        inst.recompileShaders({ TWO_COLORED: false, USE_LOCAL: false });\r\n        this._materialCache[key] = inst;\r\n        inst.overridePipelineStates({\r\n            blendState: {\r\n                targets: [{\r\n                    blendSrc: src, blendDst: dst,\r\n                }],\r\n            },\r\n        });\r\n        return inst;\r\n    }\r\n\r\n    protected _updateBuiltinMaterial (): Material {\r\n        const material = builtinResMgr.get<Material>('default-spine-material');\r\n        return material;\r\n    }\r\n\r\n    /**\r\n     * @en Custom material.\r\n     * @zh 自定义材质。\r\n     */\r\n    @override\r\n    @type(Material)\r\n    @displayOrder(0)\r\n    get customMaterial (): Material | null {\r\n        return this._customMaterial;\r\n    }\r\n    set customMaterial (val) {\r\n        this._customMaterial = val;\r\n        this.updateMaterial();\r\n        this._markForUpdateRenderData();\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    public override updateMaterial (): void {\r\n        let mat: Material;\r\n        if (this._customMaterial) mat = this._customMaterial;\r\n        else mat = this._updateBuiltinMaterial();\r\n        this.setSharedMaterial(mat, 0);\r\n        this._cleanMaterialCache();\r\n    }\r\n\r\n    protected _render (batcher: Batcher2D): void {\r\n        let indicesCount = 0;\r\n        if (this.renderData && this._drawList) {\r\n            const rd = this.renderData;\r\n            const chunk = rd.chunk;\r\n            const accessor = chunk.vertexAccessor;\r\n            const meshBuffer = rd.getMeshBuffer()!;\r\n            const origin = meshBuffer.indexOffset;\r\n            // Fill index buffer\r\n            for (let i = 0; i < this._drawList.length; i++) {\r\n                this._drawIdx = i;\r\n                const dc = this._drawList.data[i];\r\n                if (dc.texture) {\r\n                    batcher.commitMiddleware(\r\n                        this,\r\n                        meshBuffer,\r\n                        origin + dc.indexOffset,\r\n                        dc.indexCount,\r\n                        dc.texture,\r\n                        dc.material!,\r\n                        this._enableBatch,\r\n                    );\r\n                }\r\n                indicesCount += dc.indexCount;\r\n            }\r\n            const subIndices = rd.indices!.subarray(0, indicesCount);\r\n            accessor.appendIndices(chunk.bufferId, subIndices);\r\n        }\r\n    }\r\n\r\n    __preload (): void {\r\n        super.__preload();\r\n        this._init();\r\n    }\r\n    /**\r\n     * @en Initialize asset data and internal data within the component.\r\n     * @zh 初始化资产数据以及组件内部数据。\r\n     */\r\n    _init (): void {\r\n        if (EDITOR_NOT_IN_PREVIEW) {\r\n            this._objFlags |= (CCObjectFlags.IsAnchorLocked | CCObjectFlags.IsSizeLocked);\r\n            // this._refreshInspector();\r\n        }\r\n\r\n        this._cacheMode = this._defaultCacheMode;\r\n\r\n        if (this._inited) return;\r\n        this._inited = true;\r\n\r\n        // this._resetAssembler();\r\n        // this._activateMaterial();\r\n\r\n        this._parseDragonAtlasAsset();\r\n        this._refresh();\r\n\r\n        const children = this.node.children;\r\n        for (let i = 0, n = children.length; i < n; i++) {\r\n            const child = children[i];\r\n            if (child && child.name === 'DEBUG_DRAW_NODE') {\r\n                child.destroy();\r\n            }\r\n        }\r\n        this._updateDebugDraw();\r\n        this._indexBoneSockets();\r\n        this._updateSocketBindings();\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * The key of dragonbones cache data, which is regard as 'dragonbonesName', when you want to change dragonbones cloth.\r\n     * @zh\r\n     * 缓存龙骨数据的 key 值，换装的时会使用到该值，作为 'dragonbonesName' 使用。\r\n     * @method getArmatureKey\r\n     * @returns @en The key of dragonbones cache data. @zh 缓存龙骨数据的 key 值。\r\n     * @example\r\n     * let factory = dragonBones.CCFactory.getInstance();\r\n     * let needChangeSlot = needChangeArmature.armature().getSlot(\"changeSlotName\");\r\n     * factory.replaceSlotDisplay(toChangeArmature.getArmatureKey(), \"armatureName\", \"slotName\", \"displayName\", needChangeSlot);\r\n     */\r\n    getArmatureKey (): string {\r\n        return this._armatureKey;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * It's best to set cache mode before set property 'dragonAsset', or will waste some cpu time.\r\n     * If set the mode in editor, then no need to worry about order problem.\r\n     * @zh\r\n     * 若想切换渲染模式，最好在设置'dragonAsset'之前，先设置好渲染模式，否则有运行时开销。\r\n     * 若在编辑中设置渲染模式，则无需担心设置次序的问题。\r\n     *\r\n     * @method setAnimationCacheMode\r\n     * @param cacheMode\r\n     *      @en The value can be set to REALTIME, SHARED_CACHE, or PRIVATE_CACHE.\r\n     *      @zh 可以在 REALTIME，SHARED_CACHE，PRIVATE_CACHE 中取值。\r\n     * @example\r\n     * armatureDisplay.setAnimationCacheMode(dragonBones.ArmatureDisplay.AnimationCacheMode.SHARED_CACHE);\r\n     */\r\n    setAnimationCacheMode (cacheMode: AnimationCacheMode): void {\r\n        if (this._preCacheMode !== cacheMode) {\r\n            this._cacheMode = cacheMode;\r\n            this._buildArmature();\r\n            if (this._armature && !this.isAnimationCached()) {\r\n                this._factory!._dragonBones.clock.add(this._armature);\r\n            }\r\n            this._updateSocketBindings();\r\n            this._markForUpdateRenderData();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Whether in cached mode.\r\n     * @zh 当前是否处于缓存模式。\r\n     * @method isAnimationCached\r\n     * @returns @en True means animation mode is SHARED_CACHE or PRIVATE_CACHE.\r\n     *              False means animation mode is REALTIME.\r\n     *          @zh True 代表动画使用 SHARED_CACHE 或 PRIVATE_CACHE 模式。\r\n     *              False 代表动画使用 REALTIME 模式。\r\n     */\r\n    isAnimationCached (): boolean {\r\n        if (EDITOR_NOT_IN_PREVIEW) return false;\r\n        return this._cacheMode !== AnimationCacheMode.REALTIME;\r\n    }\r\n    /**\r\n     * @en Be called when the component state becomes available.\r\n     * Instance of ArmatureDisplay will be added into ArmatureSystem.\r\n     * @zh 组件状态变为可用时调用。ArmatureDisplay 实例将被添加到 ArmatureSystem。\r\n     */\r\n    onEnable (): void {\r\n        super.onEnable();\r\n        // If cache mode is cache, no need to update by dragonbones library.\r\n        if (this._armature && !this.isAnimationCached()) {\r\n            this._factory!._dragonBones.clock.add(this._armature);\r\n        }\r\n        this._flushAssembler();\r\n        ArmatureSystem.getInstance().add(this);\r\n    }\r\n    /**\r\n     * @en Be called when the component state becomes invalid.\r\n     * Instance of ArmatureDisplay will be removed from ArmatureSystem.\r\n     * @zh 组件状态变为不可用时调用。ArmatureDisplay 实例将被从 ArmatureSystem 移除。\r\n     */\r\n    onDisable (): void {\r\n        super.onDisable();\r\n        // If cache mode is cache, no need to update by dragonbones library.\r\n        if (this._armature && !this.isAnimationCached()) {\r\n            this._factory!._dragonBones.clock.remove(this._armature);\r\n        }\r\n        ArmatureSystem.getInstance().remove(this);\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _emitCacheCompleteEvent (): void {\r\n        // Animation loop complete, the event diffrent from dragonbones inner event,\r\n        // It has no event object.\r\n        this._eventTarget.emit(EventObject.LOOP_COMPLETE);\r\n\r\n        // Animation complete the event diffrent from dragonbones inner event,\r\n        // It has no event object.\r\n        this._eventTarget.emit(EventObject.COMPLETE);\r\n    }\r\n    /**\r\n     * @en Update animation frame.\r\n     * @zh 更新动画序列。\r\n     * @param dt @en Delta time, unit is second. @zh 时间差，单位为秒。\r\n     */\r\n    updateAnimation (dt): void {\r\n        this._markForUpdateRenderData();\r\n        if (!this.isAnimationCached()) return;\r\n        if (!this._frameCache) return;\r\n\r\n        const frameCache = this._frameCache;\r\n        if (!frameCache.isInited()) {\r\n            return;\r\n        }\r\n\r\n        const frames = frameCache.frames;\r\n        if (!this._playing) {\r\n            if (frameCache.isInvalid()) {\r\n                frameCache.updateToFrame();\r\n                this._curFrame = frames[frames.length - 1]!;\r\n                // Update render data size if needed\r\n                if (this.renderData\r\n                    && (this.renderData.vertexCount < frameCache.maxVertexCount\r\n                    || this.renderData.indexCount < frameCache.maxIndexCount)) {\r\n                    this.maxVertexCount = frameCache.maxVertexCount > this.maxVertexCount ? frameCache.maxVertexCount : this.maxVertexCount;\r\n                    this.maxIndexCount = frameCache.maxIndexCount > this.maxIndexCount ? frameCache.maxIndexCount : this.maxIndexCount;\r\n                    this.renderData.resize(this.maxVertexCount, this.maxIndexCount);\r\n                    if (!this.renderData.indices || this.maxIndexCount > this.renderData.indices.length) {\r\n                        this.renderData.indices = new Uint16Array(this.maxIndexCount);\r\n                    }\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        const frameTime = ArmatureCache.FrameTime;\r\n\r\n        // Animation Start, the event different from dragonbones inner event,\r\n        // It has no event object.\r\n        if (this._accTime === 0 && this._playCount === 0) {\r\n            this._eventTarget.emit(EventObject.START);\r\n        }\r\n\r\n        const globalTimeScale = timeScale;\r\n        this._accTime += dt * this.timeScale * globalTimeScale;\r\n        let frameIdx = Math.floor(this._accTime / frameTime);\r\n        if (!frameCache.isCompleted) {\r\n            frameCache.updateToFrame(frameIdx);\r\n            // Update render data size if needed\r\n            if (this.renderData\r\n                && (this.renderData.vertexCount < frameCache.maxVertexCount\r\n                || this.renderData.indexCount < frameCache.maxIndexCount)) {\r\n                this.maxVertexCount = frameCache.maxVertexCount > this.maxVertexCount ? frameCache.maxVertexCount : this.maxVertexCount;\r\n                this.maxIndexCount = frameCache.maxIndexCount > this.maxIndexCount ? frameCache.maxIndexCount : this.maxIndexCount;\r\n                this.renderData.resize(this.maxVertexCount, this.maxIndexCount);\r\n                if (!this.renderData.indices || this.maxIndexCount > this.renderData.indices.length) {\r\n                    this.renderData.indices = new Uint16Array(this.maxIndexCount);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (frameCache.isCompleted && frameIdx >= frames.length) {\r\n            this._playCount++;\r\n            if ((this.playTimes > 0 && this._playCount >= this.playTimes)) {\r\n                // set frame to end frame.\r\n                this._curFrame = frames[frames.length - 1]!;\r\n                this._accTime = 0;\r\n                this._playing = false;\r\n                this._playCount = 0;\r\n                this._emitCacheCompleteEvent();\r\n                this.attachUtil._syncAttachedNode();\r\n                return;\r\n            }\r\n            this._accTime = 0;\r\n            frameIdx = 0;\r\n            this._emitCacheCompleteEvent();\r\n        }\r\n\r\n        this._curFrame = frames[frameIdx]!;\r\n        this.attachUtil._syncAttachedNode();\r\n    }\r\n    /**\r\n     * @en Destroy component, release resource.\r\n     * @zh 销毁组件时调用，释放相关资源。\r\n     */\r\n    onDestroy (): void {\r\n        this._materialInstances = this._materialInstances.filter((instance): boolean => !!instance);\r\n        this._inited = false;\r\n\r\n        if (!EDITOR_NOT_IN_PREVIEW) {\r\n            if (this._cacheMode === AnimationCacheMode.PRIVATE_CACHE) {\r\n                this._armatureCache!.dispose();\r\n                this._armatureCache = null;\r\n                this._armature = null;\r\n            } else if (this._cacheMode === AnimationCacheMode.SHARED_CACHE) {\r\n                this._armatureCache = null;\r\n                this._armature = null;\r\n            } else if (this._armature) {\r\n                this._armature.dispose();\r\n                this._armature = null;\r\n            }\r\n        } else if (this._armature) {\r\n            this._armature.dispose();\r\n            this._armature = null;\r\n        }\r\n        this._drawList.destroy();\r\n        super.onDestroy();\r\n    }\r\n    /**\r\n     * @en Update the debugging component show.\r\n     * @zh 更新调试 Graphic 组件的显示。\r\n     */\r\n    _updateDebugDraw (): void {\r\n        if (this.debugBones) {\r\n            if (!this._debugDraw) {\r\n                let debugDrawNode: Node | null = new Node('DEBUG_DRAW_NODE');\r\n                debugDrawNode.hideFlags |= CCObjectFlags.DontSave | CCObjectFlags.HideInHierarchy;\r\n                let debugDraw: Graphics | undefined;\r\n                try {\r\n                    debugDraw = debugDrawNode.addComponent('cc.Graphics') as Graphics;\r\n                    debugDraw.lineWidth = 1;\r\n                    debugDraw.strokeColor = new Color(255, 0, 0, 255);\r\n\r\n                    this._debugDraw = debugDraw;\r\n                    this._debugDraw.node.parent = this.node;\r\n                } catch (e: any) {\r\n                    errorID(4501, e.message as string);\r\n                    debugDrawNode.destroy();\r\n                    debugDrawNode = null;\r\n                }\r\n            }\r\n        } else if (this._debugDraw) {\r\n            this._debugDraw.node.parent = null;\r\n        }\r\n        this._markForUpdateRenderData();\r\n    }\r\n    /**\r\n     * @en Update related data due to batching settings.\r\n     * @zh 更新由于合批设置导致的相关数据。\r\n     */\r\n    protected _updateBatch (): void {\r\n        this._cleanMaterialCache();\r\n        this._markForUpdateRenderData();\r\n    }\r\n    /**\r\n     * @en Building data of armature.\r\n     * @zh 构建骨架数据。\r\n     */\r\n    _buildArmature (): void {\r\n        if (!this.dragonAsset || !this.dragonAtlasAsset || !this.armatureName) return;\r\n\r\n        // Switch Asset or Atlas or cacheMode will rebuild armature.\r\n        if (this._armature) {\r\n            // dispose pre build armature\r\n            if (!EDITOR_NOT_IN_PREVIEW) {\r\n                if (this._preCacheMode === AnimationCacheMode.PRIVATE_CACHE) {\r\n                    this._armatureCache!.dispose();\r\n                } else if (this._preCacheMode === AnimationCacheMode.REALTIME) {\r\n                    this._armature.dispose();\r\n                }\r\n            } else {\r\n                this._armature.dispose();\r\n            }\r\n\r\n            this._armatureCache = null;\r\n            this._armature = null;\r\n            this._displayProxy = null;\r\n            this._frameCache = null;\r\n            this._curFrame = null;\r\n            this._playing = false;\r\n            this._preCacheMode = -1;\r\n        }\r\n\r\n        if (!EDITOR_NOT_IN_PREVIEW) {\r\n            if (this._cacheMode === AnimationCacheMode.SHARED_CACHE) {\r\n                this._armatureCache = ArmatureCache.sharedCache;\r\n            } else if (this._cacheMode === AnimationCacheMode.PRIVATE_CACHE) {\r\n                this._armatureCache = new ArmatureCache();\r\n                this._armatureCache.enablePrivateMode();\r\n            }\r\n        }\r\n\r\n        const atlasUUID = this.dragonAtlasAsset._uuid;\r\n        this._armatureKey = this.dragonAsset.init(this._factory!, atlasUUID);\r\n\r\n        if (this.isAnimationCached()) {\r\n            this._armature = this._armatureCache!.getArmatureCache(this.armatureName, this._armatureKey, atlasUUID);\r\n            if (!this._armature) {\r\n                // Cache fail,swith to REALTIME cache mode.\r\n                this._cacheMode = AnimationCacheMode.REALTIME;\r\n            }\r\n        }\r\n\r\n        this._preCacheMode = this._cacheMode;\r\n        if (EDITOR_NOT_IN_PREVIEW || this._cacheMode === AnimationCacheMode.REALTIME) {\r\n            this._displayProxy = this._factory!.buildArmatureDisplay(this.armatureName, this._armatureKey, '', atlasUUID) as CCArmatureDisplay;\r\n            if (!this._displayProxy) return;\r\n            this._displayProxy._ccNode = this.node;\r\n            this._displayProxy._ccComponent = this;\r\n            this._displayProxy.setEventTarget(this._eventTarget);\r\n            this._armature = this._displayProxy._armature;\r\n            this._armature!.animation.timeScale = this.timeScale;\r\n            // If change mode or armature, armature must insert into clock.\r\n            // this._factory._dragonBones.clock.add(this._armature);\r\n        }\r\n\r\n        if (this._cacheMode !== AnimationCacheMode.REALTIME && this.debugBones) {\r\n            warn('Debug bones is invalid in cached mode');\r\n        }\r\n\r\n        if (this._armature) {\r\n            const armatureData = this._armature.armatureData;\r\n            const aabb = armatureData.aabb;\r\n            this.node._getUITransformComp()!.setContentSize(aabb.width, aabb.height);\r\n        }\r\n        this.attachUtil.init(this);\r\n\r\n        if (this.animationName) {\r\n            this.playAnimation(this.animationName, this.playTimes);\r\n        }\r\n        this._flushAssembler();\r\n    }\r\n    /**\r\n     * @en Gets sockets binding on this component.\r\n     * @zh 获取绑定在本组件上的socket。\r\n     */\r\n    public querySockets (): string[] {\r\n        if (!this._armature) {\r\n            return [];\r\n        }\r\n        if (this._cachedSockets.size === 0) {\r\n            this._indexBoneSockets();\r\n        }\r\n        return Array.from(this._cachedSockets.keys()).sort();\r\n    }\r\n\r\n    /**\r\n     * @en Query socket path with slot or bone name.\r\n     * @zh 查询 Socket 路径。\r\n     * @param name @en Slot name or Bone name. @zh 插槽或骨骼名称。\r\n     */\r\n    public querySocketPathByName (name: string): string[] {\r\n        const ret: string[] = [];\r\n        for (const key of this._cachedSockets.keys()) {\r\n            if (key.endsWith(name)) {\r\n                ret.push(key);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _parseDragonAtlasAsset (): void {\r\n        if (this.dragonAtlasAsset) {\r\n            this.dragonAtlasAsset.init(this._factory!);\r\n        }\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _refresh (): void {\r\n        this._buildArmature();\r\n        this._indexBoneSockets();\r\n        if (EDITOR_NOT_IN_PREVIEW) {\r\n            // update inspector\r\n            this._updateArmatureEnum();\r\n            this._updateAnimEnum();\r\n            this._updateCacheModeEnum();\r\n            // Editor.Utils.refreshSelectedInspector('node', this.node.uuid);\r\n        }\r\n        this._markForUpdateRenderData();\r\n    }\r\n\r\n    private _cacheModeEnum: any;\r\n    // EDITOR\r\n    _updateCacheModeEnum (): void {\r\n        this._cacheModeEnum = Enum({});\r\n        if (this._armature) {\r\n            Object.assign(this._cacheModeEnum, AnimationCacheMode);\r\n        } else {\r\n            Object.assign(this._cacheModeEnum, DefaultCacheMode);\r\n        }\r\n        setPropertyEnumType(this, '_defaultCacheMode', this._cacheModeEnum);\r\n    }\r\n\r\n    // update animation list for editor\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _updateAnimEnum (): void {\r\n        let animEnum;\r\n        if (this.dragonAsset) {\r\n            animEnum = this.dragonAsset.getAnimsEnum(this.armatureName);\r\n        } else {\r\n            animEnum = DefaultAnimsEnum;\r\n        }\r\n\r\n        this._enumAnimations = Enum({});\r\n        Object.assign(this._enumAnimations, animEnum || DefaultAnimsEnum);\r\n        Enum.update(this._enumAnimations);\r\n        // change enum\r\n        setPropertyEnumType(this, '_animationIndex', this._enumAnimations);\r\n    }\r\n\r\n    // update armature list for editor\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _updateArmatureEnum (): void {\r\n        let armatureEnum;\r\n        if (this.dragonAsset) {\r\n            armatureEnum = this.dragonAsset.getArmatureEnum();\r\n        } else {\r\n            armatureEnum = DefaultArmaturesEnum;\r\n        }\r\n\r\n        this._enumArmatures = Enum({});\r\n        Object.assign(this._enumArmatures, armatureEnum || DefaultArmaturesEnum);\r\n        Enum.update(this._enumArmatures);\r\n        // change enum\r\n        setPropertyEnumType(this, '_defaultArmatureIndex', this._enumArmatures);\r\n    }\r\n    /**\r\n     * @engineInternal Since v3.7.2 this is an engine private function.\r\n     */\r\n    _indexBoneSockets (): void {\r\n        if (!this._armature) {\r\n            return;\r\n        }\r\n        this._cachedSockets.clear();\r\n        const nameToBone = this._cachedSockets;\r\n        const cacheBoneName = (bi: BoneIndex, bones: Bone[], cache: Map<BoneIndex, string>): string => {\r\n            if (cache.has(bi)) { return cache.get(bi)!; }\r\n            const bone = bones[bi as unknown as number];\r\n            if (!bone.parent) {\r\n                cache.set(bi, bone.name);\r\n                (bone as any).path = bone.name;\r\n                return bone.name;\r\n            }\r\n            const name = `${cacheBoneName((bone.parent as any)._boneIndex, bones, cache)}/${bone.name}`;\r\n            cache.set(bi, name);\r\n            (bone as any).path = name;\r\n            return name;\r\n        };\r\n        const walkArmature = (prefix: string, armature: Armature): void => {\r\n            const bones = armature.getBones();\r\n            const boneToName = new Map<BoneIndex, string>();\r\n            for (let i = 0; i < bones.length; i++) {\r\n                (bones[i] as any)._boneIndex = i;\r\n            }\r\n            for (let i = 0; i < bones.length; i++) {\r\n                cacheBoneName(i as unknown as BoneIndex, bones, boneToName);\r\n            }\r\n            for (const bone of boneToName.keys()) {\r\n                nameToBone.set(`${prefix}${boneToName.get(bone)!}`, bone);\r\n            }\r\n            const slots = armature.getSlots();\r\n            for (let i = 0; i < slots.length; i++) {\r\n                if (slots[i].childArmature) {\r\n                    walkArmature(slots[i].name, slots[i].childArmature!);\r\n                }\r\n            }\r\n        };\r\n        walkArmature('', this._armature);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Play the specified animation.\r\n     * Parameter animName specify the animation name.\r\n     * Parameter playTimes specify the repeat times of the animation.\r\n     * -1 means use the value of the config file.\r\n     * 0 means play the animation for ever.\r\n     * >0 means repeat times.\r\n     * @zh\r\n     * 播放指定的动画.\r\n     * animName 指定播放动画的名称。\r\n     * playTimes 指定播放动画的次数。\r\n     * -1 为使用配置文件中的次数。\r\n     * 0 为无限循环播放。\r\n     * >0 为动画的重复次数。\r\n     */\r\n    playAnimation (animName: string, playTimes?: number): AnimationState | null {\r\n        this.playTimes = (playTimes === undefined) ? -1 : playTimes;\r\n        this.animationName = animName;\r\n\r\n        if (this.isAnimationCached()) {\r\n            let cache = this._armatureCache!.getAnimationCache(this._armatureKey, animName);\r\n            if (!cache) {\r\n                cache = this._armatureCache!.initAnimationCache(this._armatureKey, animName);\r\n            }\r\n            if (cache) {\r\n                this._accTime = 0;\r\n                this._playCount = 0;\r\n                this._frameCache = cache;\r\n                if (this._sockets.length > 0) {\r\n                    this._frameCache.enableCacheAttachedInfo();\r\n                }\r\n                this._frameCache.updateToFrame(0);\r\n                this._playing = true;\r\n                this._curFrame = this._frameCache.frames[0]!;\r\n            }\r\n        } else if (this._armature) {\r\n            return this._armature.animation.play(animName, this.playTimes);\r\n        }\r\n        this._markForUpdateRenderData();\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Updating an animation cache to calculate all frame data in the animation is a cost in\r\n     * performance due to calculating all data in a single frame.\r\n     * To update the cache, use the invalidAnimationCache method with high performance.\r\n     * @zh\r\n     * 更新某个动画缓存, 预计算动画中所有帧数据，由于在单帧计算所有数据，所以较消耗性能。\r\n     * 若想更新缓存，可使用 invalidAnimationCache 方法，具有较高性能。\r\n     * @method updateAnimationCache\r\n     * @param animName @en Animation's name. @zh 动画名称。\r\n     */\r\n    updateAnimationCache (animName: string): void {\r\n        if (!this.isAnimationCached()) return;\r\n        this._armatureCache!.updateAnimationCache(this._armatureKey, animName);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Invalidates the animation cache, which is then recomputed on each frame.\r\n     * @zh\r\n     * 使动画缓存失效，之后会在每帧重新计算。\r\n     * @method invalidAnimationCache\r\n     */\r\n    invalidAnimationCache (): void {\r\n        if (!this.isAnimationCached()) return;\r\n        this._armatureCache!.invalidAnimationCache(this._armatureKey);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Get the all armature names in the DragonBones Data.\r\n     * @zh\r\n     * 获取 DragonBones 数据中所有的 armature 名称。\r\n     * @method getArmatureNames\r\n     * @returns @en Return an array of armature names. @zh 返回 armature 名称数组。\r\n     */\r\n    getArmatureNames (): string[] {\r\n        const dragonBonesData = this._factory!.getDragonBonesData(this._armatureKey);\r\n        return (dragonBonesData && dragonBonesData.armatureNames) || [];\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Get the all animation names of specified armature.\r\n     * @zh\r\n     * 获取指定的 armature 的所有动画名称。\r\n     * @method getAnimationNames\r\n     * @param armatureName @en The name of armature. @zh Armature 名称。\r\n     * @returns @en Return an array of all animation names.\r\n     *          @zh 返回包含所有动画名称的数组。\r\n     */\r\n    getAnimationNames (armatureName: string): string[] {\r\n        const ret: string[] = [];\r\n        const dragonBonesData = this._factory!.getDragonBonesData(this._armatureKey);\r\n        if (dragonBonesData) {\r\n            const armatureData = dragonBonesData.getArmature(armatureName);\r\n            if (armatureData) {\r\n                for (const animName in armatureData.animations) {\r\n                    // eslint-disable-next-line no-prototype-builtins\r\n                    if (armatureData.animations.hasOwnProperty(animName)) {\r\n                        ret.push(animName);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Add event listener for the DragonBones Event, the same to addEventListener.\r\n     * @zh\r\n     * 添加 DragonBones 事件监听器，与 addEventListener 作用相同。\r\n     * @method on\r\n     * @param eventType @en A string representing the event type to listen for.\r\n     *                  @zh 用于表示监听事件类型的字符串。\r\n     * @param listener  @en The callback that will be invoked when the event is dispatched.\r\n     *                  @zh 事件派发时的回调。\r\n     * @param target    @en The target (this object) to invoke the callback, can be null.\r\n     *                  @zh 调用回调函数的对象，可以为 null。\r\n     */\r\n    on (eventType: string, listener, target): void {\r\n        this.addEventListener(eventType, listener, target);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Remove the event listener for the DragonBones Event, the same to removeEventListener.\r\n     * @zh\r\n     * 移除 DragonBones 事件监听器，与 removeEventListener 作用相同。\r\n     * @method off\r\n     * @param eventType @en A string representing the event type to listen for.\r\n     *                  @zh 用于表示监听事件类型的字符串。\r\n     * @param listener  @en The callback that will be invoked when the event is dispatched.\r\n     *                  @zh 事件派发时的回调。\r\n     * @param target    @en The target (this object) to invoke the callback, can be null.\r\n     *                  @zh 调用回调函数的对象，可以为 null。\r\n     */\r\n    off (eventType: string, listener, target): void {\r\n        this.removeEventListener(eventType, listener, target);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Add DragonBones one-time event listener, the callback will remove itself after the first time it is triggered.\r\n     * @zh\r\n     * 添加 DragonBones 一次性事件监听器，回调会在第一时间被触发后删除自身。\r\n     * @method once\r\n     * @param eventType @en A string representing the event type to listen for.\r\n     *                  @zh 用于表示监听事件类型的字符串。\r\n     * @param listener  @en The callback that will be invoked when the event is dispatched.\r\n     *                  @zh 事件派发时的回调。\r\n     * @param target    @en The target (this object) to invoke the callback, can be null.\r\n     *                  @zh 调用回调函数的对象，可以为 null。\r\n     */\r\n    once (eventType: string, listener, target): void {\r\n        this._eventTarget.once(eventType, listener, target);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Add event listener for the DragonBones Event.\r\n     * @zh\r\n     * 添加 DragonBones 事件监听器。\r\n     * @method addEventListener\r\n     * @param eventType @en A string representing the event type to listen for.\r\n     *                  @zh 用于表示监听事件类型的字符串。\r\n     * @param listener  @en The callback that will be invoked when the event is dispatched.\r\n     *                  @zh 事件派发时的回调。\r\n     * @param target    @en The target (this object) to invoke the callback, can be null.\r\n     *                  @zh 调用回调函数的对象，可以为 null。\r\n     */\r\n    addEventListener (eventType, listener, target): void {\r\n        this._eventTarget.on(eventType, listener, target);\r\n    }\r\n\r\n    /**\r\n     * @en Remove the event listener for the DragonBones Event.\r\n     * @zh 移除 DragonBones 事件监听器。\r\n     * @method removeEventListener\r\n     * @param eventType @en A string representing the event type to listen for.\r\n     *                  @zh 用于表示监听事件类型的字符串。\r\n     * @param listener  @en The callback that will be invoked when the event is dispatched.\r\n     *                  @zh 事件派发时的回调。\r\n     * @param target    @en The target (this object) to invoke the callback, can be null.\r\n     *                  @zh 调用回调函数的对象，可以为 null。\r\n     */\r\n    removeEventListener (eventType, listener, target): void {\r\n        this._eventTarget.off(eventType, listener, target);\r\n    }\r\n\r\n    /**\r\n     * @en Build the armature for specified name.\r\n     * @zh 构建指定名称的 armature 对象。\r\n     * @method buildArmature\r\n     * @param armatureName @en The name of armature. @zh Armature 名称。\r\n     * @param node @en The node contains ArmatureDisplay component.\r\n     *             @zh 承载 ArmatureDisplay 组件的 node。\r\n     * @returns @en Return a new ArmatureDisplay component.\r\n     *          @zh 返回一个新创建的 ArmatureDisplay 组件。\r\n     */\r\n    buildArmature (armatureName: string, node?: Node): ArmatureDisplay {\r\n        return this._factory!.createArmatureNode(this, armatureName, node);\r\n    }\r\n\r\n    /**\r\n     * @en\r\n     * Get the current armature object of the ArmatureDisplay.\r\n     * @zh\r\n     * 获取 ArmatureDisplay 当前使用的 Armature 对象。\r\n     * @method armature\r\n     * @returns @en Return the armature object. @zh 返回 armature 对象。\r\n     */\r\n    armature (): Armature | null {\r\n        return this._armature;\r\n    }\r\n\r\n    protected _flushAssembler (): void {\r\n        const assembler = ArmatureDisplay.Assembler.getAssembler(this);\r\n        if (this._assembler !== assembler) {\r\n            this._assembler = assembler;\r\n        }\r\n        if (this._armature && this._assembler) {\r\n            this._renderData = this._assembler.createData!(this) as RenderData;\r\n            if (this._renderData) {\r\n                this.maxVertexCount = this._renderData.vertexCount;\r\n                this.maxIndexCount = this._renderData.indexCount;\r\n            }\r\n            this._markForUpdateRenderData();\r\n            this._updateColor();\r\n        }\r\n    }\r\n\r\n    protected _updateSocketBindings (): void {\r\n        if (!this._armature) return;\r\n        this._socketNodes.clear();\r\n        for (let i = 0, l = this._sockets.length; i < l; i++) {\r\n            const socket = this._sockets[i];\r\n            if (socket.path && socket.target) {\r\n                const bone = this._cachedSockets.get(socket.path);\r\n                if (!bone) {\r\n                    console.error(`Skeleton data does not contain path ${socket.path}`);\r\n                    continue;\r\n                }\r\n                socket.boneIndex = bone as unknown as number;\r\n                this._socketNodes.set(socket.path, socket.target);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _verifySockets (sockets: DragonBoneSocket[]): void {\r\n        for (let i = 0, l = sockets.length; i < l; i++) {\r\n            const target = sockets[i].target;\r\n            if (target) {\r\n                if (!target.parent || (target.parent !== this.node)) {\r\n                    console.error(`Target node ${target.name} is expected to be a direct child of ${this.node.name}`);\r\n                    continue;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _cleanMaterialCache (): void {\r\n        for (const val in this._materialCache) {\r\n            this._materialCache[val].destroy();\r\n        }\r\n        this._materialCache = {};\r\n    }\r\n\r\n    protected createRenderEntity (): RenderEntity {\r\n        const renderEntity = new RenderEntity(RenderEntityType.DYNAMIC);\r\n        renderEntity.setUseLocal(false);\r\n        return renderEntity;\r\n    }\r\n    /**\r\n     * @en Sets flag for update render data.\r\n     * @zh 标记组件渲染数据更新。\r\n     */\r\n    public markForUpdateRenderData (enable = true): void {\r\n        super._markForUpdateRenderData(enable);\r\n        if (this._debugDraw) {\r\n            this._debugDraw._markForUpdateRenderData(enable);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @engineInternal since v3.7.2 this is an engine private function.\r\n     */\r\n    public syncAttachedNode (): void {\r\n        // sync attached node matrix\r\n        this.attachUtil._syncAttachedNode();\r\n    }\r\n}\r\n\r\ncclegacy.internal.ArmatureDisplay = ArmatureDisplay;\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { Armature, BlendMode } from '@cocos/dragonbones-js';\r\nimport { Color, Mat4, Vec3, cclegacy } from '../../core';\r\nimport { BlendFactor } from '../../gfx';\r\nimport { vfmtPosUvColor } from '../../2d/renderer/vertex-format';\r\nimport { MaterialInstance } from '../../render-scene/core/material-instance';\r\nimport type { IAssembler } from '../../2d/renderer/base';\r\nimport { ArmatureFrame } from '../ArmatureCache';\r\nimport { ArmatureDisplay } from '../ArmatureDisplay';\r\nimport { CCSlot } from '../CCSlot';\r\nimport { StaticVBAccessor } from '../../2d/renderer/static-vb-accessor';\r\nimport { RenderData } from '../../2d/renderer/render-data';\r\nimport type { Texture2D } from '../../asset/assets';\r\nimport type { TextureBase } from '../../asset/assets/texture-base';\r\nimport type { Node } from '../../scene-graph';\r\nimport { director } from '../../game';\r\nimport type { IBatcher } from '../../2d/renderer/i-batcher';\r\n\r\nconst NEED_COLOR = 0x01;\r\nconst NEED_BATCH = 0x10;\r\n\r\nconst _boneColor = new Color(255, 0, 0, 255);\r\nconst _slotColor = new Color(0, 0, 255, 255);\r\nconst _originColor = new Color(0, 255, 0, 255);\r\n\r\n/** node R [0,1] */\r\nlet _nodeR: number;\r\n/** node G [0,1] */\r\nlet _nodeG: number;\r\n/** node B [0,1] */\r\nlet _nodeB: number;\r\n/** node alpha [0,1] */\r\nlet _nodeA: number;\r\n\r\nlet _premultipliedAlpha: boolean;\r\nlet _multiply: number;\r\nlet _mustFlush: boolean;\r\nlet _renderData: RenderData | null;\r\nlet _ibuf: Uint16Array;\r\nlet _vbuf: Float32Array;\r\nlet _node: Node | undefined;\r\nlet _comp: ArmatureDisplay | undefined;\r\nlet _vertexFloatCount = 0;\r\nlet _vertexCount = 0;\r\nlet _vertexOffset = 0;\r\nlet _vertexFloatOffset = 0;\r\nlet _indexCount = 0;\r\nlet _indexOffset = 0;\r\nlet _actualVCount = 0;\r\nlet _actualICount = 0;\r\nlet _prevDrawIndexOffset = 0;\r\nconst LOCAL_FLOAT_PER_VERTEX  = 4; //xyuv\r\nconst PER_VERTEX_SIZE = 3 + 2 + 4; //xyz-uv-rgba;\r\n\r\nconst _c = new Float32Array(4);\r\nlet _handleVal: number;\r\nconst _tempVecPos = new Vec3(0, 0, 0);\r\nconst _slotMat = new Mat4();\r\n\r\nlet _currentMaterial: MaterialInstance | null = null;\r\nlet _currentTexture: Texture2D | null = null;\r\n\r\nfunction _getSlotMaterial (tex: TextureBase | null, blendMode: BlendMode): MaterialInstance | null {\r\n    if (!tex) return null;\r\n\r\n    let src: BlendFactor;\r\n    let dst: BlendFactor;\r\n    switch (blendMode) {\r\n    case 1:// additive\r\n        src = _premultipliedAlpha ? BlendFactor.ONE : BlendFactor.SRC_ALPHA;\r\n        dst = BlendFactor.ONE;\r\n        break;\r\n    case 10:// multiply\r\n        src = BlendFactor.DST_COLOR;\r\n        dst = BlendFactor.ONE_MINUS_SRC_ALPHA;\r\n        break;\r\n    case 12:// screen\r\n        src = BlendFactor.ONE;\r\n        dst = BlendFactor.ONE_MINUS_SRC_COLOR;\r\n        break;\r\n    case 0:// normal\r\n    default:\r\n        src = _premultipliedAlpha ? BlendFactor.ONE : BlendFactor.SRC_ALPHA;\r\n        dst = BlendFactor.ONE_MINUS_SRC_ALPHA;\r\n        break;\r\n    }\r\n    return _comp!.getMaterialForBlend(src, dst);\r\n}\r\n\r\nfunction _handleColor (color: {r: number, g: number, b: number, a: number}, parentOpacity: number): void {\r\n    const _a = color.a * parentOpacity * _nodeA;\r\n    const _multiply = _premultipliedAlpha ? _a / 255.0 : 1.0;\r\n    const _r = color.r * _nodeR * _multiply / 255.0;\r\n    const _g = color.g * _nodeG * _multiply / 255.0;\r\n    const _b = color.b * _nodeB * _multiply / 255.0;\r\n    _c[0] = _r;\r\n    _c[1] = _g;\r\n    _c[2] = _b;\r\n    _c[3] = _premultipliedAlpha ? 1.0 : _a / 255.0;\r\n}\r\n\r\nlet _accessor: StaticVBAccessor = null!;\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private object.\r\n * simple 组装器\r\n * 可通过 `UI.simple` 获取该组装器。\r\n */\r\nclass Simple implements IAssembler {\r\n    private accessor = _accessor;\r\n    private vCount = 32767;\r\n    ensureAccessor (): StaticVBAccessor {\r\n        if (!_accessor) {\r\n            const device = director.root!.device;\r\n            const batcher = director.root!.batcher2D;\r\n            const attributes = vfmtPosUvColor;\r\n            this.accessor = _accessor = new StaticVBAccessor(device, attributes, this.vCount);\r\n            // Register to batcher so that batcher can upload buffers after batching process\r\n            batcher.registerBufferAccessor(Number.parseInt('DRAGONBONES', 36), _accessor);\r\n        }\r\n        return this.accessor;\r\n    }\r\n\r\n    createData (comp: ArmatureDisplay): RenderData {\r\n        let rd = comp.renderData;\r\n        if (!rd) {\r\n            this.ensureAccessor();\r\n            const slots = comp._armature!._slots;\r\n            let vCount = 0;\r\n            let iCount = 0;\r\n            for (let i = 0; i < slots.length; ++i) {\r\n                const slot = slots[i] as CCSlot;\r\n                const remainder = slot._localVertices.length % 4;\r\n                if (remainder === 0) {\r\n                    vCount += slot._localVertices.length / LOCAL_FLOAT_PER_VERTEX;\r\n                } else {\r\n                    vCount += (slot._localVertices.length - remainder) / LOCAL_FLOAT_PER_VERTEX + 1;\r\n                }\r\n                iCount += slot._indices.length;\r\n            }\r\n\r\n            rd = RenderData.add(vfmtPosUvColor, this.accessor);\r\n            rd.resize(vCount, iCount);\r\n            if (!rd.indices || iCount !== rd.indices.length) {\r\n                rd.indices = new Uint16Array(iCount);\r\n            }\r\n        }\r\n        return rd;\r\n    }\r\n\r\n    updateRenderData (comp: ArmatureDisplay): void {\r\n        _comp = comp;\r\n        const armature = comp._armature;\r\n        if (armature) {\r\n            updateComponentRenderData(comp);\r\n        }\r\n    }\r\n\r\n    updateColor (comp: ArmatureDisplay): void {\r\n        if (!comp) return;\r\n        _comp = comp;\r\n        _comp._markForUpdateRenderData();\r\n    }\r\n}\r\n\r\nexport const simple = new Simple();\r\n\r\nfunction realTimeTraverse (armature: Armature, parentOpacity: number, worldMat?: Mat4): void {\r\n    const rd = _renderData;\r\n    if (!rd) return;\r\n    _vbuf = rd.chunk.vb;\r\n    _ibuf = rd.indices!;\r\n\r\n    const slots = armature._slots;\r\n    let material: MaterialInstance;\r\n    let vertices: number[];\r\n    let indices: number[];\r\n    let slotColor: Color;\r\n    let slot: CCSlot;\r\n\r\n    let cumulatedCount = 0;\r\n\r\n    for (let i = 0, l = slots.length; i < l; i++) {\r\n        slot = slots[i] as CCSlot;\r\n        slotColor = slot._color;\r\n\r\n        if (!slot._visible || !slot._displayData) continue;\r\n\r\n        if (worldMat) {\r\n            /* enable batch or recursive armature */\r\n            Mat4.multiply(slot._worldMatrix, worldMat, slot._matrix);\r\n        } else {\r\n            Mat4.copy(slot._worldMatrix, slot._matrix);\r\n        }\r\n\r\n        if (slot.childArmature) {\r\n            realTimeTraverse(slot.childArmature, slotColor.a / 255, slot._worldMatrix);\r\n            continue;\r\n        }\r\n\r\n        material = _getSlotMaterial(slot.getTexture(), slot._blendMode)!;\r\n        if (!material) {\r\n            continue;\r\n        }\r\n        if (!_currentMaterial) _currentMaterial = material;\r\n\r\n        const texture = slot.getTexture();\r\n\r\n        if (_mustFlush || material.hash !== _currentMaterial.hash || (texture && _currentTexture !== texture)) {\r\n            _mustFlush = false;\r\n            const cumulatedCount = _indexOffset - _prevDrawIndexOffset;\r\n            // Submit draw data\r\n            if (cumulatedCount > 0) {\r\n                _comp!._requestDrawData(_currentMaterial, _currentTexture!, _prevDrawIndexOffset, cumulatedCount);\r\n                _prevDrawIndexOffset = _indexOffset;\r\n            }\r\n            _currentTexture = texture;\r\n            _currentMaterial = material;\r\n        }\r\n\r\n        _handleColor(slotColor, parentOpacity);\r\n        _slotMat.set(slot._worldMatrix);\r\n\r\n        vertices = slot._localVertices;\r\n        _vertexCount = vertices.length / LOCAL_FLOAT_PER_VERTEX;\r\n        _vertexFloatCount = _vertexCount * PER_VERTEX_SIZE;\r\n        indices = slot._indices;\r\n        _indexCount = indices.length;\r\n\r\n        // Slot and vertices in armature may be replaced in some cases\r\n        // (for example caused by CCFactory.replaceSlotDisplay)\r\n        let isResize = false;\r\n        if (_vertexOffset + _vertexCount > _actualVCount) {\r\n            _actualVCount = _vertexOffset + _vertexCount;\r\n            isResize = true;\r\n        }\r\n        if (_indexOffset + _indexCount > _actualICount) {\r\n            _actualICount = _indexOffset + _indexCount;\r\n            isResize = true;\r\n        }\r\n        if (isResize) {\r\n            const oldIndices = _ibuf;\r\n            const oldChunkOffset = rd.chunk.vertexOffset;\r\n            rd.resizeAndCopy(_actualVCount, _actualICount > rd.indexCount ? _actualICount : rd.indexCount);\r\n            _vbuf = rd.chunk.vb;\r\n            if (_actualICount > _ibuf.length) {\r\n                _ibuf = rd.indices = new Uint16Array(_actualICount);\r\n            }\r\n            const correction = rd.chunk.vertexOffset - oldChunkOffset;\r\n            for (let i = 0; i < _indexOffset; ++i) {\r\n                _ibuf[i] = oldIndices[i] + correction;\r\n            }\r\n        }\r\n\r\n        // vertext format:\r\n        //       x y z u v r g b a\r\n        for (let vi = 0, vl = vertices.length, v = _vertexFloatOffset; vi < vl; v += PER_VERTEX_SIZE) {\r\n            _tempVecPos.x = vertices[vi++];\r\n            _tempVecPos.y = vertices[vi++];\r\n            _tempVecPos.z = 0;\r\n            _tempVecPos.transformMat4(_slotMat);\r\n\r\n            _vbuf[v] = _tempVecPos.x;\r\n            _vbuf[v + 1] = _tempVecPos.y;\r\n            _vbuf[v + 2] = _tempVecPos.z;\r\n\r\n            _vbuf[v + 3] = vertices[vi++]; // u\r\n            _vbuf[v + 4] = vertices[vi++]; // v\r\n\r\n            _vbuf.set(_c, v + 5);// color\r\n        }\r\n        const chunkOffset = rd.chunk.vertexOffset;\r\n        for (let i = 0, il = indices.length, ii = _indexOffset; i < il; i++, ii++) {\r\n            _ibuf[ii] = _vertexOffset + indices[i] + chunkOffset;\r\n        }\r\n        _vertexFloatOffset += _vertexFloatCount;\r\n        _vertexOffset += _vertexCount;\r\n        _indexOffset += _indexCount;\r\n        _vertexCount = 0;\r\n        _indexCount = 0;\r\n    }\r\n\r\n    cumulatedCount = _indexOffset - _prevDrawIndexOffset;\r\n    if (_currentTexture && cumulatedCount > 0) {\r\n        _comp!._requestDrawData(_currentMaterial!, _currentTexture, _prevDrawIndexOffset, cumulatedCount);\r\n        _prevDrawIndexOffset = _indexOffset;\r\n    }\r\n    if (_comp!.maxIndexCount < _actualICount) {\r\n        _comp!.maxIndexCount = _actualICount;\r\n    }\r\n    if (_comp!.maxVertexCount < _actualVCount) {\r\n        _comp!.maxVertexCount = _actualVCount;\r\n    }\r\n}\r\n\r\nfunction cacheTraverse (frame: ArmatureFrame | null, parentMat?: Mat4): void {\r\n    if (!frame) return;\r\n    const segments = frame.segments;\r\n    const rd = _renderData;\r\n    if (segments.length === 0 || !rd) return;\r\n\r\n    let material: MaterialInstance | null = null;\r\n    // let offsetInfo;\r\n    const vertices = frame.vertices;\r\n    const indices = frame.indices;\r\n\r\n    let chunkOffset = 0;\r\n    let frameVFOffset = 0;\r\n    let frameIndexOffset = 0;\r\n    let segVFCount = 0;\r\n\r\n    let colorOffset = 0;\r\n    const colors = frame.colors;\r\n    let nowColor = colors[colorOffset++];\r\n    let maxVFOffset = nowColor.vfOffset!;\r\n    _handleColor(nowColor, 1.0);\r\n\r\n    const vbuf = rd.chunk.vb;\r\n    const ibuf = rd.indices!;\r\n\r\n    for (let i = 0, n = segments.length; i < n; i++) {\r\n        const segInfo = segments[i];\r\n        material = _getSlotMaterial(segInfo.tex, segInfo.blendMode)!;\r\n        if (!material) continue;\r\n        if (!_currentMaterial) _currentMaterial = material;\r\n        if (_mustFlush || material.hash !== _currentMaterial.hash || (segInfo.tex && segInfo.tex !== _currentTexture)) {\r\n            _mustFlush = false;\r\n            const cumulatedCount = _indexOffset - _prevDrawIndexOffset;\r\n            // Submit draw data\r\n            if (cumulatedCount > 0) {\r\n                _comp!._requestDrawData(_currentMaterial, _currentTexture!, _prevDrawIndexOffset, cumulatedCount);\r\n                _prevDrawIndexOffset = _indexOffset;\r\n            }\r\n            _currentMaterial = material;\r\n            _currentTexture = segInfo.tex!;\r\n        }\r\n\r\n        _vertexCount = segInfo.vertexCount;\r\n        _indexCount = segInfo.indexCount;\r\n\r\n        // Fill indices\r\n        chunkOffset = rd.chunk.vertexOffset;\r\n        for (let ii = _indexOffset, il = _indexOffset + _indexCount; ii < il; ii++) {\r\n            ibuf[ii] = chunkOffset + _vertexOffset + indices[frameIndexOffset++];\r\n        }\r\n\r\n        // Fill vertices\r\n        segVFCount = segInfo.vfCount;\r\n        const subArray = vertices.subarray(frameVFOffset, segVFCount);\r\n        vbuf.set(subArray, frameVFOffset);\r\n\r\n        let offset = 0;\r\n        if (parentMat) {\r\n            for (let ii = 0, il = _vertexCount; ii < il; ii++) {\r\n                _tempVecPos.x = vbuf[offset];\r\n                _tempVecPos.y = vbuf[offset + 1];\r\n                _tempVecPos.z = 0;\r\n                _tempVecPos.transformMat4(parentMat);\r\n                vbuf[offset] = _tempVecPos.x;\r\n                vbuf[offset + 1] = _tempVecPos.y;\r\n                vbuf[offset + 2] = _tempVecPos.z;\r\n                offset += PER_VERTEX_SIZE;\r\n            }\r\n        }\r\n        if ((_handleVal & NEED_COLOR)) {\r\n            // handle color\r\n            // tip: step of frameColorOffset should fix with vertex attributes, (xyzuvrgba--xyuvc)\r\n            let frameColorOffset = frameVFOffset / 9 * 5;\r\n            for (let ii = frameVFOffset, iEnd = frameVFOffset + segVFCount; ii < iEnd; ii += PER_VERTEX_SIZE, frameColorOffset += 5) {\r\n                if (frameColorOffset >= maxVFOffset) {\r\n                    nowColor = colors[colorOffset++];\r\n                    _handleColor(nowColor, 1.0);\r\n                    maxVFOffset = nowColor.vfOffset!;\r\n                }\r\n                vbuf.set(_c, ii + 5);\r\n            }\r\n        }\r\n        // Segment increment\r\n        frameVFOffset += segVFCount;\r\n        _vertexOffset += _vertexCount;\r\n        _indexOffset += _indexCount;\r\n        _vertexCount = 0;\r\n        _indexCount = 0;\r\n    }\r\n    const cumulatedCount = _indexOffset - _prevDrawIndexOffset;\r\n    if (_currentTexture && cumulatedCount > 0) {\r\n        _comp!._requestDrawData(_currentMaterial!, _currentTexture, _prevDrawIndexOffset, cumulatedCount);\r\n    }\r\n}\r\n\r\nfunction updateComponentRenderData (comp: ArmatureDisplay): void {\r\n    // comp.node._renderFlag |= RenderFlow.FLAG_UPDATE_RENDER_DATA;\r\n\r\n    const armature = comp._armature;\r\n    if (!armature || comp.renderData === null) return;\r\n\r\n    // Init temp var.\r\n    _mustFlush = true;\r\n    _premultipliedAlpha = comp.premultipliedAlpha;\r\n    // Reuse draw list\r\n    comp.drawList.reset();\r\n    _comp = comp;\r\n    _node = comp.node;\r\n    _renderData = comp.renderData;\r\n    _comp = comp;\r\n    _handleVal = 0;\r\n    _currentMaterial = null;\r\n\r\n    const nodeColor = comp.color;\r\n    _nodeR = nodeColor.r / 255;\r\n    _nodeG = nodeColor.g / 255;\r\n    _nodeB = nodeColor.b / 255;\r\n    _nodeA = comp.node._uiProps.opacity;\r\n    if (Color.toUint32(nodeColor) !== 0xffffffff) {\r\n        _handleVal |= NEED_COLOR;\r\n    }\r\n\r\n    const worldMat = comp.node.getWorldMatrix();\r\n\r\n    _vertexFloatCount = 0;\r\n    _vertexOffset = 0;\r\n    _vertexFloatOffset = 0;\r\n    _indexCount = 0;\r\n    _indexOffset = 0;\r\n    _prevDrawIndexOffset = 0;\r\n    _actualVCount = _comp.maxVertexCount;\r\n    _actualICount = _comp.maxIndexCount;\r\n\r\n    if (comp.isAnimationCached()) {\r\n        // Traverse input assembler.\r\n        cacheTraverse(comp._curFrame, worldMat);\r\n    } else {\r\n        // Traverse all armature.\r\n        realTimeTraverse(armature, 1.0, worldMat);\r\n\r\n        const graphics = comp._debugDraw;\r\n        if (comp.debugBones && graphics) {\r\n            graphics.clear();\r\n\r\n            graphics.lineWidth = 5;\r\n            graphics.strokeColor = _boneColor;\r\n            graphics.fillColor = _slotColor; // Root bone color is same as slot color.\r\n\r\n            const bones = armature.getBones();\r\n            for (let i = 0, l = bones.length; i < l; i++) {\r\n                const bone = bones[i];\r\n                const boneLength = Math.max(bone.boneData.length, 5);\r\n                const startX = bone.globalTransformMatrix.tx;\r\n                const startY = bone.globalTransformMatrix.ty;\r\n                const endX = startX + bone.globalTransformMatrix.a * boneLength;\r\n                const endY = startY + bone.globalTransformMatrix.b * boneLength;\r\n\r\n                graphics.moveTo(startX, startY);\r\n                graphics.lineTo(endX, endY);\r\n                graphics.stroke();\r\n\r\n                // Bone origins.\r\n                graphics.circle(startX, startY, Math.PI * 2);\r\n                graphics.fill();\r\n                if (i === 0) {\r\n                    graphics.fillColor = _originColor;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // Ensure mesh buffer update\r\n    _accessor.getMeshBuffer(_renderData.chunk.bufferId).setDirty();\r\n\r\n    // Clear temp var.\r\n    _node = undefined;\r\n    _comp = undefined;\r\n}\r\n\r\ncclegacy.internal.DragonBonesAssembler = simple;\r\n","/*\r\n Copyright (c) 2022-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { IAssemblerManager } from '../../2d/renderer/base';\r\nimport { ArmatureDisplay } from '../ArmatureDisplay';\r\nimport { simple } from './simple';\r\n\r\n// Inline all type switch to avoid jit deoptimization during inlined function change\r\n/**\r\n * @engineInternal Since v3.7.2 this is an engine private object.\r\n */\r\nexport const simpleDragonBoneAssembler: IAssemblerManager = {\r\n    getAssembler () {\r\n        return simple;\r\n    },\r\n};\r\n\r\nArmatureDisplay.Assembler = simpleDragonBoneAssembler;\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\n/**\r\n * @engineInternal Since v3.7.2, this is an engine private enum type.\r\n * @deprecated Since v3.7.2, will be removed in the future.\r\n */\r\nexport enum ExtensionType {\r\n    FFD = 0,\r\n    AdjustColor = 10,\r\n    BevelFilter = 11,\r\n    BlurFilter = 12,\r\n    DropShadowFilter = 13,\r\n    GlowFilter = 14,\r\n    GradientBevelFilter = 15,\r\n    GradientGlowFilter = 16\r\n}\r\n\r\n/**\r\n * @en Event type in dragonbones animation.\r\n * @zh 龙骨动画中的事件类型。\r\n */\r\nexport enum DragonBonesEventType {\r\n    /**\r\n     * @en Event about animation frame.\r\n     * @zh 动画帧相关的事件。\r\n     */\r\n    Frame = 0,\r\n    /**\r\n     * @en Event about sound.\r\n     * @zh 声音相关的事件。\r\n     */\r\n    Sound = 1\r\n}\r\n\r\n// To keep the compatibility, don't use it internally, otherwise, enum value may be inlined to wrong value.\r\n// Use DragonBonesEventType instead.\r\nexport const EventType = DragonBonesEventType;\r\n\r\n/**\r\n * @en Animation fade out mode.\r\n * @zh 动画淡出模式。\r\n */\r\nexport enum AnimationFadeOutMode {\r\n    None = 0,\r\n\r\n    /**\r\n     * @en Fade out the animation states of the same layer.\r\n     * @zh 淡出同层的动画状态。\r\n     */\r\n    SameLayer = 1,\r\n\r\n    /**\r\n     * @en Fade out the animation states of the same group.\r\n     * @zh 淡出同组的动画状态。\r\n     */\r\n    SameGroup = 2,\r\n\r\n    /**\r\n     * @en Fade out the animation states of the same layer and group.\r\n     * @zh 淡出同层并且同组的动画状态。\r\n     */\r\n    SameLayerAndGroup = 3,\r\n\r\n    /**\r\n     * @en Fade out of all animation states.\r\n     * @zh 淡出所有的动画状态。\r\n     */\r\n    All = 4\r\n}\r\n\r\nexport * from './CCFactory';\r\nexport * from './CCSlot';\r\nexport * from './CCTextureData';\r\nexport * from './CCArmatureDisplay';\r\nexport * from './ArmatureCache';\r\n\r\nexport * from './DragonBonesAsset';\r\nexport * from './DragonBonesAtlasAsset';\r\nexport * from './ArmatureDisplay';\r\nexport * from './AttachUtil';\r\nexport * from './assembler';\r\n\r\nexport * from '@cocos/dragonbones-js';\r\n"],"names":["ccclass","_decorator","CCTextureAtlasData","_dec","_class","_TextureAtlasData","_this","_len","arguments","length","args","Array","_key","call","apply","concat","_renderTexture","_inheritsLoose","toString","_proto","prototype","createTexture","BaseObject","borrowObject","CCTextureData","_onClear","renderTexture","_createClass","key","get","set","value","k","textures","textureData","spriteFrame","rect","rotated","Rect","region","x","y","height","width","SpriteFrame","texture","TextureAtlasData","_dec2","_class2","_TextureData","_this2","_len2","_key2","_proto2","TextureData","CCSlot","_Slot","_localVertices","_indices","_matrix","_worldMatrix","_worldMatrixDirty","_color","Mat4","_visible","Color","getTexture","_textureData","sp","tex","calculWorldMatrix","parent","_armature","_parent","_mulMat","copy","identity","_onUpdateDisplay","_initDisplay","_addDisplay","_replaceDisplay","_removeDisplay","_disposeDisplay","object","_updateVisible","visible","_updateGlueMesh","_updateZOrder","_updateBlendMode","_childArmature","childSlots","getSlots","i","l","slot","_blendMode","_updateColor","c","r","_colorTransform","redMultiplier","g","greenMultiplier","b","blueMultiplier","a","alphaMultiplier","_updateFrame","indices","localVertices","indexOffset","vfOffset","currentTextureData","_display","_displayIndex","textureAtlasWidth","textureAtlasHeight","console","error","name","currentVerticesData","_deformVertices","_meshDisplay","verticesData","data","intArray","floatArray","vertexCount","offset","BinaryOffset","MeshVertexCount","triangleCount","MeshTriangleCount","vertexOffset","MeshFloatOffset","uvOffset","scale","_armatureData","MeshVertexIndices","isSkinned","weight","_identityTransform","t","_visibleDirty","_blendModeDirty","_colorDirty","_updateMesh","deformVertices","vertices","bones","weightData","hasDeform","inheritDeform","weightFloatOffset","WeigthFloatOffset","iB","WeigthBoneIndices","iV","iF","lvi","boneCount","xG","yG","j","boneIndex","bone","matrix","globalTransformMatrix","xL","yL","tx","d","ty","isSurface","_boneData","type","BoneType","Bone","_getGlobalTransformMatrix","m","m00","m01","m04","m05","m12","m13","_updateTransform","_pivotX","_pivotY","updateWorldMatrix","parentSlot","childArmature","slots","n","out","aa","ab","ac","ad","atx","aty","ba","bb","bc","bd","btx","bty","Slot","CCArmatureDisplay","_DisplayData","shouldAdvanced","_ccNode","_ccComponent","_eventTarget","EventTarget","hasEvent","warn","addEvent","listener","thisObject","removeEvent","setEventTarget","eventTarget","getRootDisplay","display","convertToRootSpace","pos","worldMatrix","newPos","Vec3","convertToWorldSpace","point","_ccNode$_getUITransfo","ccNode","getRootNode","_getUITransformComp","convertToWorldSpaceAR","rootDisplay","dbInit","armature","dbClear","dbUpdate","_markForUpdateRenderData","advanceTimeBySelf","on","hasDBEventListener","hasEventListener","addDBEventListener","target","removeDBEventListener","off","dispatchDBEvent","eventObject","emit","DisplayData","CCFactory","_CCFactory","_BaseFactory","id","uuid","_slots","eventManager","_dragonBones","DragonBones","director","getScheduler","game","Game","EVENT_RESTART","onRestart","initUpdate","getInstance","_factory","dt","Scheduler","enableForTarget","scheduleUpdate","SystemPriority","HIGH","update","advanceTime","getDragonBonesDataByRawData","rawData","dataParser","ArrayBuffer","BaseFactory","_binaryParser","_dataParser","parseDragonBonesData","buildArmatureDisplay","armatureName","dragonBonesName","skinName","textureAtlasName","buildArmature","createArmatureNode","comp","node","Node","getComponent","addComponent","_armatureName","_dragonAsset","dragonAsset","_dragonAtlasAsset","dragonAtlasAsset","_init","_buildTextureAtlasData","textureAtlasData","textureAtlas","_sortSlots","sortedSlots","zOrder","_zOrder","inserted","splice","unshift","_buildArmature","dataPackage","Armature","_skinData","skin","_animation","Animation","animations","_isChildArmature","init","_buildSlot","slotData","displays","getDragonBonesDataByUUID","_dragonBonesDataMap","indexOf","removeDragonBonesDataByUUID","disposeData","undefined","bufferObject","MaxCacheTime","FrameTime","_vertices","_boneInfoOffset","_indexOffset","_vfOffset","_preTexUrl","_preBlendMode","_segVCount","_segICount","_segOffset","_colorOffset","_preColor","_x","_y","PER_VERTEX_SIZE","EXPORT_VERTEX_SIZE","AnimationCache","maxVertexCount","maxIndexCount","_privateMode","_inited","_invalid","_enableCacheAttachedInfo","frames","totalTime","isCompleted","_frameIdx","_armatureInfo","_animationName","_tempSegments","_tempColors","_tempBoneInfos","armatureInfo","animationName","clear","frame","segments","invalidAllFrame","begin","curAnimationCache","updateToFrame","animation","play","end","_needToUpdate","toFrameIdx","updateFrame","isInited","isInvalid","updateAllFrame","enableCacheAttachedInfo","index","colors","boneInfos","Float32Array","uintVert","Uint32Array","Uint16Array","_traverseArmature","preSegOffset","preSegInfo","indexCount","vfCount","copyOutVerticeSize","colorI32","parentOpacity","slotVertices","slotIndices","slotMatrix","slotColor","colorVal","_bones","boneInfo","Matrix","boneMat","cacheBoneMat","copyFrom","_displayData","nativeUrl","blendMode","vl","ii","il","ArmatureCache","_animationPool","_armatureCache","enablePrivateMode","dispose","_removeArmature","armatureKey","animationsCache","aniKey","animationCache","resetArmature","getArmatureCache","atlasUUID","factory","proxy","canCache","getAnimationCache","initAnimationCache","hasAni","hasAnimation","poolKey","invalidAnimationCache","updateAnimationCache","_ArmatureCache","sharedCache","serializable","DragonBonesAsset","_Asset","_dragonBonesJson","_initializer","_dragonBonesJsonData","_armaturesEnum","reset","createNode","callback","armatureDisplay","_clear","dragonBonesJson","JSON","parse","_nativeAsset","_uuid","dbData","dragonBonesData","getDragonBonesData","buffer","getArmatureEnum","armatureNames","enumDef","Enum","getAnimsEnum","getArmature","anims","animName","hasOwnProperty","destroy","Asset","_applyDecoratedInitializer","cclegacy","internal","DragonBonesAtlasAsset","Texture2D","_atlasJson","_texture","_initializer2","_atlasJsonData","_initializer3","_textureAtlasData","_initializer4","atlasJson","atlasJsonObj","addTextureAtlasData","parseTextureAtlasData","removeTextureAtlasData","_tempMat4","AttachUtil","_armatureNode","_armatureDisplay","_syncAttachedNode","isCached","isAnimationCached","_curFrame","sockets","socketNodes","matrixHandle","tm","getBones","sock","boneNode","isValid","path","ArmatureSystem","_System","_armatures","Set","_instance","registerSystem","ID","add","has","remove","postUpdate","forEach","updateAnimation","syncAttachedNode","prepareRenderData","System","DefaultArmaturesEnum","ccenum","DefaultAnimsEnum","DefaultCacheMode","timeScale","AnimationCacheMode","override","DragonBoneSocket","js","ArmatureDisplay","_dec3","_dec4","_dec5","_dec6","_dec7","_dec8","_dec9","Material","_class3","_class4","_ArmatureDisplay","_UIRenderer","playTimes","premultipliedAlpha","attachUtil","_defaultArmatureIndexValue","_initializer5","_initializer6","_initializer7","_initializer8","_initializer9","_animationIndexValue","_initializer0","_preCacheMode","_cacheMode","REALTIME","_defaultCacheModeValue","_initializer1","_timeScale","_initializer10","_playTimes","_initializer11","_debugBones","_initializer12","_enableBatch","_initializer13","_debugDraw","_armatureKey","_accTime","_playCount","_frameCache","_playing","_displayProxy","_drawIdx","_drawList","RecyclePool","material","_materialCache","_enumArmatures","_enumAnimations","_socketNodes","Map","_cachedSockets","_sockets","_initializer14","_drawInfoList","_cacheModeEnum","initFactory","setPropertyEnumType","_useVertexOpacity","requestDrawInfo","idx","RenderDrawInfo","onLoad","_requestDrawData","draw","destroyRenderData","getMaterialTemplate","customMaterial","updateMaterial","getMaterialForBlend","src","dst","inst","matInfo","subModelIdx","owner","MaterialInstance","recompileShaders","TWO_COLORED","USE_LOCAL","overridePipelineStates","blendState","targets","blendSrc","blendDst","_updateBuiltinMaterial","builtinResMgr","mat","_customMaterial","setSharedMaterial","_cleanMaterialCache","_render","batcher","indicesCount","renderData","rd","chunk","accessor","vertexAccessor","meshBuffer","getMeshBuffer","origin","dc","commitMiddleware","subIndices","subarray","appendIndices","bufferId","__preload","_defaultCacheMode","_parseDragonAtlasAsset","_refresh","children","child","_updateDebugDraw","_indexBoneSockets","_updateSocketBindings","getArmatureKey","setAnimationCacheMode","cacheMode","clock","onEnable","_flushAssembler","onDisable","_emitCacheCompleteEvent","EventObject","LOOP_COMPLETE","COMPLETE","frameCache","resize","frameTime","START","globalTimeScale","frameIdx","Math","floor","onDestroy","_materialInstances","filter","instance","PRIVATE_CACHE","SHARED_CACHE","debugBones","debugDrawNode","hideFlags","CCObjectFlags","DontSave","HideInHierarchy","debugDraw","lineWidth","strokeColor","e","errorID","message","_updateBatch","armatureData","aabb","setContentSize","playAnimation","querySockets","size","from","keys","sort","querySocketPathByName","ret","_iterator","_createForOfIteratorHelperLoose","_step","done","endsWith","push","_updateCacheModeEnum","Object","assign","_updateAnimEnum","animEnum","_updateArmatureEnum","armatureEnum","nameToBone","cacheBoneName","bi","cache","_boneIndex","walkArmature","prefix","boneToName","_iterator2","_step2","getArmatureNames","getAnimationNames","eventType","addEventListener","removeEventListener","once","assembler","Assembler","getAssembler","_assembler","_renderData","createData","socket","_verifySockets","val","createRenderEntity","renderEntity","RenderEntity","RenderEntityType","DYNAMIC","setUseLocal","markForUpdateRenderData","enable","animNames","armaturesEnum","_defaultArmatureIndex","_animationIndex","animsEnum","UIRenderer","_applyDecoratedDescriptor","getOwnPropertyDescriptor","NEED_COLOR","_boneColor","_slotColor","_originColor","_nodeR","_nodeG","_nodeB","_nodeA","_premultipliedAlpha","_mustFlush","_ibuf","_vbuf","_comp","_vertexFloatCount","_vertexCount","_vertexOffset","_vertexFloatOffset","_indexCount","_actualVCount","_actualICount","_prevDrawIndexOffset","LOCAL_FLOAT_PER_VERTEX","_c","_handleVal","_tempVecPos","_slotMat","_currentMaterial","_currentTexture","_getSlotMaterial","BlendFactor","ONE","SRC_ALPHA","DST_COLOR","ONE_MINUS_SRC_ALPHA","ONE_MINUS_SRC_COLOR","_handleColor","color","_a","_multiply","_r","_g","_b","_accessor","Simple","vCount","ensureAccessor","device","root","batcher2D","attributes","vfmtPosUvColor","StaticVBAccessor","registerBufferAccessor","Number","parseInt","iCount","remainder","RenderData","updateRenderData","updateComponentRenderData","updateColor","simple","realTimeTraverse","worldMat","vb","cumulatedCount","multiply","hash","isResize","oldIndices","oldChunkOffset","resizeAndCopy","correction","vi","v","z","transformMat4","chunkOffset","cacheTraverse","parentMat","frameVFOffset","frameIndexOffset","segVFCount","colorOffset","nowColor","maxVFOffset","vbuf","ibuf","segInfo","subArray","frameColorOffset","iEnd","drawList","nodeColor","_uiProps","opacity","toUint32","getWorldMatrix","graphics","fillColor","boneLength","max","boneData","startX","startY","endX","endY","moveTo","lineTo","stroke","circle","PI","fill","setDirty","DragonBonesAssembler","simpleDragonBoneAssembler","ExtensionType","DragonBonesEventType","EventType","AnimationFadeOutMode"],"mappings":"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"}