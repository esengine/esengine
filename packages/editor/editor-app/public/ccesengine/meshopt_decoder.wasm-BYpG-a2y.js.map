{"version":3,"file":"meshopt_decoder.wasm-BYpG-a2y.js","sources":["../../../external:emscripten/meshopt/meshopt_decoder.wasm.js"],"sourcesContent":["// This file is part of meshoptimizer library and is distributed under the terms of MIT License.\n// Copyright (C) 2016-2023, by Arseny Kapoulkine (arseny.kapoulkine@gmail.com)\nvar MeshoptDecoder = (function() {\n\t\"use strict\";\n\n\tvar instance;\n\tvar supported = false;\n\n\tvar ready = (instantiateWasm = {}) => {\n\n\t\tif (typeof instantiateWasm !== 'function') {\n\t\t\treturn Promise.reject(new Error('No wasm support detected'));\n\t\t}\n\n\t\treturn instantiateWasm().then(function(result) {\n\t\t\tsupported = true;\n\t\t\tinstance = result.instance;\n\t\t\tinstance.exports.__wasm_call_ctors();\n\t\t});\n\t}\n\n\tfunction decode(fun, target, count, size, source, filter) {\n\t\tvar sbrk = instance.exports.sbrk;\n\t\tvar count4 = (count + 3) & ~3;\n\t\tvar tp = sbrk(count4 * size);\n\t\tvar sp = sbrk(source.length);\n\t\tvar heap = new Uint8Array(instance.exports.memory.buffer);\n\t\theap.set(source, sp);\n\t\tvar res = fun(tp, count, size, sp, source.length);\n\t\tif (res == 0 && filter) {\n\t\t\tfilter(tp, count4, size);\n\t\t}\n\t\ttarget.set(heap.subarray(tp, tp + count * size));\n\t\tsbrk(tp - sbrk(0));\n\t\tif (res != 0) {\n\t\t\tthrow new Error(\"Malformed buffer data: \" + res);\n\t\t}\n\t}\n\n\tvar filters = {\n\t\tNONE: \"\",\n\t\tOCTAHEDRAL: \"meshopt_decodeFilterOct\",\n\t\tQUATERNION: \"meshopt_decodeFilterQuat\",\n\t\tEXPONENTIAL: \"meshopt_decodeFilterExp\",\n\t};\n\n\tvar decoders = {\n\t\tATTRIBUTES: \"meshopt_decodeVertexBuffer\",\n\t\tTRIANGLES: \"meshopt_decodeIndexBuffer\",\n\t\tINDICES: \"meshopt_decodeIndexSequence\",\n\t};\n\n\tvar workers = [];\n\tvar requestId = 0;\n\n\tfunction createWorker(url) {\n\t\tvar worker = {\n\t\t\tobject: new Worker(url),\n\t\t\tpending: 0,\n\t\t\trequests: {}\n\t\t};\n\n\t\tworker.object.onmessage = function(event) {\n\t\t\tvar data = event.data;\n\n\t\t\tworker.pending -= data.count;\n\t\t\tworker.requests[data.id][data.action](data.value);\n\n\t\t\tdelete worker.requests[data.id];\n\t\t};\n\n\t\treturn worker;\n\t}\n\n\tfunction initWorkers(count) {\n\t\tvar source =\n\t\t\t\"var instance; var ready = WebAssembly.instantiate(new Uint8Array([\" + new Uint8Array(unpack(wasm)) + \"]), {})\" +\n\t\t\t\".then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });\" +\n\t\t\t\"self.onmessage = workerProcess;\" +\n\t\t\tdecode.toString() + workerProcess.toString();\n\n\t\tvar blob = new Blob([source], {type: 'text/javascript'});\n\t\tvar url = URL.createObjectURL(blob);\n\n\t\tfor (var i = 0; i < count; ++i) {\n\t\t\tworkers[i] = createWorker(url);\n\t\t}\n\n\t\tURL.revokeObjectURL(url);\n\t}\n\n\tfunction decodeWorker(count, size, source, mode, filter) {\n\t\tvar worker = workers[0];\n\n\t\tfor (var i = 1; i < workers.length; ++i) {\n\t\t\tif (workers[i].pending < worker.pending) {\n\t\t\t\tworker = workers[i];\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\tvar data = new Uint8Array(source);\n\t\t\tvar id = requestId++;\n\n\t\t\tworker.pending += count;\n\t\t\tworker.requests[id] = { resolve: resolve, reject: reject };\n\t\t\tworker.object.postMessage({ id: id, count: count, size: size, source: data, mode: mode, filter: filter }, [ data.buffer ]);\n\t\t});\n\t}\n\n\tfunction workerProcess(event) {\n\t\tready.then(function() {\n\t\t\tvar data = event.data;\n\t\t\ttry {\n\t\t\t\tvar target = new Uint8Array(data.count * data.size);\n\t\t\t\tdecode(instance.exports[data.mode], target, data.count, data.size, data.source, instance.exports[data.filter]);\n\t\t\t\tself.postMessage({ id: data.id, count: data.count, action: \"resolve\", value: target }, [ target.buffer ]);\n\t\t\t} catch (error) {\n\t\t\t\tself.postMessage({ id: data.id, count: data.count, action: \"reject\", value: error });\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tready: ready,\n\t\tsupported: supported,\n\t\tuseWorkers: function(count) {\n\t\t\tinitWorkers(count);\n\t\t},\n\t\tdecodeVertexBuffer: function(target, count, size, source, filter) {\n\t\t\tdecode(instance.exports.meshopt_decodeVertexBuffer, target, count, size, source, instance.exports[filters[filter]]);\n\t\t},\n\t\tdecodeIndexBuffer: function(target, count, size, source) {\n\t\t\tdecode(instance.exports.meshopt_decodeIndexBuffer, target, count, size, source);\n\t\t},\n\t\tdecodeIndexSequence: function(target, count, size, source) {\n\t\t\tdecode(instance.exports.meshopt_decodeIndexSequence, target, count, size, source);\n\t\t},\n\t\tdecodeGltfBuffer: function(target, count, size, source, mode, filter) {\n\t\t\tdecode(instance.exports[decoders[mode]], target, count, size, source, instance.exports[filters[filter]]);\n\t\t},\n\t\tdecodeGltfBufferAsync: function(count, size, source, mode, filter) {\n\t\t\tif (workers.length > 0) {\n\t\t\t\treturn decodeWorker(count, size, source, decoders[mode], filters[filter]);\n\t\t\t}\n\n\t\t\treturn ready.then(function() {\n\t\t\t\tvar target = new Uint8Array(count * size);\n\t\t\t\tdecode(instance.exports[decoders[mode]], target, count, size, source, instance.exports[filters[filter]]);\n\t\t\t\treturn target;\n\t\t\t});\n\t\t}\n\t};\n})();\n\nexport default MeshoptDecoder;"],"names":["MeshoptDecoder","instance","supported","ready","instantiateWasm","Promise","reject","Error","then","result","exports","__wasm_call_ctors","decode","fun","target","count","size","source","filter","sbrk","count4","tp","sp","length","heap","Uint8Array","memory","buffer","set","res","subarray","filters","NONE","OCTAHEDRAL","QUATERNION","EXPONENTIAL","decoders","ATTRIBUTES","TRIANGLES","INDICES","workers","requestId","createWorker","url","worker","object","Worker","pending","requests","onmessage","event","data","id","action","value","initWorkers","unpack","wasm","toString","workerProcess","blob","Blob","type","URL","createObjectURL","i","revokeObjectURL","decodeWorker","mode","resolve","postMessage","self","error","useWorkers","decodeVertexBuffer","meshopt_decodeVertexBuffer","decodeIndexBuffer","meshopt_decodeIndexBuffer","decodeIndexSequence","meshopt_decodeIndexSequence","decodeGltfBuffer","decodeGltfBufferAsync"],"mappings":"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"}