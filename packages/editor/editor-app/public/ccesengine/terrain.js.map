{"version":3,"file":"terrain.js","sources":["../../../cocos/terrain/height-field.ts","../../../cocos/terrain/terrain-lod.ts","../../../cocos/terrain/terrain.ts"],"sourcesContent":["/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { clamp } from '../core/math';\r\n\r\nexport class HeightField {\r\n    public data: Uint16Array = new Uint16Array();\r\n    public w = 0;\r\n    public h = 0;\r\n\r\n    constructor (w: number, h: number) {\r\n        this.w = w;\r\n        this.h = h;\r\n        this.data = new Uint16Array(w * h);\r\n\r\n        for (let i = 0; i < w * h; ++i) {\r\n            this.data[i] = 0;\r\n        }\r\n    }\r\n\r\n    public set (i: number, j: number, value: number): void {\r\n        this.data[j * this.w + i] = value;\r\n    }\r\n\r\n    public get (i: number, j: number): number {\r\n        return this.data[j * this.w + i];\r\n    }\r\n\r\n    public getClamp (i: number, j: number): number {\r\n        i = clamp(i, 0, this.w - 1);\r\n        j = clamp(j, 0, this.h  - 1);\r\n\r\n        return this.get(i, j);\r\n    }\r\n\r\n    public getAt (x: number, y: number): number {\r\n        const fx = x;\r\n        const fy = y;\r\n\r\n        let ix0 = Math.floor(fx);\r\n        let iz0 = Math.floor(fy);\r\n        let ix1 = ix0 + 1;\r\n        let iz1 = iz0 + 1;\r\n        const dx = fx - ix0;\r\n        const dz = fy - iz0;\r\n\r\n        ix0 = clamp(ix0, 0, this.w - 1);\r\n        iz0 = clamp(iz0, 0, this.h - 1);\r\n        ix1 = clamp(ix1, 0, this.w - 1);\r\n        iz1 = clamp(iz1, 0, this.h - 1);\r\n\r\n        let a = this.get(ix0, iz0);\r\n        const b = this.get(ix1, iz0);\r\n        const c = this.get(ix0, iz1);\r\n        let d = this.get(ix1, iz1);\r\n        const m = (b + c) * 0.5;\r\n\r\n        if (dx + dz <= 1.0) {\r\n            d = m + (m - a);\r\n        } else {\r\n            a = m + (m - d);\r\n        }\r\n\r\n        const h1 = a * (1.0 - dx) + b * dx;\r\n        const h2 = c * (1.0 - dx) + d * dx;\r\n\r\n        const h = h1 * (1.0 - dz) + h2 * dz;\r\n\r\n        return h;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nexport const TERRAIN_LOD_VERTS = 33;\r\nexport const TERRAIN_LOD_TILES = 32;\r\nexport const TERRAIN_LOD_LEVELS = 4;\r\nexport const TERRAIN_LOD_NORTH_INDEX = 0;\r\nexport const TERRAIN_LOD_SOUTH_INDEX = 1;\r\nexport const TERRAIN_LOD_WEST_INDEX = 2;\r\nexport const TERRAIN_LOD_EAST_INDEX = 3;\r\nexport const TERRAIN_LOD_MAX_DISTANCE = 100000000000000.0;\r\n\r\nexport class TerrainLodKey {\r\n    public level = 0;\r\n    public north = 0;\r\n    public south = 0;\r\n    public west = 0;\r\n    public east = 0;\r\n\r\n    public equals (rk: TerrainLodKey): boolean {\r\n        return this.level === rk.level && this.north === rk.north && this.south === rk.south && this.west === rk.west && this.east === rk.east;\r\n    }\r\n}\r\n\r\nexport class TerrainIndexPool {\r\n    public size = 0;\r\n    public indices: Uint16Array|null = null;\r\n}\r\n\r\nexport class TerrainIndexData {\r\n    public key: TerrainLodKey = new TerrainLodKey();\r\n    public start = 0;\r\n    public size = 0;\r\n    public buffer: Uint16Array|null = null;\r\n    public primCount = 0;\r\n}\r\n\r\nexport class TerrainLod {\r\n    public static mapIndex (i: number, j: number, k: number): number {\r\n        return i * (TERRAIN_LOD_LEVELS * TERRAIN_LOD_LEVELS) + j * TERRAIN_LOD_LEVELS + k;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _bodyIndexPool: TerrainIndexPool[];\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _connecterIndexPool: TerrainIndexPool[];\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _indexMap: TerrainIndexData[] = [];\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _indexBuffer: Uint16Array = new Uint16Array();\r\n\r\n    constructor () {\r\n        this._bodyIndexPool = new Array<TerrainIndexPool>(TERRAIN_LOD_LEVELS);\r\n        for (let i = 0; i < TERRAIN_LOD_LEVELS; ++i) {\r\n            this._bodyIndexPool[i] = new TerrainIndexPool();\r\n        }\r\n\r\n        this._connecterIndexPool = new Array<TerrainIndexPool>(TERRAIN_LOD_LEVELS * TERRAIN_LOD_LEVELS * 4);\r\n        for (let i = 0; i < TERRAIN_LOD_LEVELS; ++i) {\r\n            for (let j = 0; j < TERRAIN_LOD_LEVELS; ++j) {\r\n                for (let k = 0; k < 4; ++k) {\r\n                    this._connecterIndexPool[TerrainLod.mapIndex(i, j, k)] = new TerrainIndexPool();\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < TERRAIN_LOD_LEVELS; ++i) {\r\n            this._genBodyIndex(i);\r\n        }\r\n\r\n        for (let i = 0; i < TERRAIN_LOD_LEVELS; ++i) {\r\n            for (let j = 0; j < TERRAIN_LOD_LEVELS; ++j) {\r\n                this._genConnecterIndexNorth(i, j);\r\n                this._genConnecterIndexSouth(i, j);\r\n                this._genConnecterIndexWest(i, j);\r\n                this._genConnecterIndexEast(i, j);\r\n            }\r\n        }\r\n\r\n        const levels = TERRAIN_LOD_LEVELS;\r\n        for (let l = 0; l < levels; ++l) {\r\n            for (let n = 0; n < levels; ++n) {\r\n                if (n < l) {\r\n                    continue;\r\n                }\r\n\r\n                for (let s = 0; s < levels; ++s) {\r\n                    if (s < l) {\r\n                        continue;\r\n                    }\r\n\r\n                    for (let w = 0; w < levels; ++w) {\r\n                        if (w < l) {\r\n                            continue;\r\n                        }\r\n\r\n                        for (let e = 0; e < levels; ++e) {\r\n                            if (e < l) {\r\n                                continue;\r\n                            }\r\n\r\n                            const k = new TerrainLodKey();\r\n                            k.level = l;\r\n                            k.north = n;\r\n                            k.south = s;\r\n                            k.west = w;\r\n                            k.east = e;\r\n                            this._genIndexData(k);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public getIndexData (k: TerrainLodKey): TerrainIndexData | null {\r\n        for (let i = 0; i < this._indexMap.length; ++i) {\r\n            if (this._indexMap[i].key.equals(k)) {\r\n                return this._indexMap[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private _genBodyIndex (level: number): void {\r\n        const step = 1 << level;\r\n        let tiles = TERRAIN_LOD_TILES >> level;\r\n        let start = 0;\r\n\r\n        if (level < TERRAIN_LOD_LEVELS - 1)  {\r\n            tiles -= 2;\r\n            start = step * TERRAIN_LOD_VERTS + step;\r\n        }\r\n\r\n        if (tiles === 0 || tiles === 0) {\r\n            return;\r\n        }\r\n\r\n        const count = tiles * tiles * 6;\r\n        this._bodyIndexPool[level].indices = new Uint16Array(count);\r\n\r\n        let index = 0;\r\n        const indices = new Uint16Array(count);\r\n\r\n        // generate triangle list cw\r\n        //\r\n        let row_c = start;\r\n        let row_n = row_c + TERRAIN_LOD_VERTS * step;\r\n        for (let y = 0; y < tiles; ++y) {\r\n            for (let x = 0; x < tiles; ++x) {\r\n                /*\r\n                indices[index++] = row_n + x * step;\r\n                indices[index++] = row_c + x * step;\r\n                indices[index++] = row_n + (x + 1) * step;\r\n\r\n                indices[index++] = row_n + (x + 1) * step;\r\n                indices[index++] = row_c + x * step;\r\n                indices[index++] = row_c + (x + 1) * step;\r\n                */\r\n\r\n                indices[index++] = row_n + x * step;\r\n                indices[index++] = row_n + (x + 1) * step;\r\n                indices[index++] = row_c + x * step;\r\n\r\n                indices[index++] = row_n + (x + 1) * step;\r\n                indices[index++] = row_c + (x + 1) * step;\r\n                indices[index++] = row_c + x * step;\r\n            }\r\n\r\n            row_c += TERRAIN_LOD_VERTS * step;\r\n            row_n += TERRAIN_LOD_VERTS * step;\r\n        }\r\n\r\n        this._bodyIndexPool[level].size = index;\r\n        this._bodyIndexPool[level].indices = indices;\r\n    }\r\n\r\n    private _genConnecterIndexNorth (level: number, connecter: number): void {\r\n        const connecterIndex = TerrainLod.mapIndex(level, connecter, TERRAIN_LOD_NORTH_INDEX);\r\n\r\n        if (connecter < level || level === TERRAIN_LOD_LEVELS - 1) {\r\n            this._connecterIndexPool[connecterIndex].size = 0;\r\n            this._connecterIndexPool[connecterIndex].indices = null;\r\n            return;\r\n        }\r\n\r\n        const self_step = 1 << level;\r\n        const neighbor_step = 1 << connecter;\r\n        const self_tile = TERRAIN_LOD_TILES >> level;\r\n        const count = self_tile * 2 + 2;\r\n\r\n        let index = 0;\r\n        const indices = new Uint16Array(count);\r\n\r\n        // starter\r\n        indices[index++] = 0;\r\n        indices[index++] = 0;\r\n\r\n        // middler\r\n        for (let i = 1; i < self_tile; ++i) {\r\n            const x1 = i * self_step;\r\n            const y1 = self_step;\r\n            const x0 = x1 / neighbor_step * neighbor_step;\r\n            const y0 = y1 - self_step;\r\n\r\n            const index0 = y1 * TERRAIN_LOD_VERTS + x1;\r\n            const index1 = y0 * TERRAIN_LOD_VERTS + x0;\r\n\r\n            indices[index++] = index0;\r\n            indices[index++] = index1;\r\n        }\r\n\r\n        // ender\r\n        indices[index++] = TERRAIN_LOD_VERTS - 1;\r\n        indices[index++] = TERRAIN_LOD_VERTS - 1;\r\n\r\n        this._connecterIndexPool[connecterIndex].size = index;\r\n        this._connecterIndexPool[connecterIndex].indices = indices;\r\n    }\r\n\r\n    private _genConnecterIndexSouth (level: number, connecter: number): void {\r\n        const connecterIndex = TerrainLod.mapIndex(level, connecter, TERRAIN_LOD_SOUTH_INDEX);\r\n\r\n        if (connecter < level || level === TERRAIN_LOD_LEVELS - 1) {\r\n            this._connecterIndexPool[connecterIndex].size = 0;\r\n            this._connecterIndexPool[connecterIndex].indices = null;\r\n            return;\r\n        }\r\n\r\n        const self_step = 1 << level;\r\n        const neighbor_step = 1 << connecter;\r\n        const self_tile = TERRAIN_LOD_TILES >> level;\r\n        const count = self_tile * 2 + 2;\r\n\r\n        let index = 0;\r\n        const indices = new Uint16Array(count);\r\n\r\n        // starter\r\n        indices[index++] = TERRAIN_LOD_TILES * TERRAIN_LOD_VERTS;\r\n        indices[index++] = TERRAIN_LOD_TILES * TERRAIN_LOD_VERTS;\r\n\r\n        // middler\r\n        for (let i = 1; i < self_tile; ++i) {\r\n            const x0 = i * self_step;\r\n            const y0 = TERRAIN_LOD_VERTS - 1 - self_step;\r\n            const x1 = x0 / neighbor_step * neighbor_step;\r\n            const y1 = y0 + self_step;\r\n\r\n            const index0 = y1 * TERRAIN_LOD_VERTS + x1;\r\n            const index1 = y0 * TERRAIN_LOD_VERTS + x0;\r\n\r\n            indices[index++] = index0;\r\n            indices[index++] = index1;\r\n        }\r\n\r\n        // ender\r\n        indices[index++] = TERRAIN_LOD_VERTS * TERRAIN_LOD_VERTS - 1;\r\n        indices[index++] = TERRAIN_LOD_VERTS * TERRAIN_LOD_VERTS - 1;\r\n\r\n        this._connecterIndexPool[connecterIndex].size = index;\r\n        this._connecterIndexPool[connecterIndex].indices = indices;\r\n    }\r\n\r\n    private _genConnecterIndexWest (level: number, connecter: number): void {\r\n        const connecterIndex = TerrainLod.mapIndex(level, connecter, TERRAIN_LOD_WEST_INDEX);\r\n\r\n        if (connecter < level || level === TERRAIN_LOD_LEVELS - 1) {\r\n            this._connecterIndexPool[connecterIndex].size = 0;\r\n            this._connecterIndexPool[connecterIndex].indices = null;\r\n            return;\r\n        }\r\n\r\n        const self_step = 1 << level;\r\n        const neighbor_step = 1 << connecter;\r\n        const self_tile = TERRAIN_LOD_TILES >> level;\r\n        const count = self_tile * 2 + 2;\r\n\r\n        let index = 0;\r\n        const indices = new Uint16Array(count);\r\n\r\n        // starter\r\n        indices[index++] = 0;\r\n        indices[index++] = 0;\r\n\r\n        // middler\r\n        for (let i = 1; i < self_tile; ++i)  {\r\n            const x0 = 0;\r\n            const y0 = i * self_step / neighbor_step * neighbor_step;\r\n            const x1 = self_step;\r\n            const y1 = i * self_step;\r\n\r\n            const index0 = y0 * TERRAIN_LOD_VERTS + x0;\r\n            const index1 = y1 * TERRAIN_LOD_VERTS + x1;\r\n\r\n            indices[index++] = index0;\r\n            indices[index++] = index1;\r\n        }\r\n\r\n        // ender\r\n        indices[index++] = TERRAIN_LOD_TILES * TERRAIN_LOD_VERTS;\r\n        indices[index++] = TERRAIN_LOD_TILES * TERRAIN_LOD_VERTS;\r\n\r\n        this._connecterIndexPool[connecterIndex].size = index;\r\n        this._connecterIndexPool[connecterIndex].indices = indices;\r\n    }\r\n\r\n    private _genConnecterIndexEast (level: number, connecter: number): void {\r\n        const connecterIndex = TerrainLod.mapIndex(level, connecter, TERRAIN_LOD_EAST_INDEX);\r\n\r\n        if (connecter < level || level === TERRAIN_LOD_LEVELS - 1) {\r\n            this._connecterIndexPool[connecterIndex].size = 0;\r\n            this._connecterIndexPool[connecterIndex].indices = null;\r\n            return;\r\n        }\r\n\r\n        const self_step = 1 << level;\r\n        const neighbor_step = 1 << connecter;\r\n        const self_tile = TERRAIN_LOD_TILES >> level;\r\n        const count = self_tile * 2 + 2;\r\n\r\n        let index = 0;\r\n        const indices = new Uint16Array(count);\r\n\r\n        // starter\r\n        indices[index++] = TERRAIN_LOD_VERTS - 1;\r\n        indices[index++] = TERRAIN_LOD_VERTS - 1;\r\n\r\n        // middler\r\n        for (let i = 1; i < self_tile; ++i) {\r\n            const x0 = TERRAIN_LOD_VERTS - 1 - self_step;\r\n            const y0 = i * self_step;\r\n            const x1 = TERRAIN_LOD_VERTS - 1;\r\n            const y1 = i * self_step / neighbor_step * neighbor_step;\r\n\r\n            const index0 = y0 * TERRAIN_LOD_VERTS + x0;\r\n            const index1 = y1 * TERRAIN_LOD_VERTS + x1;\r\n\r\n            indices[index++] = index0;\r\n            indices[index++] = index1;\r\n        }\r\n\r\n        // ender\r\n        indices[index++] = TERRAIN_LOD_VERTS * TERRAIN_LOD_VERTS - 1;\r\n        indices[index++] = TERRAIN_LOD_VERTS * TERRAIN_LOD_VERTS - 1;\r\n\r\n        this._connecterIndexPool[connecterIndex].size = index;\r\n        this._connecterIndexPool[connecterIndex].indices = indices;\r\n    }\r\n\r\n    private _getConnenterIndex (i: number, j: number, k: number): TerrainIndexPool {\r\n        return this._connecterIndexPool[TerrainLod.mapIndex(i, j, k)];\r\n    }\r\n\r\n    private _genIndexData (k: TerrainLodKey): TerrainIndexData | null {\r\n        let data = this.getIndexData(k);\r\n        if (data != null) {\r\n            return data;\r\n        }\r\n\r\n        const body = this._bodyIndexPool[k.level];\r\n        const north = this._getConnenterIndex(k.level, k.north, TERRAIN_LOD_NORTH_INDEX);\r\n        const south = this._getConnenterIndex(k.level, k.south, TERRAIN_LOD_SOUTH_INDEX);\r\n        const west = this._getConnenterIndex(k.level, k.west, TERRAIN_LOD_WEST_INDEX);\r\n        const east = this._getConnenterIndex(k.level, k.east, TERRAIN_LOD_EAST_INDEX);\r\n\r\n        data = new TerrainIndexData();\r\n        data.size = 0;\r\n        data.primCount = 0;\r\n\r\n        if (body.indices != null) {\r\n            data.size += body.size;\r\n        }\r\n        if (north.indices) {\r\n            data.size += (north.size - 2) * 3;\r\n        }\r\n        if (south.indices) {\r\n            data.size += (south.size - 2) * 3;\r\n        }\r\n        if (west.indices) {\r\n            data.size += (west.size - 2) * 3;\r\n        }\r\n        if (east.indices) {\r\n            data.size += (east.size - 2) * 3;\r\n        }\r\n\r\n        if (data.size === 0) {\r\n            return null;\r\n        }\r\n\r\n        let index = 0;\r\n        data.buffer = new Uint16Array(data.size);\r\n        data.key.level = k.level;\r\n        data.key.east = k.east;\r\n        data.key.west = k.west;\r\n        data.key.north = k.north;\r\n        data.key.south = k.south;\r\n\r\n        if (body.indices) {\r\n            for (let i = 0; i < body.size; ++i) {\r\n                data.buffer[index++] = body.indices[i];\r\n            }\r\n        }\r\n\r\n        if (north.indices) {\r\n            for (let i = 0; i < north.size - 2; i += 2)  {\r\n                const a = north.indices[i + 0];\r\n                const b = north.indices[i + 1];\r\n                const c = north.indices[i + 2];\r\n                const d = north.indices[i + 3];\r\n\r\n                data.buffer[index++] = a;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = b;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = d;\r\n                data.buffer[index++] = b;\r\n            }\r\n        }\r\n\r\n        if (south.indices)  {\r\n            for (let i = 0; i < south.size - 2; i += 2)  {\r\n                const a = south.indices[i + 0];\r\n                const b = south.indices[i + 1];\r\n                const c = south.indices[i + 2];\r\n                const d = south.indices[i + 3];\r\n\r\n                data.buffer[index++] = a;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = b;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = d;\r\n                data.buffer[index++] = b;\r\n            }\r\n        }\r\n\r\n        if (west.indices) {\r\n            for (let i = 0; i < west.size - 2; i += 2)  {\r\n                const a = west.indices[i + 0];\r\n                const b = west.indices[i + 1];\r\n                const c = west.indices[i + 2];\r\n                const d = west.indices[i + 3];\r\n\r\n                data.buffer[index++] = a;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = b;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = d;\r\n                data.buffer[index++] = b;\r\n            }\r\n        }\r\n\r\n        if (east.indices)  {\r\n            for (let i = 0; i < east.size - 2; i += 2) {\r\n                const a = east.indices[i + 0];\r\n                const b = east.indices[i + 1];\r\n                const c = east.indices[i + 2];\r\n                const d = east.indices[i + 3];\r\n\r\n                data.buffer[index++] = a;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = b;\r\n                data.buffer[index++] = c;\r\n                data.buffer[index++] = d;\r\n                data.buffer[index++] = b;\r\n            }\r\n        }\r\n\r\n        data.primCount = index / 3;\r\n        data.start = this._indexBuffer.length;\r\n        this._indexMap.push(data);\r\n\r\n        const temp = new Uint16Array(data.start + data.size);\r\n        temp.set(this._indexBuffer, 0);\r\n        temp.set(data.buffer, data.start);\r\n        this._indexBuffer = temp;\r\n\r\n        return data;\r\n    }\r\n}\r\n","/*\r\n Copyright (c) 2020-2023 Xiamen Yaji Software Co., Ltd.\r\n\r\n https://www.cocos.com/\r\n\r\n Permission is hereby granted, free of charge, to any person obtaining a copy\r\n of this software and associated documentation files (the \"Software\"), to deal\r\n in the Software without restriction, including without limitation the rights to\r\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\r\n of the Software, and to permit persons to whom the Software is furnished to do so,\r\n subject to the following conditions:\r\n\r\n The above copyright notice and this permission notice shall be included in\r\n all copies or substantial portions of the Software.\r\n\r\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n THE SOFTWARE.\r\n*/\r\n\r\nimport { ccclass, disallowMultiple, executeInEditMode, help, visible, type, serializable, editable, disallowAnimation, menu } from 'cc.decorator';\r\nimport { EDITOR } from 'internal:constants';\r\nimport { builtinResMgr } from '../asset/asset-manager';\r\nimport { ModelRenderer } from '../misc/model-renderer';\r\nimport { EffectAsset, Texture2D } from '../asset/assets';\r\nimport { TextureFilter, PixelFormat, WrapMode } from '../asset/assets/asset-enum';\r\nimport { Material } from '../asset/assets/material';\r\nimport { RenderingSubMesh } from '../asset/assets/rendering-sub-mesh';\r\nimport { Component } from '../scene-graph/component';\r\nimport { CCObjectFlags, isValid } from '../core/data/object';\r\nimport { director } from '../game/director';\r\nimport { AttributeName, BufferUsageBit, Format, MemoryUsageBit, PrimitiveMode, Attribute, Buffer, BufferInfo, deviceManager, Texture } from '../gfx';\r\nimport { clamp, Rect, Size, v3, Vec2, Vec3, Vec4 } from '../core/math';\r\nimport { MacroRecord } from '../render-scene/core/pass-utils';\r\nimport { Pass, scene } from '../render-scene';\r\nimport { Camera } from '../render-scene/scene/camera';\r\nimport { Root } from '../root';\r\nimport { HeightField } from './height-field';\r\nimport { legacyCC } from '../core/global-exports';\r\nimport { TerrainLod, TerrainLodKey, TERRAIN_LOD_LEVELS, TERRAIN_LOD_MAX_DISTANCE, TerrainIndexData } from './terrain-lod';\r\nimport { TerrainAsset, TerrainLayerInfo, TERRAIN_HEIGHT_BASE, TERRAIN_HEIGHT_FACTORY,\r\n    TERRAIN_BLOCK_TILE_COMPLEXITY, TERRAIN_BLOCK_VERTEX_SIZE, TERRAIN_BLOCK_VERTEX_COMPLEXITY,\r\n    TERRAIN_MAX_LAYER_COUNT, TERRAIN_HEIGHT_FMIN, TERRAIN_HEIGHT_FMAX, TERRAIN_MAX_BLEND_LAYERS, TERRAIN_DATA_VERSION5 } from './terrain-asset';\r\nimport { CCFloat } from '../core';\r\nimport { PipelineEventType } from '../rendering';\r\nimport { MobilityMode, Node } from '../scene-graph';\r\n\r\n// the same as dependentAssets: legacy/terrain.effect\r\nconst TERRAIN_EFFECT_UUID = '1d08ef62-a503-4ce2-8b9a-46c90873f7d3';\r\n\r\n/**\r\n * @en Terrain info\r\n * @zh 地形信息\r\n */\r\n@ccclass('cc.TerrainInfo')\r\nexport class TerrainInfo {\r\n    constructor () {\r\n    }\r\n    /**\r\n     * @en tile size\r\n     * @zh 栅格大小\r\n     */\r\n    @serializable\r\n    @editable\r\n    public tileSize = 1;\r\n\r\n    /**\r\n     * @en block count\r\n     * @zh 地形块的数量\r\n     */\r\n    @serializable\r\n    @editable\r\n    public blockCount: number[] = [1, 1];\r\n\r\n    /**\r\n     * @en weight map size\r\n     * @zh 权重图大小\r\n     */\r\n    @serializable\r\n    @editable\r\n    public weightMapSize = 128;\r\n\r\n    /**\r\n     * @en light map size\r\n     * @zh 光照图大小\r\n     */\r\n    @serializable\r\n    @editable\r\n    public lightMapSize = 128;\r\n\r\n    /**\r\n     * @en terrain size\r\n     * @zh 地形大小\r\n     */\r\n    public get size (): Size {\r\n        const sz = new Size(0, 0);\r\n        sz.width = this.blockCount[0] * TERRAIN_BLOCK_TILE_COMPLEXITY * this.tileSize;\r\n        sz.height = this.blockCount[1] * TERRAIN_BLOCK_TILE_COMPLEXITY * this.tileSize;\r\n        return sz;\r\n    }\r\n\r\n    /**\r\n     * @en tile count\r\n     * @zh 栅格数量\r\n     */\r\n    public get tileCount (): number[] {\r\n        const _tileCount = [0, 0];\r\n        _tileCount[0] = this.blockCount[0] * TERRAIN_BLOCK_TILE_COMPLEXITY;\r\n        _tileCount[1] = this.blockCount[1] * TERRAIN_BLOCK_TILE_COMPLEXITY;\r\n        return _tileCount;\r\n    }\r\n\r\n    /**\r\n     * @en vertex count\r\n     * @zh 顶点数量\r\n     */\r\n    public get vertexCount (): number[] {\r\n        const _vertexCount = this.tileCount;\r\n        _vertexCount[0] += 1;\r\n        _vertexCount[1] += 1;\r\n        return _vertexCount;\r\n    }\r\n}\r\n\r\n/**\r\n * @en Terrain layer\r\n * @zh 地形纹理层\r\n */\r\n@ccclass('cc.TerrainLayer')\r\nexport class TerrainLayer {\r\n    /**\r\n     * @en detail texture\r\n     * @zh 细节纹理\r\n     */\r\n    @serializable\r\n    @editable\r\n    public detailMap: Texture2D|null = null;\r\n\r\n    /**\r\n     * @en normal texture\r\n     * @zh 法线纹理\r\n     */\r\n    @serializable\r\n    @editable\r\n    public normalMap: Texture2D|null = null;\r\n\r\n    /**\r\n     * @en tile size\r\n     * @zh 平铺大小\r\n     */\r\n    @serializable\r\n    @editable\r\n    public tileSize = 1;\r\n\r\n    /**\r\n     * @en metallic\r\n     * @zh 金属性\r\n     */\r\n    @serializable\r\n    @editable\r\n    public metallic = 0; /* [0, 1] */\r\n\r\n    /**\r\n     * @en roughness\r\n     * @zh 粗糙度\r\n     */\r\n    @serializable\r\n    @editable\r\n    public roughness = 1; /* [0, 1] */\r\n}\r\n\r\n/**\r\n * @en Terrain renderable\r\n * @zh 地形渲染组件\r\n */\r\nclass TerrainRenderable extends ModelRenderer {\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _model: scene.Model | null = null;\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _meshData: RenderingSubMesh | null = null;\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _brushPass: Pass | null = null;\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _brushMaterial: Material | null = null;\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _currentMaterial: Material | null = null;\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _currentMaterialLayers = 0;\r\n\r\n    /**\r\n     * @engineInternal\r\n     * @mangle\r\n     */\r\n    public _lightmap: Texture2D | null = null;\r\n\r\n    public destroy (): boolean {\r\n        // this._invalidMaterial();\r\n        if (this._model != null) {\r\n            legacyCC.director.root.destroyModel(this._model);\r\n            this._model = null;\r\n        }\r\n\r\n        return super.destroy();\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _destroyModel (): void {\r\n        // this._invalidMaterial();\r\n        if (this._model != null) {\r\n            legacyCC.director.root.destroyModel(this._model);\r\n            this._model = null;\r\n        }\r\n\r\n        if (this._meshData != null) {\r\n            this._meshData.destroy();\r\n            this._meshData = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _invalidMaterial (): void {\r\n        if (this._currentMaterial == null) {\r\n            return;\r\n        }\r\n\r\n        this._clearMaterials();\r\n\r\n        this._brushPass = null;\r\n        this._currentMaterial = null;\r\n        if (this._model != null) {\r\n            this._model.enabled = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _updateMaterial (block: TerrainBlock, init: boolean): boolean {\r\n        if (this._meshData == null || this._model == null) {\r\n            return false;\r\n        }\r\n\r\n        const nLayers = block.getMaxLayer();\r\n        if (this._currentMaterial == null || nLayers !== this._currentMaterialLayers) {\r\n            this._currentMaterial = new Material();\r\n\r\n            this._currentMaterial.initialize({\r\n                effectAsset: block.getTerrain().getEffectAsset(),\r\n                defines: block._getMaterialDefines(nLayers),\r\n            });\r\n\r\n            if (this._brushMaterial !== null) {\r\n                // Create brush material instance, avoid being destroyed by material gc\r\n                const brushMaterialInstance = new Material();\r\n                brushMaterialInstance.copy(this._brushMaterial);\r\n\r\n                this._brushPass = null;\r\n                if (brushMaterialInstance.passes !== null && brushMaterialInstance.passes.length > 0) {\r\n                    this._brushPass = brushMaterialInstance.passes[0];\r\n                    const passes = this._currentMaterial.passes;\r\n                    passes.push(this._brushPass);\r\n                    brushMaterialInstance.passes.pop();\r\n                }\r\n            }\r\n\r\n            if (init) {\r\n                this._model.initSubModel(0, this._meshData, this._currentMaterial);\r\n            }\r\n\r\n            this.setSharedMaterial(this._currentMaterial, 0);\r\n\r\n            this._currentMaterialLayers = nLayers;\r\n            this._model.enabled = true;\r\n            this._model.receiveShadow = block.getTerrain().receiveShadow;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _updateLightingmap (texture: Texture2D | null, uvParam: Vec4): void {\r\n        if (this._model == null) {\r\n            return;\r\n        }\r\n\r\n        this._lightmap = texture;\r\n        this._updateReceiveDirLight();\r\n        this._model.updateLightingmap(texture, uvParam);\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _onMaterialModified (idx: number, mtl: Material|null): void {\r\n        if (this._model == null) {\r\n            return;\r\n        }\r\n        this._onRebuildPSO(idx, mtl || this._getBuiltinMaterial());\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    public _onRebuildPSO (idx: number, material: Material): void {\r\n        if (this._model) {\r\n            this._model.setSubModelMaterial(idx, material);\r\n        }\r\n    }\r\n\r\n    protected _clearMaterials (): void {\r\n        if (this._model == null) {\r\n            return;\r\n        }\r\n\r\n        this._onMaterialModified(0, null);\r\n    }\r\n\r\n    protected _onUpdateReceiveDirLight (visibility: number, forceClose = false): void {\r\n        if (!this._model) { return; }\r\n        if (forceClose) {\r\n            this._model.receiveDirLight = false;\r\n            return;\r\n        }\r\n        if (this.node && ((visibility & this.node.layer) === this.node.layer)\r\n        || (visibility & this._model.visFlags)) {\r\n            this._model.receiveDirLight = true;\r\n        } else {\r\n            this._model.receiveDirLight = false;\r\n        }\r\n    }\r\n\r\n    protected _updateReceiveDirLight (): void {\r\n        const scene = this.node.scene;\r\n        if (!scene || !scene.renderScene) { return; }\r\n        const mainLight = scene.renderScene.mainLight;\r\n        if (!mainLight) { return; }\r\n        const visibility = mainLight.visibility;\r\n        if (!mainLight.node) { return; }\r\n        if (mainLight.node.mobility === MobilityMode.Static && this._lightmap) {\r\n            this._onUpdateReceiveDirLight(visibility, true);\r\n        } else {\r\n            this._onUpdateReceiveDirLight(visibility);\r\n        }\r\n    }\r\n\r\n    private _getBuiltinMaterial (): Material {\r\n        return builtinResMgr.get<Material>('missing-material');\r\n    }\r\n}\r\n\r\n/**\r\n * @en Terrain block light map info\r\n * @zh 地形块光照图信息\r\n */\r\n@ccclass('cc.TerrainBlockLightmapInfo')\r\nexport class TerrainBlockLightmapInfo {\r\n    @serializable\r\n    @editable\r\n    public texture: Texture2D|null = null;\r\n    @serializable\r\n    @editable\r\n    public UOff = 0;\r\n    @serializable\r\n    @editable\r\n    public VOff = 0;\r\n    @serializable\r\n    @editable\r\n    public UScale = 0;\r\n    @serializable\r\n    @editable\r\n    public VScale = 0;\r\n}\r\n\r\n/**\r\n * @en Terrain block\r\n * @zh 地形块\r\n */\r\nexport class TerrainBlock {\r\n    private _terrain: Terrain;\r\n    private _node: Node;\r\n    private _renderable: TerrainRenderable;\r\n    private _index: number[] = [1, 1];\r\n    private _weightMap: Texture2D|null = null;\r\n    private _lightmapInfo: TerrainBlockLightmapInfo|null = null;\r\n    private _lodLevel = 0;\r\n    private _lodKey: TerrainLodKey = new TerrainLodKey();\r\n    private _errorMetrics: number[] = [0, 0, 0, 0];\r\n    private _LevelDistances: number[] = [TERRAIN_LOD_MAX_DISTANCE, TERRAIN_LOD_MAX_DISTANCE, TERRAIN_LOD_MAX_DISTANCE, TERRAIN_LOD_MAX_DISTANCE];\r\n    private _bbMin = v3();\r\n    private _bbMax = v3();\r\n\r\n    constructor (t: Terrain, i: number, j: number) {\r\n        this._terrain = t;\r\n        this._index[0] = i;\r\n        this._index[1] = j;\r\n        this._lightmapInfo = t._getLightmapInfo(i, j);\r\n\r\n        this._node = new Node('TerrainBlock');\r\n        this._node.setParent(this._terrain.node);\r\n        this._node.hideFlags |= CCObjectFlags.DontSave | CCObjectFlags.HideInHierarchy;\r\n        this._node.layer = this._terrain.node.layer;\r\n\r\n        this._renderable = this._node.addComponent(TerrainRenderable);\r\n    }\r\n\r\n    public build (): void {\r\n        const gfxDevice = director.root!.device;\r\n\r\n        // vertex buffer\r\n        const vertexData = new Float32Array(TERRAIN_BLOCK_VERTEX_SIZE * TERRAIN_BLOCK_VERTEX_COMPLEXITY * TERRAIN_BLOCK_VERTEX_COMPLEXITY);\r\n        this._buildVertexData(vertexData);\r\n        const vertexBuffer = gfxDevice.createBuffer(new BufferInfo(\r\n            BufferUsageBit.VERTEX | BufferUsageBit.TRANSFER_DST,\r\n            MemoryUsageBit.DEVICE,\r\n            TERRAIN_BLOCK_VERTEX_SIZE * Float32Array.BYTES_PER_ELEMENT * TERRAIN_BLOCK_VERTEX_COMPLEXITY * TERRAIN_BLOCK_VERTEX_COMPLEXITY,\r\n            TERRAIN_BLOCK_VERTEX_SIZE * Float32Array.BYTES_PER_ELEMENT,\r\n        ));\r\n        vertexBuffer.update(vertexData);\r\n\r\n        // build bounding box\r\n        this._buildBoundingBox();\r\n\r\n        // initialize renderable\r\n        const gfxAttributes: Attribute[] = [\r\n            new Attribute(AttributeName.ATTR_POSITION, Format.RGB32F),\r\n            new Attribute(AttributeName.ATTR_NORMAL, Format.RGB32F),\r\n            new Attribute(AttributeName.ATTR_TEX_COORD, Format.RG32F),\r\n        ];\r\n\r\n        this._renderable._meshData = new RenderingSubMesh(\r\n            [vertexBuffer],\r\n            gfxAttributes,\r\n            PrimitiveMode.TRIANGLE_LIST,\r\n            this._terrain._getSharedIndexBuffer(),\r\n            null,\r\n            false,\r\n        );\r\n        this._renderable._model = (legacyCC.director.root as Root).createModel(scene.Model);\r\n        this._renderable._model.createBoundingShape(this._bbMin, this._bbMax);\r\n        this._renderable._model.node = this._renderable._model.transform = this._node;\r\n        // ensure the terrain node is in the scene\r\n        if (this._renderable.node.scene != null) {\r\n            this.visible = true;\r\n        }\r\n\r\n        // reset weightMap\r\n        this._updateWeightMap();\r\n\r\n        // reset material\r\n        this._updateMaterial(true);\r\n\r\n        if (this._terrain.lodEnable) {\r\n            // update lod\r\n            this._updateLodBuffer(vertexData);\r\n            // update index buffer\r\n            this._updateIndexBuffer();\r\n        }\r\n    }\r\n\r\n    public rebuild (): void {\r\n        this._updateHeight();\r\n        this._updateWeightMap();\r\n\r\n        this._renderable._invalidMaterial();\r\n        this._updateMaterial(false);\r\n    }\r\n\r\n    public destroy (): void {\r\n        this.visible = false;\r\n        this._renderable._destroyModel();\r\n\r\n        if (this._node != null && this._node.isValid) {\r\n            this._node.destroy();\r\n        }\r\n        if (this._weightMap != null) {\r\n            this._weightMap.destroy();\r\n        }\r\n    }\r\n\r\n    public update (): void {\r\n        this._updateMaterial(false);\r\n\r\n        if (this.lightmap !== this._renderable._lightmap) {\r\n            this._renderable._updateLightingmap(this.lightmap, this.lightmapUVParam);\r\n        }\r\n\r\n        const useNormalMap = this._terrain.useNormalMap;\r\n        const usePBR = this._terrain.usePBR;\r\n\r\n        // eslint-disable-next-line arrow-body-style\r\n        const getDetailTex = (layer: TerrainLayer|null): Texture2D | null => {\r\n            return layer !== null ? layer.detailMap : null;\r\n        };\r\n\r\n        const getNormalTex = (layer: TerrainLayer|null): Texture2D | null => {\r\n            let normalTex = layer !== null ? layer.normalMap : null;\r\n            if (normalTex === null) {\r\n                normalTex = builtinResMgr.get<Texture2D>('normal-texture');\r\n            }\r\n\r\n            return normalTex;\r\n        };\r\n\r\n        const mtl = this._renderable._currentMaterial;\r\n        if (mtl !== null) {\r\n            const nLayers = this.getMaxLayer();\r\n            const uvScale = new Vec4(1, 1, 1, 1);\r\n            const roughness = new Vec4(1, 1, 1, 1);\r\n            const metallic = new Vec4(0, 0, 0, 0);\r\n\r\n            if (nLayers === 0) {\r\n                if (this.layers[0] !== -1) {\r\n                    const l0 = this._terrain.getLayer(this.layers[0]);\r\n\r\n                    if (l0 !== null) {\r\n                        uvScale.x = 1.0 / l0.tileSize;\r\n                        roughness.x = l0.roughness;\r\n                        metallic.x = l0.metallic;\r\n                    }\r\n\r\n                    mtl.setProperty('detailMap0', getDetailTex(l0));\r\n                    if (useNormalMap) {\r\n                        mtl.setProperty('normalMap0', getNormalTex(l0));\r\n                    }\r\n                } else {\r\n                    mtl.setProperty('detailMap0', builtinResMgr.get<Texture2D>('default-texture'));\r\n                    if (useNormalMap) {\r\n                        mtl.setProperty('normalMap0', builtinResMgr.get<Texture2D>('normal-texture'));\r\n                    }\r\n                }\r\n            } else if (nLayers === 1) {\r\n                const l0 = this._terrain.getLayer(this.layers[0]);\r\n                const l1 = this._terrain.getLayer(this.layers[1]);\r\n\r\n                if (l0 !== null) {\r\n                    uvScale.x = 1.0 / l0.tileSize;\r\n                    roughness.x = l0.roughness;\r\n                    metallic.x = l0.metallic;\r\n                }\r\n                if (l1 !== null) {\r\n                    uvScale.y = 1.0 / l1.tileSize;\r\n                    roughness.y = l1.roughness;\r\n                    metallic.y = l1.metallic;\r\n                }\r\n\r\n                mtl.setProperty('weightMap', this._weightMap);\r\n                mtl.setProperty('detailMap0', getDetailTex(l0));\r\n                mtl.setProperty('detailMap1', getDetailTex(l1));\r\n                if (useNormalMap) {\r\n                    mtl.setProperty('normalMap0', getNormalTex(l0));\r\n                    mtl.setProperty('normalMap1', getNormalTex(l1));\r\n                }\r\n            } else if (nLayers === 2) {\r\n                const l0 = this._terrain.getLayer(this.layers[0]);\r\n                const l1 = this._terrain.getLayer(this.layers[1]);\r\n                const l2 = this._terrain.getLayer(this.layers[2]);\r\n\r\n                if (l0 !== null) {\r\n                    uvScale.x = 1.0 / l0.tileSize;\r\n                    roughness.x = l0.roughness;\r\n                    metallic.x = l0.metallic;\r\n                }\r\n                if (l1 !== null) {\r\n                    uvScale.y = 1.0 / l1.tileSize;\r\n                    roughness.y = l1.roughness;\r\n                    metallic.y = l1.metallic;\r\n                }\r\n                if (l2 !== null) {\r\n                    uvScale.z = 1.0 / l2.tileSize;\r\n                    roughness.z = l2.roughness;\r\n                    metallic.z = l2.metallic;\r\n                }\r\n\r\n                mtl.setProperty('weightMap', this._weightMap);\r\n                mtl.setProperty('detailMap0', getDetailTex(l0));\r\n                mtl.setProperty('detailMap1', getDetailTex(l1));\r\n                mtl.setProperty('detailMap2', getDetailTex(l2));\r\n                if (useNormalMap) {\r\n                    mtl.setProperty('normalMap0', getNormalTex(l0));\r\n                    mtl.setProperty('normalMap1', getNormalTex(l1));\r\n                    mtl.setProperty('normalMap2', getNormalTex(l2));\r\n                }\r\n            } else if (nLayers === 3) {\r\n                const l0 = this._terrain.getLayer(this.layers[0]);\r\n                const l1 = this._terrain.getLayer(this.layers[1]);\r\n                const l2 = this._terrain.getLayer(this.layers[2]);\r\n                const l3 = this._terrain.getLayer(this.layers[3]);\r\n\r\n                if (l0 !== null) {\r\n                    uvScale.x = 1.0 / l0.tileSize;\r\n                    roughness.x = l0.roughness;\r\n                    metallic.x = l0.metallic;\r\n                }\r\n                if (l1 !== null) {\r\n                    uvScale.y = 1.0 / l1.tileSize;\r\n                    roughness.y = l1.roughness;\r\n                    metallic.y = l1.metallic;\r\n                }\r\n                if (l2 !== null) {\r\n                    uvScale.z = 1.0 / l2.tileSize;\r\n                    roughness.z = l2.roughness;\r\n                    metallic.z = l2.metallic;\r\n                }\r\n                if (l3 !== null) {\r\n                    uvScale.w = 1.0 / l3.tileSize;\r\n                    roughness.w = l3.roughness;\r\n                    metallic.w = l3.metallic;\r\n                }\r\n\r\n                mtl.setProperty('weightMap', this._weightMap);\r\n                mtl.setProperty('detailMap0', getDetailTex(l0));\r\n                mtl.setProperty('detailMap1', getDetailTex(l1));\r\n                mtl.setProperty('detailMap2', getDetailTex(l2));\r\n                mtl.setProperty('detailMap3', getDetailTex(l3));\r\n                if (useNormalMap) {\r\n                    mtl.setProperty('normalMap0', getNormalTex(l0));\r\n                    mtl.setProperty('normalMap1', getNormalTex(l1));\r\n                    mtl.setProperty('normalMap2', getNormalTex(l2));\r\n                    mtl.setProperty('normalMap3', getNormalTex(l3));\r\n                }\r\n            }\r\n\r\n            mtl.setProperty('UVScale', uvScale);\r\n            if (usePBR) {\r\n                mtl.setProperty('roughness', roughness);\r\n                mtl.setProperty('metallic', metallic);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     */\r\n    public _buildLodInfo (): void {\r\n        const vertexData = new Float32Array(TERRAIN_BLOCK_VERTEX_SIZE * TERRAIN_BLOCK_VERTEX_COMPLEXITY * TERRAIN_BLOCK_VERTEX_COMPLEXITY);\r\n        this._buildVertexData(vertexData);\r\n        // update lod\r\n        this._updateLodBuffer(vertexData);\r\n        // update index buffer\r\n        this._updateIndexBuffer();\r\n    }\r\n\r\n    /**\r\n     * @engineInternal\r\n     * @mangle\r\n     */\r\n    public _updateLevel (camPos: Vec3): void {\r\n        const terrain = this._terrain;\r\n        const terrainNode = terrain.node;\r\n\r\n        const maxLevel = TERRAIN_LOD_LEVELS - 1;\r\n        const bbMin = v3();\r\n        const bbMax = v3();\r\n\r\n        Vec3.add(bbMin, this._bbMin, terrainNode.worldPosition);\r\n        Vec3.add(bbMax, this._bbMax, terrainNode.worldPosition);\r\n\r\n        const d1 = Vec3.distance(bbMin, camPos);\r\n        const d2 = Vec3.distance(bbMax, camPos);\r\n        let d = Math.min(d1, d2);\r\n\r\n        d -= terrain.LodBias;\r\n\r\n        this._lodLevel = 0;\r\n        while (this._lodLevel < maxLevel) {\r\n            const ld1 = this._LevelDistances[this._lodLevel + 1];\r\n            if (d <= ld1) {\r\n                break;\r\n            }\r\n\r\n            ++this._lodLevel;\r\n        }\r\n    }\r\n\r\n    public setBrushMaterial (mtl: Material|null): void {\r\n        if (this._renderable._brushMaterial !== mtl) {\r\n            this._renderable._invalidMaterial();\r\n            this._renderable._brushMaterial = mtl;\r\n        }\r\n    }\r\n\r\n    public _getBrushMaterial (): Material | null {\r\n        return this._renderable ? this._renderable._brushMaterial : null;\r\n    }\r\n\r\n    public _getBrushPass (): Pass | null {\r\n        return this._renderable ? this._renderable._brushPass : null;\r\n    }\r\n\r\n    /**\r\n     * @en valid\r\n     * @zh 是否有效\r\n     */\r\n    get valid (): boolean {\r\n        if (this._terrain === null) {\r\n            return false;\r\n        }\r\n\r\n        const blocks = this._terrain.getBlocks();\r\n        for (let i = 0; i < blocks.length; ++i) {\r\n            if (blocks[i] === this) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @en get current material\r\n     * @zh 获得当前的材质\r\n     */\r\n    get material (): Material | null {\r\n        return this._renderable ? this._renderable._currentMaterial : null;\r\n    }\r\n\r\n    /**\r\n     * @en get layers\r\n     * @zh 获得纹理层索引\r\n     */\r\n    get layers (): number[] {\r\n        return this._terrain.getBlockLayers(this._index[0], this._index[1]);\r\n    }\r\n\r\n    /**\r\n     * @en get weight map\r\n     * @zh 获得权重图\r\n     */\r\n    get weightmap (): Texture2D | null {\r\n        return this._weightMap;\r\n    }\r\n\r\n    /**\r\n     * @en get light map\r\n     * @zh 获得光照图\r\n     */\r\n    get lightmap (): Texture2D | null {\r\n        return this._lightmapInfo ? this._lightmapInfo.texture : null;\r\n    }\r\n\r\n    /**\r\n     * @en get light map uv parameter\r\n     * @zh 获得光照图纹理坐标参数\r\n     */\r\n    get lightmapUVParam (): Vec4 {\r\n        if (this._lightmapInfo != null) {\r\n            return new Vec4(this._lightmapInfo.UOff, this._lightmapInfo.VOff, this._lightmapInfo.UScale, this._lightmapInfo.VScale);\r\n        }\r\n\r\n        return new Vec4(0, 0, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * @zh 地形块的可见性\r\n     * @en The visibility of the block\r\n     */\r\n    set visible (val) {\r\n        if (this._renderable._model !== null) {\r\n            if (val) {\r\n                if (this._terrain.node != null\r\n                    && this._terrain.node.scene != null\r\n                    && this._terrain.node.scene.renderScene != null\r\n                    && this._renderable._model.scene == null) {\r\n                    this._terrain.node.scene.renderScene.addModel(this._renderable._model);\r\n                }\r\n            } else if (this._renderable._model.scene !== null) {\r\n                this._renderable._model.scene.removeModel(this._renderable._model);\r\n            }\r\n        }\r\n    }\r\n\r\n    get visible (): boolean {\r\n        if (this._renderable._model !== null) {\r\n            return this._renderable._model.scene !== null;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @en get terrain owner\r\n     * @zh 获得地形对象\r\n     */\r\n    public getTerrain (): Terrain {\r\n        return this._terrain;\r\n    }\r\n\r\n    /**\r\n     * @en get index\r\n     * @zh 获得地形索引\r\n     */\r\n    public getIndex (): number[] {\r\n        return this._index;\r\n    }\r\n\r\n    /**\r\n     * @en get rect bound\r\n     * @zh 获得地形矩形包围体\r\n     */\r\n    public getRect (): Rect {\r\n        const rect = new Rect();\r\n        rect.x = this._index[0] * TERRAIN_BLOCK_TILE_COMPLEXITY;\r\n        rect.y = this._index[1] * TERRAIN_BLOCK_TILE_COMPLEXITY;\r\n        rect.width = TERRAIN_BLOCK_TILE_COMPLEXITY;\r\n        rect.height = TERRAIN_BLOCK_TILE_COMPLEXITY;\r\n\r\n        return rect;\r\n    }\r\n\r\n    /**\r\n     * @en set layer\r\n     * @zh 设置纹理层\r\n     */\r\n    public setLayer (index: number, layerId: number): void {\r\n        if (this.layers[index] !== layerId) {\r\n            this._terrain.setBlockLayer(this._index[0], this._index[1], index, layerId);\r\n            this._renderable._invalidMaterial();\r\n            this._updateMaterial(false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en get layer\r\n     * @zh 获得纹理层\r\n     */\r\n    public getLayer (index: number): number {\r\n        return this.layers[index];\r\n    }\r\n\r\n    /**\r\n     * @en get max layer index\r\n     * @zh 获得最大纹理索引\r\n     */\r\n    public getMaxLayer (): number {\r\n        if (this.layers[3] >= 0) {\r\n            return 3;\r\n        }\r\n        if (this.layers[2] >= 0) {\r\n            return 2;\r\n        }\r\n        if (this.layers[1] >= 0) {\r\n            return 1;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    public _getMaterialDefines (nLayers: number): MacroRecord {\r\n        let lightmapMacroValue = 1; /*static*/\r\n        if (this._terrain.node && this._terrain.node.scene) {\r\n            if (this._terrain.node.scene.globals.bakedWithStationaryMainLight) {\r\n                lightmapMacroValue = 2; /*stationary*/\r\n            }\r\n        }\r\n        return {\r\n            LAYERS: nLayers + 1,\r\n            CC_USE_LIGHTMAP: this.lightmap !== null ? lightmapMacroValue : 0,\r\n            USE_NORMALMAP: this._terrain.useNormalMap ? 1 : 0,\r\n            USE_PBR: this._terrain.usePBR ? 1 : 0,\r\n            // CC_RECEIVE_SHADOW: this._terrain.receiveShadow ? 1 : 0,\r\n        };\r\n    }\r\n\r\n    public _invalidMaterial (): void {\r\n        this._renderable._invalidMaterial();\r\n    }\r\n\r\n    public _updateMaterial (init: boolean): void {\r\n        if (this._renderable._updateMaterial(this, init)) {\r\n            // Need set wrap mode clamp to border\r\n            if (this.lightmap !== null) {\r\n                this.lightmap.setWrapMode(WrapMode.CLAMP_TO_BORDER, WrapMode.CLAMP_TO_BORDER);\r\n            }\r\n\r\n            this._renderable._updateLightingmap(this.lightmap, this.lightmapUVParam);\r\n        }\r\n    }\r\n\r\n    public _updateHeight (): void {\r\n        if (this._renderable._meshData == null) {\r\n            return;\r\n        }\r\n\r\n        const vertexData = new Float32Array(TERRAIN_BLOCK_VERTEX_SIZE * TERRAIN_BLOCK_VERTEX_COMPLEXITY * TERRAIN_BLOCK_VERTEX_COMPLEXITY);\r\n        this._buildVertexData(vertexData);\r\n        this._renderable._meshData.vertexBuffers[0].update(vertexData);\r\n\r\n        this._buildBoundingBox();\r\n        this._renderable._model!.createBoundingShape(this._bbMin, this._bbMax);\r\n        this._renderable._model!.updateWorldBound();\r\n\r\n        this._updateLodBuffer(vertexData);\r\n\r\n        this._updateIndexBuffer();\r\n    }\r\n\r\n    public _updateWeightMap (): void {\r\n        const nLayers = this.getMaxLayer();\r\n\r\n        if (nLayers === 0) {\r\n            if (this._weightMap != null) {\r\n                this._weightMap.destroy();\r\n                this._weightMap = null;\r\n            }\r\n\r\n            return;\r\n        }\r\n\r\n        if (this._weightMap == null) {\r\n            this._weightMap = new Texture2D();\r\n            this._weightMap.create(this._terrain.weightMapSize, this._terrain.weightMapSize, PixelFormat.RGBA8888);\r\n            this._weightMap.setFilters(TextureFilter.LINEAR, TextureFilter.LINEAR);\r\n            this._weightMap.setWrapMode(WrapMode.CLAMP_TO_EDGE, WrapMode.CLAMP_TO_EDGE);\r\n        }\r\n\r\n        const weightData = new Uint8Array(this._terrain.weightMapSize * this._terrain.weightMapSize * 4);\r\n        let weightIndex = 0;\r\n        for (let j = 0; j < this._terrain.weightMapSize; ++j) {\r\n            for (let i = 0; i < this._terrain.weightMapSize; ++i) {\r\n                const x = this._index[0] * this._terrain.weightMapSize + i;\r\n                const y = this._index[1] * this._terrain.weightMapSize + j;\r\n                const w = this._terrain.getWeight(x, y);\r\n\r\n                weightData[weightIndex * 4 + 0] = Math.floor(w.x * 255);\r\n                weightData[weightIndex * 4 + 1] = Math.floor(w.y * 255);\r\n                weightData[weightIndex * 4 + 2] = Math.floor(w.z * 255);\r\n                weightData[weightIndex * 4 + 3] = Math.floor(w.w * 255);\r\n\r\n                weightIndex += 1;\r\n            }\r\n        }\r\n        this._weightMap.uploadData(weightData);\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _updateLightmap (info: TerrainBlockLightmapInfo): void {\r\n        this._lightmapInfo = info;\r\n        this._invalidMaterial();\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _updateLod (): void {\r\n        const key = new TerrainLodKey();\r\n        key.level = this._lodLevel;\r\n        key.north = this._lodLevel;\r\n        key.south = this._lodLevel;\r\n        key.west = this._lodLevel;\r\n        key.east = this._lodLevel;\r\n\r\n        if (this._index[0] > 0) {\r\n            const n = this.getTerrain().getBlock(this._index[0] - 1, this._index[1]);\r\n            key.west = n._lodLevel;\r\n            if (key.west < this._lodLevel) {\r\n                key.west = this._lodLevel;\r\n            }\r\n        }\r\n\r\n        if (this._index[0] < this._terrain.info.blockCount[0] - 1) {\r\n            const n = this.getTerrain().getBlock(this._index[0] + 1, this._index[1]);\r\n            key.east = n._lodLevel;\r\n            if (key.east < this._lodLevel) {\r\n                key.east = this._lodLevel;\r\n            }\r\n        }\r\n\r\n        if (this._index[1] > 0) {\r\n            const n = this.getTerrain().getBlock(this._index[0], this._index[1] - 1);\r\n            key.north = n._lodLevel;\r\n            if (key.north < this._lodLevel) {\r\n                key.north = this._lodLevel;\r\n            }\r\n        }\r\n\r\n        if (this._index[1] < this._terrain.info.blockCount[1] - 1) {\r\n            const n = this.getTerrain().getBlock(this._index[0], this._index[1] + 1);\r\n            key.south = n._lodLevel;\r\n            if (key.south < this._lodLevel) {\r\n                key.south = this._lodLevel;\r\n            }\r\n        }\r\n\r\n        if (this._lodKey.equals(key)) {\r\n            return;\r\n        }\r\n\r\n        this._lodKey = key;\r\n        this._updateIndexBuffer();\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _resetLod (): void {\r\n        const key = new TerrainLodKey();\r\n        key.level = 0;\r\n        key.north = 0;\r\n        key.south = 0;\r\n        key.west = 0;\r\n        key.east = 0;\r\n\r\n        if (this._lodKey.equals(key)) {\r\n            return;\r\n        }\r\n\r\n        this._lodKey = key;\r\n        this._updateIndexBuffer();\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _updateIndexBuffer (): void {\r\n        if (this._renderable._meshData === null) {\r\n            return;\r\n        }\r\n        if (this._renderable._model === null) {\r\n            return;\r\n        }\r\n        if (this._renderable._model.subModels.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const indexData = this._terrain._getIndexData(this._lodKey);\r\n        if (indexData === null) {\r\n            return;\r\n        }\r\n\r\n        const model = this._renderable._model.subModels[0];\r\n        model.inputAssembler.firstIndex = indexData.start;\r\n        model.inputAssembler.indexCount = indexData.size;\r\n    }\r\n\r\n    private _getHeight (x: number, y: number, verts: Float32Array): number {\r\n        const idx = TERRAIN_BLOCK_VERTEX_COMPLEXITY * y + x;\r\n        return verts[idx * TERRAIN_BLOCK_VERTEX_SIZE + 1];\r\n    }\r\n\r\n    private _updateLodBuffer (vertices: Float32Array): void  {\r\n        this._lodLevel = 0;\r\n        this._lodKey = new TerrainLodKey();\r\n        this._calcErrorMetrics(vertices);\r\n        this._calcLevelDistances(vertices);\r\n    }\r\n\r\n    private _calcErrorMetrics (vertices: Float32Array): void {\r\n        this._errorMetrics[0] = 0;\r\n\r\n        for (let i = 1; i < TERRAIN_LOD_LEVELS; ++i) {\r\n            this._errorMetrics[i] = this._calcErrorMetric(i, vertices);\r\n        }\r\n\r\n        for (let i = 2; i < TERRAIN_LOD_LEVELS; ++i) {\r\n            this._errorMetrics[i] = Math.max(this._errorMetrics[i],  this._errorMetrics[i - 1]);\r\n        }\r\n    }\r\n\r\n    private _calcErrorMetric (level: number, vertices: Float32Array): number {\r\n        let err = 0.0;\r\n        const step = 1 << level;\r\n        const xSectionVertices = TERRAIN_BLOCK_VERTEX_COMPLEXITY;\r\n        const ySectionVertices = TERRAIN_BLOCK_VERTEX_COMPLEXITY;\r\n        const xSides = (xSectionVertices - 1) >> level;\r\n        const ySides = (ySectionVertices - 1) >> level;\r\n\r\n        for (let y = 0; y < ySectionVertices; y += step)  {\r\n            for (let x = 0; x < xSides; ++x)  {\r\n                const x0 = x * step;\r\n                const x1 = x0 + step;\r\n                const xm = (x1 + x0) / 2;\r\n\r\n                const h0 = this._getHeight(x0, y, vertices);\r\n                const h1 = this._getHeight(x1, y, vertices);\r\n                const hm = this._getHeight(xm, y, vertices);\r\n                const hmi = (h0 + h1) / 2;\r\n\r\n                const delta = Math.abs(hm - hmi);\r\n\r\n                err = Math.max(err, delta);\r\n            }\r\n        }\r\n\r\n        for (let x = 0; x < xSectionVertices; x += step) {\r\n            for (let y = 0; y < ySides; ++y) {\r\n                const y0 = y * step;\r\n                const y1 = y0 + step;\r\n                const ym = (y0 + y1) / 2;\r\n\r\n                const h0 = this._getHeight(x, y0, vertices);\r\n                const h1 = this._getHeight(x, y1, vertices);\r\n                const hm = this._getHeight(x, ym, vertices);\r\n                const hmi = (h0 + h1) / 2;\r\n\r\n                const delta = Math.abs(hm - hmi);\r\n\r\n                err = Math.max(err, delta);\r\n            }\r\n        }\r\n\r\n        for (let y = 0; y < ySides; ++y) {\r\n            const y0 = y * step;\r\n            const y1 = y0 + step;\r\n            const ym = (y0 + y1) / 2;\r\n\r\n            for (let x = 0; x < xSides; ++x) {\r\n                const x0 = x * step;\r\n                const x1 = x0 + step;\r\n                const xm = (x0 + x1) / 2;\r\n\r\n                const h0 = this._getHeight(x0, y0, vertices);\r\n                const h1 = this._getHeight(x1, y1, vertices);\r\n                const hm = this._getHeight(xm, ym, vertices);\r\n                const hmi = (h0 + h1) / 2;\r\n\r\n                const delta = Math.abs(hm - hmi);\r\n\r\n                err = Math.max(err, delta);\r\n            }\r\n        }\r\n\r\n        return err;\r\n    }\r\n\r\n    private _calcLevelDistances (vertices: Float32Array): void  {\r\n        const pixelErr = 4;\r\n        const resolution = 768;\r\n        const c = 1.0 / (2 * pixelErr / resolution);\r\n\r\n        for (let i = 1; i < TERRAIN_LOD_LEVELS; ++i) {\r\n            const e = this._errorMetrics[i];\r\n            const d = e * c;\r\n            this._LevelDistances[i] = d;\r\n        }\r\n    }\r\n\r\n    private _buildVertexData (vertexData: Float32Array): void {\r\n        let index = 0;\r\n        for (let j = 0; j < TERRAIN_BLOCK_VERTEX_COMPLEXITY; ++j) {\r\n            for (let i = 0; i < TERRAIN_BLOCK_VERTEX_COMPLEXITY; ++i) {\r\n                const x = this._index[0] * TERRAIN_BLOCK_TILE_COMPLEXITY + i;\r\n                const y = this._index[1] * TERRAIN_BLOCK_TILE_COMPLEXITY + j;\r\n                const position = this._terrain.getPosition(x, y);\r\n                const normal = this._terrain.getNormal(x, y);\r\n                const uv = new Vec2(i / TERRAIN_BLOCK_TILE_COMPLEXITY, j / TERRAIN_BLOCK_TILE_COMPLEXITY);\r\n                vertexData[index++] = position.x;\r\n                vertexData[index++] = position.y;\r\n                vertexData[index++] = position.z;\r\n                vertexData[index++] = normal.x;\r\n                vertexData[index++] = normal.y;\r\n                vertexData[index++] = normal.z;\r\n                vertexData[index++] = uv.x;\r\n                vertexData[index++] = uv.y;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _buildBoundingBox (): void {\r\n        this._bbMin.set(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);\r\n        this._bbMax.set(Number.MIN_VALUE, Number.MIN_VALUE, Number.MIN_VALUE);\r\n        for (let j = 0; j < TERRAIN_BLOCK_VERTEX_COMPLEXITY; ++j) {\r\n            for (let i = 0; i < TERRAIN_BLOCK_VERTEX_COMPLEXITY; ++i) {\r\n                const x = this._index[0] * TERRAIN_BLOCK_TILE_COMPLEXITY + i;\r\n                const y = this._index[1] * TERRAIN_BLOCK_TILE_COMPLEXITY + j;\r\n                const position = this._terrain.getPosition(x, y);\r\n                Vec3.min(this._bbMin, this._bbMin, position);\r\n                Vec3.max(this._bbMax, this._bbMax, position);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * @en Terrain\r\n * @zh 地形组件\r\n */\r\n@ccclass('cc.Terrain')\r\n@help('i18n:cc.Terrain')\r\n@menu('Terrain/Terrain')\r\n@executeInEditMode\r\n@disallowMultiple\r\nexport class Terrain extends Component {\r\n    @type(TerrainAsset)\r\n    @serializable\r\n    @disallowAnimation\r\n    protected __asset: TerrainAsset|null = null;\r\n\r\n    @type(EffectAsset)\r\n    @serializable\r\n    @disallowAnimation\r\n    @visible(false)\r\n    protected _effectAsset: EffectAsset|null = null;\r\n\r\n    @type(TerrainBlockLightmapInfo)\r\n    @serializable\r\n    @disallowAnimation\r\n    protected _lightmapInfos: TerrainBlockLightmapInfo[] = [];\r\n\r\n    @serializable\r\n    @disallowAnimation\r\n    protected _receiveShadow = false;\r\n\r\n    @serializable\r\n    @disallowAnimation\r\n    protected _useNormalmap = false;\r\n\r\n    @serializable\r\n    @disallowAnimation\r\n    protected _usePBR = false;\r\n\r\n    @serializable\r\n    @disallowAnimation\r\n    protected _lodEnable = false;\r\n\r\n    @type(CCFloat)\r\n    @serializable\r\n    @disallowAnimation\r\n    protected _lodBias = 0;\r\n\r\n    // when the terrain undo, __asset is changed by serialize, but the internal block is created by last asset, here saved last asset\r\n    protected _buitinAsset: TerrainAsset|null = null;\r\n    protected _tileSize = 1;\r\n    protected _blockCount: number[] = [1, 1];\r\n    protected _weightMapSize = 128;\r\n    protected _lightMapSize = 128;\r\n    protected _heights: Uint16Array = new Uint16Array();\r\n    protected _weights: Uint8Array = new Uint8Array();\r\n    protected _normals: Float32Array = new Float32Array();\r\n    protected _layerList: (TerrainLayer|null)[] = [];\r\n    protected _layerBuffer: number[] = [];\r\n    protected _blocks: TerrainBlock[] = [];\r\n    protected _lod: TerrainLod|null = null;\r\n    protected _sharedIndexBuffer: Buffer|null = null;\r\n    protected _sharedLodIndexBuffer: Buffer|null = null;\r\n\r\n    constructor () {\r\n        super();\r\n\r\n        // initialize layers\r\n        for (let i = 0; i < TERRAIN_MAX_LAYER_COUNT; ++i) {\r\n            this._layerList.push(null);\r\n        }\r\n    }\r\n\r\n    @type(TerrainAsset)\r\n    @visible(true)\r\n    public set _asset (value: TerrainAsset|null) {\r\n        this.__asset = value;\r\n\r\n        if (this._buitinAsset !== this.__asset) {\r\n            this._buitinAsset = this.__asset;\r\n\r\n            // destroy all block\r\n            for (let i = 0; i < this._blocks.length; ++i) {\r\n                this._blocks[i].destroy();\r\n            }\r\n            this._blocks = [];\r\n\r\n            // restore to default\r\n            if (this.__asset === null) {\r\n                this._effectAsset = null;\r\n                this._lightmapInfos = [];\r\n                this._receiveShadow = false;\r\n                this._useNormalmap = false;\r\n                this._usePBR = false;\r\n                this._tileSize = 1;\r\n                this._blockCount = [1, 1];\r\n                this._weightMapSize = 128;\r\n                this._lightMapSize = 128;\r\n                this._heights = new Uint16Array();\r\n                this._weights = new Uint8Array();\r\n                this._normals = new Float32Array();\r\n                this._layerBuffer = [];\r\n                this._blocks = [];\r\n\r\n                // initialize layers\r\n                this._layerList = [];\r\n                for (let i = 0; i < TERRAIN_MAX_LAYER_COUNT; ++i) {\r\n                    this._layerList.push(null);\r\n                }\r\n            }\r\n\r\n            // Ensure device is created\r\n            if (deviceManager.gfxDevice) {\r\n                // rebuild\r\n                this._buildImp();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public get _asset (): TerrainAsset | null {\r\n        return this.__asset;\r\n    }\r\n\r\n    /**\r\n     * @en Terrain effect asset\r\n     * @zh 地形特效资源\r\n     */\r\n    @type(EffectAsset)\r\n    @visible(true)\r\n    public set effectAsset (value) {\r\n        if (this._effectAsset === value) {\r\n            return;\r\n        }\r\n\r\n        this._effectAsset = value;\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i]._invalidMaterial();\r\n        }\r\n    }\r\n\r\n    public get effectAsset (): EffectAsset | null {\r\n        return this._effectAsset;\r\n    }\r\n\r\n    /**\r\n     * @en Receive shadow\r\n     * @zh 是否接受阴影\r\n     */\r\n    @editable\r\n    get receiveShadow (): boolean {\r\n        return this._receiveShadow;\r\n    }\r\n\r\n    set receiveShadow (val) {\r\n        this._receiveShadow = val;\r\n        for (let i = 0; i < this._blocks.length; i++) {\r\n            this._blocks[i]._invalidMaterial();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Use normal map\r\n     * @zh 是否使用法线贴图\r\n     */\r\n    @editable\r\n    get useNormalMap (): boolean {\r\n        return this._useNormalmap;\r\n    }\r\n\r\n    set useNormalMap (val) {\r\n        this._useNormalmap = val;\r\n        for (let i = 0; i < this._blocks.length; i++) {\r\n            this._blocks[i]._invalidMaterial();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Use pbr material\r\n     * @zh 是否使用物理材质\r\n     */\r\n    @editable\r\n    get usePBR (): boolean {\r\n        return this._usePBR;\r\n    }\r\n\r\n    set usePBR (val) {\r\n        this._usePBR = val;\r\n        for (let i = 0; i < this._blocks.length; i++) {\r\n            this._blocks[i]._invalidMaterial();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Enable lod\r\n     * @zh 是否允许lod\r\n     */\r\n    @editable\r\n    get lodEnable (): boolean {\r\n        return this._lodEnable;\r\n    }\r\n\r\n    set lodEnable (val) {\r\n        this._lodEnable = val;\r\n\r\n        if (this._lodEnable && this._lod === null) {\r\n            this._lod = new TerrainLod();\r\n\r\n            if (this._sharedLodIndexBuffer === null) {\r\n                this._sharedLodIndexBuffer = this._createSharedIndexBuffer();\r\n            }\r\n\r\n            // rebuild all block\r\n            for (let i = 0; i < this._blocks.length; ++i) {\r\n                this._blocks[i].destroy();\r\n            }\r\n            this._blocks = [];\r\n\r\n            for (let j = 0; j < this._blockCount[1]; ++j) {\r\n                for (let i = 0; i < this._blockCount[0]; ++i) {\r\n                    this._blocks.push(new TerrainBlock(this, i, j));\r\n                }\r\n            }\r\n\r\n            for (let i = 0; i < this._blocks.length; ++i) {\r\n                this._blocks[i].build();\r\n            }\r\n        }\r\n\r\n        if (!this._lodEnable) {\r\n            for (let i = 0; i < this._blocks.length; i++) {\r\n                this._blocks[i]._resetLod();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en Lod bias\r\n     * @zh Lod偏移距离\r\n     */\r\n    @editable\r\n    get LodBias (): number {\r\n        return this._lodBias;\r\n    }\r\n\r\n    set LodBias (val) {\r\n        this._lodBias = val;\r\n    }\r\n\r\n    /**\r\n     * @en get terrain size\r\n     * @zh 获得地形大小\r\n     */\r\n    public get size (): Size {\r\n        const sz = new Size(0, 0);\r\n        sz.width = this.blockCount[0] * TERRAIN_BLOCK_TILE_COMPLEXITY * this.tileSize;\r\n        sz.height = this.blockCount[1] * TERRAIN_BLOCK_TILE_COMPLEXITY * this.tileSize;\r\n        return sz;\r\n    }\r\n\r\n    /**\r\n     * @en get tile size\r\n     * @zh 获得栅格大小\r\n     */\r\n    get tileSize (): number {\r\n        return this._tileSize;\r\n    }\r\n\r\n    /**\r\n     * @en get tile count\r\n     * @zh 获得栅格数量\r\n     */\r\n    public get tileCount (): number[] {\r\n        return [this.blockCount[0] * TERRAIN_BLOCK_TILE_COMPLEXITY, this.blockCount[1] * TERRAIN_BLOCK_TILE_COMPLEXITY];\r\n    }\r\n\r\n    /**\r\n     * @en get vertex count\r\n     * @zh 获得顶点数量\r\n     */\r\n    public get vertexCount (): number[] {\r\n        const _vertexCount = this.tileCount;\r\n        _vertexCount[0] += 1;\r\n        _vertexCount[1] += 1;\r\n\r\n        return _vertexCount;\r\n    }\r\n\r\n    /**\r\n     * @en get block count\r\n     * @zh 获得地形块数量\r\n     */\r\n    get blockCount (): number[] {\r\n        return this._blockCount;\r\n    }\r\n\r\n    /**\r\n     * @en get light map size\r\n     * @zh 获得光照图大小\r\n     */\r\n    get lightMapSize (): number {\r\n        return this._lightMapSize;\r\n    }\r\n\r\n    /**\r\n     * @en get weight map size\r\n     * @zh 获得权重图大小\r\n     */\r\n    get weightMapSize (): number {\r\n        return this._weightMapSize;\r\n    }\r\n\r\n    /**\r\n     * @en get height buffer\r\n     * @zh 获得高度缓存\r\n     */\r\n    get heights (): Uint16Array {\r\n        return this._heights;\r\n    }\r\n\r\n    /**\r\n     * @en get weight buffer\r\n     * @zh 获得权重缓存\r\n     */\r\n    get weights (): Uint8Array {\r\n        return this._weights;\r\n    }\r\n\r\n    /**\r\n     * @en check valid\r\n     * @zh 检测是否有效\r\n     */\r\n    get valid (): boolean {\r\n        return this._blocks.length > 0;\r\n    }\r\n\r\n    /**\r\n     * @en get terrain info\r\n     * @zh 获得地形信息\r\n     */\r\n    @type(TerrainInfo)\r\n    public get info (): TerrainInfo {\r\n        const ti = new TerrainInfo();\r\n        ti.tileSize = this.tileSize;\r\n        ti.blockCount[0] = this.blockCount[0];\r\n        ti.blockCount[1] = this.blockCount[1];\r\n        ti.weightMapSize = this.weightMapSize;\r\n        ti.lightMapSize = this.lightMapSize;\r\n\r\n        return ti;\r\n    }\r\n\r\n    /**\r\n     * @en build\r\n     * @zh 构建地形\r\n     */\r\n    public build (info: TerrainInfo): void {\r\n        this._tileSize = info.tileSize;\r\n        this._blockCount[0] = info.blockCount[0];\r\n        this._blockCount[1] = info.blockCount[1];\r\n        this._weightMapSize = info.weightMapSize;\r\n        this._lightMapSize = info.lightMapSize;\r\n\r\n        return this._buildImp();\r\n    }\r\n\r\n    /**\r\n     * @en rebuild\r\n     * @zh 重建地形\r\n     */\r\n    public rebuild (info: TerrainInfo): void {\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i].destroy();\r\n        }\r\n        this._blocks = [];\r\n\r\n        // reset lightmap\r\n        this._resetLightmap(false);\r\n\r\n        // build layer buffer\r\n        this._rebuildLayerBuffer(info);\r\n\r\n        // build heights and normals\r\n        const heightsChanged = this._rebuildHeights(info);\r\n\r\n        // build weights\r\n        this._rebuildWeights(info);\r\n\r\n        // update info\r\n        this._tileSize = info.tileSize;\r\n        this._blockCount[0] = info.blockCount[0];\r\n        this._blockCount[1] = info.blockCount[1];\r\n        this._weightMapSize = info.weightMapSize;\r\n        this._lightMapSize = info.lightMapSize;\r\n\r\n        // build normals if heights changed\r\n        if (heightsChanged) {\r\n            this._normals = new Float32Array(this.heights.length * 3);\r\n            this._buildNormals();\r\n        }\r\n\r\n        // build blocks\r\n        for (let j = 0; j < this._blockCount[1]; ++j) {\r\n            for (let i = 0; i < this._blockCount[0]; ++i) {\r\n                this._blocks.push(new TerrainBlock(this, i, j));\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i].build();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en import height field\r\n     * @zh 导入高度图\r\n     */\r\n    public importHeightField (hf: HeightField, heightScale: number): void {\r\n        let index = 0;\r\n        for (let j = 0; j < this.vertexCount[1]; ++j) {\r\n            for (let i = 0; i < this.vertexCount[0]; ++i) {\r\n                const u = i / this.tileCount[0];\r\n                const v = j / this.tileCount[1];\r\n\r\n                const h = hf.getAt(u * hf.w, v * hf.h) * heightScale;\r\n\r\n                this._heights[index++] = h;\r\n            }\r\n        }\r\n\r\n        this._buildNormals();\r\n\r\n        // rebuild all blocks\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i]._updateHeight();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en export height field\r\n     * @zh 导出高度图\r\n     */\r\n    public exportHeightField (hf: HeightField, heightScale: number): void {\r\n        let index = 0;\r\n        for (let j = 0; j < hf.h; ++j) {\r\n            for (let i = 0; i < hf.w; ++i) {\r\n                const u = i / (hf.w - 1);\r\n                const v = j / (hf.h - 1);\r\n\r\n                const x = u * this.size.width;\r\n                const y = v * this.size.height;\r\n\r\n                const h = this.getHeightAt(x, y);\r\n                if (h != null) {\r\n                    hf.data[index++] = h * heightScale;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public exportAsset (): TerrainAsset {\r\n        const asset = new TerrainAsset();\r\n\r\n        asset.tileSize = this.tileSize;\r\n        asset.blockCount = this.blockCount;\r\n        asset.lightMapSize = this.lightMapSize;\r\n        asset.weightMapSize = this.weightMapSize;\r\n        asset.heights = this.heights;\r\n        asset.weights = this.weights;\r\n\r\n        asset.layerBuffer = new Array<number>(this._blocks.length * 4);\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            asset.layerBuffer[i * 4 + 0] = this._blocks[i].layers[0];\r\n            asset.layerBuffer[i * 4 + 1] = this._blocks[i].layers[1];\r\n            asset.layerBuffer[i * 4 + 2] = this._blocks[i].layers[2];\r\n            asset.layerBuffer[i * 4 + 3] = this._blocks[i].layers[3];\r\n        }\r\n\r\n        this.exportLayerListToAsset(asset);\r\n\r\n        return asset;\r\n    }\r\n\r\n    public exportLayerListToAsset (asset: TerrainAsset): void {\r\n        asset.layerInfos.length = 0;\r\n        for (let i = 0; i < this._layerList.length; ++i) {\r\n            const temp = this._layerList[i];\r\n            if (temp && temp.detailMap && isValid(temp.detailMap)) {\r\n                const layer = new TerrainLayerInfo();\r\n                layer.slot = i;\r\n                layer.tileSize = temp.tileSize;\r\n                layer.detailMap = temp.detailMap;\r\n                layer.normalMap = temp.normalMap;\r\n                layer.metallic = temp.metallic;\r\n                layer.roughness = temp.roughness;\r\n                asset.layerInfos.push(layer);\r\n            }\r\n        }\r\n    }\r\n\r\n    public getEffectAsset (): EffectAsset {\r\n        if (this._effectAsset === null) {\r\n            return legacyCC.EffectAsset.get(TERRAIN_EFFECT_UUID) as EffectAsset;\r\n        }\r\n\r\n        return this._effectAsset;\r\n    }\r\n\r\n    public onEnable (): void {\r\n        if (this._blocks.length === 0) {\r\n            this._buildImp();\r\n        }\r\n\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i].visible = true;\r\n        }\r\n\r\n        (legacyCC.director.root as Root).pipelineEvent.on(PipelineEventType.RENDER_CAMERA_BEGIN, this.onUpdateFromCamera, this);\r\n    }\r\n\r\n    public onDisable (): void {\r\n        (legacyCC.director.root as Root).pipelineEvent.off(PipelineEventType.RENDER_CAMERA_BEGIN, this.onUpdateFromCamera, this);\r\n\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i].visible = false;\r\n        }\r\n    }\r\n\r\n    public onDestroy (): void {\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i].destroy();\r\n        }\r\n        this._blocks = [];\r\n\r\n        for (let i = 0; i < this._layerList.length; ++i) {\r\n            this._layerList[i] = null;\r\n        }\r\n\r\n        if (this._sharedIndexBuffer != null) {\r\n            this._sharedIndexBuffer.destroy();\r\n        }\r\n        if (this._sharedLodIndexBuffer != null) {\r\n            this._sharedLodIndexBuffer.destroy();\r\n        }\r\n    }\r\n\r\n    public onRestore (): void {\r\n        this.onEnable();\r\n        this._buildImp(true);\r\n    }\r\n\r\n    public update (deltaTime: number): void {\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i].update();\r\n        }\r\n    }\r\n\r\n    public onUpdateFromCamera (cam: Camera): void {\r\n        if (!this.lodEnable || this._sharedLodIndexBuffer == null) {\r\n            return;\r\n        }\r\n        if (cam.scene !== this._getRenderScene()) {\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i]._updateLevel(cam.position);\r\n        }\r\n\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i]._updateLod();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en add layer\r\n     * @zh 添加纹理层\r\n     */\r\n    public addLayer (layer: TerrainLayer): number {\r\n        for (let i = 0; i < this._layerList.length; ++i) {\r\n            if (this._layerList[i] === null || (this._layerList[i] && this._layerList[i]?.detailMap === null)) {\r\n                this._layerList[i] = layer;\r\n                if (this._asset) {\r\n                    this.exportLayerListToAsset(this._asset);\r\n                }\r\n                return i;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n    /**\r\n     * @en set layer\r\n     * @zh 设置纹理层\r\n     */\r\n    public setLayer (i: number, layer: TerrainLayer): void {\r\n        this._layerList[i] = layer;\r\n        if (this._asset) {\r\n            this.exportLayerListToAsset(this._asset);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en remove layer\r\n     * @zh 移除纹理层\r\n     */\r\n    public removeLayer (id: number): void {\r\n        this._layerList[id] = null;\r\n        if (this._asset) {\r\n            this.exportLayerListToAsset(this._asset);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en get layer\r\n     * @zh 获得纹理层\r\n     */\r\n    public getLayer (id: number): TerrainLayer | null {\r\n        if (id === -1) {\r\n            return null;\r\n        }\r\n\r\n        return this._layerList[id];\r\n    }\r\n\r\n    /**\r\n     * @en get position\r\n     * @zh 获得地形上的位置\r\n     */\r\n    public getPosition (i: number, j: number): Vec3 {\r\n        const x = i * this._tileSize;\r\n        const z = j * this._tileSize;\r\n        const y = this.getHeight(i, j);\r\n\r\n        return v3(x, y, z);\r\n    }\r\n\r\n    public getHeightField (): Uint16Array {\r\n        return this._heights;\r\n    }\r\n\r\n    /**\r\n     * @en set height\r\n     * @zh 设置地形上的高度\r\n     */\r\n    public setHeight (i: number, j: number, h: number): void {\r\n        h = clamp(h, TERRAIN_HEIGHT_FMIN, TERRAIN_HEIGHT_FMAX);\r\n        this._heights[j * this.vertexCount[0] + i] = TERRAIN_HEIGHT_BASE + h / TERRAIN_HEIGHT_FACTORY;\r\n        if (EDITOR && this._asset) {\r\n            this._asset.heights[j * this.vertexCount[0] + i] = TERRAIN_HEIGHT_BASE + h / TERRAIN_HEIGHT_FACTORY;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en get height\r\n     * @zh 获得地形上的高度\r\n     */\r\n    public getHeight (i: number, j: number): number {\r\n        return (this._heights[j * this.vertexCount[0] + i] - TERRAIN_HEIGHT_BASE) * TERRAIN_HEIGHT_FACTORY;\r\n    }\r\n\r\n    /**\r\n     * @en set height\r\n     * @zh 设置高度\r\n     */\r\n    public getHeightClamp (i: number, j: number): number {\r\n        i = clamp(i, 0, this.vertexCount[0] - 1);\r\n        j = clamp(j, 0, this.vertexCount[1] - 1);\r\n\r\n        return this.getHeight(i, j);\r\n    }\r\n\r\n    /**\r\n     * @en get height by point\r\n     * @zh 根据点的坐标获得高度\r\n     */\r\n    public getHeightAt (x: number, y: number): number | null {\r\n        const fx = x / this.tileSize;\r\n        const fy = y / this.tileSize;\r\n\r\n        let ix0 = Math.floor(fx);\r\n        let iz0 = Math.floor(fy);\r\n        let ix1 = ix0 + 1;\r\n        let iz1 = iz0 + 1;\r\n        const dx = fx - ix0;\r\n        const dz = fy - iz0;\r\n\r\n        if (ix0 < 0 || ix0 > this.vertexCount[0] - 1 || iz0 < 0 || iz0 > this.vertexCount[1] - 1) {\r\n            return null;\r\n        }\r\n\r\n        ix0 = clamp(ix0, 0, this.vertexCount[0] - 1);\r\n        iz0 = clamp(iz0, 0, this.vertexCount[1] - 1);\r\n        ix1 = clamp(ix1, 0, this.vertexCount[0] - 1);\r\n        iz1 = clamp(iz1, 0, this.vertexCount[1] - 1);\r\n\r\n        let a = this.getHeight(ix0, iz0);\r\n        const b = this.getHeight(ix1, iz0);\r\n        const c = this.getHeight(ix0, iz1);\r\n        let d = this.getHeight(ix1, iz1);\r\n        const m = (b + c) * 0.5;\r\n\r\n        if (dx + dz <= 1.0) {\r\n            d = m + (m - a);\r\n        } else {\r\n            a = m + (m - d);\r\n        }\r\n\r\n        const h1 = a * (1.0 - dx) + b * dx;\r\n        const h2 = c * (1.0 - dx) + d * dx;\r\n\r\n        const h = h1 * (1.0 - dz) + h2 * dz;\r\n\r\n        return h;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _setNormal (i: number, j: number, n: Vec3): void {\r\n        const index = j * this.vertexCount[0] + i;\r\n\r\n        this._normals[index * 3 + 0] = n.x;\r\n        this._normals[index * 3 + 1] = n.y;\r\n        this._normals[index * 3 + 2] = n.z;\r\n    }\r\n\r\n    /**\r\n     * @en get normal\r\n     * @zh 获得法线\r\n     */\r\n    public getNormal (i: number, j: number): Vec3 {\r\n        const index = j * this.vertexCount[0] + i;\r\n\r\n        const n = v3();\r\n        n.x = this._normals[index * 3 + 0];\r\n        n.y = this._normals[index * 3 + 1];\r\n        n.z = this._normals[index * 3 + 2];\r\n\r\n        return n;\r\n    }\r\n\r\n    /**\r\n     * @en get normal by point\r\n     * @zh 根据点的坐标获得法线\r\n     */\r\n    public getNormalAt (x: number, y: number): Vec3 | null {\r\n        const fx = x / this.tileSize;\r\n        const fy = y / this.tileSize;\r\n\r\n        let ix0 = Math.floor(fx);\r\n        let iz0 = Math.floor(fy);\r\n        let ix1 = ix0 + 1;\r\n        let iz1 = iz0 + 1;\r\n        const dx = fx - ix0;\r\n        const dz = fy - iz0;\r\n\r\n        if (ix0 < 0 || ix0 > this.vertexCount[0] - 1 || iz0 < 0 || iz0 > this.vertexCount[1] - 1) {\r\n            return null;\r\n        }\r\n\r\n        ix0 = clamp(ix0, 0, this.vertexCount[0] - 1);\r\n        iz0 = clamp(iz0, 0, this.vertexCount[1] - 1);\r\n        ix1 = clamp(ix1, 0, this.vertexCount[0] - 1);\r\n        iz1 = clamp(iz1, 0, this.vertexCount[1] - 1);\r\n\r\n        const a = this.getNormal(ix0, iz0);\r\n        const b = this.getNormal(ix1, iz0);\r\n        const c = this.getNormal(ix0, iz1);\r\n        const d = this.getNormal(ix1, iz1);\r\n        const m = v3();\r\n        Vec3.add(m, b, c).multiplyScalar(0.5);\r\n\r\n        if (dx + dz <= 1.0) {\r\n            // d = m + (m - a);\r\n            d.set(m);\r\n            d.subtract(a);\r\n            d.add(m);\r\n        } else {\r\n            // a = m + (m - d);\r\n            a.set(m);\r\n            a.subtract(d);\r\n            a.add(m);\r\n        }\r\n\r\n        const n1 = v3();\r\n        const n2 = v3();\r\n        const n = v3();\r\n        Vec3.lerp(n1, a, b, dx);\r\n        Vec3.lerp(n2, c, d, dx);\r\n        Vec3.lerp(n, n1, n2, dz);\r\n\r\n        return n;\r\n    }\r\n\r\n    /**\r\n     * @en set weight\r\n     * @zh 设置权重\r\n     */\r\n    public setWeight (i: number, j: number, w: Vec4): void {\r\n        const index = j * this._weightMapSize * this._blockCount[0] + i;\r\n\r\n        this._weights[index * 4 + 0] = w.x * 255;\r\n        this._weights[index * 4 + 1] = w.y * 255;\r\n        this._weights[index * 4 + 2] = w.z * 255;\r\n        this._weights[index * 4 + 3] = w.w * 255;\r\n        if (EDITOR && this._asset) {\r\n            this._asset.weights[index * 4 + 0] = w.x * 255;\r\n            this._asset.weights[index * 4 + 1] = w.y * 255;\r\n            this._asset.weights[index * 4 + 2] = w.z * 255;\r\n            this._asset.weights[index * 4 + 3] = w.w * 255;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @en get weight\r\n     * @zh 获得权重\r\n     */\r\n    public getWeight (i: number, j: number): Vec4 {\r\n        const index = j * this._weightMapSize * this._blockCount[0] + i;\r\n\r\n        const w = new Vec4();\r\n        w.x = this._weights[index * 4 + 0] / 255.0;\r\n        w.y = this._weights[index * 4 + 1] / 255.0;\r\n        w.z = this._weights[index * 4 + 2] / 255.0;\r\n        w.w = this._weights[index * 4 + 3] / 255.0;\r\n\r\n        return w;\r\n    }\r\n\r\n    /**\r\n     * @en get normal by point\r\n     * @zh 根据点的坐标获得权重\r\n     */\r\n    public getWeightAt (x: number, y: number): Vec4 | null {\r\n        const uWeightComplexity = this.weightMapSize * this.blockCount[0];\r\n        const vWeightComplexity = this.weightMapSize * this.blockCount[1];\r\n        if (uWeightComplexity === 0 || vWeightComplexity === 0) {\r\n            return null;\r\n        }\r\n\r\n        const fx = x / uWeightComplexity;\r\n        const fy = y / vWeightComplexity;\r\n\r\n        let ix0 = Math.floor(fx);\r\n        let iz0 = Math.floor(fy);\r\n        let ix1 = ix0 + 1;\r\n        let iz1 = iz0 + 1;\r\n        const dx = fx - ix0;\r\n        const dz = fy - iz0;\r\n\r\n        if (ix0 < 0 || ix0 > uWeightComplexity - 1 || iz0 < 0 || iz0 > vWeightComplexity - 1) {\r\n            return null;\r\n        }\r\n\r\n        ix0 = clamp(ix0, 0, uWeightComplexity - 1);\r\n        iz0 = clamp(iz0, 0, vWeightComplexity - 1);\r\n        ix1 = clamp(ix1, 0, uWeightComplexity - 1);\r\n        iz1 = clamp(iz1, 0, vWeightComplexity - 1);\r\n\r\n        let a = this.getWeight(ix0, iz0);\r\n        const b = this.getWeight(ix1, iz0);\r\n        const c = this.getWeight(ix0, iz1);\r\n        let d = this.getWeight(ix1, iz1);\r\n        const m = new Vec4();\r\n        Vec4.add(m, b, c).multiplyScalar(0.5);\r\n\r\n        if (dx + dz <= 1.0) {\r\n            d = new Vec4();\r\n            Vec4.subtract(d, m, a).add(m);\r\n        } else {\r\n            a = new Vec4();\r\n            Vec4.subtract(a, m, d).add(m);\r\n        }\r\n\r\n        const n1 = new Vec4();\r\n        const n2 = new Vec4();\r\n        const n = new Vec4();\r\n        Vec4.lerp(n1, a, b, dx);\r\n        Vec4.lerp(n2, c, d, dx);\r\n        Vec4.lerp(n, n1, n2, dz);\r\n\r\n        return n;\r\n    }\r\n\r\n    /**\r\n     * @en get max weight layer by point\r\n     * @zh 根据点的坐标获得权重最大的纹理层\r\n     */\r\n    public getMaxWeightLayerAt (x: number, y: number): TerrainLayer | null {\r\n        const uWeightComplexity = this.weightMapSize * this.blockCount[0];\r\n        const vWeightComplexity = this.weightMapSize * this.blockCount[1];\r\n        if (uWeightComplexity === 0 || vWeightComplexity === 0) {\r\n            return null;\r\n        }\r\n\r\n        const fx = x / uWeightComplexity;\r\n        const fy = y / vWeightComplexity;\r\n        const ix0 = Math.floor(fx);\r\n        const iz0 = Math.floor(fy);\r\n\r\n        if (ix0 < 0 || ix0 > uWeightComplexity - 1 || iz0 < 0 || iz0 > vWeightComplexity - 1) {\r\n            return null;\r\n        }\r\n\r\n        const w = this.getWeight(ix0, iz0);\r\n        const bx = Math.floor(x / this.weightMapSize);\r\n        const by = Math.floor(y / this.weightMapSize);\r\n        const block = this.getBlock(bx, by);\r\n\r\n        let i = 0;\r\n        if (w.y > w[i] && block.getLayer(1) !== -1) {\r\n            i = 1;\r\n        }\r\n        if (w.y > w[i] && block.getLayer(2) !== -1) {\r\n            i = 2;\r\n        }\r\n        if (w.z > w[i] && block.getLayer(3) !== -1) {\r\n            i = 3;\r\n        }\r\n\r\n        i = block.getLayer(i);\r\n\r\n        return this.getLayer(i);\r\n    }\r\n\r\n    /**\r\n     * @en get block layers\r\n     * @zh 获得地形块纹理层\r\n     */\r\n    public getBlockLayers (i: number, j: number): number[] {\r\n        const layerIndex = (j * this._blockCount[0] + i) * TERRAIN_MAX_BLEND_LAYERS;\r\n\r\n        return [\r\n            this._layerBuffer[layerIndex],\r\n            this._layerBuffer[layerIndex + 1],\r\n            this._layerBuffer[layerIndex + 2],\r\n            this._layerBuffer[layerIndex + 3],\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * @en get block layer\r\n     * @zh 获得地形块纹理层\r\n     */\r\n    public getBlockLayer (i: number, j: number, index: number): number {\r\n        const layerIndex = (j * this._blockCount[0] + i) * TERRAIN_MAX_BLEND_LAYERS;\r\n        return this._layerBuffer[layerIndex + index];\r\n    }\r\n\r\n    /**\r\n     * @en set block layer\r\n     * @zh 获得地形块层\r\n     */\r\n    public setBlockLayer (i: number, j: number, index: number, layerId: number): void {\r\n        const layerIndex = (j * this._blockCount[0] + i) * TERRAIN_MAX_BLEND_LAYERS;\r\n        this._layerBuffer[layerIndex + index] = layerId;\r\n    }\r\n\r\n    /**\r\n     * @en get block\r\n     * @zh 获得地形块对象\r\n     */\r\n    public getBlock (i: number, j: number): TerrainBlock {\r\n        return this._blocks[j * this._blockCount[0] + i];\r\n    }\r\n\r\n    /**\r\n     * @en get all blocks\r\n     * @zh 获得地形块缓存\r\n     */\r\n    public getBlocks (): TerrainBlock[] {\r\n        return this._blocks;\r\n    }\r\n\r\n    /**\r\n     * @en ray check\r\n     * @zh 射线检测\r\n     * @param start ray start\r\n     * @param dir ray direction\r\n     * @param step ray step\r\n     * @param worldSpace is world space\r\n     */\r\n    public rayCheck (start: Vec3, dir: Vec3, step: number, worldSpace = true): Vec3 | null {\r\n        const MAX_COUNT = 2000;\r\n\r\n        const trace = start;\r\n        if (worldSpace) {\r\n            Vec3.subtract(trace, start, this.node.worldPosition);\r\n        }\r\n\r\n        const delta = v3();\r\n        delta.set(dir);\r\n        delta.multiplyScalar(step);\r\n\r\n        let position: Vec3|null = null;\r\n\r\n        if (dir.equals(v3(0, 1, 0))) {\r\n            const y = this.getHeightAt(trace.x, trace.z);\r\n            if (y != null && trace.y <= y) {\r\n                position = v3(trace.x, y, trace.z);\r\n            }\r\n        } else if (dir.equals(v3(0, -1, 0))) {\r\n            const y = this.getHeightAt(trace.x, trace.z);\r\n            if (y != null && trace.y >= y) {\r\n                position = v3(trace.x, y, trace.z);\r\n            }\r\n        } else {\r\n            let i = 0;\r\n\r\n            // 优先大步进查找\r\n            while (i++ < MAX_COUNT) {\r\n                const y = this.getHeightAt(trace.x, trace.z);\r\n                if (y != null && trace.y <= y) {\r\n                    break;\r\n                }\r\n\r\n                trace.add(dir);\r\n            }\r\n\r\n            // 穷举法\r\n            while (i++ < MAX_COUNT) {\r\n                const y = this.getHeightAt(trace.x, trace.z);\r\n                if (y != null && trace.y <= y) {\r\n                    position = v3(trace.x, y, trace.z);\r\n                    break;\r\n                }\r\n\r\n                trace.add(delta);\r\n            }\r\n        }\r\n\r\n        return position;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.1, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _createSharedIndexBuffer (): Buffer {\r\n        // initialize shared index buffer\r\n        const gfxDevice = deviceManager.gfxDevice;\r\n\r\n        if (this._lod !== null) {\r\n            const gfxBuffer = gfxDevice.createBuffer(new BufferInfo(\r\n                BufferUsageBit.INDEX | BufferUsageBit.TRANSFER_DST,\r\n                MemoryUsageBit.DEVICE,\r\n                Uint16Array.BYTES_PER_ELEMENT * this._lod._indexBuffer.length,\r\n                Uint16Array.BYTES_PER_ELEMENT,\r\n            ));\r\n            gfxBuffer.update(this._lod._indexBuffer);\r\n            return gfxBuffer;\r\n        } else {\r\n            const indexData = new Uint16Array(TERRAIN_BLOCK_TILE_COMPLEXITY * TERRAIN_BLOCK_TILE_COMPLEXITY * 6);\r\n\r\n            let index = 0;\r\n            for (let j = 0; j < TERRAIN_BLOCK_TILE_COMPLEXITY; ++j) {\r\n                for (let i = 0; i < TERRAIN_BLOCK_TILE_COMPLEXITY; ++i) {\r\n                    const a = j * TERRAIN_BLOCK_VERTEX_COMPLEXITY + i;\r\n                    const b = j * TERRAIN_BLOCK_VERTEX_COMPLEXITY + i + 1;\r\n                    const c = (j + 1) * TERRAIN_BLOCK_VERTEX_COMPLEXITY + i;\r\n                    const d = (j + 1) * TERRAIN_BLOCK_VERTEX_COMPLEXITY + i + 1;\r\n\r\n                    // face 1\r\n                    indexData[index++] = a;\r\n                    indexData[index++] = c;\r\n                    indexData[index++] = b;\r\n                    // face 2\r\n                    indexData[index++] = b;\r\n                    indexData[index++] = c;\r\n                    indexData[index++] = d;\r\n                }\r\n            }\r\n\r\n            const gfxBuffer = gfxDevice.createBuffer(new BufferInfo(\r\n                BufferUsageBit.INDEX | BufferUsageBit.TRANSFER_DST,\r\n                MemoryUsageBit.DEVICE,\r\n                Uint16Array.BYTES_PER_ELEMENT * indexData.length,\r\n                Uint16Array.BYTES_PER_ELEMENT,\r\n            ));\r\n            gfxBuffer.update(indexData);\r\n            return gfxBuffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _getSharedIndexBuffer (): Buffer {\r\n        if (this._sharedLodIndexBuffer !== null) {\r\n            return this._sharedLodIndexBuffer;\r\n        }\r\n\r\n        if (this._sharedIndexBuffer !== null) {\r\n            return this._sharedIndexBuffer;\r\n        }\r\n\r\n        if (this.lodEnable && this._lod === null) {\r\n            this._lod = new TerrainLod();\r\n        }\r\n\r\n        if (this._lod !== null) {\r\n            this._sharedLodIndexBuffer = this._createSharedIndexBuffer();\r\n            return this._sharedLodIndexBuffer;\r\n        } else {\r\n            this._sharedIndexBuffer = this._createSharedIndexBuffer();\r\n            return this._sharedIndexBuffer;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _getIndexData (key: TerrainLodKey): TerrainIndexData | null {\r\n        if (this._sharedLodIndexBuffer !== null && this._lod !== null) {\r\n            return this._lod.getIndexData(key);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _resetLightmap (enable: boolean): void {\r\n        this._lightmapInfos.length = 0;\r\n        if (enable) {\r\n            for (let i = 0; i < this._blockCount[0] * this._blockCount[1]; ++i) {\r\n                this._lightmapInfos.push(new TerrainBlockLightmapInfo());\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _updateLightmap (blockId: number, tex: Texture2D|null, uOff: number, vOff: number, uScale: number, vScale: number): void {\r\n        if (tex) {\r\n            // ensure the lightmap infos is initialized\r\n            if (this._lightmapInfos.length === 0) {\r\n                for (let i = 0; i < this._blockCount[0] * this._blockCount[1]; ++i) {\r\n                    this._lightmapInfos.push(new TerrainBlockLightmapInfo());\r\n                }\r\n            }\r\n        } else if (this._lightmapInfos.length === 0) {\r\n            return;\r\n        }\r\n\r\n        this._lightmapInfos[blockId].texture = tex;\r\n        this._lightmapInfos[blockId].UOff = uOff;\r\n        this._lightmapInfos[blockId].VOff = vOff;\r\n        this._lightmapInfos[blockId].UScale = uScale;\r\n        this._lightmapInfos[blockId].VScale = vScale;\r\n        this._blocks[blockId]._updateLightmap(this._lightmapInfos[blockId]);\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _getLightmapInfo (i: number, j: number): TerrainBlockLightmapInfo | null {\r\n        const index = j * this._blockCount[0] + i;\r\n        return index < this._lightmapInfos.length ? this._lightmapInfos[index] : null;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _calcNormal (x: number, z: number): Vec3 {\r\n        let flip = 1;\r\n        const here = this.getPosition(x, z);\r\n        let right: Vec3;\r\n        let up: Vec3;\r\n\r\n        if (x < this.vertexCount[0] - 1) {\r\n            right = this.getPosition(x + 1, z);\r\n        } else {\r\n            flip *= -1;\r\n            right = this.getPosition(x - 1, z);\r\n        }\r\n\r\n        if (z < this.vertexCount[1] - 1) {\r\n            up = this.getPosition(x, z + 1);\r\n        } else {\r\n            flip *= -1;\r\n            up = this.getPosition(x, z - 1);\r\n        }\r\n\r\n        right.subtract(here);\r\n        up.subtract(here);\r\n\r\n        const normal = v3();\r\n        normal.set(up);\r\n        normal.cross(right);\r\n        normal.multiplyScalar(flip);\r\n        normal.normalize();\r\n\r\n        return normal;\r\n    }\r\n\r\n    /**\r\n     * @deprecated since v3.5.0, this is an engine private interface that will be removed in the future.\r\n     */\r\n    public _buildNormals (): void {\r\n        let index = 0;\r\n        for (let y = 0; y < this.vertexCount[1]; ++y) {\r\n            for (let x = 0; x < this.vertexCount[0]; ++x) {\r\n                const n = this._calcNormal(x, y);\r\n\r\n                this._normals[index * 3 + 0] = n.x;\r\n                this._normals[index * 3 + 1] = n.y;\r\n                this._normals[index * 3 + 2] = n.z;\r\n                index += 1;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _buildImp (restore = false): void {\r\n        if (this.valid) {\r\n            return;\r\n        }\r\n\r\n        const terrainAsset = this.__asset;\r\n        if (this._buitinAsset !== terrainAsset) {\r\n            this._buitinAsset = terrainAsset;\r\n        }\r\n\r\n        if (!restore && terrainAsset !== null) {\r\n            this._tileSize = terrainAsset.tileSize;\r\n            this._blockCount = terrainAsset.blockCount;\r\n            this._weightMapSize = terrainAsset.weightMapSize;\r\n            this._lightMapSize = terrainAsset.lightMapSize;\r\n            this._heights = terrainAsset.heights;\r\n            this._normals = terrainAsset.normals;\r\n            this._weights = terrainAsset.weights;\r\n            this._layerBuffer = terrainAsset.layerBuffer;\r\n\r\n            // build layers\r\n            for (let i = 0; i < this._layerList.length; ++i) {\r\n                this._layerList[i] = null;\r\n            }\r\n\r\n            if (terrainAsset.version < TERRAIN_DATA_VERSION5) {\r\n                for (let i = 0; i < terrainAsset.layerBinaryInfos.length; ++i) {\r\n                    const layer = new TerrainLayer();\r\n                    const layerInfo = terrainAsset.layerBinaryInfos[i];\r\n                    layer.tileSize = layerInfo.tileSize;\r\n                    legacyCC.assetManager.loadAny(layerInfo.detailMapId, (err, asset) => {\r\n                        layer.detailMap = asset;\r\n                    });\r\n\r\n                    if (layerInfo.normalMapId !== '') {\r\n                        legacyCC.assetManager.loadAny(layerInfo.normalMapId, (err, asset) => {\r\n                            layer.normalMap = asset;\r\n                        });\r\n                    }\r\n\r\n                    layer.roughness = layerInfo.roughness;\r\n                    layer.metallic = layerInfo.metallic;\r\n\r\n                    this._layerList[layerInfo.slot] = layer;\r\n                }\r\n            } else {\r\n                for (let i = 0; i < terrainAsset.layerInfos.length; ++i) {\r\n                    const layer = new TerrainLayer();\r\n                    const layerInfo = terrainAsset.layerInfos[i];\r\n                    layer.tileSize = layerInfo.tileSize;\r\n                    layer.detailMap = layerInfo.detailMap;\r\n                    layer.normalMap = layerInfo.normalMap;\r\n                    layer.roughness = layerInfo.roughness;\r\n                    layer.metallic = layerInfo.metallic;\r\n\r\n                    this._layerList[layerInfo.slot] = layer;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._blockCount[0] === 0 || this._blockCount[1] === 0) {\r\n            return;\r\n        }\r\n\r\n        // build heights & normals\r\n        const vertexCount = this.vertexCount[0] * this.vertexCount[1];\r\n        if (this._heights === null || this._heights.length !== vertexCount) {\r\n            this._heights = new Uint16Array(vertexCount);\r\n            this._normals = new Float32Array(vertexCount * 3);\r\n            for (let i = 0; i < vertexCount; ++i) {\r\n                this._heights[i] = TERRAIN_HEIGHT_BASE;\r\n                this._normals[i * 3 + 0] = 0;\r\n                this._normals[i * 3 + 1] = 1;\r\n                this._normals[i * 3 + 2] = 0;\r\n            }\r\n            if (terrainAsset) {\r\n                terrainAsset.heights = this._heights;\r\n                terrainAsset.normals = this._normals;\r\n            }\r\n        }\r\n\r\n        if (this._normals === null || this._normals.length !== vertexCount * 3) {\r\n            this._normals = new Float32Array(vertexCount * 3);\r\n            this._buildNormals();\r\n        }\r\n\r\n        // build layer buffer\r\n        const layerBufferSize = this.blockCount[0] * this.blockCount[1] * TERRAIN_MAX_BLEND_LAYERS;\r\n        if (this._layerBuffer === null || this._layerBuffer.length !== layerBufferSize) {\r\n            this._layerBuffer = new Array<number>(layerBufferSize);\r\n            for (let i = 0; i < layerBufferSize; ++i) {\r\n                this._layerBuffer[i] = -1;\r\n            }\r\n            if (terrainAsset) {\r\n                terrainAsset.layerBuffer = this._layerBuffer;\r\n            }\r\n        }\r\n\r\n        // build weights\r\n        const weightMapComplexityU = this._weightMapSize * this._blockCount[0];\r\n        const weightMapComplexityV = this._weightMapSize * this._blockCount[1];\r\n        if (this._weights.length !== weightMapComplexityU * weightMapComplexityV * 4) {\r\n            this._weights = new Uint8Array(weightMapComplexityU * weightMapComplexityV * 4);\r\n            for (let i = 0; i < weightMapComplexityU * weightMapComplexityV; ++i) {\r\n                this._weights[i * 4 + 0] = 255;\r\n                this._weights[i * 4 + 1] = 0;\r\n                this._weights[i * 4 + 2] = 0;\r\n                this._weights[i * 4 + 3] = 0;\r\n            }\r\n            if (terrainAsset) {\r\n                terrainAsset.weights = this._weights;\r\n            }\r\n        }\r\n\r\n        // build blocks\r\n        for (let j = 0; j < this._blockCount[1]; ++j) {\r\n            for (let i = 0; i < this._blockCount[0]; ++i) {\r\n                this._blocks.push(new TerrainBlock(this, i, j));\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this._blocks.length; ++i) {\r\n            this._blocks[i].build();\r\n        }\r\n    }\r\n\r\n    private _rebuildHeights (info: TerrainInfo): boolean {\r\n        if (this.vertexCount[0] === info.vertexCount[0] && this.vertexCount[1] === info.vertexCount[1]) {\r\n            return false;\r\n        }\r\n\r\n        const heights = new Uint16Array(info.vertexCount[0] * info.vertexCount[1]);\r\n        for (let i = 0; i < heights.length; ++i) {\r\n            heights[i] = TERRAIN_HEIGHT_BASE;\r\n        }\r\n\r\n        const w = Math.min(this.vertexCount[0], info.vertexCount[0]);\r\n        const h = Math.min(this.vertexCount[1], info.vertexCount[1]);\r\n\r\n        for (let j = 0; j < h; ++j) {\r\n            for (let i = 0; i < w; ++i) {\r\n                const index0 = j * info.vertexCount[0] + i;\r\n                const index1 = j * this.vertexCount[0] + i;\r\n\r\n                heights[index0] = this._heights[index1];\r\n            }\r\n        }\r\n\r\n        this._heights = heights;\r\n\r\n        return true;\r\n    }\r\n\r\n    private _rebuildLayerBuffer (info: TerrainInfo): boolean {\r\n        if (this.blockCount[0] === info.blockCount[0] && this.blockCount[1] === info.blockCount[1]) {\r\n            return false;\r\n        }\r\n\r\n        const layerBuffer: number[] = [];\r\n        layerBuffer.length = info.blockCount[0] * info.blockCount[1] * TERRAIN_MAX_BLEND_LAYERS;\r\n        for (let i = 0; i < layerBuffer.length; ++i) {\r\n            layerBuffer[i] = -1;\r\n        }\r\n\r\n        const w = Math.min(this.blockCount[0], info.blockCount[0]);\r\n        const h = Math.min(this.blockCount[1], info.blockCount[1]);\r\n        for (let j = 0; j < h; ++j) {\r\n            for (let i = 0; i < w; ++i) {\r\n                const index0 = j * info.blockCount[0] + i;\r\n                const index1 = j * this.blockCount[0] + i;\r\n\r\n                for (let l = 0; l < TERRAIN_MAX_BLEND_LAYERS; ++l) {\r\n                    layerBuffer[index0 * TERRAIN_MAX_BLEND_LAYERS + l] = this._layerBuffer[index1 * TERRAIN_MAX_BLEND_LAYERS + l];\r\n                }\r\n            }\r\n        }\r\n\r\n        this._layerBuffer = layerBuffer;\r\n\r\n        return true;\r\n    }\r\n\r\n    private _rebuildWeights (info: TerrainInfo): boolean {\r\n        const oldWeightMapSize = this._weightMapSize;\r\n        const oldWeightMapComplexityU = this._weightMapSize * this._blockCount[0];\r\n        const oldWeightMapComplexityV = this._weightMapSize * this._blockCount[1];\r\n\r\n        const weightMapComplexityU = info.weightMapSize * info.blockCount[0];\r\n        const weightMapComplexityV = info.weightMapSize * info.blockCount[1];\r\n\r\n        if (weightMapComplexityU === oldWeightMapComplexityU && weightMapComplexityV === oldWeightMapComplexityV) {\r\n            return false;\r\n        }\r\n\r\n        const weights = new Uint8Array(weightMapComplexityU * weightMapComplexityV * 4);\r\n\r\n        for (let i = 0; i < weightMapComplexityU * weightMapComplexityV; ++i) {\r\n            weights[i * 4 + 0] = 255;\r\n            weights[i * 4 + 1] = 0;\r\n            weights[i * 4 + 2] = 0;\r\n            weights[i * 4 + 3] = 0;\r\n        }\r\n\r\n        const w = Math.min(info.blockCount[0], this._blockCount[0]);\r\n        const h = Math.min(info.blockCount[1], this._blockCount[1]);\r\n\r\n        // get weight\r\n        const getOldWeight = (_i: number, _j: number, _weights: Uint8Array): Vec4 => {\r\n            const index = _j * oldWeightMapComplexityU + _i;\r\n\r\n            const weight = new Vec4();\r\n            weight.x = _weights[index * 4 + 0] / 255.0;\r\n            weight.y = _weights[index * 4 + 1] / 255.0;\r\n            weight.z = _weights[index * 4 + 2] / 255.0;\r\n            weight.w = _weights[index * 4 + 3] / 255.0;\r\n\r\n            return weight;\r\n        };\r\n\r\n        // sample weight\r\n        const sampleOldWeight = (_x: number, _y: number, _xOff: number, _yOff: number, _weights: Uint8Array): Vec4 => {\r\n            const ix0 = Math.floor(_x);\r\n            const iz0 = Math.floor(_y);\r\n            const ix1 = Math.min(ix0 + 1, oldWeightMapSize - 1);\r\n            const iz1 = Math.min(iz0 + 1, oldWeightMapSize - 1);\r\n            const dx = _x - ix0;\r\n            const dz = _y - iz0;\r\n\r\n            const a = getOldWeight(ix0 + _xOff, iz0 + _yOff, this._weights);\r\n            const b = getOldWeight(ix1 + _xOff, iz0 + _yOff, this._weights);\r\n            const c = getOldWeight(ix0 + _xOff, iz1 + _yOff, this._weights);\r\n            const d = getOldWeight(ix1 + _xOff, iz1 + _yOff, this._weights);\r\n            const m = new Vec4();\r\n            Vec4.add(m, b, c).multiplyScalar(0.5);\r\n\r\n            if (dx + dz <= 1.0) {\r\n                d.set(m);\r\n                d.subtract(a);\r\n                d.add(m);\r\n            } else {\r\n                a.set(m);\r\n                a.subtract(d);\r\n                a.add(m);\r\n            }\r\n\r\n            const n1 = new Vec4();\r\n            const n2 = new Vec4();\r\n            const n = new Vec4();\r\n            Vec4.lerp(n1, a, b, dx);\r\n            Vec4.lerp(n2, c, d, dx);\r\n            Vec4.lerp(n, n1, n2, dz);\r\n\r\n            return n;\r\n        };\r\n\r\n        // fill new weights\r\n        for (let j = 0; j < h; ++j) {\r\n            for (let i = 0; i < w; ++i) {\r\n                const uOff = i * oldWeightMapSize;\r\n                const vOff = j * oldWeightMapSize;\r\n\r\n                for (let v = 0; v < info.weightMapSize; ++v) {\r\n                    for (let u = 0; u < info.weightMapSize; ++u) {\r\n                        let w: Vec4;\r\n                        if (info.weightMapSize === oldWeightMapSize) {\r\n                            w = getOldWeight(u + uOff, v + vOff, this._weights);\r\n                        } else {\r\n                            const x = u / (info.weightMapSize - 1) * (oldWeightMapSize - 1);\r\n                            const y = v / (info.weightMapSize - 1) * (oldWeightMapSize - 1);\r\n                            w = sampleOldWeight(x, y, uOff, vOff, this._weights);\r\n                        }\r\n\r\n                        const du = i * info.weightMapSize + u;\r\n                        const dv = j * info.weightMapSize + v;\r\n                        const index = dv * weightMapComplexityU + du;\r\n\r\n                        weights[index * 4 + 0] = w.x * 255;\r\n                        weights[index * 4 + 1] = w.y * 255;\r\n                        weights[index * 4 + 2] = w.z * 255;\r\n                        weights[index * 4 + 3] = w.w * 255;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this._weights = weights;\r\n\r\n        return true;\r\n    }\r\n}\r\n"],"names":["HeightField","w","h","data","Uint16Array","i","_proto","prototype","set","j","value","get","getClamp","clamp","getAt","x","y","fx","fy","ix0","Math","floor","iz0","ix1","iz1","dx","dz","a","b","c","d","m","h1","h2","TERRAIN_LOD_VERTS","TERRAIN_LOD_TILES","TERRAIN_LOD_LEVELS","TERRAIN_LOD_NORTH_INDEX","TERRAIN_LOD_SOUTH_INDEX","TERRAIN_LOD_WEST_INDEX","TERRAIN_LOD_EAST_INDEX","TERRAIN_LOD_MAX_DISTANCE","TerrainLodKey","level","north","south","west","east","equals","rk","TerrainIndexPool","size","indices","TerrainIndexData","key","start","buffer","primCount","TerrainLod","_bodyIndexPool","_connecterIndexPool","_indexMap","_indexBuffer","Array","k","mapIndex","_genBodyIndex","_genConnecterIndexNorth","_genConnecterIndexSouth","_genConnecterIndexWest","_genConnecterIndexEast","levels","l","n","s","e","_genIndexData","_proto2","getIndexData","length","step","tiles","count","index","row_c","row_n","connecter","connecterIndex","self_step","neighbor_step","self_tile","x1","y1","x0","y0","index0","index1","_getConnenterIndex","body","push","temp","TERRAIN_EFFECT_UUID","TerrainInfo","_dec","ccclass","_class","_class2","tileSize","_initializer","blockCount","_initializer2","weightMapSize","_initializer3","lightMapSize","_initializer4","_createClass","sz","Size","width","TERRAIN_BLOCK_TILE_COMPLEXITY","height","_tileCount","_vertexCount","tileCount","_applyDecoratedInitializer","serializable","TerrainLayer","_dec2","_class3","_class4","detailMap","_initializer5","normalMap","_initializer6","_initializer7","metallic","_initializer8","roughness","_initializer9","TerrainRenderable","_ModelRenderer","_this","_len","arguments","args","_key","call","apply","concat","_model","_meshData","_brushPass","_brushMaterial","_currentMaterial","_currentMaterialLayers","_lightmap","_inheritsLoose","destroy","legacyCC","director","root","destroyModel","_destroyModel","_invalidMaterial","_clearMaterials","enabled","_updateMaterial","block","init","nLayers","getMaxLayer","Material","initialize","effectAsset","getTerrain","getEffectAsset","defines","_getMaterialDefines","brushMaterialInstance","copy","passes","pop","initSubModel","setSharedMaterial","receiveShadow","_updateLightingmap","texture","uvParam","_updateReceiveDirLight","updateLightingmap","_onMaterialModified","idx","mtl","_onRebuildPSO","_getBuiltinMaterial","material","setSubModelMaterial","_onUpdateReceiveDirLight","visibility","forceClose","receiveDirLight","node","layer","visFlags","scene","renderScene","mainLight","mobility","MobilityMode","Static","builtinResMgr","ModelRenderer","TerrainBlockLightmapInfo","_dec3","_class5","_class6","_initializer0","UOff","_initializer1","VOff","_initializer10","UScale","_initializer11","VScale","_initializer12","TerrainBlock","t","_terrain","_node","_renderable","_index","_weightMap","_lightmapInfo","_lodLevel","_lodKey","_errorMetrics","_LevelDistances","_bbMin","v3","_bbMax","_getLightmapInfo","Node","setParent","hideFlags","CCObjectFlags","DontSave","HideInHierarchy","addComponent","build","gfxDevice","device","vertexData","Float32Array","TERRAIN_BLOCK_VERTEX_SIZE","TERRAIN_BLOCK_VERTEX_COMPLEXITY","_buildVertexData","vertexBuffer","createBuffer","BufferInfo","BufferUsageBit","VERTEX","TRANSFER_DST","MemoryUsageBit","DEVICE","BYTES_PER_ELEMENT","update","_buildBoundingBox","gfxAttributes","Attribute","AttributeName","ATTR_POSITION","Format","RGB32F","ATTR_NORMAL","ATTR_TEX_COORD","RG32F","RenderingSubMesh","PrimitiveMode","TRIANGLE_LIST","_getSharedIndexBuffer","createModel","createBoundingShape","transform","visible","_updateWeightMap","lodEnable","_updateLodBuffer","_updateIndexBuffer","rebuild","_updateHeight","isValid","lightmap","lightmapUVParam","useNormalMap","usePBR","getDetailTex","getNormalTex","normalTex","uvScale","Vec4","layers","l0","getLayer","setProperty","l1","l2","z","l3","_buildLodInfo","_updateLevel","camPos","terrain","terrainNode","maxLevel","bbMin","bbMax","Vec3","add","worldPosition","d1","distance","d2","min","LodBias","ld1","setBrushMaterial","_getBrushMaterial","_getBrushPass","getIndex","getRect","rect","Rect","setLayer","layerId","setBlockLayer","lightmapMacroValue","globals","bakedWithStationaryMainLight","LAYERS","CC_USE_LIGHTMAP","USE_NORMALMAP","USE_PBR","setWrapMode","WrapMode","CLAMP_TO_BORDER","vertexBuffers","updateWorldBound","Texture2D","create","PixelFormat","RGBA8888","setFilters","TextureFilter","LINEAR","CLAMP_TO_EDGE","weightData","Uint8Array","weightIndex","getWeight","uploadData","_updateLightmap","info","_updateLod","getBlock","_resetLod","subModels","indexData","_getIndexData","model","inputAssembler","firstIndex","indexCount","_getHeight","verts","vertices","_calcErrorMetrics","_calcLevelDistances","_calcErrorMetric","max","err","xSectionVertices","ySectionVertices","xSides","ySides","xm","h0","hm","hmi","delta","abs","ym","pixelErr","resolution","position","getPosition","normal","getNormal","uv","Vec2","Number","MAX_VALUE","MIN_VALUE","blocks","getBlocks","getBlockLayers","val","addModel","removeModel","Terrain","_dec4","_dec5","type","TerrainAsset","_dec6","EffectAsset","_dec7","_dec8","CCFloat","_dec9","_dec0","_dec1","_class7","disallowMultiple","_class8","_Component","_this2","__asset","_initializer13","_effectAsset","_initializer14","_lightmapInfos","_initializer15","_receiveShadow","_initializer16","_useNormalmap","_initializer17","_usePBR","_initializer18","_lodEnable","_initializer19","_lodBias","_initializer20","_buitinAsset","_tileSize","_blockCount","_weightMapSize","_lightMapSize","_heights","_weights","_normals","_layerList","_layerBuffer","_blocks","_lod","_sharedIndexBuffer","_sharedLodIndexBuffer","TERRAIN_MAX_LAYER_COUNT","_proto3","_buildImp","_resetLightmap","_rebuildLayerBuffer","heightsChanged","_rebuildHeights","_rebuildWeights","heights","_buildNormals","importHeightField","hf","heightScale","vertexCount","u","v","exportHeightField","getHeightAt","exportAsset","asset","weights","layerBuffer","exportLayerListToAsset","layerInfos","TerrainLayerInfo","slot","onEnable","pipelineEvent","on","PipelineEventType","RENDER_CAMERA_BEGIN","onUpdateFromCamera","onDisable","off","onDestroy","onRestore","deltaTime","cam","_getRenderScene","addLayer","_this$_layerList$i","_asset","removeLayer","id","getHeight","getHeightField","setHeight","TERRAIN_HEIGHT_FMIN","TERRAIN_HEIGHT_FMAX","TERRAIN_HEIGHT_BASE","TERRAIN_HEIGHT_FACTORY","getHeightClamp","_setNormal","getNormalAt","multiplyScalar","subtract","n1","n2","lerp","setWeight","getWeightAt","uWeightComplexity","vWeightComplexity","getMaxWeightLayerAt","bx","by","layerIndex","TERRAIN_MAX_BLEND_LAYERS","getBlockLayer","rayCheck","dir","worldSpace","MAX_COUNT","trace","_createSharedIndexBuffer","deviceManager","gfxBuffer","INDEX","enable","blockId","tex","uOff","vOff","uScale","vScale","_calcNormal","flip","here","right","up","cross","normalize","restore","_this3","valid","terrainAsset","normals","version","TERRAIN_DATA_VERSION5","_loop","layerInfo","layerBinaryInfos","assetManager","loadAny","detailMapId","normalMapId","layerBufferSize","weightMapComplexityU","weightMapComplexityV","_this4","oldWeightMapSize","oldWeightMapComplexityU","oldWeightMapComplexityV","getOldWeight","_i","_j","weight","sampleOldWeight","_x","_y","_xOff","_yOff","du","dv","ti","Component","_applyDecoratedDescriptor","Object","getOwnPropertyDescriptor"],"mappings":"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"}