"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CustomClassNode = exports.ClassNode = exports.DictNode = exports.ArrayNode = exports.Node = exports.TraceableDict = exports.TraceableItem = void 0;
const cc_1 = require("cc");
// import deserializer types
var D = cc_1.deserialize.Internal;
var DataTypeID = D.DataTypeID_;
const { DICT_JSON_LAYOUT, CLASS_TYPE, CLASS_KEYS, CLASS_PROP_TYPE_OFFSET, CUSTOM_OBJ_DATA_CONTENT, MASK_CLASS, } = cc_1.deserialize._macros;
class TraceableItem {
    // dataTypeID: DataTypeID | undefined = undefined;
    // 引用关系。这里不考虑定义引用对象了，改用两个数组。因为引用对象使用者也会被耦合，而且使用者创建的临时对象会更多
    tracers = [];
    keys = [];
    // get isSerialized (): boolean {
    //     return this.result !== TraceableItem.NO_RESULT;
    // };
    static compareByRefCount(lhs, rhs) {
        return rhs.tracers.length - lhs.tracers.length;
    }
    static NO_RESULT = Object.create(null);
    // 需要追踪的数据
    result = TraceableItem.NO_RESULT;
    constructor() {
        // this.source = source;
        // this.serialized = serialized;
    }
    traceBy(tracer, key) {
        this.tracers.push(tracer);
        this.keys.push(key);
    }
    movedTo(index) {
        for (let i = 0; i < this.tracers.length; i++) {
            this.tracers[i][this.keys[i]] = index;
        }
    }
}
exports.TraceableItem = TraceableItem;
class TraceableDict {
    // 当某个索引将会被延迟赋值时，使用这个字段来占坑
    static PLACEHOLDER = 0;
    values = new Map();
    trace(source, tracer, key) {
        let item = this.values.get(source);
        if (!item) {
            item = new TraceableItem();
            this.values.set(source, item);
        }
        item.traceBy(tracer, key);
        return item;
    }
    traceString(source, tracer, key) {
        const item = this.trace(source, tracer, key);
        // if (!item.isSerialized) {
        item.result = source;
        // }
    }
    get(source) {
        return this.values.get(source);
    }
    getSortedItems() {
        const array = Array.from(this.values.values());
        array.sort(TraceableItem.compareByRefCount);
        return array;
    }
    dump(offset = 0) {
        const array = this.getSortedItems();
        for (let i = 0; i < array.length; i++) {
            array[i].movedTo(offset + i);
        }
        return array.map((x) => x.result);
    }
}
exports.TraceableDict = TraceableDict;
// 保存场景对象结构，此 Node 非 cc.Node，而是用来表示关系对象关系图中的节点。这些节点会组织成有向有环图。
class Node {
    // 自身序列化时需要用的实际类型
    selfType;
    // 此对象被引用的次数，决定了是否必须放到 instances，以及后续的优化权重
    refCount = 0;
    // 当前节点是否在 instances 中
    indexed = false;
    // 当前节点只能放在 instances 中
    shouldBeIndexed = false;
    // 当前节点在 instances 中的索引，如果当前节点不在 instances 中则返回持有当前节点的祖先节点的索引
    _index = -1;
    get instanceIndex() {
        return this._index;
    }
    set instanceIndex(val) {
        if (this.indexed) {
            throw new Error('Should not change instanceIndex on indexed object');
        }
        this._index = val;
    }
    // 被其它对象引用时的类型
    get refType() {
        return this.indexed ? DataTypeID.InstanceRef : this.selfType;
    }
    static compareByRefCount(lhs, rhs) {
        return rhs.refCount - lhs.refCount;
    }
    constructor(dataTypeID) {
        this.selfType = dataTypeID;
    }
    setStatic(key, dataTypeID, data) {
    }
    setDynamic(target, key) {
        ++target.refCount;
    }
    static AssetPlaceholderType = DataTypeID.SimpleType;
    static AssetPlaceholderValue = null;
    setAssetRefPlaceholderOnIndexed(key) {
        // 设置会被延迟初始化的资源默认值
        // 只有不为 AssetRefByInnerObj / Array_AssetRefByInnerObj 的属性才要多设置这个 placeholder
        // 实际上只有数组需要提前初始化，因为如果赋值顺序不递增，会产生空洞，导致数组退化为字典，影响性能
        // 类对象在构造函数已经预分配了，不需要在反序列化重新分配
        // 字典对象不常用就不纠结了
    }
    dumpRecursively(refsBuilder) {
        // 递归调用所有除了 DataTypeID.InstanceRef 类型的关联节点的 dumpRecursively。
        // 由于所有可能产生循环引用的节点，都提前转换成了 DataTypeID.InstanceRef 类型，
        // 所以这里直接递归就行，不会死循环。
    }
}
exports.Node = Node;
class ArrayNode extends Node {
    types;
    datas;
    static DeriveTypes = [
        [DataTypeID.SimpleType, DataTypeID.SimpleType],
        [DataTypeID.Class, DataTypeID.Array_Class],
        [DataTypeID.AssetRefByInnerObj, DataTypeID.Array_AssetRefByInnerObj],
        [DataTypeID.InstanceRef, DataTypeID.Array_InstanceRef],
    ];
    constructor(length) {
        super(DataTypeID.Array);
        this.types = new Array(length);
        this.datas = new Array(length);
    }
    setStatic(key, dataTypeID, data) {
        this.types[key] = dataTypeID;
        this.datas[key] = data;
    }
    setDynamic(target, key) {
        super.setDynamic(target);
        this.types[key] = undefined;
        this.datas[key] = target;
    }
    setAssetRefPlaceholderOnIndexed(key) {
        this.types[key] = Node.AssetPlaceholderType;
        this.datas[key] = Node.AssetPlaceholderValue;
    }
    dumpRecursively(refsBuilder) {
        // 递归依赖节点
        for (let i = 0; i < this.datas.length; ++i) {
            const target = this.datas[i];
            if (target instanceof Node) {
                if (target.indexed) {
                    const refData = refsBuilder.addRef(this, i, target);
                    if (isFinite(refData)) {
                        this.types[i] = DataTypeID.InstanceRef;
                        this.datas[i] = refData;
                    }
                    else {
                        // 先赋值为 null，反序列化后会被 refs 延迟赋值为目标节点
                        // TODO - 这样可能会导致无法特化为 Array_InstanceRef
                        this.types[i] = DataTypeID.SimpleType;
                        this.datas[i] = null;
                    }
                }
                else {
                    target.instanceIndex = this.instanceIndex;
                    const data = target.dumpRecursively(refsBuilder);
                    this.types[i] = target.refType;
                    this.datas[i] = data;
                }
            }
        }
        // 特化数组
        for (let i = 0; i < ArrayNode.DeriveTypes.length; ++i) {
            const [elementType, arrayType] = ArrayNode.DeriveTypes[i];
            if (this.types.every((x) => x === elementType)) {
                this.selfType = arrayType;
                return this.datas;
            }
        }
        // 混合数组
        this.selfType = DataTypeID.Array;
        return [this.datas, ...this.types];
    }
}
exports.ArrayNode = ArrayNode;
class DictNode extends Node {
    data = [null];
    json = Object.create(null);
    dynamics = Object.create(null);
    constructor() {
        super(DataTypeID.Dict);
        this.data[DICT_JSON_LAYOUT] = this.json;
    }
    setStatic(key, dataTypeID, value) {
        if (dataTypeID === DataTypeID.SimpleType) {
            this.json[key] = value;
        }
        else {
            this.data.push(key, dataTypeID, value);
        }
    }
    setDynamic(target, key) {
        super.setDynamic(target);
        this.dynamics[key] = target;
    }
    dumpRecursively(refsBuilder) {
        for (const key in this.dynamics) {
            const target = this.dynamics[key];
            if (target.indexed) {
                const refData = refsBuilder.addRef(this, key, target);
                if (isFinite(refData)) {
                    this.data.push(key, DataTypeID.InstanceRef, refData);
                }
            }
            else {
                // 由于所有可能产生循环引用的节点，都提前转换成了 DataTypeID.InstanceRef 类型，
                // 所以这里直接递归就行，不会死循环
                target.instanceIndex = this.instanceIndex;
                const data = target.dumpRecursively(refsBuilder);
                if (target.refType === DataTypeID.SimpleType) {
                    this.json[key] = data;
                }
                else {
                    this.data.push(key, target.refType, data);
                }
            }
        }
        const isSimple = this.data.length === 1;
        if (isSimple) {
            this.selfType = DataTypeID.SimpleType;
            return this.json;
        }
        else {
            return this.data;
        }
    }
}
exports.DictNode = DictNode;
class ClassNode extends Node {
    ctor;
    simpleKeys = new Array();
    simpleValues = [];
    advanceds = new Array();
    // dump 后的结果。dump 后 simpleValues 会被清空，advanceds 中的数据部分也会被删除
    dumped;
    // 从数据直接反向生成一个已经调用过 dumpRecursively 的对象
    static fromData(clazz, mask, data) {
        const ctor = clazz[CLASS_TYPE];
        const res = new ClassNode(ctor);
        res.dumped = data;
        res.simpleValues = null;
        const keys = clazz[CLASS_KEYS];
        const classTypeOffset = clazz[CLASS_PROP_TYPE_OFFSET];
        const maskTypeOffset = mask[mask.length - 1];
        let i = MASK_CLASS + 1;
        for (; i < maskTypeOffset; ++i) {
            const key = keys[mask[i]];
            res.simpleKeys.push(key);
        }
        for (let i = maskTypeOffset; i < data.length; ++i) {
            const key = keys[mask[i]];
            const type = clazz[mask[i] + classTypeOffset];
            res.advanceds.push(key, type);
        }
        return res;
    }
    constructor(ctor) {
        super(DataTypeID.Class);
        this.ctor = ctor;
    }
    setStatic(key, dataTypeID, value) {
        if (dataTypeID === DataTypeID.SimpleType) {
            this.simpleKeys.push(key);
            // @ts-ignore
            this.simpleValues.push(value);
        }
        else {
            this.advanceds.push(key, dataTypeID, value);
        }
        // this.metas.push(key, dataTypeID);
        // this.datas.push(value);
    }
    setDynamic(target, key) {
        super.setDynamic(target);
        this.advanceds.push(key, undefined, target);
    }
    dumpRecursively(refsBuilder) {
        const advanceds = this.advanceds;
        const TYPE_OFFSET = 1;
        const VALUE_OFFSET = 2;
        // dump children
        for (let i = advanceds.length - 3; i >= 0; i -= 3) {
            // let key = this.metas[m];
            // let type = this.metas[m + 1];
            const target = advanceds[i + VALUE_OFFSET];
            if (target instanceof Node) {
                if (target.indexed) {
                    const refData = refsBuilder.addRef(this, advanceds[i], target);
                    if (isFinite(refData)) {
                        advanceds[i + TYPE_OFFSET] = DataTypeID.InstanceRef;
                        advanceds[i + VALUE_OFFSET] = refData;
                    }
                    else {
                        // Remove key-type-value tuple from advanceds
                        advanceds.splice(i, 3);
                    }
                }
                else {
                    target.instanceIndex = this.instanceIndex;
                    const dumped = target.dumpRecursively(refsBuilder);
                    if (target.refType === DataTypeID.SimpleType) {
                        this.simpleKeys.push(advanceds[i]);
                        // @ts-ignore
                        this.simpleValues.push(dumped);
                        // Remove key-type-value tuple from advanceds
                        advanceds.splice(i, 3);
                    }
                    else {
                        advanceds[i + TYPE_OFFSET] = target.refType;
                        advanceds[i + VALUE_OFFSET] = dumped;
                    }
                }
            }
        }
        // dump values
        const mask = TraceableDict.PLACEHOLDER;
        // 缓存 dumped 对象，等对象都 dump 后再生成 mask 索引。
        this.dumped = [mask].concat(this.simpleValues);
        for (let i = 0; i < advanceds.length; i += 3) {
            this.dumped.push(advanceds[i + VALUE_OFFSET]);
        }
        this.simpleValues = null;
        this.advanceds = this.advanceds.filter((x, index) => index % 3 !== 2);
        return this.dumped;
    }
}
exports.ClassNode = ClassNode;
class CustomClassNode extends Node {
    ctor;
    content;
    dumped;
    // 从数据直接反向生成一个已经调用过 dumpRecursively 的对象
    static fromData(ctor, data) {
        const content = data[CUSTOM_OBJ_DATA_CONTENT];
        const res = new CustomClassNode(ctor, content);
        res.dumped = data;
        return res;
    }
    constructor(ctor, content) {
        super(DataTypeID.CustomizedClass);
        this.ctor = ctor;
        this.content = content;
    }
    setStatic(key, dataTypeID, value) {
        throw new Error('Should not set property of CustomClass');
    }
    setDynamic(target, key) {
        throw new Error('Should not set property of CustomClass');
    }
    dumpRecursively(refsBuilder) {
        const CLASS = TraceableDict.PLACEHOLDER;
        this.dumped = [CLASS, this.content];
        // 通过保存 dumped 对象，等对象都 dump 后再生成 mask 索引。
        return this.dumped;
    }
}
exports.CustomClassNode = CustomClassNode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvY29yZS9lbmdpbmUvZWRpdG9yLWV4dGVuZHMvdXRpbHMvc2VyaWFsaXplL2NvbXBpbGVkL3R5cGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDJCQUVZO0FBRVosNEJBQTRCO0FBQzVCLElBQU8sQ0FBQyxHQUFHLGdCQUFXLENBQUMsUUFBUSxDQUFDO0FBR2hDLElBQU8sVUFBVSxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUM7QUFVbEMsTUFBTSxFQUNGLGdCQUFnQixFQUNoQixVQUFVLEVBQ1YsVUFBVSxFQUNWLHNCQUFzQixFQUN0Qix1QkFBdUIsRUFDdkIsVUFBVSxHQUNiLEdBQUcsZ0JBQVcsQ0FBQyxPQUFPLENBQUM7QUFFeEIsTUFBYSxhQUFhO0lBRXRCLGtEQUFrRDtJQUVsRCwwREFBMEQ7SUFDbEQsT0FBTyxHQUFVLEVBQUUsQ0FBQztJQUNwQixJQUFJLEdBQXNCLEVBQUUsQ0FBQztJQUVyQyxpQ0FBaUM7SUFDakMsc0RBQXNEO0lBQ3RELEtBQUs7SUFFRSxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBa0IsRUFBRSxHQUFrQjtRQUNsRSxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQ25ELENBQUM7SUFFTyxNQUFNLENBQVUsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFeEQsVUFBVTtJQUNWLE1BQU0sR0FBUSxhQUFhLENBQUMsU0FBUyxDQUFDO0lBRXRDO1FBQ0ksd0JBQXdCO1FBQ3hCLGdDQUFnQztJQUNwQyxDQUFDO0lBQ0QsT0FBTyxDQUFDLE1BQWMsRUFBRSxHQUFvQjtRQUN4QyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBQ0QsT0FBTyxDQUFDLEtBQWE7UUFDakIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDM0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO1FBQzFDLENBQUM7SUFDTCxDQUFDOztBQWpDTCxzQ0FrQ0M7QUFFRCxNQUFhLGFBQWE7SUFDdEIsMEJBQTBCO0lBQ25CLE1BQU0sQ0FBVSxXQUFXLEdBQUcsQ0FBQyxDQUFDO0lBRS9CLE1BQU0sR0FBRyxJQUFJLEdBQUcsRUFBc0IsQ0FBQztJQUUvQyxLQUFLLENBQUMsTUFBVyxFQUFFLE1BQWMsRUFBRSxHQUFvQjtRQUNuRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDUixJQUFJLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbEMsQ0FBQztRQUNELElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQzFCLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCxXQUFXLENBQUMsTUFBYyxFQUFFLE1BQWMsRUFBRSxHQUFvQjtRQUM1RCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDN0MsNEJBQTRCO1FBQzVCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUk7SUFDUixDQUFDO0lBQ0QsR0FBRyxDQUFDLE1BQVc7UUFDWCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFDRCxjQUFjO1FBQ1YsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDL0MsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM1QyxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBQ0QsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ1gsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3BDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDcEMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDakMsQ0FBQztRQUNELE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RDLENBQUM7O0FBbkNMLHNDQW9DQztBQXFDRCw2REFBNkQ7QUFDN0QsTUFBYSxJQUFJO0lBQ2IsaUJBQWlCO0lBQ2pCLFFBQVEsQ0FBNEI7SUFDcEMsMENBQTBDO0lBQzFDLFFBQVEsR0FBRyxDQUFDLENBQUM7SUFDYixzQkFBc0I7SUFDdEIsT0FBTyxHQUFHLEtBQUssQ0FBQztJQUNoQix1QkFBdUI7SUFDdkIsZUFBZSxHQUFHLEtBQUssQ0FBQztJQUV4Qiw2REFBNkQ7SUFDckQsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3BCLElBQUksYUFBYTtRQUNiLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBQ0QsSUFBSSxhQUFhLENBQUMsR0FBVztRQUN6QixJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNmLE1BQU0sSUFBSSxLQUFLLENBQUMsbURBQW1ELENBQUMsQ0FBQztRQUN6RSxDQUFDO1FBQ0QsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUM7SUFDdEIsQ0FBQztJQUVELGNBQWM7SUFDZCxJQUFJLE9BQU87UUFDUCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDakUsQ0FBQztJQUVNLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFTLEVBQUUsR0FBUztRQUNoRCxPQUFPLEdBQUcsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztJQUN2QyxDQUFDO0lBRUQsWUFBWSxVQUF1QjtRQUMvQixJQUFJLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQztJQUMvQixDQUFDO0lBQ0QsU0FBUyxDQUF1QixHQUFrQixFQUFFLFVBQWEsRUFBRSxJQUFrQjtJQUNyRixDQUFDO0lBQ0QsVUFBVSxDQUFDLE1BQVksRUFBRSxHQUFtQjtRQUN4QyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUM7SUFDdEIsQ0FBQztJQUVELE1BQU0sQ0FBVSxvQkFBb0IsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDO0lBQzdELE1BQU0sQ0FBVSxxQkFBcUIsR0FBRyxJQUFJLENBQUM7SUFDN0MsK0JBQStCLENBQUMsR0FBa0I7UUFDOUMsa0JBQWtCO1FBQ2xCLDRFQUE0RTtRQUM1RSxrREFBa0Q7UUFDbEQsOEJBQThCO1FBQzlCLGVBQWU7SUFDbkIsQ0FBQztJQUVELGVBQWUsQ0FBQyxXQUF5QjtRQUNyQyw0REFBNEQ7UUFDNUQscURBQXFEO1FBQ3JELG9CQUFvQjtJQUN4QixDQUFDOztBQXRETCxvQkF1REM7QUFFRCxNQUFhLFNBQVUsU0FBUSxJQUFJO0lBQy9CLEtBQUssQ0FBNkI7SUFDbEMsS0FBSyxDQUFxQjtJQUUxQixNQUFNLENBQUMsV0FBVyxHQUFHO1FBQ2pCLENBQUMsVUFBVSxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsVUFBVSxDQUFDO1FBQzlDLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsV0FBVyxDQUFDO1FBQzFDLENBQUMsVUFBVSxDQUFDLGtCQUFrQixFQUFFLFVBQVUsQ0FBQyx3QkFBd0IsQ0FBQztRQUNwRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsVUFBVSxDQUFDLGlCQUFpQixDQUFDO0tBQ3pELENBQUM7SUFFRixZQUFZLE1BQWM7UUFDdEIsS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUNELFNBQVMsQ0FBQyxHQUFXLEVBQUUsVUFBc0IsRUFBRSxJQUFhO1FBQ3hELElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDO1FBQzdCLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQzNCLENBQUM7SUFDRCxVQUFVLENBQUMsTUFBWSxFQUFFLEdBQVc7UUFDaEMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFNBQVMsQ0FBQztRQUM1QixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQztJQUM3QixDQUFDO0lBQ0QsK0JBQStCLENBQUMsR0FBVztRQUN2QyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztRQUM1QyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsZUFBZSxDQUFDLFdBQXlCO1FBQ3JDLFNBQVM7UUFDVCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUN6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdCLElBQUksTUFBTSxZQUFZLElBQUksRUFBRSxDQUFDO2dCQUN6QixJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztvQkFDakIsTUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO29CQUNwRCxJQUFJLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO3dCQUNwQixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxXQUFXLENBQUM7d0JBQ3ZDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDO29CQUM1QixDQUFDO3lCQUNJLENBQUM7d0JBQ0YsbUNBQW1DO3dCQUNuQyx3Q0FBd0M7d0JBQ3hDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLFVBQVUsQ0FBQzt3QkFDdEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7b0JBQ3pCLENBQUM7Z0JBQ0wsQ0FBQztxQkFDSSxDQUFDO29CQUNGLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztvQkFDMUMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDakQsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO29CQUMvQixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDekIsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO1FBQ0QsT0FBTztRQUNQLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ3BELE1BQU0sQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssV0FBVyxDQUFDLEVBQUUsQ0FBQztnQkFDN0MsSUFBSSxDQUFDLFFBQVEsR0FBRyxTQUFnQixDQUFDO2dCQUNqQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDdEIsQ0FBQztRQUNMLENBQUM7UUFDRCxPQUFPO1FBQ1AsSUFBSSxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDO1FBQ2pDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBZSxDQUFDO0lBQ3JELENBQUM7O0FBbEVMLDhCQW1FQztBQUVELE1BQWEsUUFBUyxTQUFRLElBQUk7SUFDOUIsSUFBSSxHQUFjLENBQUMsSUFBSSxDQUFRLENBQUM7SUFDaEMsSUFBSSxHQUFxRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdFLFFBQVEsR0FBeUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVyRDtRQUNJLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDNUMsQ0FBQztJQUNELFNBQVMsQ0FBQyxHQUFXLEVBQUUsVUFBc0IsRUFBRSxLQUFjO1FBQ3pELElBQUksVUFBVSxLQUFLLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUMzQixDQUFDO2FBQ0ksQ0FBQztZQUNGLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDM0MsQ0FBQztJQUNMLENBQUM7SUFDRCxVQUFVLENBQUMsTUFBWSxFQUFFLEdBQVc7UUFDaEMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQztJQUNoQyxDQUFDO0lBQ0QsZUFBZSxDQUFDLFdBQXlCO1FBQ3JDLEtBQUssTUFBTSxHQUFHLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzlCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEMsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ2pCLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDdEQsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztvQkFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ3pELENBQUM7WUFDTCxDQUFDO2lCQUNJLENBQUM7Z0JBQ0YscURBQXFEO2dCQUNyRCxtQkFBbUI7Z0JBQ25CLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztnQkFDMUMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDakQsSUFBSSxNQUFNLENBQUMsT0FBTyxLQUFLLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztvQkFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7Z0JBQzFCLENBQUM7cUJBQ0ksQ0FBQztvQkFDRixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFDOUMsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO1FBQ0QsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLElBQUksUUFBUSxFQUFFLENBQUM7WUFDWCxJQUFJLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUM7WUFDdEMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3JCLENBQUM7YUFDSSxDQUFDO1lBQ0YsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3JCLENBQUM7SUFDTCxDQUFDO0NBQ0o7QUFwREQsNEJBb0RDO0FBRUQsTUFBYSxTQUFVLFNBQVEsSUFBSTtJQUMvQixJQUFJLENBQVM7SUFDYixVQUFVLEdBQUcsSUFBSSxLQUFLLEVBQVUsQ0FBQztJQUN6QixZQUFZLEdBQXFCLEVBQUUsQ0FBQztJQUM1QyxTQUFTLEdBQUcsSUFBSSxLQUFLLEVBQWdELENBQUM7SUFDdEUsMkRBQTJEO0lBQzNELE1BQU0sQ0FBNkI7SUFFbkMsdUNBQXVDO0lBQ3ZDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBYSxFQUFFLElBQVcsRUFBRSxJQUFzQjtRQUM5RCxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFXLENBQUM7UUFDekMsTUFBTSxHQUFHLEdBQUcsSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbEIsR0FBRyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7UUFFeEIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBYSxDQUFDO1FBQzNDLE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxzQkFBc0IsQ0FBVyxDQUFDO1FBQ2hFLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRTdDLElBQUksQ0FBQyxHQUFHLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDdkIsT0FBTyxDQUFDLEdBQUcsY0FBYyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDN0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFCLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLENBQUM7UUFFRCxLQUFLLElBQUksQ0FBQyxHQUFHLGNBQWMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ2hELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLGVBQWUsQ0FBZSxDQUFDO1lBQzVELEdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBRUQsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDO0lBRUQsWUFBWSxJQUFZO1FBQ3BCLEtBQUssQ0FBRSxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUNELFNBQVMsQ0FBQyxHQUFXLEVBQUUsVUFBc0IsRUFBRSxLQUFjO1FBQ3pELElBQUksVUFBVSxLQUFLLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN2QyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMxQixhQUFhO1lBQ2IsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEMsQ0FBQzthQUNJLENBQUM7WUFDRixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2hELENBQUM7UUFDRCxvQ0FBb0M7UUFDcEMsMEJBQTBCO0lBQzlCLENBQUM7SUFDRCxVQUFVLENBQUMsTUFBWSxFQUFFLEdBQVc7UUFDaEMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFDRCxlQUFlLENBQUMsV0FBeUI7UUFDckMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUNqQyxNQUFNLFdBQVcsR0FBRyxDQUFDLENBQUM7UUFDdEIsTUFBTSxZQUFZLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLGdCQUFnQjtRQUNoQixLQUFLLElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ2hELDJCQUEyQjtZQUMzQixnQ0FBZ0M7WUFDaEMsTUFBTSxNQUFNLEdBQUcsU0FBUyxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsQ0FBQztZQUMzQyxJQUFJLE1BQU0sWUFBWSxJQUFJLEVBQUUsQ0FBQztnQkFDekIsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7b0JBQ2pCLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztvQkFDekUsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQzt3QkFDcEIsU0FBUyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxVQUFVLENBQUMsV0FBVyxDQUFDO3dCQUNwRCxTQUFTLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxHQUFHLE9BQU8sQ0FBQztvQkFDMUMsQ0FBQzt5QkFDSSxDQUFDO3dCQUNGLDZDQUE2Qzt3QkFDN0MsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQzNCLENBQUM7Z0JBQ0wsQ0FBQztxQkFDSSxDQUFDO29CQUNGLE1BQU0sQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztvQkFDMUMsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDbkQsSUFBSSxNQUFNLENBQUMsT0FBTyxLQUFLLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQzt3QkFDM0MsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBVyxDQUFDLENBQUM7d0JBQzdDLGFBQWE7d0JBQ2IsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQy9CLDZDQUE2Qzt3QkFDN0MsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQzNCLENBQUM7eUJBQ0ksQ0FBQzt3QkFDRixTQUFTLENBQUMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUM7d0JBQzVDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLEdBQUcsTUFBTSxDQUFDO29CQUN6QyxDQUFDO2dCQUNMLENBQUM7WUFDTCxDQUFDO1FBQ0wsQ0FBQztRQUVELGNBQWM7UUFDZCxNQUFNLElBQUksR0FBRyxhQUFhLENBQUMsV0FBVyxDQUFDO1FBQ3ZDLHVDQUF1QztRQUN2QyxJQUFJLENBQUMsTUFBTSxHQUFJLENBQUMsSUFBSSxDQUFzQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFxQixDQUFDO1FBQ3pGLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMzQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBWSxDQUFDLENBQUM7UUFDN0QsQ0FBQztRQUVELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBRXRFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0NBQ0o7QUExR0QsOEJBMEdDO0FBRUQsTUFBYSxlQUFnQixTQUFRLElBQUk7SUFDckMsSUFBSSxDQUFTO0lBQ2IsT0FBTyxDQUEyQjtJQUNsQyxNQUFNLENBQThCO0lBRXBDLHVDQUF1QztJQUN2QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQVksRUFBRSxJQUF1QjtRQUNqRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUM5QyxNQUFNLEdBQUcsR0FBRyxJQUFJLGVBQWUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDL0MsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDbEIsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDO0lBRUQsWUFBWSxJQUFZLEVBQUUsT0FBaUM7UUFDdkQsS0FBSyxDQUFFLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUMzQixDQUFDO0lBQ0QsU0FBUyxDQUFDLEdBQVcsRUFBRSxVQUFzQixFQUFFLEtBQWM7UUFDekQsTUFBTSxJQUFJLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFDRCxVQUFVLENBQUMsTUFBWSxFQUFFLEdBQVc7UUFDaEMsTUFBTSxJQUFJLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFDRCxlQUFlLENBQUMsV0FBeUI7UUFDckMsTUFBTSxLQUFLLEdBQUcsYUFBYSxDQUFDLFdBQVcsQ0FBQztRQUN4QyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNwQyx5Q0FBeUM7UUFDekMsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7Q0FDSjtBQTlCRCwwQ0E4QkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgZGVzZXJpYWxpemUsXHJcbn0gZnJvbSAnY2MnO1xyXG5cclxuLy8gaW1wb3J0IGRlc2VyaWFsaXplciB0eXBlc1xyXG5pbXBvcnQgRCA9IGRlc2VyaWFsaXplLkludGVybmFsO1xyXG50eXBlIE90aGVyT2JqZWN0RGF0YSA9IEQuT3RoZXJPYmplY3REYXRhXztcclxudHlwZSBBbnlEYXRhID0gRC5BbnlEYXRhXztcclxuaW1wb3J0IERhdGFUeXBlSUQgPSBELkRhdGFUeXBlSURfO1xyXG50eXBlIERhdGFUeXBlcyA9IEQuRGF0YVR5cGVzXztcclxudHlwZSBJQXJyYXlEYXRhID0gRC5JQXJyYXlEYXRhXztcclxudHlwZSBJQ2xhc3NPYmplY3REYXRhID0gRC5JQ2xhc3NPYmplY3REYXRhXztcclxudHlwZSBJQ3VzdG9tT2JqZWN0RGF0YSA9IEQuSUN1c3RvbU9iamVjdERhdGFfO1xyXG50eXBlIElDdXN0b21PYmplY3REYXRhQ29udGVudCA9IEQuSUN1c3RvbU9iamVjdERhdGFDb250ZW50XztcclxudHlwZSBJRGljdERhdGEgPSBELklEaWN0RGF0YV87XHJcbnR5cGUgSU1hc2sgPSBELklNYXNrXztcclxudHlwZSBJQ2xhc3MgPSBELklDbGFzc187XHJcblxyXG5jb25zdCB7XHJcbiAgICBESUNUX0pTT05fTEFZT1VULFxyXG4gICAgQ0xBU1NfVFlQRSxcclxuICAgIENMQVNTX0tFWVMsXHJcbiAgICBDTEFTU19QUk9QX1RZUEVfT0ZGU0VULFxyXG4gICAgQ1VTVE9NX09CSl9EQVRBX0NPTlRFTlQsXHJcbiAgICBNQVNLX0NMQVNTLFxyXG59ID0gZGVzZXJpYWxpemUuX21hY3JvcztcclxuXHJcbmV4cG9ydCBjbGFzcyBUcmFjZWFibGVJdGVtIHtcclxuICAgXHJcbiAgICAvLyBkYXRhVHlwZUlEOiBEYXRhVHlwZUlEIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG5cclxuICAgIC8vIOW8leeUqOWFs+ezu+OAgui/memHjOS4jeiAg+iZkeWumuS5ieW8leeUqOWvueixoeS6hu+8jOaUueeUqOS4pOS4quaVsOe7hOOAguWboOS4uuW8leeUqOWvueixoeS9v+eUqOiAheS5n+S8muiiq+iApuWQiO+8jOiAjOS4lOS9v+eUqOiAheWIm+W7uueahOS4tOaXtuWvueixoeS8muabtOWkmlxyXG4gICAgcHJpdmF0ZSB0cmFjZXJzOiBhbnlbXSA9IFtdO1xyXG4gICAgcHJpdmF0ZSBrZXlzOiAoc3RyaW5nfG51bWJlcilbXSA9IFtdO1xyXG5cclxuICAgIC8vIGdldCBpc1NlcmlhbGl6ZWQgKCk6IGJvb2xlYW4ge1xyXG4gICAgLy8gICAgIHJldHVybiB0aGlzLnJlc3VsdCAhPT0gVHJhY2VhYmxlSXRlbS5OT19SRVNVTFQ7XHJcbiAgICAvLyB9O1xyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgY29tcGFyZUJ5UmVmQ291bnQobGhzOiBUcmFjZWFibGVJdGVtLCByaHM6IFRyYWNlYWJsZUl0ZW0pOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiByaHMudHJhY2Vycy5sZW5ndGggLSBsaHMudHJhY2Vycy5sZW5ndGg7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTk9fUkVTVUxUID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuXHJcbiAgICAvLyDpnIDopoHov73ouKrnmoTmlbDmja5cclxuICAgIHJlc3VsdDogYW55ID0gVHJhY2VhYmxlSXRlbS5OT19SRVNVTFQ7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgLy8gdGhpcy5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgLy8gdGhpcy5zZXJpYWxpemVkID0gc2VyaWFsaXplZDtcclxuICAgIH1cclxuICAgIHRyYWNlQnkodHJhY2VyOiBvYmplY3QsIGtleTogKHN0cmluZ3xudW1iZXIpKSB7XHJcbiAgICAgICAgdGhpcy50cmFjZXJzLnB1c2godHJhY2VyKTtcclxuICAgICAgICB0aGlzLmtleXMucHVzaChrZXkpO1xyXG4gICAgfVxyXG4gICAgbW92ZWRUbyhpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnRyYWNlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy50cmFjZXJzW2ldW3RoaXMua2V5c1tpXV0gPSBpbmRleDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBUcmFjZWFibGVEaWN0PFQ+IHtcclxuICAgIC8vIOW9k+afkOS4que0ouW8leWwhuS8muiiq+W7tui/n+i1i+WAvOaXtu+8jOS9v+eUqOi/meS4quWtl+auteadpeWNoOWdkVxyXG4gICAgcHVibGljIHN0YXRpYyByZWFkb25seSBQTEFDRUhPTERFUiA9IDA7XHJcblxyXG4gICAgcHJpdmF0ZSB2YWx1ZXMgPSBuZXcgTWFwPGFueSwgVHJhY2VhYmxlSXRlbT4oKTtcclxuXHJcbiAgICB0cmFjZShzb3VyY2U6IGFueSwgdHJhY2VyOiBvYmplY3QsIGtleTogKHN0cmluZ3xudW1iZXIpKTogVHJhY2VhYmxlSXRlbSB7XHJcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLnZhbHVlcy5nZXQoc291cmNlKTtcclxuICAgICAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgICAgICAgaXRlbSA9IG5ldyBUcmFjZWFibGVJdGVtKCk7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWVzLnNldChzb3VyY2UsIGl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpdGVtLnRyYWNlQnkodHJhY2VyLCBrZXkpO1xyXG4gICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgfVxyXG4gICAgdHJhY2VTdHJpbmcoc291cmNlOiBzdHJpbmcsIHRyYWNlcjogb2JqZWN0LCBrZXk6IChzdHJpbmd8bnVtYmVyKSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLnRyYWNlKHNvdXJjZSwgdHJhY2VyLCBrZXkpO1xyXG4gICAgICAgIC8vIGlmICghaXRlbS5pc1NlcmlhbGl6ZWQpIHtcclxuICAgICAgICBpdGVtLnJlc3VsdCA9IHNvdXJjZTtcclxuICAgICAgICAvLyB9XHJcbiAgICB9XHJcbiAgICBnZXQoc291cmNlOiBhbnkpOiBUcmFjZWFibGVJdGVtIHwgdW5kZWZpbmVkIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXMuZ2V0KHNvdXJjZSk7XHJcbiAgICB9XHJcbiAgICBnZXRTb3J0ZWRJdGVtcygpOiBUcmFjZWFibGVJdGVtW10ge1xyXG4gICAgICAgIGNvbnN0IGFycmF5ID0gQXJyYXkuZnJvbSh0aGlzLnZhbHVlcy52YWx1ZXMoKSk7XHJcbiAgICAgICAgYXJyYXkuc29ydChUcmFjZWFibGVJdGVtLmNvbXBhcmVCeVJlZkNvdW50KTtcclxuICAgICAgICByZXR1cm4gYXJyYXk7XHJcbiAgICB9XHJcbiAgICBkdW1wKG9mZnNldCA9IDApOiBUW10ge1xyXG4gICAgICAgIGNvbnN0IGFycmF5ID0gdGhpcy5nZXRTb3J0ZWRJdGVtcygpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgYXJyYXlbaV0ubW92ZWRUbyhvZmZzZXQgKyBpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFycmF5Lm1hcCgoeCkgPT4geC5yZXN1bHQpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElSZWZzQnVpbGRlciB7XHJcbiAgICAvLyDlpoLmnpzov5Tlm54gTmFOIOWImeivtOaYjuWxnuaAp+S8muiiq+W7tui/n+i1i+WAvO+8jOaXoOmcgOS/neWtmOWcqOWvueixoeS4ilxyXG4gICAgYWRkUmVmIChvd25lcjogTm9kZSwga2V5OiBzdHJpbmcgfCBudW1iZXIsIHRhcmdldDogTm9kZSk6IG51bWJlcjtcclxufVxyXG5cclxuLy8gY2xhc3MgUm9vdGVkVHJhY2VhYmxlRGljdDxUPiBleHRlbmRzIFRyYWNlYWJsZURpY3Q8VD4ge1xyXG4vLyAgICAgcHJpdmF0ZSByb290OiBhbnk7XHJcbi8vXHJcbi8vICAgICBzZXRSb290IChzb3VyY2U6IGFueSkge1xyXG4vLyAgICAgICAgIHRoaXMucm9vdCA9IHNvdXJjZTtcclxuLy8gICAgIH1cclxuLy8gICAgIGR1bXAgKCk6IChUfG51bWJlcilbXSB7XHJcbi8vICAgICAgICAgbGV0IGFycmF5ID0gc3VwZXIuZ2V0U29ydGVkSXRlbXMoKTtcclxuLy8gICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbi8vICAgICAgICAgICAgIGFycmF5W2ldLm1vdmVkVG8oaSk7XHJcbi8vICAgICAgICAgfVxyXG4vLyAgICAgICAgIGxldCByZXMgPSBhcnJheS5tYXAoeCA9PiB4LnJlc3VsdCk7XHJcbi8vXHJcbi8vICAgICAgICAgbGV0IHJvb3RJdGVtID0gdGhpcy5nZXQodGhpcy5yb290KTtcclxuLy8gICAgICAgICBpZiAoIXJvb3RJdGVtKSB7XHJcbi8vICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHNlcmlhbGl6ZSwgcm9vdCBpdGVtIGlzIG5vdCBkZWZpbmVkLicpO1xyXG4vLyAgICAgICAgIH1cclxuLy8gICAgICAgICBsZXQgcm9vdEluZGV4ID0gYXJyYXkuaW5kZXhPZihyb290SXRlbSk7XHJcbi8vXHJcbi8vICAgICAgICAgcmVzLnB1c2gocm9vdEluZGV4KTtcclxuLy8gICAgICAgICByZXR1cm4gcmVzO1xyXG4vLyAgICAgfVxyXG4vLyB9XHJcblxyXG50eXBlIER5bmFtaWNUeXBlID0gRGF0YVR5cGVJRC5BcnJheSB8IERhdGFUeXBlSUQuRGljdCB8IERhdGFUeXBlSUQuQ2xhc3MgfCBEYXRhVHlwZUlELkN1c3RvbWl6ZWRDbGFzcztcclxudHlwZSBEZXJpdmVkVHlwZSA9IERhdGFUeXBlSUQuSW5zdGFuY2VSZWYgfCAvLyDooqvlpJrkuKrlr7nosaHlpI3nlKjml7ZcclxuICAgIERhdGFUeXBlSUQuU2ltcGxlVHlwZSB8IC8vIOWPr+S7peWujOe+juiiqyBqc29uIOW6j+WIl+WMluaXtlxyXG4gICAgRGF0YVR5cGVJRC5BcnJheV9Bc3NldFJlZkJ5SW5uZXJPYmogfCBEYXRhVHlwZUlELkFycmF5X0NsYXNzIHwgRGF0YVR5cGVJRC5BcnJheV9JbnN0YW5jZVJlZjtcclxudHlwZSBTdGF0aWNUeXBlID0gRGF0YVR5cGVJRC5TaW1wbGVUeXBlIHwgRGF0YVR5cGVJRC5WYWx1ZVR5cGUgfCBEYXRhVHlwZUlELlZhbHVlVHlwZUNyZWF0ZWQgfCBEYXRhVHlwZUlELlRSUyB8IERhdGFUeXBlSUQuQXNzZXRSZWZCeUlubmVyT2JqO1xyXG5cclxuLy8g5L+d5a2Y5Zy65pmv5a+56LGh57uT5p6E77yM5q2kIE5vZGUg6Z2eIGNjLk5vZGXvvIzogIzmmK/nlKjmnaXooajnpLrlhbPns7vlr7nosaHlhbPns7vlm77kuK3nmoToioLngrnjgILov5nkupvoioLngrnkvJrnu4Tnu4fmiJDmnInlkJHmnInnjq/lm77jgIJcclxuZXhwb3J0IGNsYXNzIE5vZGUge1xyXG4gICAgLy8g6Ieq6Lqr5bqP5YiX5YyW5pe26ZyA6KaB55So55qE5a6e6ZmF57G75Z6LXHJcbiAgICBzZWxmVHlwZTogRHluYW1pY1R5cGUgfCBEZXJpdmVkVHlwZTtcclxuICAgIC8vIOatpOWvueixoeiiq+W8leeUqOeahOasoeaVsO+8jOWGs+WumuS6huaYr+WQpuW/hemhu+aUvuWIsCBpbnN0YW5jZXPvvIzku6Xlj4rlkI7nu63nmoTkvJjljJbmnYPph41cclxuICAgIHJlZkNvdW50ID0gMDtcclxuICAgIC8vIOW9k+WJjeiKgueCueaYr+WQpuWcqCBpbnN0YW5jZXMg5LitXHJcbiAgICBpbmRleGVkID0gZmFsc2U7XHJcbiAgICAvLyDlvZPliY3oioLngrnlj6rog73mlL7lnKggaW5zdGFuY2VzIOS4rVxyXG4gICAgc2hvdWxkQmVJbmRleGVkID0gZmFsc2U7XHJcblxyXG4gICAgLy8g5b2T5YmN6IqC54K55ZyoIGluc3RhbmNlcyDkuK3nmoTntKLlvJXvvIzlpoLmnpzlvZPliY3oioLngrnkuI3lnKggaW5zdGFuY2VzIOS4reWImei/lOWbnuaMgeacieW9k+WJjeiKgueCueeahOelluWFiOiKgueCueeahOe0ouW8lVxyXG4gICAgcHJpdmF0ZSBfaW5kZXggPSAtMTtcclxuICAgIGdldCBpbnN0YW5jZUluZGV4KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2luZGV4O1xyXG4gICAgfVxyXG4gICAgc2V0IGluc3RhbmNlSW5kZXgodmFsOiBudW1iZXIpIHtcclxuICAgICAgICBpZiAodGhpcy5pbmRleGVkKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2hvdWxkIG5vdCBjaGFuZ2UgaW5zdGFuY2VJbmRleCBvbiBpbmRleGVkIG9iamVjdCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9pbmRleCA9IHZhbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDooqvlhbblroPlr7nosaHlvJXnlKjml7bnmoTnsbvlnotcclxuICAgIGdldCByZWZUeXBlKCk6IER5bmFtaWNUeXBlIHwgRGVyaXZlZFR5cGUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4ZWQgPyBEYXRhVHlwZUlELkluc3RhbmNlUmVmIDogdGhpcy5zZWxmVHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGNvbXBhcmVCeVJlZkNvdW50KGxoczogTm9kZSwgcmhzOiBOb2RlKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gcmhzLnJlZkNvdW50IC0gbGhzLnJlZkNvdW50O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGRhdGFUeXBlSUQ6IER5bmFtaWNUeXBlKSB7XHJcbiAgICAgICAgdGhpcy5zZWxmVHlwZSA9IGRhdGFUeXBlSUQ7XHJcbiAgICB9XHJcbiAgICBzZXRTdGF0aWM8VCBleHRlbmRzIFN0YXRpY1R5cGU+KGtleTogc3RyaW5nfG51bWJlciwgZGF0YVR5cGVJRDogVCwgZGF0YTogRGF0YVR5cGVzW1RdKSB7XHJcbiAgICB9XHJcbiAgICBzZXREeW5hbWljKHRhcmdldDogTm9kZSwga2V5Pzogc3RyaW5nfG51bWJlcikge1xyXG4gICAgICAgICsrdGFyZ2V0LnJlZkNvdW50O1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZWFkb25seSBBc3NldFBsYWNlaG9sZGVyVHlwZSA9IERhdGFUeXBlSUQuU2ltcGxlVHlwZTtcclxuICAgIHN0YXRpYyByZWFkb25seSBBc3NldFBsYWNlaG9sZGVyVmFsdWUgPSBudWxsO1xyXG4gICAgc2V0QXNzZXRSZWZQbGFjZWhvbGRlck9uSW5kZXhlZChrZXk6IHN0cmluZ3xudW1iZXIpIHtcclxuICAgICAgICAvLyDorr7nva7kvJrooqvlu7bov5/liJ3lp4vljJbnmoTotYTmupDpu5jorqTlgLxcclxuICAgICAgICAvLyDlj6rmnInkuI3kuLogQXNzZXRSZWZCeUlubmVyT2JqIC8gQXJyYXlfQXNzZXRSZWZCeUlubmVyT2JqIOeahOWxnuaAp+aJjeimgeWkmuiuvue9rui/meS4qiBwbGFjZWhvbGRlclxyXG4gICAgICAgIC8vIOWunumZheS4iuWPquacieaVsOe7hOmcgOimgeaPkOWJjeWIneWni+WMlu+8jOWboOS4uuWmguaenOi1i+WAvOmhuuW6j+S4jemAkuWinu+8jOS8muS6p+eUn+epuua0nu+8jOWvvOiHtOaVsOe7hOmAgOWMluS4uuWtl+WFuO+8jOW9seWTjeaAp+iDvVxyXG4gICAgICAgIC8vIOexu+WvueixoeWcqOaehOmAoOWHveaVsOW3sue7j+mihOWIhumFjeS6hu+8jOS4jemcgOimgeWcqOWPjeW6j+WIl+WMlumHjeaWsOWIhumFjVxyXG4gICAgICAgIC8vIOWtl+WFuOWvueixoeS4jeW4uOeUqOWwseS4jee6oOe7k+S6hlxyXG4gICAgfVxyXG5cclxuICAgIGR1bXBSZWN1cnNpdmVseShyZWZzQnVpbGRlcjogSVJlZnNCdWlsZGVyKTogKElDbGFzc09iamVjdERhdGF8T3RoZXJPYmplY3REYXRhKSB7XHJcbiAgICAgICAgLy8g6YCS5b2S6LCD55So5omA5pyJ6Zmk5LqGIERhdGFUeXBlSUQuSW5zdGFuY2VSZWYg57G75Z6L55qE5YWz6IGU6IqC54K555qEIGR1bXBSZWN1cnNpdmVseeOAglxyXG4gICAgICAgIC8vIOeUseS6juaJgOacieWPr+iDveS6p+eUn+W+queOr+W8leeUqOeahOiKgueCue+8jOmDveaPkOWJjei9rOaNouaIkOS6hiBEYXRhVHlwZUlELkluc3RhbmNlUmVmIOexu+Wei++8jFxyXG4gICAgICAgIC8vIOaJgOS7pei/memHjOebtOaOpemAkuW9kuWwseihjO+8jOS4jeS8muatu+W+queOr+OAglxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQXJyYXlOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgICB0eXBlczogKERhdGFUeXBlSUQgfCB1bmRlZmluZWQpW107XHJcbiAgICBkYXRhczogKEFueURhdGEgfCBOb2RlKVtdO1xyXG5cclxuICAgIHN0YXRpYyBEZXJpdmVUeXBlcyA9IFtcclxuICAgICAgICBbRGF0YVR5cGVJRC5TaW1wbGVUeXBlLCBEYXRhVHlwZUlELlNpbXBsZVR5cGVdLFxyXG4gICAgICAgIFtEYXRhVHlwZUlELkNsYXNzLCBEYXRhVHlwZUlELkFycmF5X0NsYXNzXSxcclxuICAgICAgICBbRGF0YVR5cGVJRC5Bc3NldFJlZkJ5SW5uZXJPYmosIERhdGFUeXBlSUQuQXJyYXlfQXNzZXRSZWZCeUlubmVyT2JqXSxcclxuICAgICAgICBbRGF0YVR5cGVJRC5JbnN0YW5jZVJlZiwgRGF0YVR5cGVJRC5BcnJheV9JbnN0YW5jZVJlZl0sXHJcbiAgICBdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGxlbmd0aDogbnVtYmVyKSB7XHJcbiAgICAgICAgc3VwZXIoRGF0YVR5cGVJRC5BcnJheSk7XHJcbiAgICAgICAgdGhpcy50eXBlcyA9IG5ldyBBcnJheShsZW5ndGgpO1xyXG4gICAgICAgIHRoaXMuZGF0YXMgPSBuZXcgQXJyYXkobGVuZ3RoKTtcclxuICAgIH1cclxuICAgIHNldFN0YXRpYyhrZXk6IG51bWJlciwgZGF0YVR5cGVJRDogU3RhdGljVHlwZSwgZGF0YTogQW55RGF0YSkge1xyXG4gICAgICAgIHRoaXMudHlwZXNba2V5XSA9IGRhdGFUeXBlSUQ7XHJcbiAgICAgICAgdGhpcy5kYXRhc1trZXldID0gZGF0YTtcclxuICAgIH1cclxuICAgIHNldER5bmFtaWModGFyZ2V0OiBOb2RlLCBrZXk6IG51bWJlcikge1xyXG4gICAgICAgIHN1cGVyLnNldER5bmFtaWModGFyZ2V0KTtcclxuICAgICAgICB0aGlzLnR5cGVzW2tleV0gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5kYXRhc1trZXldID0gdGFyZ2V0O1xyXG4gICAgfVxyXG4gICAgc2V0QXNzZXRSZWZQbGFjZWhvbGRlck9uSW5kZXhlZChrZXk6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMudHlwZXNba2V5XSA9IE5vZGUuQXNzZXRQbGFjZWhvbGRlclR5cGU7XHJcbiAgICAgICAgdGhpcy5kYXRhc1trZXldID0gTm9kZS5Bc3NldFBsYWNlaG9sZGVyVmFsdWU7XHJcbiAgICB9XHJcbiAgICBkdW1wUmVjdXJzaXZlbHkocmVmc0J1aWxkZXI6IElSZWZzQnVpbGRlcikge1xyXG4gICAgICAgIC8vIOmAkuW9kuS+nei1luiKgueCuVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kYXRhcy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmRhdGFzW2ldO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgTm9kZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldC5pbmRleGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVmRGF0YSA9IHJlZnNCdWlsZGVyLmFkZFJlZih0aGlzLCBpLCB0YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0Zpbml0ZShyZWZEYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGVzW2ldID0gRGF0YVR5cGVJRC5JbnN0YW5jZVJlZjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhc1tpXSA9IHJlZkRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlhYjotYvlgLzkuLogbnVsbO+8jOWPjeW6j+WIl+WMluWQjuS8muiiqyByZWZzIOW7tui/n+i1i+WAvOS4uuebruagh+iKgueCuVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIC0g6L+Z5qC35Y+v6IO95Lya5a+86Ie05peg5rOV54m55YyW5Li6IEFycmF5X0luc3RhbmNlUmVmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHlwZXNbaV0gPSBEYXRhVHlwZUlELlNpbXBsZVR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YXNbaV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5pbnN0YW5jZUluZGV4ID0gdGhpcy5pbnN0YW5jZUluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB0YXJnZXQuZHVtcFJlY3Vyc2l2ZWx5KHJlZnNCdWlsZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnR5cGVzW2ldID0gdGFyZ2V0LnJlZlR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhc1tpXSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g54m55YyW5pWw57uEXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBBcnJheU5vZGUuRGVyaXZlVHlwZXMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgY29uc3QgW2VsZW1lbnRUeXBlLCBhcnJheVR5cGVdID0gQXJyYXlOb2RlLkRlcml2ZVR5cGVzW2ldO1xyXG4gICAgICAgICAgICBpZiAodGhpcy50eXBlcy5ldmVyeSgoeCkgPT4geCA9PT0gZWxlbWVudFR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGZUeXBlID0gYXJyYXlUeXBlIGFzIGFueTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGFzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIOa3t+WQiOaVsOe7hFxyXG4gICAgICAgIHRoaXMuc2VsZlR5cGUgPSBEYXRhVHlwZUlELkFycmF5O1xyXG4gICAgICAgIHJldHVybiBbdGhpcy5kYXRhcywgLi4udGhpcy50eXBlc10gYXMgSUFycmF5RGF0YTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIERpY3ROb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgICBkYXRhOiBJRGljdERhdGEgPSBbbnVsbF0gYXMgYW55O1xyXG4gICAganNvbjogUmVjb3JkPHN0cmluZywgRGF0YVR5cGVzW0RhdGFUeXBlSUQuU2ltcGxlVHlwZV0+ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgIGR5bmFtaWNzOiBSZWNvcmQ8c3RyaW5nLCBOb2RlPiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoRGF0YVR5cGVJRC5EaWN0KTtcclxuICAgICAgICB0aGlzLmRhdGFbRElDVF9KU09OX0xBWU9VVF0gPSB0aGlzLmpzb247XHJcbiAgICB9XHJcbiAgICBzZXRTdGF0aWMoa2V5OiBzdHJpbmcsIGRhdGFUeXBlSUQ6IFN0YXRpY1R5cGUsIHZhbHVlOiBBbnlEYXRhKSB7XHJcbiAgICAgICAgaWYgKGRhdGFUeXBlSUQgPT09IERhdGFUeXBlSUQuU2ltcGxlVHlwZSkge1xyXG4gICAgICAgICAgICB0aGlzLmpzb25ba2V5XSA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLnB1c2goa2V5LCBkYXRhVHlwZUlELCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2V0RHluYW1pYyh0YXJnZXQ6IE5vZGUsIGtleTogc3RyaW5nKSB7XHJcbiAgICAgICAgc3VwZXIuc2V0RHluYW1pYyh0YXJnZXQpO1xyXG4gICAgICAgIHRoaXMuZHluYW1pY3Nba2V5XSA9IHRhcmdldDtcclxuICAgIH1cclxuICAgIGR1bXBSZWN1cnNpdmVseShyZWZzQnVpbGRlcjogSVJlZnNCdWlsZGVyKTogSURpY3REYXRhIHwgb2JqZWN0IHtcclxuICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLmR5bmFtaWNzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRoaXMuZHluYW1pY3Nba2V5XTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldC5pbmRleGVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCByZWZEYXRhID0gcmVmc0J1aWxkZXIuYWRkUmVmKHRoaXMsIGtleSwgdGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIGlmIChpc0Zpbml0ZShyZWZEYXRhKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5wdXNoKGtleSwgRGF0YVR5cGVJRC5JbnN0YW5jZVJlZiwgcmVmRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyDnlLHkuo7miYDmnInlj6/og73kuqfnlJ/lvqrnjq/lvJXnlKjnmoToioLngrnvvIzpg73mj5DliY3ovazmjaLmiJDkuoYgRGF0YVR5cGVJRC5JbnN0YW5jZVJlZiDnsbvlnovvvIxcclxuICAgICAgICAgICAgICAgIC8vIOaJgOS7pei/memHjOebtOaOpemAkuW9kuWwseihjO+8jOS4jeS8muatu+W+queOr1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0Lmluc3RhbmNlSW5kZXggPSB0aGlzLmluc3RhbmNlSW5kZXg7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gdGFyZ2V0LmR1bXBSZWN1cnNpdmVseShyZWZzQnVpbGRlcik7XHJcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LnJlZlR5cGUgPT09IERhdGFUeXBlSUQuU2ltcGxlVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuanNvbltrZXldID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5wdXNoKGtleSwgdGFyZ2V0LnJlZlR5cGUsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGlzU2ltcGxlID0gdGhpcy5kYXRhLmxlbmd0aCA9PT0gMTtcclxuICAgICAgICBpZiAoaXNTaW1wbGUpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxmVHlwZSA9IERhdGFUeXBlSUQuU2ltcGxlVHlwZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuanNvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ2xhc3NOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgICBjdG9yOiBzdHJpbmc7XHJcbiAgICBzaW1wbGVLZXlzID0gbmV3IEFycmF5PHN0cmluZz4oKTtcclxuICAgIHByaXZhdGUgc2ltcGxlVmFsdWVzOiBBbnlEYXRhW10gfCBudWxsID0gW107XHJcbiAgICBhZHZhbmNlZHMgPSBuZXcgQXJyYXk8c3RyaW5nfChEYXRhVHlwZUlEfHVuZGVmaW5lZCl8KEFueURhdGF8Tm9kZSk+KCk7XHJcbiAgICAvLyBkdW1wIOWQjueahOe7k+aenOOAgmR1bXAg5ZCOIHNpbXBsZVZhbHVlcyDkvJrooqvmuIXnqbrvvIxhZHZhbmNlZHMg5Lit55qE5pWw5o2u6YOo5YiG5Lmf5Lya6KKr5Yig6ZmkXHJcbiAgICBkdW1wZWQ6IElDbGFzc09iamVjdERhdGF8dW5kZWZpbmVkO1xyXG5cclxuICAgIC8vIOS7juaVsOaNruebtOaOpeWPjeWQkeeUn+aIkOS4gOS4quW3sue7j+iwg+eUqOi/hyBkdW1wUmVjdXJzaXZlbHkg55qE5a+56LGhXHJcbiAgICBzdGF0aWMgZnJvbURhdGEoY2xheno6IElDbGFzcywgbWFzazogSU1hc2ssIGRhdGE6IElDbGFzc09iamVjdERhdGEpOiBDbGFzc05vZGUge1xyXG4gICAgICAgIGNvbnN0IGN0b3IgPSBjbGF6eltDTEFTU19UWVBFXSBhcyBzdHJpbmc7XHJcbiAgICAgICAgY29uc3QgcmVzID0gbmV3IENsYXNzTm9kZShjdG9yKTtcclxuICAgICAgICByZXMuZHVtcGVkID0gZGF0YTtcclxuICAgICAgICByZXMuc2ltcGxlVmFsdWVzID0gbnVsbDtcclxuXHJcbiAgICAgICAgY29uc3Qga2V5cyA9IGNsYXp6W0NMQVNTX0tFWVNdIGFzIHN0cmluZ1tdO1xyXG4gICAgICAgIGNvbnN0IGNsYXNzVHlwZU9mZnNldCA9IGNsYXp6W0NMQVNTX1BST1BfVFlQRV9PRkZTRVRdIGFzIG51bWJlcjtcclxuICAgICAgICBjb25zdCBtYXNrVHlwZU9mZnNldCA9IG1hc2tbbWFzay5sZW5ndGggLSAxXTtcclxuXHJcbiAgICAgICAgbGV0IGkgPSBNQVNLX0NMQVNTICsgMTtcclxuICAgICAgICBmb3IgKDsgaSA8IG1hc2tUeXBlT2Zmc2V0OyArK2kpIHtcclxuICAgICAgICAgICAgY29uc3Qga2V5ID0ga2V5c1ttYXNrW2ldXTtcclxuICAgICAgICAgICAgcmVzLnNpbXBsZUtleXMucHVzaChrZXkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IG1hc2tUeXBlT2Zmc2V0OyBpIDwgZGF0YS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBjb25zdCBrZXkgPSBrZXlzW21hc2tbaV1dO1xyXG4gICAgICAgICAgICBjb25zdCB0eXBlID0gY2xhenpbbWFza1tpXSArIGNsYXNzVHlwZU9mZnNldF0gYXMgRGF0YVR5cGVJRDtcclxuICAgICAgICAgICAgcmVzLmFkdmFuY2Vkcy5wdXNoKGtleSwgdHlwZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGN0b3I6IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyIChEYXRhVHlwZUlELkNsYXNzKTtcclxuICAgICAgICB0aGlzLmN0b3IgPSBjdG9yO1xyXG4gICAgfVxyXG4gICAgc2V0U3RhdGljKGtleTogc3RyaW5nLCBkYXRhVHlwZUlEOiBTdGF0aWNUeXBlLCB2YWx1ZTogQW55RGF0YSkge1xyXG4gICAgICAgIGlmIChkYXRhVHlwZUlEID09PSBEYXRhVHlwZUlELlNpbXBsZVR5cGUpIHtcclxuICAgICAgICAgICAgdGhpcy5zaW1wbGVLZXlzLnB1c2goa2V5KTtcclxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICB0aGlzLnNpbXBsZVZhbHVlcy5wdXNoKHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWR2YW5jZWRzLnB1c2goa2V5LCBkYXRhVHlwZUlELCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHRoaXMubWV0YXMucHVzaChrZXksIGRhdGFUeXBlSUQpO1xyXG4gICAgICAgIC8vIHRoaXMuZGF0YXMucHVzaCh2YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBzZXREeW5hbWljKHRhcmdldDogTm9kZSwga2V5OiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlci5zZXREeW5hbWljKHRhcmdldCk7XHJcbiAgICAgICAgdGhpcy5hZHZhbmNlZHMucHVzaChrZXksIHVuZGVmaW5lZCwgdGFyZ2V0KTtcclxuICAgIH1cclxuICAgIGR1bXBSZWN1cnNpdmVseShyZWZzQnVpbGRlcjogSVJlZnNCdWlsZGVyKTogSUNsYXNzT2JqZWN0RGF0YSB7XHJcbiAgICAgICAgY29uc3QgYWR2YW5jZWRzID0gdGhpcy5hZHZhbmNlZHM7XHJcbiAgICAgICAgY29uc3QgVFlQRV9PRkZTRVQgPSAxO1xyXG4gICAgICAgIGNvbnN0IFZBTFVFX09GRlNFVCA9IDI7XHJcbiAgICAgICAgLy8gZHVtcCBjaGlsZHJlblxyXG4gICAgICAgIGZvciAobGV0IGkgPSBhZHZhbmNlZHMubGVuZ3RoIC0gMzsgaSA+PSAwOyBpIC09IDMpIHtcclxuICAgICAgICAgICAgLy8gbGV0IGtleSA9IHRoaXMubWV0YXNbbV07XHJcbiAgICAgICAgICAgIC8vIGxldCB0eXBlID0gdGhpcy5tZXRhc1ttICsgMV07XHJcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGFkdmFuY2Vkc1tpICsgVkFMVUVfT0ZGU0VUXTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIE5vZGUpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuaW5kZXhlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZkRhdGEgPSByZWZzQnVpbGRlci5hZGRSZWYodGhpcywgYWR2YW5jZWRzW2ldIGFzIHN0cmluZywgdGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNGaW5pdGUocmVmRGF0YSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRzW2kgKyBUWVBFX09GRlNFVF0gPSBEYXRhVHlwZUlELkluc3RhbmNlUmVmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZHNbaSArIFZBTFVFX09GRlNFVF0gPSByZWZEYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIGtleS10eXBlLXZhbHVlIHR1cGxlIGZyb20gYWR2YW5jZWRzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2Vkcy5zcGxpY2UoaSwgMyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Lmluc3RhbmNlSW5kZXggPSB0aGlzLmluc3RhbmNlSW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVtcGVkID0gdGFyZ2V0LmR1bXBSZWN1cnNpdmVseShyZWZzQnVpbGRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldC5yZWZUeXBlID09PSBEYXRhVHlwZUlELlNpbXBsZVR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaW1wbGVLZXlzLnB1c2goYWR2YW5jZWRzW2ldIGFzIHN0cmluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaW1wbGVWYWx1ZXMucHVzaChkdW1wZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUga2V5LXR5cGUtdmFsdWUgdHVwbGUgZnJvbSBhZHZhbmNlZHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRzLnNwbGljZShpLCAzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2Vkc1tpICsgVFlQRV9PRkZTRVRdID0gdGFyZ2V0LnJlZlR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2Vkc1tpICsgVkFMVUVfT0ZGU0VUXSA9IGR1bXBlZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGR1bXAgdmFsdWVzXHJcbiAgICAgICAgY29uc3QgbWFzayA9IFRyYWNlYWJsZURpY3QuUExBQ0VIT0xERVI7XHJcbiAgICAgICAgLy8g57yT5a2YIGR1bXBlZCDlr7nosaHvvIznrYnlr7nosaHpg70gZHVtcCDlkI7lho3nlJ/miJAgbWFzayDntKLlvJXjgIJcclxuICAgICAgICB0aGlzLmR1bXBlZCA9IChbbWFza10gYXMgSUNsYXNzT2JqZWN0RGF0YSkuY29uY2F0KHRoaXMuc2ltcGxlVmFsdWVzKSBhcyBJQ2xhc3NPYmplY3REYXRhO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWR2YW5jZWRzLmxlbmd0aDsgaSArPSAzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZHVtcGVkLnB1c2goYWR2YW5jZWRzW2kgKyBWQUxVRV9PRkZTRVRdIGFzIEFueURhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5zaW1wbGVWYWx1ZXMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYWR2YW5jZWRzID0gdGhpcy5hZHZhbmNlZHMuZmlsdGVyKCh4LCBpbmRleCkgPT4gaW5kZXggJSAzICE9PSAyKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZHVtcGVkO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ3VzdG9tQ2xhc3NOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgICBjdG9yOiBzdHJpbmc7XHJcbiAgICBjb250ZW50OiBJQ3VzdG9tT2JqZWN0RGF0YUNvbnRlbnQ7XHJcbiAgICBkdW1wZWQ6IElDdXN0b21PYmplY3REYXRhfHVuZGVmaW5lZDtcclxuXHJcbiAgICAvLyDku47mlbDmja7nm7TmjqXlj43lkJHnlJ/miJDkuIDkuKrlt7Lnu4/osIPnlKjov4cgZHVtcFJlY3Vyc2l2ZWx5IOeahOWvueixoVxyXG4gICAgc3RhdGljIGZyb21EYXRhKGN0b3I6IHN0cmluZywgZGF0YTogSUN1c3RvbU9iamVjdERhdGEpOiBDdXN0b21DbGFzc05vZGUge1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkYXRhW0NVU1RPTV9PQkpfREFUQV9DT05URU5UXTtcclxuICAgICAgICBjb25zdCByZXMgPSBuZXcgQ3VzdG9tQ2xhc3NOb2RlKGN0b3IsIGNvbnRlbnQpO1xyXG4gICAgICAgIHJlcy5kdW1wZWQgPSBkYXRhO1xyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoY3Rvcjogc3RyaW5nLCBjb250ZW50OiBJQ3VzdG9tT2JqZWN0RGF0YUNvbnRlbnQpIHtcclxuICAgICAgICBzdXBlciAoRGF0YVR5cGVJRC5DdXN0b21pemVkQ2xhc3MpO1xyXG4gICAgICAgIHRoaXMuY3RvciA9IGN0b3I7XHJcbiAgICAgICAgdGhpcy5jb250ZW50ID0gY29udGVudDtcclxuICAgIH1cclxuICAgIHNldFN0YXRpYyhrZXk6IHN0cmluZywgZGF0YVR5cGVJRDogU3RhdGljVHlwZSwgdmFsdWU6IEFueURhdGEpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Nob3VsZCBub3Qgc2V0IHByb3BlcnR5IG9mIEN1c3RvbUNsYXNzJyk7XHJcbiAgICB9XHJcbiAgICBzZXREeW5hbWljKHRhcmdldDogTm9kZSwga2V5OiBzdHJpbmcpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Nob3VsZCBub3Qgc2V0IHByb3BlcnR5IG9mIEN1c3RvbUNsYXNzJyk7XHJcbiAgICB9XHJcbiAgICBkdW1wUmVjdXJzaXZlbHkocmVmc0J1aWxkZXI6IElSZWZzQnVpbGRlcik6IElDdXN0b21PYmplY3REYXRhIHtcclxuICAgICAgICBjb25zdCBDTEFTUyA9IFRyYWNlYWJsZURpY3QuUExBQ0VIT0xERVI7XHJcbiAgICAgICAgdGhpcy5kdW1wZWQgPSBbQ0xBU1MsIHRoaXMuY29udGVudF07XHJcbiAgICAgICAgLy8g6YCa6L+H5L+d5a2YIGR1bXBlZCDlr7nosaHvvIznrYnlr7nosaHpg70gZHVtcCDlkI7lho3nlJ/miJAgbWFzayDntKLlvJXjgIJcclxuICAgICAgICByZXR1cm4gdGhpcy5kdW1wZWQ7XHJcbiAgICB9XHJcbn1cclxuIl19