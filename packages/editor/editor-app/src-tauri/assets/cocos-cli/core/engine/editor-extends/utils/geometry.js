'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.splitBasedOnJoints = exports.MeshSplitInfo = exports.calculateTangents = exports.calculateNormals = void 0;
exports.forEachFace = forEachFace;
exports.getUintArrayCtor = getUintArrayCtor;
exports.calculateNormals = (() => {
    const { Vec3 } = cc;
    const p0 = new Vec3();
    const p1 = new Vec3();
    const p2 = new Vec3();
    const e1 = new Vec3();
    const e2 = new Vec3();
    const n = new Vec3();
    return (positions, indices, out = []) => {
        const nFaces = indices.length / 3;
        const nVertices = positions.length / 3;
        const normals = Array(3 * nVertices).fill(0).map(() => new Vec3());
        for (let iFace = 0; iFace < nFaces; ++iFace) {
            const i0 = indices[3 * iFace + 0];
            const i1 = indices[3 * iFace + 1];
            const i2 = indices[3 * iFace + 2];
            Vec3.fromArray(p0, positions, i0 * 3);
            Vec3.fromArray(p1, positions, i1 * 3);
            Vec3.fromArray(p2, positions, i2 * 3);
            Vec3.subtract(e1, p1, p0);
            Vec3.subtract(e2, p2, p0);
            Vec3.cross(n, e1, e2);
            Vec3.add(normals[i0], normals[i0], n);
            Vec3.add(normals[i1], normals[i1], n);
            Vec3.add(normals[i2], normals[i2], n);
        }
        for (let iVertex = 0; iVertex < nVertices; ++iVertex) {
            Vec3.toArray(out, Vec3.normalize(n, normals[iVertex]), iVertex * 3);
        }
        return out;
    };
})();
exports.calculateTangents = (() => {
    const { Vec2, Vec3 } = cc;
    const p0 = new Vec3();
    const p1 = new Vec3();
    const p2 = new Vec3();
    const e1 = new Vec3();
    const e2 = new Vec3();
    const w0 = new Vec2();
    const w1 = new Vec2();
    const w2 = new Vec2();
    const t = new Vec3();
    const b = new Vec3();
    const v3_1 = new Vec3();
    const v3_2 = new Vec3();
    return (positions, indices, normals, uvs, out = []) => {
        const nFaces = indices.length / 3;
        const nVertices = positions.length / 3;
        /// FGED2, Chp. 7.5
        const tangents = Array(nVertices).fill(0).map(() => new Vec3());
        const bitangents = Array(nVertices).fill(0).map(() => new Vec3());
        // Calculate tangent and bitangent for each triangle and add to all three vertices.
        for (let iFace = 0; iFace < nFaces; ++iFace) {
            const i0 = indices[iFace * 3 + 0];
            const i1 = indices[iFace * 3 + 1];
            const i2 = indices[iFace * 3 + 2];
            Vec3.fromArray(p0, positions, i0 * 3);
            Vec3.fromArray(p1, positions, i1 * 3);
            Vec3.fromArray(p2, positions, i2 * 3);
            Vec2.fromArray(w0, uvs, i0 * 2);
            Vec2.fromArray(w1, uvs, i1 * 2);
            Vec2.fromArray(w2, uvs, i2 * 2);
            Vec3.subtract(e1, p1, p0);
            Vec3.subtract(e2, p2, p0);
            const x1 = w1.x - w0.x;
            const x2 = w2.x - w0.x;
            const y1 = w1.y - w0.y;
            const y2 = w2.y - w0.y;
            let r = x1 * y2 - x2 * y1;
            if (r !== 0) {
                r = 1 / r;
            }
            Vec3.multiplyScalar(t, Vec3.subtract(v3_1, Vec3.multiplyScalar(v3_1, e1, y2), Vec3.multiplyScalar(v3_2, e2, y1)), r);
            Vec3.multiplyScalar(b, Vec3.subtract(v3_1, Vec3.multiplyScalar(v3_1, e2, x1), Vec3.multiplyScalar(v3_2, e1, x2)), r);
            Vec3.add(tangents[i0], tangents[i0], t);
            Vec3.add(tangents[i1], tangents[i1], t);
            Vec3.add(tangents[i2], tangents[i2], t);
            Vec3.add(bitangents[i0], bitangents[i0], b);
            Vec3.add(bitangents[i1], bitangents[i1], b);
            Vec3.add(bitangents[i2], bitangents[i2], b);
        }
        // Orthonormalize each tangent and calculate the handedness.
        for (let iVertex = 0; iVertex < nVertices; ++iVertex) {
            const t = tangents[iVertex];
            const b = bitangents[iVertex];
            const n = Vec3.fromArray(v3_1, normals, iVertex * 3);
            Vec3.subtract(v3_2, t, Vec3.multiplyScalar(v3_2, n, (Vec3.dot(t, n) / Vec3.dot(n, n)))); // Reject
            if (Vec3.dot(v3_2, v3_2) == 0) { // The 'perfect symmetry' case
                if (n.x || n.z) {
                    Vec3.set(v3_2, n.z, 0, -n.x);
                }
                else {
                    Vec3.set(v3_2, 0, n.x, -n.y);
                }
            }
            Vec3.toArray(out, Vec3.normalize(v3_2, v3_2), iVertex * 4);
            out[iVertex * 4 + 3] = Vec3.dot(Vec3.cross(v3_2, b, t), n) > 0 ? 1 : -1;
        }
        return out;
    };
})();
function forEachFace(indices, primitiveMode, callback) {
    let faces = 0;
    const faceIndices = [];
    switch (primitiveMode) {
        case ccm.gfx.PrimitiveMode.TRIANGLE_LIST:
            faces = indices.length / 3;
            for (let i = 0; i < faces; i++) {
                faceIndices[0] = indices[i * 3];
                faceIndices[1] = indices[i * 3 + 1];
                faceIndices[2] = indices[i * 3 + 2];
                callback(faceIndices);
            }
            break;
        case ccm.gfx.PrimitiveMode.TRIANGLE_STRIP:
            faces = indices.length - 2;
            let rev = 0;
            for (let i = 0; i < faces; i++) {
                faceIndices[0] = indices[i - rev];
                faceIndices[1] = indices[i + rev + 1];
                faceIndices[2] = indices[i + 2];
                callback(faceIndices);
                rev = ~rev;
            }
            break;
        case ccm.gfx.PrimitiveMode.TRIANGLE_FAN:
            faces = indices.length - 1;
            const first = indices[0];
            for (let i = 1; i < faces; i++) {
                faceIndices[0] = first;
                faceIndices[1] = indices[i];
                faceIndices[2] = indices[i + 1];
                callback(faceIndices);
            }
            break;
        case ccm.gfx.PrimitiveMode.LINE_LIST:
            faces = indices.length / 2;
            for (let i = 0; i < faces; i++) {
                faceIndices[0] = indices[i * 2];
                faceIndices[1] = indices[i * 2 + 1];
                callback(faceIndices);
            }
            break;
        case ccm.gfx.PrimitiveMode.LINE_STRIP:
            faces = indices.length - 1;
            for (let i = 0; i < faces; i++) {
                faceIndices[0] = indices[i];
                faceIndices[1] = indices[i + 1];
                callback(faceIndices);
            }
            break;
        case ccm.gfx.PrimitiveMode.LINE_LOOP:
            faces = indices.length;
            for (let i = 0; i < faces; i++) {
                faceIndices[0] = indices[i];
                faceIndices[1] = indices[(i + 1) === faces ? 0 : (i + 1)];
                callback(faceIndices);
            }
            break;
        case ccm.gfx.PrimitiveMode.POINT_LIST:
            faces = indices.length;
            for (let i = 0; i < faces; i++) {
                faceIndices[0] = indices[i];
                callback(faceIndices);
            }
            break;
        default:
            break;
    }
}
class MeshSplitInfo {
    indices = []; // new IB, indexed into original vertices
    jointSet = new Set(); // new effective joints, indexed into original skeleton
    // @ts-ignore
    primitiveMode; // new primitive mode
    constructor(primitiveMode = ccm.gfx.PrimitiveMode.TRIANGLE_LIST) {
        this.primitiveMode = primitiveMode;
    }
}
exports.MeshSplitInfo = MeshSplitInfo;
exports.splitBasedOnJoints = (() => {
    function addFace(target, joints, faceIndices) {
        for (let i = 0; i < faceIndices.length; i++) {
            const idx = faceIndices[i];
            for (let j = 0; j < 4; j++) {
                target.jointSet.add(joints[idx * 4 + j]);
            }
            target.indices.push(idx);
        }
    }
    function testFace(target, joints, faceIndices, capacity) {
        let counter = 0; // dry run
        for (let i = 0; i < faceIndices.length; i++) {
            const idx = faceIndices[i];
            for (let j = 0; j < 4; j++) {
                if (!target.jointSet.has(joints[idx * 4 + j])) {
                    counter++;
                }
            }
        }
        return target.jointSet.size + counter <= capacity;
    }
    return (joints, indices, primitiveMode, capacity) => {
        // @ts-ignore
        let prim;
        switch (primitiveMode) {
            case ccm.gfx.PrimitiveMode.TRIANGLE_LIST:
            case ccm.gfx.PrimitiveMode.TRIANGLE_STRIP:
            case ccm.gfx.PrimitiveMode.TRIANGLE_FAN:
                prim = ccm.gfx.PrimitiveMode.TRIANGLE_LIST;
                break;
            case ccm.gfx.PrimitiveMode.LINE_LIST:
            case ccm.gfx.PrimitiveMode.LINE_STRIP:
            case ccm.gfx.PrimitiveMode.LINE_LOOP:
                prim = ccm.gfx.PrimitiveMode.LINE_LIST;
                break;
            case ccm.gfx.PrimitiveMode.POINT_LIST:
                prim = ccm.gfx.PrimitiveMode.POINT_LIST;
                break;
        }
        if (prim === undefined) {
            return [];
        }
        const primitives = [new MeshSplitInfo(prim)];
        let primitive = primitives[0];
        // TODO: be more greedy on merging faces
        // but need to handle prefab & scene material migrations
        forEachFace(indices, primitiveMode, (faceIndices) => {
            if (!testFace(primitive, joints, faceIndices, capacity)) {
                primitive = new MeshSplitInfo(prim);
                primitives.push(primitive);
            }
            addFace(primitive, joints, faceIndices);
        });
        return primitives;
    };
})();
function getUintArrayCtor(maxElement) {
    if (maxElement < (1 << (Uint8Array.BYTES_PER_ELEMENT * 8))) {
        return Uint8Array;
    }
    if (maxElement < (1 << (Uint16Array.BYTES_PER_ELEMENT * 8))) {
        return Uint16Array;
    }
    return Uint32Array;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VvbWV0cnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY29yZS9lbmdpbmUvZWRpdG9yLWV4dGVuZHMvdXRpbHMvZ2VvbWV0cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUE4R2Isa0NBb0VDO0FBNkRELDRDQUlDO0FBek9ZLFFBQUEsZ0JBQWdCLEdBQUcsQ0FBQyxHQUFHLEVBQUU7SUFDbEMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQztJQUNwQixNQUFNLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3RCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixNQUFNLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3RCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDdEIsTUFBTSxDQUFDLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUNyQixPQUFPLENBQUMsU0FBNEIsRUFBRSxPQUEwQixFQUFFLE1BQWtDLEVBQUUsRUFBRSxFQUFFO1FBQ3RHLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sU0FBUyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUM7UUFDbkUsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLE1BQU0sRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDO1lBQzFDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRXRDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDMUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRXRCLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFDRCxLQUFLLElBQUksT0FBTyxHQUFHLENBQUMsRUFBRSxPQUFPLEdBQUcsU0FBUyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUM7WUFDbkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLENBQUM7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUMsQ0FBQztBQUNOLENBQUMsQ0FBQyxFQUFFLENBQUM7QUFFUSxRQUFBLGlCQUFpQixHQUFHLENBQUMsR0FBRyxFQUFFO0lBQ25DLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDO0lBQzFCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixNQUFNLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3RCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixNQUFNLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3RCLE1BQU0sRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixNQUFNLENBQUMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3JCLE1BQU0sQ0FBQyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7SUFDckIsTUFBTSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN4QixNQUFNLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3hCLE9BQU8sQ0FBQyxTQUE0QixFQUFFLE9BQTBCLEVBQUUsT0FBMEIsRUFDeEYsR0FBc0IsRUFBRSxNQUFrQyxFQUFFLEVBQUUsRUFBRTtRQUNoRSxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUNsQyxNQUFNLFNBQVMsR0FBRyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUN2QyxtQkFBbUI7UUFDbkIsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNsRSxtRkFBbUY7UUFDbkYsS0FBSyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsS0FBSyxHQUFHLE1BQU0sRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDO1lBQzFDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUN0QyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNoQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRWhDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNyRCxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDL0MsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBRS9DLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQztZQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDckgsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUs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QUFTLENBQUMsQ0FBQztZQUNwRSxDQUFDO1lBQ0QsT0FBTyxDQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDNUMsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLFVBQVUsQ0FBQztJQUN0QixDQUFDLENBQUM7QUFDTixDQUFDLENBQUMsRUFBRSxDQUFDO0FBRUwsU0FBZ0IsZ0JBQWdCLENBQUMsVUFBa0I7SUFDL0MsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQUMsT0FBTyxVQUFVLENBQUM7SUFBQyxDQUFDO0lBQ2xGLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGlCQUFpQixHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUFDLE9BQU8sV0FBVyxDQUFDO0lBQUMsQ0FBQztJQUNwRixPQUFPLFdBQVcsQ0FBQztBQUN2QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IHsgZ2Z4IH0gZnJvbSAnY2MnO1xyXG5kZWNsYXJlIGNvbnN0IGNjbTogYW55O1xyXG5cclxuaW50ZXJmYWNlIElXcml0YWJsZUFycmF5TGlrZTxUPiB7XHJcbiAgICBsZW5ndGg6IG51bWJlcjtcclxuICAgIFtpbmRleDogbnVtYmVyXTogVDtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNhbGN1bGF0ZU5vcm1hbHMgPSAoKCkgPT4ge1xyXG4gICAgY29uc3QgeyBWZWMzIH0gPSBjYztcclxuICAgIGNvbnN0IHAwID0gbmV3IFZlYzMoKTtcclxuICAgIGNvbnN0IHAxID0gbmV3IFZlYzMoKTtcclxuICAgIGNvbnN0IHAyID0gbmV3IFZlYzMoKTtcclxuICAgIGNvbnN0IGUxID0gbmV3IFZlYzMoKTtcclxuICAgIGNvbnN0IGUyID0gbmV3IFZlYzMoKTtcclxuICAgIGNvbnN0IG4gPSBuZXcgVmVjMygpO1xyXG4gICAgcmV0dXJuIChwb3NpdGlvbnM6IEFycmF5TGlrZTxudW1iZXI+LCBpbmRpY2VzOiBBcnJheUxpa2U8bnVtYmVyPiwgb3V0OiBJV3JpdGFibGVBcnJheUxpa2U8bnVtYmVyPiA9IFtdKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbkZhY2VzID0gaW5kaWNlcy5sZW5ndGggLyAzO1xyXG4gICAgICAgIGNvbnN0IG5WZXJ0aWNlcyA9IHBvc2l0aW9ucy5sZW5ndGggLyAzO1xyXG4gICAgICAgIGNvbnN0IG5vcm1hbHMgPSBBcnJheSgzICogblZlcnRpY2VzKS5maWxsKDApLm1hcCgoKSA9PiBuZXcgVmVjMygpKTtcclxuICAgICAgICBmb3IgKGxldCBpRmFjZSA9IDA7IGlGYWNlIDwgbkZhY2VzOyArK2lGYWNlKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGkwID0gaW5kaWNlc1szICogaUZhY2UgKyAwXTtcclxuICAgICAgICAgICAgY29uc3QgaTEgPSBpbmRpY2VzWzMgKiBpRmFjZSArIDFdO1xyXG4gICAgICAgICAgICBjb25zdCBpMiA9IGluZGljZXNbMyAqIGlGYWNlICsgMl07XHJcbiAgICAgICAgICAgIFZlYzMuZnJvbUFycmF5KHAwLCBwb3NpdGlvbnMsIGkwICogMyk7XHJcbiAgICAgICAgICAgIFZlYzMuZnJvbUFycmF5KHAxLCBwb3NpdGlvbnMsIGkxICogMyk7XHJcbiAgICAgICAgICAgIFZlYzMuZnJvbUFycmF5KHAyLCBwb3NpdGlvbnMsIGkyICogMyk7XHJcblxyXG4gICAgICAgICAgICBWZWMzLnN1YnRyYWN0KGUxLCBwMSwgcDApO1xyXG4gICAgICAgICAgICBWZWMzLnN1YnRyYWN0KGUyLCBwMiwgcDApO1xyXG4gICAgICAgICAgICBWZWMzLmNyb3NzKG4sIGUxLCBlMik7XHJcblxyXG4gICAgICAgICAgICBWZWMzLmFkZChub3JtYWxzW2kwXSwgbm9ybWFsc1tpMF0sIG4pO1xyXG4gICAgICAgICAgICBWZWMzLmFkZChub3JtYWxzW2kxXSwgbm9ybWFsc1tpMV0sIG4pO1xyXG4gICAgICAgICAgICBWZWMzLmFkZChub3JtYWxzW2kyXSwgbm9ybWFsc1tpMl0sIG4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpVmVydGV4ID0gMDsgaVZlcnRleCA8IG5WZXJ0aWNlczsgKytpVmVydGV4KSB7XHJcbiAgICAgICAgICAgIFZlYzMudG9BcnJheShvdXQsIFZlYzMubm9ybWFsaXplKG4sIG5vcm1hbHNbaVZlcnRleF0pLCBpVmVydGV4ICogMyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvdXQ7XHJcbiAgICB9O1xyXG59KSgpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNhbGN1bGF0ZVRhbmdlbnRzID0gKCgpID0+IHtcclxuICAgIGNvbnN0IHsgVmVjMiwgVmVjMyB9ID0gY2M7XHJcbiAgICBjb25zdCBwMCA9IG5ldyBWZWMzKCk7XHJcbiAgICBjb25zdCBwMSA9IG5ldyBWZWMzKCk7XHJcbiAgICBjb25zdCBwMiA9IG5ldyBWZWMzKCk7XHJcbiAgICBjb25zdCBlMSA9IG5ldyBWZWMzKCk7XHJcbiAgICBjb25zdCBlMiA9IG5ldyBWZWMzKCk7XHJcbiAgICBjb25zdCB3MCA9IG5ldyBWZWMyKCk7XHJcbiAgICBjb25zdCB3MSA9IG5ldyBWZWMyKCk7XHJcbiAgICBjb25zdCB3MiA9IG5ldyBWZWMyKCk7XHJcbiAgICBjb25zdCB0ID0gbmV3IFZlYzMoKTtcclxuICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpO1xyXG4gICAgY29uc3QgdjNfMSA9IG5ldyBWZWMzKCk7XHJcbiAgICBjb25zdCB2M18yID0gbmV3IFZlYzMoKTtcclxuICAgIHJldHVybiAocG9zaXRpb25zOiBBcnJheUxpa2U8bnVtYmVyPiwgaW5kaWNlczogQXJyYXlMaWtlPG51bWJlcj4sIG5vcm1hbHM6IEFycmF5TGlrZTxudW1iZXI+LFxyXG4gICAgICAgIHV2czogQXJyYXlMaWtlPG51bWJlcj4sIG91dDogSVdyaXRhYmxlQXJyYXlMaWtlPG51bWJlcj4gPSBbXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG5GYWNlcyA9IGluZGljZXMubGVuZ3RoIC8gMztcclxuICAgICAgICBjb25zdCBuVmVydGljZXMgPSBwb3NpdGlvbnMubGVuZ3RoIC8gMztcclxuICAgICAgICAvLy8gRkdFRDIsIENocC4gNy41XHJcbiAgICAgICAgY29uc3QgdGFuZ2VudHMgPSBBcnJheShuVmVydGljZXMpLmZpbGwoMCkubWFwKCgpID0+IG5ldyBWZWMzKCkpO1xyXG4gICAgICAgIGNvbnN0IGJpdGFuZ2VudHMgPSBBcnJheShuVmVydGljZXMpLmZpbGwoMCkubWFwKCgpID0+IG5ldyBWZWMzKCkpO1xyXG4gICAgICAgIC8vIENhbGN1bGF0ZSB0YW5nZW50IGFuZCBiaXRhbmdlbnQgZm9yIGVhY2ggdHJpYW5nbGUgYW5kIGFkZCB0byBhbGwgdGhyZWUgdmVydGljZXMuXHJcbiAgICAgICAgZm9yIChsZXQgaUZhY2UgPSAwOyBpRmFjZSA8IG5GYWNlczsgKytpRmFjZSkge1xyXG4gICAgICAgICAgICBjb25zdCBpMCA9IGluZGljZXNbaUZhY2UgKiAzICsgMF07XHJcbiAgICAgICAgICAgIGNvbnN0IGkxID0gaW5kaWNlc1tpRmFjZSAqIDMgKyAxXTtcclxuICAgICAgICAgICAgY29uc3QgaTIgPSBpbmRpY2VzW2lGYWNlICogMyArIDJdO1xyXG4gICAgICAgICAgICBWZWMzLmZyb21BcnJheShwMCwgcG9zaXRpb25zLCBpMCAqIDMpO1xyXG4gICAgICAgICAgICBWZWMzLmZyb21BcnJheShwMSwgcG9zaXRpb25zLCBpMSAqIDMpO1xyXG4gICAgICAgICAgICBWZWMzLmZyb21BcnJheShwMiwgcG9zaXRpb25zLCBpMiAqIDMpO1xyXG4gICAgICAgICAgICBWZWMyLmZyb21BcnJheSh3MCwgdXZzLCBpMCAqIDIpO1xyXG4gICAgICAgICAgICBWZWMyLmZyb21BcnJheSh3MSwgdXZzLCBpMSAqIDIpO1xyXG4gICAgICAgICAgICBWZWMyLmZyb21BcnJheSh3MiwgdXZzLCBpMiAqIDIpO1xyXG5cclxuICAgICAgICAgICAgVmVjMy5zdWJ0cmFjdChlMSwgcDEsIHAwKTsgVmVjMy5zdWJ0cmFjdChlMiwgcDIsIHAwKTtcclxuICAgICAgICAgICAgY29uc3QgeDEgPSB3MS54IC0gdzAueDsgY29uc3QgeDIgPSB3Mi54IC0gdzAueDtcclxuICAgICAgICAgICAgY29uc3QgeTEgPSB3MS55IC0gdzAueTsgY29uc3QgeTIgPSB3Mi55IC0gdzAueTtcclxuXHJcbiAgICAgICAgICAgIGxldCByID0geDEgKiB5MiAtIHgyICogeTE7IGlmIChyICE9PSAwKSB7IHIgPSAxIC8gcjsgfVxyXG4gICAgICAgICAgICBWZWMzLm11bHRpcGx5U2NhbGFyKHQsIFZlYzMuc3VidHJhY3QodjNfMSwgVmVjMy5tdWx0aXBseVNjYWxhcih2M18xLCBlMSwgeTIpLCBWZWMzLm11bHRpcGx5U2NhbGFyKHYzXzIsIGUyLCB5MSkpLCByKTtcclxuICAgICAgICAgICAgVmVjMy5tdWx0aXBseVNjYWxhcihiLCBWZWMzLnN1YnRyYWN0KHYzXzEsIFZlYzMubXVsdGlwbHlTY2FsYXIodjNfMSwgZTIsIHgxKSwgVmVjMy5tdWx0aXBseVNjYWxhcih2M18yLCBlMSwgeDIpKSwgcik7XHJcblxyXG4gICAgICAgICAgICBWZWMzLmFkZCh0YW5nZW50c1tpMF0sIHRhbmdlbnRzW2kwXSwgdCk7XHJcbiAgICAgICAgICAgIFZlYzMuYWRkKHRhbmdlbnRzW2kxXSwgdGFuZ2VudHNbaTFdLCB0KTtcclxuICAgICAgICAgICAgVmVjMy5hZGQodGFuZ2VudHNbaTJdLCB0YW5nZW50c1tpMl0sIHQpO1xyXG4gICAgICAgICAgICBWZWMzLmFkZChiaXRhbmdlbnRzW2kwXSwgYml0YW5nZW50c1tpMF0sIGIpO1xyXG4gICAgICAgICAgICBWZWMzLmFkZChiaXRhbmdlbnRzW2kxXSwgYml0YW5nZW50c1tpMV0sIGIpO1xyXG4gICAgICAgICAgICBWZWMzLmFkZChiaXRhbmdlbnRzW2kyXSwgYml0YW5nZW50c1tpMl0sIGIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBPcnRob25vcm1hbGl6ZSBlYWNoIHRhbmdlbnQgYW5kIGNhbGN1bGF0ZSB0aGUgaGFuZGVkbmVzcy5cclxuICAgICAgICBmb3IgKGxldCBpVmVydGV4ID0gMDsgaVZlcnRleCA8IG5WZXJ0aWNlczsgKytpVmVydGV4KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0YW5nZW50c1tpVmVydGV4XTtcclxuICAgICAgICAgICAgY29uc3QgYiA9IGJpdGFuZ2VudHNbaVZlcnRleF07XHJcbiAgICAgICAgICAgIGNvbnN0IG4gPSBWZWMzLmZyb21BcnJheSh2M18xLCBub3JtYWxzLCBpVmVydGV4ICogMyk7XHJcbiAgICAgICAgICAgIFZlYzMuc3VidHJhY3QodjNfMiwgdCwgVmVjMy5tdWx0aXBseVNjYWxhcih2M18yLCBuLCAoVmVjMy5kb3QodCwgbikgLyBWZWMzLmRvdChuLCBuKSkpKTsgLy8gUmVqZWN0XHJcbiAgICAgICAgICAgIGlmIChWZWMzLmRvdCh2M18yLCB2M18yKSA9PSAwKSB7IC8vIFRoZSAncGVyZmVjdCBzeW1tZXRyeScgY2FzZVxyXG4gICAgICAgICAgICAgICAgaWYgKG4ueCB8fCBuLnopIHsgVmVjMy5zZXQodjNfMiwgbi56LCAwLCAtbi54KTsgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7IFZlYzMuc2V0KHYzXzIsIDAsIG4ueCwgLW4ueSk7IH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBWZWMzLnRvQXJyYXkob3V0LCBWZWMzLm5vcm1hbGl6ZSh2M18yLCB2M18yKSwgaVZlcnRleCAqIDQpO1xyXG4gICAgICAgICAgICBvdXRbaVZlcnRleCAqIDQgKyAzXSA9IFZlYzMuZG90KFZlYzMuY3Jvc3ModjNfMiwgYiwgdCksIG4pID4gMCA/IDEgOiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG91dDtcclxuICAgIH07XHJcbn0pKCk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZm9yRWFjaEZhY2UoaW5kaWNlczogQXJyYXlMaWtlPG51bWJlcj4sIHByaW1pdGl2ZU1vZGU6IGdmeC5QcmltaXRpdmVNb2RlLCBjYWxsYmFjazogKGZhY2VJbmRpY2VzOiBudW1iZXJbXSkgPT4gYW55KSB7XHJcbiAgICBsZXQgZmFjZXMgPSAwO1xyXG4gICAgY29uc3QgZmFjZUluZGljZXM6IG51bWJlcltdID0gW107XHJcbiAgICBzd2l0Y2ggKHByaW1pdGl2ZU1vZGUpIHtcclxuICAgICAgICBjYXNlIGNjbS5nZnguUHJpbWl0aXZlTW9kZS5UUklBTkdMRV9MSVNUOlxyXG4gICAgICAgICAgICBmYWNlcyA9IGluZGljZXMubGVuZ3RoIC8gMztcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmYWNlczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmYWNlSW5kaWNlc1swXSA9IGluZGljZXNbaSAqIDNdO1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMV0gPSBpbmRpY2VzW2kgKiAzICsgMV07XHJcbiAgICAgICAgICAgICAgICBmYWNlSW5kaWNlc1syXSA9IGluZGljZXNbaSAqIDMgKyAyXTtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGZhY2VJbmRpY2VzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIGNjbS5nZnguUHJpbWl0aXZlTW9kZS5UUklBTkdMRV9TVFJJUDpcclxuICAgICAgICAgICAgZmFjZXMgPSBpbmRpY2VzLmxlbmd0aCAtIDI7XHJcbiAgICAgICAgICAgIGxldCByZXYgPSAwO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZhY2VzOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGZhY2VJbmRpY2VzWzBdID0gaW5kaWNlc1tpIC0gcmV2XTtcclxuICAgICAgICAgICAgICAgIGZhY2VJbmRpY2VzWzFdID0gaW5kaWNlc1tpICsgcmV2ICsgMV07XHJcbiAgICAgICAgICAgICAgICBmYWNlSW5kaWNlc1syXSA9IGluZGljZXNbaSArIDJdO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZmFjZUluZGljZXMpO1xyXG4gICAgICAgICAgICAgICAgcmV2ID0gfnJldjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIGNjbS5nZnguUHJpbWl0aXZlTW9kZS5UUklBTkdMRV9GQU46XHJcbiAgICAgICAgICAgIGZhY2VzID0gaW5kaWNlcy5sZW5ndGggLSAxO1xyXG4gICAgICAgICAgICBjb25zdCBmaXJzdCA9IGluZGljZXNbMF07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgZmFjZXM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMF0gPSBmaXJzdDtcclxuICAgICAgICAgICAgICAgIGZhY2VJbmRpY2VzWzFdID0gaW5kaWNlc1tpXTtcclxuICAgICAgICAgICAgICAgIGZhY2VJbmRpY2VzWzJdID0gaW5kaWNlc1tpICsgMV07XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhmYWNlSW5kaWNlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBjY20uZ2Z4LlByaW1pdGl2ZU1vZGUuTElORV9MSVNUOlxyXG4gICAgICAgICAgICBmYWNlcyA9IGluZGljZXMubGVuZ3RoIC8gMjtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmYWNlczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmYWNlSW5kaWNlc1swXSA9IGluZGljZXNbaSAqIDJdO1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMV0gPSBpbmRpY2VzW2kgKiAyICsgMV07XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhmYWNlSW5kaWNlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBjY20uZ2Z4LlByaW1pdGl2ZU1vZGUuTElORV9TVFJJUDpcclxuICAgICAgICAgICAgZmFjZXMgPSBpbmRpY2VzLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFjZXM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMF0gPSBpbmRpY2VzW2ldO1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMV0gPSBpbmRpY2VzW2kgKyAxXTtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKGZhY2VJbmRpY2VzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIGNjbS5nZnguUHJpbWl0aXZlTW9kZS5MSU5FX0xPT1A6XHJcbiAgICAgICAgICAgIGZhY2VzID0gaW5kaWNlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFjZXM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMF0gPSBpbmRpY2VzW2ldO1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMV0gPSBpbmRpY2VzWyhpICsgMSkgPT09IGZhY2VzID8gMCA6IChpICsgMSldO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZmFjZUluZGljZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgY2NtLmdmeC5QcmltaXRpdmVNb2RlLlBPSU5UX0xJU1Q6XHJcbiAgICAgICAgICAgIGZhY2VzID0gaW5kaWNlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFjZXM7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgZmFjZUluZGljZXNbMF0gPSBpbmRpY2VzW2ldO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soZmFjZUluZGljZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTWVzaFNwbGl0SW5mbyB7XHJcbiAgICBwdWJsaWMgaW5kaWNlczogbnVtYmVyW10gPSBbXTsgLy8gbmV3IElCLCBpbmRleGVkIGludG8gb3JpZ2luYWwgdmVydGljZXNcclxuICAgIHB1YmxpYyBqb2ludFNldCA9IG5ldyBTZXQ8bnVtYmVyPigpOyAvLyBuZXcgZWZmZWN0aXZlIGpvaW50cywgaW5kZXhlZCBpbnRvIG9yaWdpbmFsIHNrZWxldG9uXHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICBwdWJsaWMgcHJpbWl0aXZlTW9kZTogZ2Z4LlByaW1pdGl2ZU1vZGU7IC8vIG5ldyBwcmltaXRpdmUgbW9kZVxyXG4gICAgY29uc3RydWN0b3IocHJpbWl0aXZlTW9kZSA9IGNjbS5nZnguUHJpbWl0aXZlTW9kZS5UUklBTkdMRV9MSVNUKSB7XHJcbiAgICAgICAgdGhpcy5wcmltaXRpdmVNb2RlID0gcHJpbWl0aXZlTW9kZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHNwbGl0QmFzZWRPbkpvaW50cyA9ICgoKSA9PiB7XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkRmFjZSh0YXJnZXQ6IE1lc2hTcGxpdEluZm8sIGpvaW50czogQXJyYXlMaWtlPG51bWJlcj4sIGZhY2VJbmRpY2VzOiBBcnJheUxpa2U8bnVtYmVyPikge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFjZUluZGljZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgaWR4ID0gZmFjZUluZGljZXNbaV07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQuam9pbnRTZXQuYWRkKGpvaW50c1tpZHggKiA0ICsgal0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRhcmdldC5pbmRpY2VzLnB1c2goaWR4KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiB0ZXN0RmFjZShcclxuICAgICAgICB0YXJnZXQ6IE1lc2hTcGxpdEluZm8sIGpvaW50czogQXJyYXlMaWtlPG51bWJlcj4sIGZhY2VJbmRpY2VzOiBBcnJheUxpa2U8bnVtYmVyPiwgY2FwYWNpdHk6IG51bWJlcikge1xyXG4gICAgICAgIGxldCBjb3VudGVyID0gMDsgLy8gZHJ5IHJ1blxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFjZUluZGljZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgaWR4ID0gZmFjZUluZGljZXNbaV07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRhcmdldC5qb2ludFNldC5oYXMoam9pbnRzW2lkeCAqIDQgKyBqXSkpIHsgY291bnRlcisrOyB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRhcmdldC5qb2ludFNldC5zaXplICsgY291bnRlciA8PSBjYXBhY2l0eTtcclxuICAgIH1cclxuICAgIHJldHVybiAoam9pbnRzOiBBcnJheUxpa2U8bnVtYmVyPiwgaW5kaWNlczogQXJyYXlMaWtlPG51bWJlcj4sIHByaW1pdGl2ZU1vZGU6IGdmeC5QcmltaXRpdmVNb2RlLCBjYXBhY2l0eTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIGxldCBwcmltOiBjY20uZ2Z4LlByaW1pdGl2ZU1vZGUgfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgc3dpdGNoIChwcmltaXRpdmVNb2RlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgY2NtLmdmeC5QcmltaXRpdmVNb2RlLlRSSUFOR0xFX0xJU1Q6XHJcbiAgICAgICAgICAgIGNhc2UgY2NtLmdmeC5QcmltaXRpdmVNb2RlLlRSSUFOR0xFX1NUUklQOlxyXG4gICAgICAgICAgICBjYXNlIGNjbS5nZnguUHJpbWl0aXZlTW9kZS5UUklBTkdMRV9GQU46IHByaW0gPSBjY20uZ2Z4LlByaW1pdGl2ZU1vZGUuVFJJQU5HTEVfTElTVDsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY2NtLmdmeC5QcmltaXRpdmVNb2RlLkxJTkVfTElTVDpcclxuICAgICAgICAgICAgY2FzZSBjY20uZ2Z4LlByaW1pdGl2ZU1vZGUuTElORV9TVFJJUDpcclxuICAgICAgICAgICAgY2FzZSBjY20uZ2Z4LlByaW1pdGl2ZU1vZGUuTElORV9MT09QOiBwcmltID0gY2NtLmdmeC5QcmltaXRpdmVNb2RlLkxJTkVfTElTVDsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgY2NtLmdmeC5QcmltaXRpdmVNb2RlLlBPSU5UX0xJU1Q6IHByaW0gPSBjY20uZ2Z4LlByaW1pdGl2ZU1vZGUuUE9JTlRfTElTVDsgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwcmltID09PSB1bmRlZmluZWQpIHsgcmV0dXJuIFtdOyB9XHJcbiAgICAgICAgY29uc3QgcHJpbWl0aXZlczogTWVzaFNwbGl0SW5mb1tdID0gW25ldyBNZXNoU3BsaXRJbmZvKHByaW0pXTtcclxuICAgICAgICBsZXQgcHJpbWl0aXZlID0gcHJpbWl0aXZlc1swXTtcclxuICAgICAgICAvLyBUT0RPOiBiZSBtb3JlIGdyZWVkeSBvbiBtZXJnaW5nIGZhY2VzXHJcbiAgICAgICAgLy8gYnV0IG5lZWQgdG8gaGFuZGxlIHByZWZhYiAmIHNjZW5lIG1hdGVyaWFsIG1pZ3JhdGlvbnNcclxuICAgICAgICBmb3JFYWNoRmFjZShpbmRpY2VzLCBwcmltaXRpdmVNb2RlLCAoZmFjZUluZGljZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKCF0ZXN0RmFjZShwcmltaXRpdmUsIGpvaW50cywgZmFjZUluZGljZXMsIGNhcGFjaXR5KSkge1xyXG4gICAgICAgICAgICAgICAgcHJpbWl0aXZlID0gbmV3IE1lc2hTcGxpdEluZm8ocHJpbSk7IHByaW1pdGl2ZXMucHVzaChwcmltaXRpdmUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFkZEZhY2UocHJpbWl0aXZlLCBqb2ludHMsIGZhY2VJbmRpY2VzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcHJpbWl0aXZlcztcclxuICAgIH07XHJcbn0pKCk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VWludEFycmF5Q3RvcihtYXhFbGVtZW50OiBudW1iZXIpIHtcclxuICAgIGlmIChtYXhFbGVtZW50IDwgKDEgPDwgKFVpbnQ4QXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiA4KSkpIHsgcmV0dXJuIFVpbnQ4QXJyYXk7IH1cclxuICAgIGlmIChtYXhFbGVtZW50IDwgKDEgPDwgKFVpbnQxNkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogOCkpKSB7IHJldHVybiBVaW50MTZBcnJheTsgfVxyXG4gICAgcmV0dXJuIFVpbnQzMkFycmF5O1xyXG59XHJcbiJdfQ==