"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Awaiter = void 0;
const asserts_1 = require("./asserts");
class Awaiter {
    resolve(value) {
        (0, asserts_1.asserts)(this._state === State.PENDING);
        this._result = value;
        this._state = State.RESOLVED;
        for (const { resolve } of this._queue) {
            resolve(value);
        }
        this._queue.length = 0;
    }
    reject(err) {
        (0, asserts_1.asserts)(this._state === State.PENDING);
        this._result = err;
        this._state = State.RESOLVED;
        for (const { reject } of this._queue) {
            reject(err);
        }
        this._queue.length = 0;
    }
    async wait() {
        switch (this._state) {
            case State.RESOLVED:
                return this._result;
            case State.REJECTED:
                throw this._result;
        }
        return await new Promise((resolve, reject) => {
            this._queue.push({
                resolve,
                reject,
            });
        });
    }
    _state = State.PENDING;
    _result = null;
    _queue = [];
}
exports.Awaiter = Awaiter;
var State;
(function (State) {
    State[State["PENDING"] = 0] = "PENDING";
    State[State["RESOLVED"] = 1] = "RESOLVED";
    State[State["REJECTED"] = 2] = "REJECTED";
})(State || (State = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXdhaXRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb3JlL3NjcmlwdGluZy91dGlscy9hd2FpdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHVDQUFvQztBQUVwQyxNQUFhLE9BQU87SUFDVCxPQUFPLENBQUMsS0FBYTtRQUN4QixJQUFBLGlCQUFPLEVBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDckIsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBQzdCLEtBQUssTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNwQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkIsQ0FBQztRQUNELElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRU0sTUFBTSxDQUFDLEdBQVk7UUFDdEIsSUFBQSxpQkFBTyxFQUFDLElBQUksQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1FBQ25CLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQztRQUM3QixLQUFLLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDbkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLENBQUM7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVNLEtBQUssQ0FBQyxJQUFJO1FBQ2IsUUFBUSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDbEIsS0FBSyxLQUFLLENBQUMsUUFBUTtnQkFDZixPQUFRLElBQUksQ0FBQyxPQUFrQixDQUFDO1lBQ3BDLEtBQUssS0FBSyxDQUFDLFFBQVE7Z0JBQ2YsTUFBTyxJQUFJLENBQUMsT0FBOEIsQ0FBQztRQUNuRCxDQUFDO1FBQ0QsT0FBTyxNQUFNLElBQUksT0FBTyxDQUFTLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1lBQ2pELElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNiLE9BQU87Z0JBQ1AsTUFBTTthQUNULENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVPLE1BQU0sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO0lBRXZCLE9BQU8sR0FBdUMsSUFBSSxDQUFDO0lBRW5ELE1BQU0sR0FHVCxFQUFFLENBQUM7Q0FDWDtBQTVDRCwwQkE0Q0M7QUFFRCxJQUFLLEtBSUo7QUFKRCxXQUFLLEtBQUs7SUFDTix1Q0FBTyxDQUFBO0lBQ1AseUNBQVEsQ0FBQTtJQUNSLHlDQUFRLENBQUE7QUFDWixDQUFDLEVBSkksS0FBSyxLQUFMLEtBQUssUUFJVCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzc2VydHMgfSBmcm9tICcuL2Fzc2VydHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEF3YWl0ZXI8VFZhbHVlLCBURXJyb3IgPSBhbnk+IHtcclxuICAgIHB1YmxpYyByZXNvbHZlKHZhbHVlOiBUVmFsdWUpIHtcclxuICAgICAgICBhc3NlcnRzKHRoaXMuX3N0YXRlID09PSBTdGF0ZS5QRU5ESU5HKTtcclxuICAgICAgICB0aGlzLl9yZXN1bHQgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9zdGF0ZSA9IFN0YXRlLlJFU09MVkVEO1xyXG4gICAgICAgIGZvciAoY29uc3QgeyByZXNvbHZlIH0gb2YgdGhpcy5fcXVldWUpIHtcclxuICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3F1ZXVlLmxlbmd0aCA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlamVjdChlcnI/OiBURXJyb3IpIHtcclxuICAgICAgICBhc3NlcnRzKHRoaXMuX3N0YXRlID09PSBTdGF0ZS5QRU5ESU5HKTtcclxuICAgICAgICB0aGlzLl9yZXN1bHQgPSBlcnI7XHJcbiAgICAgICAgdGhpcy5fc3RhdGUgPSBTdGF0ZS5SRVNPTFZFRDtcclxuICAgICAgICBmb3IgKGNvbnN0IHsgcmVqZWN0IH0gb2YgdGhpcy5fcXVldWUpIHtcclxuICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3F1ZXVlLmxlbmd0aCA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGFzeW5jIHdhaXQoKSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLl9zdGF0ZSkge1xyXG4gICAgICAgICAgICBjYXNlIFN0YXRlLlJFU09MVkVEOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLl9yZXN1bHQgYXMgVFZhbHVlKTtcclxuICAgICAgICAgICAgY2FzZSBTdGF0ZS5SRUpFQ1RFRDpcclxuICAgICAgICAgICAgICAgIHRocm93ICh0aGlzLl9yZXN1bHQgYXMgVEVycm9yIHwgdW5kZWZpbmVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPFRWYWx1ZT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9xdWV1ZS5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUsXHJcbiAgICAgICAgICAgICAgICByZWplY3QsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3N0YXRlID0gU3RhdGUuUEVORElORztcclxuXHJcbiAgICBwcml2YXRlIF9yZXN1bHQ6IFRWYWx1ZSB8IFRFcnJvciB8IHVuZGVmaW5lZCB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIHByaXZhdGUgX3F1ZXVlOiBBcnJheTx7XHJcbiAgICAgICAgcmVzb2x2ZTogKHZhbHVlOiBUVmFsdWUpID0+IHZvaWQ7XHJcbiAgICAgICAgcmVqZWN0OiAoZXJyPzogYW55KSA9PiB2b2lkO1xyXG4gICAgfT4gPSBbXTtcclxufVxyXG5cclxuZW51bSBTdGF0ZSB7XHJcbiAgICBQRU5ESU5HLFxyXG4gICAgUkVTT0xWRUQsXHJcbiAgICBSRUpFQ1RFRCxcclxufVxyXG4iXX0=