"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ServiceEvents = void 0;
const events_1 = require("events");
const common_1 = require("../../../common");
// 全局共享的 EventEmitter 实例（内部使用，不对外暴露）
const globalEventEmitter = new events_1.EventEmitter();
/**
 * 全局事件管理器
 * 统一管理所有服务的事件监听，支持类型安全的事件订阅
 */
class GlobalEventManager {
    on(event, listener) {
        globalEventEmitter.on(event, listener);
    }
    once(event, listener) {
        globalEventEmitter.once(event, listener);
    }
    off(event, listener) {
        globalEventEmitter.off(event, listener);
    }
    emit(event, ...args) {
        globalEventEmitter.emit(event, ...args);
    }
    broadcast(event, ...args) {
        const message = {
            type: common_1.SceneProcessEventTag,
            event: event,
            args: [...args]
        };
        globalEventEmitter.emit(event, ...args);
        if ('connected' in process) {
            process.send?.(message);
        }
    }
    /**
     * 清除事件监听器
     * @param event 事件名称，如果不提供则清除所有
     */
    clear(event) {
        if (event) {
            globalEventEmitter.removeAllListeners(event);
        }
        else {
            globalEventEmitter.removeAllListeners();
        }
    }
}
// 导出全局单例
exports.ServiceEvents = new GlobalEventManager();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLWV2ZW50cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb3JlL3NjZW5lL3NjZW5lLXByb2Nlc3Mvc2VydmljZS9jb3JlL2dsb2JhbC1ldmVudHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsbUNBQXNDO0FBQ3RDLDRDQUF1RDtBQUV2RCxvQ0FBb0M7QUFDcEMsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLHFCQUFZLEVBQUUsQ0FBQztBQUU5Qzs7O0dBR0c7QUFDSCxNQUFNLGtCQUFrQjtJQWtCcEIsRUFBRSxDQUFDLEtBQVUsRUFBRSxRQUFhO1FBQ3hCLGtCQUFrQixDQUFDLEVBQUUsQ0FBQyxLQUFlLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQW1CRCxJQUFJLENBQUMsS0FBVSxFQUFFLFFBQWE7UUFDMUIsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEtBQWUsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBbUJELEdBQUcsQ0FBQyxLQUFVLEVBQUUsUUFBYTtRQUN6QixrQkFBa0IsQ0FBQyxHQUFHLENBQUMsS0FBZSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFpQkQsSUFBSSxDQUFDLEtBQVUsRUFBRSxHQUFHLElBQVc7UUFDM0Isa0JBQWtCLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFZRCxTQUFTLENBQUMsS0FBVSxFQUFFLEdBQUcsSUFBVztRQUNoQyxNQUFNLE9BQU8sR0FBRztZQUNaLElBQUksRUFBRSw2QkFBb0I7WUFDMUIsS0FBSyxFQUFFLEtBQWU7WUFDdEIsSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7U0FDbEIsQ0FBQztRQUNGLGtCQUFrQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztRQUN4QyxJQUFJLFdBQVcsSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUN6QixPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDNUIsQ0FBQztJQUNMLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsS0FBYztRQUNoQixJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ1Isa0JBQWtCLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakQsQ0FBQzthQUFNLENBQUM7WUFDSixrQkFBa0IsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzVDLENBQUM7SUFDTCxDQUFDO0NBQ0o7QUFFRCxTQUFTO0FBQ0ksUUFBQSxhQUFhLEdBQUcsSUFBSSxrQkFBa0IsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcclxuaW1wb3J0IHsgU2NlbmVQcm9jZXNzRXZlbnRUYWcgfSBmcm9tICcuLi8uLi8uLi9jb21tb24nO1xyXG5cclxuLy8g5YWo5bGA5YWx5Lqr55qEIEV2ZW50RW1pdHRlciDlrp7kvovvvIjlhoXpg6jkvb/nlKjvvIzkuI3lr7nlpJbmmrTpnLLvvIlcclxuY29uc3QgZ2xvYmFsRXZlbnRFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuLyoqXHJcbiAqIOWFqOWxgOS6i+S7tueuoeeQhuWZqFxyXG4gKiDnu5/kuIDnrqHnkIbmiYDmnInmnI3liqHnmoTkuovku7bnm5HlkKzvvIzmlK/mjIHnsbvlnovlronlhajnmoTkuovku7borqLpmIVcclxuICovXHJcbmNsYXNzIEdsb2JhbEV2ZW50TWFuYWdlciB7XHJcbiAgICAvKipcclxuICAgICAqIOebkeWQrOaMh+Wumuexu+Wei+eahOS6i+S7tu+8iOexu+Wei+WuieWFqOeJiOacrO+8iVxyXG4gICAgICogQHBhcmFtIGV2ZW50IOS6i+S7tuWQjeensFxyXG4gICAgICogQHBhcmFtIGxpc3RlbmVyIOS6i+S7tuebkeWQrOWZqFxyXG4gICAgICovXHJcbiAgICBvbjxURXZlbnRzIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55Pj4oXHJcbiAgICAgICAgZXZlbnQ6IGtleW9mIFRFdmVudHMsXHJcbiAgICAgICAgbGlzdGVuZXI6IFRFdmVudHNba2V5b2YgVEV2ZW50c10gZXh0ZW5kcyB2b2lkXHJcbiAgICAgICAgICAgID8gKCkgPT4gdm9pZFxyXG4gICAgICAgICAgICA6IChwYXlsb2FkOiBURXZlbnRzW2tleW9mIFRFdmVudHNdKSA9PiB2b2lkXHJcbiAgICApOiB2b2lkO1xyXG4gICAgLyoqXHJcbiAgICAgKiDnm5HlkKzmjIflrprnsbvlnovnmoTkuovku7bvvIjpgJrnlKjniYjmnKzvvIlcclxuICAgICAqIEBwYXJhbSBldmVudCDkuovku7blkI3np7BcclxuICAgICAqIEBwYXJhbSBsaXN0ZW5lciDkuovku7bnm5HlkKzlmahcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHZvaWQ7XHJcbiAgICBvbihldmVudDogYW55LCBsaXN0ZW5lcjogYW55KTogdm9pZCB7XHJcbiAgICAgICAgZ2xvYmFsRXZlbnRFbWl0dGVyLm9uKGV2ZW50IGFzIHN0cmluZywgbGlzdGVuZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog55uR5ZCs5oyH5a6a57G75Z6L55qE5LqL5Lu277yI5LiA5qyh5oCn77yM57G75Z6L5a6J5YWo54mI5pys77yJXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQg5LqL5Lu25ZCN56ewXHJcbiAgICAgKiBAcGFyYW0gbGlzdGVuZXIg5LqL5Lu255uR5ZCs5ZmoXHJcbiAgICAgKi9cclxuICAgIG9uY2U8VEV2ZW50cyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4+KFxyXG4gICAgICAgIGV2ZW50OiBrZXlvZiBURXZlbnRzLFxyXG4gICAgICAgIGxpc3RlbmVyOiBURXZlbnRzW2tleW9mIFRFdmVudHNdIGV4dGVuZHMgdm9pZFxyXG4gICAgICAgICAgICA/ICgpID0+IHZvaWRcclxuICAgICAgICAgICAgOiAocGF5bG9hZDogVEV2ZW50c1trZXlvZiBURXZlbnRzXSkgPT4gdm9pZFxyXG4gICAgKTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog55uR5ZCs5oyH5a6a57G75Z6L55qE5LqL5Lu277yI5LiA5qyh5oCn77yM6YCa55So54mI5pys77yJXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQg5LqL5Lu25ZCN56ewXHJcbiAgICAgKiBAcGFyYW0gbGlzdGVuZXIg5LqL5Lu255uR5ZCs5ZmoXHJcbiAgICAgKi9cclxuICAgIG9uY2UoZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCk6IHZvaWQ7XHJcbiAgICBvbmNlKGV2ZW50OiBhbnksIGxpc3RlbmVyOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBnbG9iYWxFdmVudEVtaXR0ZXIub25jZShldmVudCBhcyBzdHJpbmcsIGxpc3RlbmVyKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOenu+mZpOaMh+Wumuexu+Wei+eahOS6i+S7tuebkeWQrOWZqO+8iOexu+Wei+WuieWFqOeJiOacrO+8iVxyXG4gICAgICogQHBhcmFtIGV2ZW50IOS6i+S7tuWQjeensFxyXG4gICAgICogQHBhcmFtIGxpc3RlbmVyIOS6i+S7tuebkeWQrOWZqFxyXG4gICAgICovXHJcbiAgICBvZmY8VEV2ZW50cyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4+KFxyXG4gICAgICAgIGV2ZW50OiBrZXlvZiBURXZlbnRzLFxyXG4gICAgICAgIGxpc3RlbmVyOiBURXZlbnRzW2tleW9mIFRFdmVudHNdIGV4dGVuZHMgdm9pZFxyXG4gICAgICAgICAgICA/ICgpID0+IHZvaWRcclxuICAgICAgICAgICAgOiAocGF5bG9hZDogVEV2ZW50c1trZXlvZiBURXZlbnRzXSkgPT4gdm9pZFxyXG4gICAgKTogdm9pZDtcclxuICAgIC8qKlxyXG4gICAgICog56e76Zmk5LqL5Lu255uR5ZCs5Zmo77yI6YCa55So54mI5pys77yJXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQg5LqL5Lu25ZCN56ewXHJcbiAgICAgKiBAcGFyYW0gbGlzdGVuZXIg5LqL5Lu255uR5ZCs5ZmoXHJcbiAgICAgKi9cclxuICAgIG9mZihldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkKTogdm9pZDtcclxuICAgIG9mZihldmVudDogYW55LCBsaXN0ZW5lcjogYW55KTogdm9pZCB7XHJcbiAgICAgICAgZ2xvYmFsRXZlbnRFbWl0dGVyLm9mZihldmVudCBhcyBzdHJpbmcsIGxpc3RlbmVyKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWPkeWwhOaMh+Wumuexu+Wei+eahOS6i+S7tu+8iOexu+Wei+WuieWFqOeJiOacrO+8iVxyXG4gICAgICogQHBhcmFtIGV2ZW50IOS6i+S7tuWQjeensFxyXG4gICAgICogQHBhcmFtIGFyZ3Mg5LqL5Lu25Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIGVtaXQ8VEV2ZW50cyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4+KFxyXG4gICAgICAgIGV2ZW50OiBrZXlvZiBURXZlbnRzLFxyXG4gICAgICAgIC4uLmFyZ3M6IFRFdmVudHNba2V5b2YgVEV2ZW50c11cclxuICAgICk6IHZvaWQ7XHJcbiAgICAvKipcclxuICAgICAqIOinpuWPkeS6i+S7tu+8iOmAmueUqOeJiOacrO+8iVxyXG4gICAgICogQHBhcmFtIGV2ZW50IOS6i+S7tuWQjeensFxyXG4gICAgICogQHBhcmFtIGFyZ3Mg5LqL5Lu25Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIGVtaXQoZXZlbnQ6IHN0cmluZywgLi4uYXJnczogYW55W10pOiB2b2lkO1xyXG4gICAgZW1pdChldmVudDogYW55LCAuLi5hcmdzOiBhbnlbXSk6IHZvaWQge1xyXG4gICAgICAgIGdsb2JhbEV2ZW50RW1pdHRlci5lbWl0KGV2ZW50LCAuLi5hcmdzKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOi3qOi/m+eoi+W5v+aSre+8jOS8oOeahOWPguaVsOmcgOimgeiDveiiq+W6j+WIl+WMllxyXG4gICAgICogQHBhcmFtIGV2ZW50IOS6i+S7tuWQjeensFxyXG4gICAgICogQHBhcmFtIGFyZ3Mg5LqL5Lu25Y+C5pWwXHJcbiAgICAgKi9cclxuICAgIGJyb2FkY2FzdDxURXZlbnRzIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55Pj4oXHJcbiAgICAgICAgZXZlbnQ6IGtleW9mIFRFdmVudHMsXHJcbiAgICAgICAgLi4uYXJnczogVEV2ZW50c1trZXlvZiBURXZlbnRzXVxyXG4gICAgKTogdm9pZDtcclxuICAgIGJyb2FkY2FzdChldmVudDogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSk6IHZvaWQ7XHJcbiAgICBicm9hZGNhc3QoZXZlbnQ6IGFueSwgLi4uYXJnczogYW55W10pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBTY2VuZVByb2Nlc3NFdmVudFRhZyxcclxuICAgICAgICAgICAgZXZlbnQ6IGV2ZW50IGFzIHN0cmluZyxcclxuICAgICAgICAgICAgYXJnczogWy4uLmFyZ3NdXHJcbiAgICAgICAgfTtcclxuICAgICAgICBnbG9iYWxFdmVudEVtaXR0ZXIuZW1pdChldmVudCwgLi4uYXJncyk7XHJcbiAgICAgICAgaWYgKCdjb25uZWN0ZWQnIGluIHByb2Nlc3MpIHtcclxuICAgICAgICAgICAgcHJvY2Vzcy5zZW5kPy4obWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5riF6Zmk5LqL5Lu255uR5ZCs5ZmoXHJcbiAgICAgKiBAcGFyYW0gZXZlbnQg5LqL5Lu25ZCN56ew77yM5aaC5p6c5LiN5o+Q5L6b5YiZ5riF6Zmk5omA5pyJXHJcbiAgICAgKi9cclxuICAgIGNsZWFyKGV2ZW50Pzogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGdsb2JhbEV2ZW50RW1pdHRlci5yZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGdsb2JhbEV2ZW50RW1pdHRlci5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIOWvvOWHuuWFqOWxgOWNleS+i1xyXG5leHBvcnQgY29uc3QgU2VydmljZUV2ZW50cyA9IG5ldyBHbG9iYWxFdmVudE1hbmFnZXIoKTtcclxuIl19