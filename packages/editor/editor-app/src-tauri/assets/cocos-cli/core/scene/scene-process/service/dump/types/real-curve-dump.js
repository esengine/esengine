"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.realCurveDump = void 0;
// valueType 直接使用引擎序列化
class RealCurveDump {
    encode(object, data, opts) {
        data.value = this.encodeByObj(object, opts);
        // HACK 目前曲线新建完无默认数据
        // @ts-ignore
        // if (!data.value.keyFrames.length) {
        //     data.value = data.default;
        // }
    }
    decode(data, info, dump, opts) {
        if (dump.value) {
            // @ts-ignore
            const curve = data[info.key];
            this.decodeByDump(dump, curve, opts);
        }
    }
    encodeByObj(curve, opts) {
        try {
            return {
                postExtrap: curve.postExtrapolation,
                preExtrap: curve.preExtrapolation,
                keyFrames: [...curve.keyframes()].map(([time, value]) => {
                    return {
                        time,
                        value: value.value,
                        inTangent: value.leftTangent,
                        outTangent: value.rightTangent,
                        inTangentWeight: value.leftTangentWeight,
                        outTangentWeight: value.rightTangentWeight,
                        interpMode: value.interpolationMode,
                        tangentWeightMode: value.tangentWeightMode,
                    };
                }),
            };
        }
        catch (error) {
            console.warn('Value dump failed.');
            console.warn(error);
            const ctor = opts.ctor;
            const dump = EditorExtends.serialize(new ctor(), { stringify: false, forceInline: true });
            delete dump.__type__;
            return dump;
        }
    }
    decodeByDump(dump, curve, opts) {
        if (dump.value.keyFrames) {
            const keyData = dump.value.keyFrames.map((item) => {
                return [item.time, {
                        value: item.value,
                        leftTangent: item.inTangent,
                        rightTangent: item.outTangent,
                        interpolationMode: item.interpMode,
                        tangentWeightMode: item.tangentWeightMode,
                        leftTangentWeight: item.inTangentWeight,
                        rightTangentWeight: item.outTangentWeight,
                    }];
            });
            curve.assignSorted(keyData);
            curve.postExtrapolation = dump.value.postExtrap;
            curve.preExtrapolation = dump.value.preExtrap;
        }
        return curve;
    }
}
exports.realCurveDump = new RealCurveDump();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhbC1jdXJ2ZS1kdW1wLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvcmUvc2NlbmUvc2NlbmUtcHJvY2Vzcy9zZXJ2aWNlL2R1bXAvdHlwZXMvcmVhbC1jdXJ2ZS1kdW1wLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQU9BLHNCQUFzQjtBQUN0QixNQUFNLGFBQWE7SUFFUixNQUFNLENBQUMsTUFBb0IsRUFBRSxJQUFlLEVBQUUsSUFBVTtRQUMzRCxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTVDLG9CQUFvQjtRQUNwQixhQUFhO1FBQ2Isc0NBQXNDO1FBQ3RDLGlDQUFpQztRQUNqQyxJQUFJO0lBQ1IsQ0FBQztJQUVNLE1BQU0sQ0FBQyxJQUFtQixFQUFFLElBQVMsRUFBRSxJQUFTLEVBQUUsSUFBVTtRQUMvRCxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNiLGFBQWE7WUFDYixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBaUIsQ0FBQztZQUM3QyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDekMsQ0FBQztJQUNMLENBQUM7SUFFTSxXQUFXLENBQUMsS0FBbUIsRUFBRSxJQUFVO1FBQzlDLElBQUksQ0FBQztZQUNELE9BQU87Z0JBQ0gsVUFBVSxFQUFFLEtBQUssQ0FBQyxpQkFBaUI7Z0JBQ25DLFNBQVMsRUFBRSxLQUFLLENBQUMsZ0JBQWdCO2dCQUNqQyxTQUFTLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUU7b0JBQ3BELE9BQU87d0JBQ0gsSUFBSTt3QkFDSixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7d0JBRWxCLFNBQVMsRUFBRSxLQUFLLENBQUMsV0FBVzt3QkFDNUIsVUFBVSxFQUFFLEtBQUssQ0FBQyxZQUFZO3dCQUU5QixlQUFlLEVBQUUsS0FBSyxDQUFDLGlCQUFpQjt3QkFDeEMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLGtCQUFrQjt3QkFFMUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxpQkFBaUI7d0JBQ25DLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxpQkFBaUI7cUJBQzdDLENBQUM7Z0JBQ04sQ0FBQyxDQUFDO2FBQ0wsQ0FBQztRQUNOLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ25DLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFcEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztZQUN2QixNQUFNLElBQUksR0FBRyxhQUFhLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FBUSxDQUFDO1lBQ2pHLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNyQixPQUFPLElBQUksQ0FBQztRQUNoQixDQUFDO0lBQ0wsQ0FBQztJQUVNLFlBQVksQ0FBQyxJQUFTLEVBQUUsS0FBbUIsRUFBRSxJQUFVO1FBQzFELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUN2QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFTLEVBQUUsRUFBRTtnQkFDbkQsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUU7d0JBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO3dCQUVqQixXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVM7d0JBQzNCLFlBQVksRUFBRSxJQUFJLENBQUMsVUFBVTt3QkFFN0IsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLFVBQVU7d0JBQ2xDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxpQkFBaUI7d0JBRXpDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxlQUFlO3dCQUN2QyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsZ0JBQWdCO3FCQUM1QyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQztZQUNILEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDNUIsS0FBSyxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDO1lBQ2hELEtBQUssQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQztRQUNsRCxDQUFDO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztDQUNKO0FBRVksUUFBQSxhQUFhLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBJUHJvcGVydHksXHJcbn0gZnJvbSAnLi4vLi4vLi4vLi4vQHR5cGVzL3B1YmxpYyc7XHJcblxyXG5pbXBvcnQgeyBEdW1wSW50ZXJmYWNlIH0gZnJvbSAnLi9kdW1wLWludGVyZmFjZSc7XHJcbmltcG9ydCAqIGFzIGNjIGZyb20gJ2NjJztcclxuXHJcbi8vIHZhbHVlVHlwZSDnm7TmjqXkvb/nlKjlvJXmk47luo/liJfljJZcclxuY2xhc3MgUmVhbEN1cnZlRHVtcCBpbXBsZW1lbnRzIER1bXBJbnRlcmZhY2Uge1xyXG5cclxuICAgIHB1YmxpYyBlbmNvZGUob2JqZWN0OiBjYy5SZWFsQ3VydmUsIGRhdGE6IElQcm9wZXJ0eSwgb3B0cz86IGFueSk6IHZvaWQge1xyXG4gICAgICAgIGRhdGEudmFsdWUgPSB0aGlzLmVuY29kZUJ5T2JqKG9iamVjdCwgb3B0cyk7XHJcblxyXG4gICAgICAgIC8vIEhBQ0sg55uu5YmN5puy57q/5paw5bu65a6M5peg6buY6K6k5pWw5o2uXHJcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgICAgIC8vIGlmICghZGF0YS52YWx1ZS5rZXlGcmFtZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgLy8gICAgIGRhdGEudmFsdWUgPSBkYXRhLmRlZmF1bHQ7XHJcbiAgICAgICAgLy8gfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkZWNvZGUoZGF0YTogY2MuQ3VydmVSYW5nZSwgaW5mbzogYW55LCBkdW1wOiBhbnksIG9wdHM/OiBhbnkpOiB2b2lkIHtcclxuICAgICAgICBpZiAoZHVtcC52YWx1ZSkge1xyXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXHJcbiAgICAgICAgICAgIGNvbnN0IGN1cnZlID0gZGF0YVtpbmZvLmtleV0gYXMgY2MuUmVhbEN1cnZlO1xyXG4gICAgICAgICAgICB0aGlzLmRlY29kZUJ5RHVtcChkdW1wLCBjdXJ2ZSwgb3B0cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBlbmNvZGVCeU9iaihjdXJ2ZTogY2MuUmVhbEN1cnZlLCBvcHRzPzogYW55KTogYW55IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgcG9zdEV4dHJhcDogY3VydmUucG9zdEV4dHJhcG9sYXRpb24sXHJcbiAgICAgICAgICAgICAgICBwcmVFeHRyYXA6IGN1cnZlLnByZUV4dHJhcG9sYXRpb24sXHJcbiAgICAgICAgICAgICAgICBrZXlGcmFtZXM6IFsuLi5jdXJ2ZS5rZXlmcmFtZXMoKV0ubWFwKChbdGltZSwgdmFsdWVdKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnZhbHVlLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5UYW5nZW50OiB2YWx1ZS5sZWZ0VGFuZ2VudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0VGFuZ2VudDogdmFsdWUucmlnaHRUYW5nZW50LFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5UYW5nZW50V2VpZ2h0OiB2YWx1ZS5sZWZ0VGFuZ2VudFdlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0VGFuZ2VudFdlaWdodDogdmFsdWUucmlnaHRUYW5nZW50V2VpZ2h0LFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJwTW9kZTogdmFsdWUuaW50ZXJwb2xhdGlvbk1vZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhbmdlbnRXZWlnaHRNb2RlOiB2YWx1ZS50YW5nZW50V2VpZ2h0TW9kZSxcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKCdWYWx1ZSBkdW1wIGZhaWxlZC4nKTtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGN0b3IgPSBvcHRzLmN0b3I7XHJcbiAgICAgICAgICAgIGNvbnN0IGR1bXAgPSBFZGl0b3JFeHRlbmRzLnNlcmlhbGl6ZShuZXcgY3RvcigpLCB7IHN0cmluZ2lmeTogZmFsc2UsIGZvcmNlSW5saW5lOiB0cnVlIH0pIGFzIGFueTtcclxuICAgICAgICAgICAgZGVsZXRlIGR1bXAuX190eXBlX187XHJcbiAgICAgICAgICAgIHJldHVybiBkdW1wO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGVjb2RlQnlEdW1wKGR1bXA6IGFueSwgY3VydmU6IGNjLlJlYWxDdXJ2ZSwgb3B0cz86IGFueSk6IGNjLlJlYWxDdXJ2ZSB7XHJcbiAgICAgICAgaWYgKGR1bXAudmFsdWUua2V5RnJhbWVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtleURhdGEgPSBkdW1wLnZhbHVlLmtleUZyYW1lcy5tYXAoKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtpdGVtLnRpbWUsIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbGVmdFRhbmdlbnQ6IGl0ZW0uaW5UYW5nZW50LFxyXG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0VGFuZ2VudDogaXRlbS5vdXRUYW5nZW50LFxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpbnRlcnBvbGF0aW9uTW9kZTogaXRlbS5pbnRlcnBNb2RlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRhbmdlbnRXZWlnaHRNb2RlOiBpdGVtLnRhbmdlbnRXZWlnaHRNb2RlLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZWZ0VGFuZ2VudFdlaWdodDogaXRlbS5pblRhbmdlbnRXZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRUYW5nZW50V2VpZ2h0OiBpdGVtLm91dFRhbmdlbnRXZWlnaHQsXHJcbiAgICAgICAgICAgICAgICB9XTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGN1cnZlLmFzc2lnblNvcnRlZChrZXlEYXRhKTtcclxuICAgICAgICAgICAgY3VydmUucG9zdEV4dHJhcG9sYXRpb24gPSBkdW1wLnZhbHVlLnBvc3RFeHRyYXA7XHJcbiAgICAgICAgICAgIGN1cnZlLnByZUV4dHJhcG9sYXRpb24gPSBkdW1wLnZhbHVlLnByZUV4dHJhcDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjdXJ2ZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHJlYWxDdXJ2ZUR1bXAgPSBuZXcgUmVhbEN1cnZlRHVtcCgpO1xyXG4iXX0=