'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.InterpolationType = void 0;
exports.srgbToLinear = srgbToLinear;
exports.linearToSRGB = linearToSRGB;
exports.nearestPowerOfTwo = nearestPowerOfTwo;
exports.equirectToCubemapFaces = equirectToCubemapFaces;
// refer to https://github.com/thomcc/equirect-to-cubemap-faces
function clamp(value, low, high) {
    return Math.min(high, Math.max(low, value));
}
function srgbToLinear(value) {
    return Math.pow(value, 2.2);
}
const i255 = 1.0 / 255.0;
function betweenZeroAndOne(value) {
    return i255 * value;
}
function linearToSRGB(value) {
    return Math.pow(value, 0.454545);
}
const ilog2 = 1 / Math.log(2);
function nearestPowerOfTwo(value) {
    return 1 << Math.round(Math.log(value) * ilog2);
}
var InterpolationType;
(function (InterpolationType) {
    InterpolationType["BILINEAR"] = "bilinear";
    InterpolationType["NEAREST"] = "nearest";
})(InterpolationType || (exports.InterpolationType = InterpolationType = {}));
const DEFAULT_OPTIONS = {
    flipTheta: false,
    interpolation: InterpolationType.BILINEAR,
    isRGBE: false,
};
const rgbe_base = 1.1;
function floatToRGBE(r, g, b, out, offset) {
    const v = Math.max(Math.max(r, g), b);
    const e = Math.ceil(Math.log(v) / Math.log(rgbe_base));
    const e_store = Math.min(Math.max(e + 128.0, 0.0), 255.0);
    const s = Math.pow(rgbe_base, e_store - 128);
    out[offset + 0] = ((r / s) * 255.0) | 0;
    out[offset + 1] = ((g / s) * 255.0) | 0;
    out[offset + 2] = ((b / s) * 255.0) | 0;
    out[offset + 3] = e_store;
}
function transformSingleFace(inPixels, faceIdx, facePixels, opts) {
    const thetaFlip = opts.flipTheta ? -1 : 1;
    const edge = facePixels.width | 0;
    const inWidth = inPixels.width | 0;
    const inHeight = inPixels.height | 0;
    const inData = inPixels.data;
    const smoothNearest = opts.interpolation === InterpolationType.NEAREST;
    const rgbe = opts.isRGBE;
    const faceData = facePixels.data;
    const faceWidth = facePixels.width | 0;
    const faceHeight = facePixels.height | 0;
    const face = faceIdx | 0;
    const iFaceWidth2 = 2.0 / faceWidth;
    const iFaceHeight2 = 2.0 / faceHeight;
    for (let j = 0; j < faceHeight; ++j) {
        for (let i = 0; i < faceWidth; ++i) {
            const a = iFaceWidth2 * i;
            const b = iFaceHeight2 * j;
            const outPos = (i + j * edge) << 2;
            let x = 0.0;
            let y = 0.0;
            let z = 0.0;
            // @@NOTE: Tried using explicit matrices for this and didn't see any
            // speedup over the (IMO more understandable) switch. (Probably because these
            // branches should be correctly predicted almost every time).
            switch (face) {
                case 0:
                    x = 1.0;
                    y = 1.0 - a;
                    z = 1.0 - b;
                    break; // right  (+x)
                case 1:
                    x = -1.0;
                    y = a - 1.0;
                    z = 1.0 - b;
                    break; // left   (-x)
                case 2:
                    x = a - 1.0;
                    y = b - 1.0;
                    z = 1.0;
                    break; // top    (+y)
                case 3:
                    x = a - 1.0;
                    y = 1.0 - b;
                    z = -1.0;
                    break; // bottom (-y)
                case 4:
                    x = a - 1.0;
                    y = 1.0;
                    z = 1.0 - b;
                    break; // front  (+z)
                case 5:
                    x = 1.0 - a;
                    y = -1.0;
                    z = 1.0 - b;
                    break; // back   (-z)
            }
            const theta = thetaFlip * Math.atan2(y, x);
            const rad = Math.sqrt(x * x + y * y);
            const phi = Math.atan2(z, rad);
            const uf = (2.0 * (inWidth / 4) * (theta + Math.PI)) / Math.PI;
            const vf = (2.0 * (inWidth / 4) * (Math.PI / 2 - phi)) / Math.PI;
            const ui = Math.floor(uf) | 0;
            const vi = Math.floor(vf) | 0;
            if (smoothNearest) {
                const inPos = ((ui % inWidth) + inWidth * clamp(vi, 0, inHeight - 1)) << 2;
                faceData[outPos + 0] = inData[inPos + 0] | 0;
                faceData[outPos + 1] = inData[inPos + 1] | 0;
                faceData[outPos + 2] = inData[inPos + 2] | 0;
                faceData[outPos + 3] = inData[inPos + 3] | 0;
            }
            else {
                // bilinear blend
                const u2 = ui + 1;
                const v2 = vi + 1;
                const mu = uf - ui;
                const nu = vf - vi;
                const pA = ((ui % inWidth) + inWidth * clamp(vi, 0, inHeight - 1)) << 2;
                const pB = ((u2 % inWidth) + inWidth * clamp(vi, 0, inHeight - 1)) << 2;
                const pC = ((ui % inWidth) + inWidth * clamp(v2, 0, inHeight - 1)) << 2;
                const pD = ((u2 % inWidth) + inWidth * clamp(v2, 0, inHeight - 1)) << 2;
                const aFactor = (1.0 - mu) * (1.0 - nu);
                const bFactor = mu * (1.0 - nu);
                const cFactor = (1.0 - mu) * nu;
                const dFactor = mu * nu;
                if (!rgbe) {
                    const aA = betweenZeroAndOne(inData[pA + 3] | 0);
                    const aB = betweenZeroAndOne(inData[pB + 3] | 0);
                    const aC = betweenZeroAndOne(inData[pC + 3] | 0);
                    const aD = betweenZeroAndOne(inData[pD + 3] | 0);
                    const rA = srgbToLinear(betweenZeroAndOne(inData[pA + 0] | 0)) * aA;
                    const gA = srgbToLinear(betweenZeroAndOne(inData[pA + 1] | 0)) * aA;
                    const bA = srgbToLinear(betweenZeroAndOne(inData[pA + 2] | 0)) * aA;
                    const rB = srgbToLinear(betweenZeroAndOne(inData[pB + 0] | 0)) * aB;
                    const gB = srgbToLinear(betweenZeroAndOne(inData[pB + 1] | 0)) * aB;
                    const bB = srgbToLinear(betweenZeroAndOne(inData[pB + 2] | 0)) * aB;
                    const rC = srgbToLinear(betweenZeroAndOne(inData[pC + 0] | 0)) * aC;
                    const gC = srgbToLinear(betweenZeroAndOne(inData[pC + 1] | 0)) * aC;
                    const bC = srgbToLinear(betweenZeroAndOne(inData[pC + 2] | 0)) * aC;
                    const rD = srgbToLinear(betweenZeroAndOne(inData[pD + 0] | 0)) * aD;
                    const gD = srgbToLinear(betweenZeroAndOne(inData[pD + 1] | 0)) * aD;
                    const bD = srgbToLinear(betweenZeroAndOne(inData[pD + 2] | 0)) * aD;
                    const r = rA * aFactor + rB * bFactor + rC * cFactor + rD * dFactor;
                    const g = gA * aFactor + gB * bFactor + gC * cFactor + gD * dFactor;
                    const b = bA * aFactor + bB * bFactor + bC * cFactor + bD * dFactor;
                    const a = aA * aFactor + aB * bFactor + aC * cFactor + aD * dFactor;
                    const ia = 1.0 / a;
                    faceData[outPos + 3] = (a * 255.0) | 0;
                    faceData[outPos + 0] = (linearToSRGB(r * ia) * 255.0) | 0;
                    faceData[outPos + 1] = (linearToSRGB(g * ia) * 255.0) | 0;
                    faceData[outPos + 2] = (linearToSRGB(b * ia) * 255.0) | 0;
                }
                else {
                    const aA = Math.pow(rgbe_base, (inData[pA + 3] | 0) - 128.0);
                    const aB = Math.pow(rgbe_base, (inData[pB + 3] | 0) - 128.0);
                    const aC = Math.pow(rgbe_base, (inData[pC + 3] | 0) - 128.0);
                    const aD = Math.pow(rgbe_base, (inData[pD + 3] | 0) - 128.0);
                    const rA = betweenZeroAndOne(inData[pA + 0] | 0) * aA;
                    const gA = betweenZeroAndOne(inData[pA + 1] | 0) * aA;
                    const bA = betweenZeroAndOne(inData[pA + 2] | 0) * aA;
                    const rB = betweenZeroAndOne(inData[pB + 0] | 0) * aB;
                    const gB = betweenZeroAndOne(inData[pB + 1] | 0) * aB;
                    const bB = betweenZeroAndOne(inData[pB + 2] | 0) * aB;
                    const rC = betweenZeroAndOne(inData[pC + 0] | 0) * aC;
                    const gC = betweenZeroAndOne(inData[pC + 1] | 0) * aC;
                    const bC = betweenZeroAndOne(inData[pC + 2] | 0) * aC;
                    const rD = betweenZeroAndOne(inData[pD + 0] | 0) * aD;
                    const gD = betweenZeroAndOne(inData[pD + 1] | 0) * aD;
                    const bD = betweenZeroAndOne(inData[pD + 2] | 0) * aD;
                    const r = rA * aFactor + rB * bFactor + rC * cFactor + rD * dFactor;
                    const g = gA * aFactor + gB * bFactor + gC * cFactor + gD * dFactor;
                    const b = bA * aFactor + bB * bFactor + bC * cFactor + bD * dFactor;
                    floatToRGBE(r, g, b, faceData, outPos);
                }
            }
        }
    }
    return facePixels;
}
function transformToCubeFaces(inPixels, facePixArray, options) {
    if (facePixArray.length !== 6) {
        throw new Error('facePixArray length must be 6!');
    }
    for (let face = 0; face < 6; ++face) {
        transformSingleFace(inPixels, face, facePixArray[face], options);
    }
    return facePixArray;
}
async function equirectToCubemapFaces(image, faceSize, options) {
    // const inPixels = imageGetPixels(image);
    const meta = await image.metadata();
    const imageData = await image.raw().toBuffer();
    let imageData4 = null;
    if (meta.channels === 3) {
        const pixelCount = (meta.width || 0) * (meta.height || 0);
        imageData4 = new Uint8Array(pixelCount * 4);
        for (let i = 0; i < pixelCount; ++i) {
            imageData4[i * 4 + 0] = imageData[i * 3 + 0];
            imageData4[i * 4 + 1] = imageData[i * 3 + 1];
            imageData4[i * 4 + 2] = imageData[i * 3 + 2];
            imageData4[i * 4 + 3] = 255;
        }
    }
    const inPixels = {
        width: meta.width || 0,
        height: meta.height || 0,
        data: imageData4 ? new Uint8Array(imageData4.buffer) : new Uint8Array(imageData.buffer),
    };
    const faces = [];
    for (let i = 0; i < 6; ++i) {
        // const c = document.createElement('canvas');
        // c.width = faceSize;
        // c.height = faceSize;
        faces.push({
            width: faceSize,
            height: faceSize,
            data: new Uint8Array(faceSize * faceSize * 4),
        });
    }
    if (!options) {
        options = DEFAULT_OPTIONS;
    }
    transformToCubeFaces(inPixels, faces, options);
    // .forEach((imageData, i) => {
    //     (faces[i].getContext('2d') as CanvasRenderingContext2D).putImageData(imageData, 0, 0);
    // });
    return faces;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXF1aXJlY3QtY3ViZW1hcC1mYWNlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb3JlL2Fzc2V0cy9hc3NldC1oYW5kbGVyL2Fzc2V0cy91dGlscy9lcXVpcmVjdC1jdWJlbWFwLWZhY2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7O0FBZWIsb0NBRUM7QUFPRCxvQ0FFQztBQUdELDhDQUVDO0FBMkxELHdEQTZDQztBQTdQRCwrREFBK0Q7QUFDL0QsU0FBUyxLQUFLLENBQUMsS0FBYSxFQUFFLEdBQVcsRUFBRSxJQUFZO0lBQ25ELE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQsU0FBZ0IsWUFBWSxDQUFDLEtBQWE7SUFDdEMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztBQUNoQyxDQUFDO0FBRUQsTUFBTSxJQUFJLEdBQUcsR0FBRyxHQUFHLEtBQUssQ0FBQztBQUN6QixTQUFTLGlCQUFpQixDQUFDLEtBQWE7SUFDcEMsT0FBTyxJQUFJLEdBQUcsS0FBSyxDQUFDO0FBQ3hCLENBQUM7QUFFRCxTQUFnQixZQUFZLENBQUMsS0FBYTtJQUN0QyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ3JDLENBQUM7QUFFRCxNQUFNLEtBQUssR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM5QixTQUFnQixpQkFBaUIsQ0FBQyxLQUFhO0lBQzNDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztBQUNwRCxD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RSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNqRCxNQUFNLEVBQUUsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNqRCxNQUFNLEVBQUUsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUNqRCxNQUFNLEVBQUUsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDcEUsTUFBTSxFQUFFLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQ3BFLE1BQU0sRUFBRSxHQUFHLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUNwRSxNQUFNLEVBQUUsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDcEUsTUFBTSxFQUFFLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQ3BFLE1BQU0sRUFBRSxHQUFHLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUNwRSxNQUFNLEVBQUUsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDcEUsTUFBTSxFQUFFLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQ3BFLE1BQU0sRUFBRSxHQUFHLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUNwRSxNQUFNLEVBQUUsR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDcEUsTUFBTSxFQUFFLEdBQUcsWUFBWSxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQ3BFLE1BQU0sRUFBRSxHQUFHLFlBQVksQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO29CQUNwRSxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUcsT0FBTyxHQUFHLEVBQUUsR0FBRyxPQUFPLEdBQUcsRUFBRSxHQUFHLE9BQU8sR0FBRyxFQUFFLEdBQUcsT0FBTyxDQUFDO29CQUNwRSxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUcsT0FBTyxHQUFHLEVBQUUsR0FBRyxPQUFPLEdBQUcsRUFBRSxHQUFHLE9BQU8sR0FBRyxFQUFFLEdBQUcsT0FBTyxDQUFDO29CQUNwRSxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUcsT0FBTyxHQUFHLEVBQUUsR0FBRyxPQUFPLEdBQUcsRUFBRSxHQUFHLE9BQU8sR0FBRyxF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TyxDQUFDLENBQUM7SUFDL0MsK0JBQStCO0lBQy9CLDZGQUE2RjtJQUM3RixNQUFNO0lBQ04sT0FBTyxLQUFLLENBQUM7QUFDakIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmltcG9ydCBzaGFycCwgeyBTaGFycCB9IGZyb20gJ3NoYXJwJztcclxuXHJcbmludGVyZmFjZSBJRGF0YSB7XHJcbiAgICBoZWlnaHQ6IG51bWJlcjtcclxuICAgIHdpZHRoOiBudW1iZXI7XHJcbiAgICBkYXRhOiBVaW50OEFycmF5O1xyXG59XHJcblxyXG4vLyByZWZlciB0byBodHRwczovL2dpdGh1Yi5jb20vdGhvbWNjL2VxdWlyZWN0LXRvLWN1YmVtYXAtZmFjZXNcclxuZnVuY3Rpb24gY2xhbXAodmFsdWU6IG51bWJlciwgbG93OiBudW1iZXIsIGhpZ2g6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIE1hdGgubWluKGhpZ2gsIE1hdGgubWF4KGxvdywgdmFsdWUpKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNyZ2JUb0xpbmVhcih2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gTWF0aC5wb3codmFsdWUsIDIuMik7XHJcbn1cclxuXHJcbmNvbnN0IGkyNTUgPSAxLjAgLyAyNTUuMDtcclxuZnVuY3Rpb24gYmV0d2Vlblplcm9BbmRPbmUodmFsdWU6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIGkyNTUgKiB2YWx1ZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxpbmVhclRvU1JHQih2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gTWF0aC5wb3codmFsdWUsIDAuNDU0NTQ1KTtcclxufVxyXG5cclxuY29uc3QgaWxvZzIgPSAxIC8gTWF0aC5sb2coMik7XHJcbmV4cG9ydCBmdW5jdGlvbiBuZWFyZXN0UG93ZXJPZlR3byh2YWx1ZTogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gMSA8PCBNYXRoLnJvdW5kKE1hdGgubG9nKHZhbHVlKSAqIGlsb2cyKTtcclxufVxyXG5cclxuZXhwb3J0IGVudW0gSW50ZXJwb2xhdGlvblR5cGUge1xyXG4gICAgQklMSU5FQVIgPSAnYmlsaW5lYXInLFxyXG4gICAgTkVBUkVTVCA9ICduZWFyZXN0JyxcclxufVxyXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zZm9ybU9wdGlvbnMge1xyXG4gICAgaW50ZXJwb2xhdGlvbj86IEludGVycG9sYXRpb25UeXBlO1xyXG4gICAgaXNSR0JFPzogYm9vbGVhbjtcclxuICAgIGZsaXBUaGV0YT86IGJvb2xlYW47XHJcbn1cclxuXHJcbmNvbnN0IERFRkFVTFRfT1BUSU9OUyA9IHtcclxuICAgIGZsaXBUaGV0YTogZmFsc2UsXHJcbiAgICBpbnRlcnBvbGF0aW9uOiBJbnRlcnBvbGF0aW9uVHlwZS5CSUxJTkVBUixcclxuICAgIGlzUkdCRTogZmFsc2UsXHJcbn07XHJcblxyXG5jb25zdCByZ2JlX2Jhc2UgPSAxLjE7XHJcbmZ1bmN0aW9uIGZsb2F0VG9SR0JFKHI6IG51bWJlciwgZzogbnVtYmVyLCBiOiBudW1iZXIsIG91dDogVWludDhBcnJheSwgb2Zmc2V0OiBudW1iZXIpIHtcclxuICAgIGNvbnN0IHYgPSBNYXRoLm1heChNYXRoLm1heChyLCBnKSwgYik7XHJcbiAgICBjb25zdCBlID0gTWF0aC5jZWlsKE1hdGgubG9nKHYpIC8gTWF0aC5sb2cocmdiZV9iYXNlKSk7XHJcbiAgICBjb25zdCBlX3N0b3JlID0gTWF0aC5taW4oTWF0aC5tYXgoZSArIDEyOC4wLCAwLjApLCAyNTUuMCk7XHJcbiAgICBjb25zdCBzID0gTWF0aC5wb3cocmdiZV9iYXNlLCBlX3N0b3JlIC0gMTI4KTtcclxuICAgIG91dFtvZmZzZXQgKyAwXSA9ICgociAvIHMpICogMjU1LjApIHwgMDtcclxuICAgIG91dFtvZmZzZXQgKyAxXSA9ICgoZyAvIHMpICogMjU1LjApIHwgMDtcclxuICAgIG91dFtvZmZzZXQgKyAyXSA9ICgoYiAvIHMpICogMjU1LjApIHwgMDtcclxuICAgIG91dFtvZmZzZXQgKyAzXSA9IGVfc3RvcmU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRyYW5zZm9ybVNpbmdsZUZhY2UoaW5QaXhlbHM6IElEYXRhLCBmYWNlSWR4OiBudW1iZXIsIGZhY2VQaXhlbHM6IElEYXRhLCBvcHRzOiBUcmFuc2Zvcm1PcHRpb25zKSB7XHJcbiAgICBjb25zdCB0aGV0YUZsaXAgPSBvcHRzLmZsaXBUaGV0YSA/IC0xIDogMTtcclxuICAgIGNvbnN0IGVkZ2UgPSBmYWNlUGl4ZWxzLndpZHRoIHwgMDtcclxuXHJcbiAgICBjb25zdCBpbldpZHRoID0gaW5QaXhlbHMud2lkdGggfCAwO1xyXG4gICAgY29uc3QgaW5IZWlnaHQgPSBpblBpeGVscy5oZWlnaHQgfCAwO1xyXG4gICAgY29uc3QgaW5EYXRhID0gaW5QaXhlbHMuZGF0YTtcclxuXHJcbiAgICBjb25zdCBzbW9vdGhOZWFyZXN0ID0gb3B0cy5pbnRlcnBvbGF0aW9uID09PSBJbnRlcnBvbGF0aW9uVHlwZS5ORUFSRVNUO1xyXG4gICAgY29uc3QgcmdiZSA9IG9wdHMuaXNSR0JFO1xyXG5cclxuICAgIGNvbnN0IGZhY2VEYXRhID0gZmFjZVBpeGVscy5kYXRhO1xyXG4gICAgY29uc3QgZmFjZVdpZHRoID0gZmFjZVBpeGVscy53aWR0aCB8IDA7XHJcbiAgICBjb25zdCBmYWNlSGVpZ2h0ID0gZmFjZVBpeGVscy5oZWlnaHQgfCAwO1xyXG4gICAgY29uc3QgZmFjZSA9IGZhY2VJZHggfCAwO1xyXG5cclxuICAgIGNvbnN0IGlGYWNlV2lkdGgyID0gMi4wIC8gZmFjZVdpZHRoO1xyXG4gICAgY29uc3QgaUZhY2VIZWlnaHQyID0gMi4wIC8gZmFjZUhlaWdodDtcclxuXHJcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGZhY2VIZWlnaHQ7ICsraikge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmFjZVdpZHRoOyArK2kpIHtcclxuICAgICAgICAgICAgY29uc3QgYSA9IGlGYWNlV2lkdGgyICogaTtcclxuICAgICAgICAgICAgY29uc3QgYiA9IGlGYWNlSGVpZ2h0MiAqIGo7XHJcbiAgICAgICAgICAgIGNvbnN0IG91dFBvcyA9IChpICsgaiAqIGVkZ2UpIDw8IDI7XHJcbiAgICAgICAgICAgIGxldCB4ID0gMC4wO1xyXG4gICAgICAgICAgICBsZXQgeSA9IDAuMDtcclxuICAgICAgICAgICAgbGV0IHogPSAwLjA7XHJcbiAgICAgICAgICAgIC8vIEBATk9URTogVHJpZWQgdXNpbmcgZXhwbGljaXQgbWF0cmljZXMgZm9yIHRoaXMgYW5kIGRpZG4ndCBzZWUgYW55XHJcbiAgICAgICAgICAgIC8vIHNwZWVkdXAgb3ZlciB0aGUgKElNTyBtb3JlIHVuZGVyc3RhbmRhYmxlKSBzd2l0Y2guIChQcm9iYWJseSBiZWNhdXNlIHRoZXNlXHJcbiAgICAgICAgICAgIC8vIGJyYW5jaGVzIHNob3VsZCBiZSBjb3JyZWN0bHkgcHJlZGljdGVkIGFsbW9zdCBldmVyeSB0aW1lKS5cclxuICAgICAgICAgICAgc3dpdGNoIChmYWNlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICAgICAgICAgICAgeCA9IDEuMDtcclxuICAgICAgICAgICAgICAgICAgICB5ID0gMS4wIC0gYTtcclxuICAgICAgICAgICAgICAgICAgICB6ID0gMS4wIC0gYjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gcmlnaHQgICgreClcclxuICAgICAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgICAgICB4ID0gLTEuMDtcclxuICAgICAgICAgICAgICAgICAgICB5ID0gYSAtIDEuMDtcclxuICAgICAgICAgICAgICAgICAgICB6ID0gMS4wIC0gYjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gbGVmdCAgICgteClcclxuICAgICAgICAgICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgICAgICAgICAgICB4ID0gYSAtIDEuMDtcclxuICAgICAgICAgICAgICAgICAgICB5ID0gYiAtIDEuMDtcclxuICAgICAgICAgICAgICAgICAgICB6ID0gMS4wO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyB0b3AgICAgKCt5KVxyXG4gICAgICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgICAgIHggPSBhIC0gMS4wO1xyXG4gICAgICAgICAgICAgICAgICAgIHkgPSAxLjAgLSBiO1xyXG4gICAgICAgICAgICAgICAgICAgIHogPSAtMS4wO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBib3R0b20gKC15KVxyXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxyXG4gICAgICAgICAgICAgICAgICAgIHggPSBhIC0gMS4wO1xyXG4gICAgICAgICAgICAgICAgICAgIHkgPSAxLjA7XHJcbiAgICAgICAgICAgICAgICAgICAgeiA9IDEuMCAtIGI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIGZyb250ICAoK3opXHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6XHJcbiAgICAgICAgICAgICAgICAgICAgeCA9IDEuMCAtIGE7XHJcbiAgICAgICAgICAgICAgICAgICAgeSA9IC0xLjA7XHJcbiAgICAgICAgICAgICAgICAgICAgeiA9IDEuMCAtIGI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIGJhY2sgICAoLXopXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRoZXRhID0gdGhldGFGbGlwICogTWF0aC5hdGFuMih5LCB4KTtcclxuICAgICAgICAgICAgY29uc3QgcmFkID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpO1xyXG4gICAgICAgICAgICBjb25zdCBwaGkgPSBNYXRoLmF0YW4yKHosIHJhZCk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB1ZiA9ICgyLjAgKiAoaW5XaWR0aCAvIDQpICogKHRoZXRhICsgTWF0aC5QSSkpIC8gTWF0aC5QSTtcclxuICAgICAgICAgICAgY29uc3QgdmYgPSAoMi4wICogKGluV2lkdGggLyA0KSAqIChNYXRoLlBJIC8gMiAtIHBoaSkpIC8gTWF0aC5QSTtcclxuICAgICAgICAgICAgY29uc3QgdWkgPSBNYXRoLmZsb29yKHVmKSB8IDA7XHJcbiAgICAgICAgICAgIGNvbnN0IHZpID0gTWF0aC5mbG9vcih2ZikgfCAwO1xyXG5cclxuICAgICAgICAgICAgaWYgKHNtb290aE5lYXJlc3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluUG9zID0gKCh1aSAlIGluV2lkdGgpICsgaW5XaWR0aCAqIGNsYW1wKHZpLCAwLCBpbkhlaWdodCAtIDEpKSA8PCAyO1xyXG4gICAgICAgICAgICAgICAgZmFjZURhdGFbb3V0UG9zICsgMF0gPSBpbkRhdGFbaW5Qb3MgKyAwXSB8IDA7XHJcbiAgICAgICAgICAgICAgICBmYWNlRGF0YVtvdXRQb3MgKyAxXSA9IGluRGF0YVtpblBvcyArIDFdIHwgMDtcclxuICAgICAgICAgICAgICAgIGZhY2VEYXRhW291dFBvcyArIDJdID0gaW5EYXRhW2luUG9zICsgMl0gfCAwO1xyXG4gICAgICAgICAgICAgICAgZmFjZURhdGFbb3V0UG9zICsgM10gPSBpbkRhdGFbaW5Qb3MgKyAzXSB8IDA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBiaWxpbmVhciBibGVuZFxyXG4gICAgICAgICAgICAgICAgY29uc3QgdTIgPSB1aSArIDE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2MiA9IHZpICsgMTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG11ID0gdWYgLSB1aTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG51ID0gdmYgLSB2aTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBwQSA9ICgodWkgJSBpbldpZHRoKSArIGluV2lkdGggKiBjbGFtcCh2aSwgMCwgaW5IZWlnaHQgLSAxKSkgPDwgMjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBCID0gKCh1MiAlIGluV2lkdGgpICsgaW5XaWR0aCAqIGNsYW1wKHZpLCAwLCBpbkhlaWdodCAtIDEpKSA8PCAyO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcEMgPSAoKHVpICUgaW5XaWR0aCkgKyBpbldpZHRoICogY2xhbXAodjIsIDAsIGluSGVpZ2h0IC0gMSkpIDw8IDI7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwRCA9ICgodTIgJSBpbldpZHRoKSArIGluV2lkdGggKiBjbGFtcCh2MiwgMCwgaW5IZWlnaHQgLSAxKSkgPDwgMjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGFGYWN0b3IgPSAoMS4wIC0gbXUpICogKDEuMCAtIG51KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGJGYWN0b3IgPSBtdSAqICgxLjAgLSBudSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjRmFjdG9yID0gKDEuMCAtIG11KSAqIG51O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZEZhY3RvciA9IG11ICogbnU7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJnYmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhQSA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQSArIDNdIHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYUIgPSBiZXR3ZWVuWmVyb0FuZE9uZShpbkRhdGFbcEIgKyAzXSB8IDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFDID0gYmV0d2Vlblplcm9BbmRPbmUoaW5EYXRhW3BDICsgM10gfCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhRCA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwRCArIDNdIHwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgckEgPSBzcmdiVG9MaW5lYXIoYmV0d2Vlblplcm9BbmRPbmUoaW5EYXRhW3BBICsgMF0gfCAwKSkgKiBhQTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnQSA9IHNyZ2JUb0xpbmVhcihiZXR3ZWVuWmVyb0FuZE9uZShpbkRhdGFbcEEgKyAxXSB8IDApKSAqIGFBO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJBID0gc3JnYlRvTGluZWFyKGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQSArIDJdIHwgMCkpICogYUE7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgckIgPSBzcmdiVG9MaW5lYXIoYmV0d2Vlblplcm9BbmRPbmUoaW5EYXRhW3BCICsgMF0gfCAwKSkgKiBhQjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnQiA9IHNyZ2JUb0xpbmVhcihiZXR3ZWVuWmVyb0FuZE9uZShpbkRhdGFbcEIgKyAxXSB8IDApKSAqIGFCO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJCID0gc3JnYlRvTGluZWFyKGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQiArIDJdIHwgMCkpICogYUI7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgckMgPSBzcmdiVG9MaW5lYXIoYmV0d2Vlblplcm9BbmRPbmUoaW5EYXRhW3BDICsgMF0gfCAwKSkgKiBhQztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnQyA9IHNyZ2JUb0xpbmVhcihiZXR3ZWVuWmVyb0FuZE9uZShpbkRhdGFbcEMgKyAxXSB8IDApKSAqIGFDO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJDID0gc3JnYlRvTGluZWFyKGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQyArIDJdIHwgMCkpICogYUM7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgckQgPSBzcmdiVG9MaW5lYXIoYmV0d2Vlblplcm9BbmRPbmUoaW5EYXRhW3BEICsgMF0gfCAwKSkgKiBhRDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnRCA9IHNyZ2JUb0xpbmVhcihiZXR3ZWVuWmVyb0FuZE9uZShpbkRhdGFbcEQgKyAxXSB8IDApKSAqIGFEO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGJEID0gc3JnYlRvTGluZWFyKGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwRCArIDJdIHwgMCkpICogYUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IHJBICogYUZhY3RvciArIHJCICogYkZhY3RvciArIHJDICogY0ZhY3RvciArIHJEICogZEZhY3RvcjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gZ0EgKiBhRmFjdG9yICsgZ0IgKiBiRmFjdG9yICsgZ0MgKiBjRmFjdG9yICsgZ0QgKiBkRmFjdG9yO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBiQSAqIGFGYWN0b3IgKyBiQiAqIGJGYWN0b3IgKyBiQyAqIGNGYWN0b3IgKyBiRCAqIGRGYWN0b3I7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IGFBICogYUZhY3RvciArIGFCICogYkZhY3RvciArIGFDICogY0ZhY3RvciArIGFEICogZEZhY3RvcjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpYSA9IDEuMCAvIGE7XHJcbiAgICAgICAgICAgICAgICAgICAgZmFjZURhdGFbb3V0UG9zICsgM10gPSAoYSAqIDI1NS4wKSB8IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZmFjZURhdGFbb3V0UG9zICsgMF0gPSAobGluZWFyVG9TUkdCKHIgKiBpYSkgKiAyNTUuMCkgfCAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZhY2VEYXRhW291dFBvcyArIDFdID0gKGxpbmVhclRvU1JHQihnICogaWEpICogMjU1LjApIHwgMDtcclxuICAgICAgICAgICAgICAgICAgICBmYWNlRGF0YVtvdXRQb3MgKyAyXSA9IChsaW5lYXJUb1NSR0IoYiAqIGlhKSAqIDI1NS4wKSB8IDA7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFBID0gTWF0aC5wb3cocmdiZV9iYXNlLCAoaW5EYXRhW3BBICsgM10gfCAwKSAtIDEyOC4wKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhQiA9IE1hdGgucG93KHJnYmVfYmFzZSwgKGluRGF0YVtwQiArIDNdIHwgMCkgLSAxMjguMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYUMgPSBNYXRoLnBvdyhyZ2JlX2Jhc2UsIChpbkRhdGFbcEMgKyAzXSB8IDApIC0gMTI4LjApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFEID0gTWF0aC5wb3cocmdiZV9iYXNlLCAoaW5EYXRhW3BEICsgM10gfCAwKSAtIDEyOC4wKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByQSA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQSArIDBdIHwgMCkgKiBhQTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnQSA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQSArIDFdIHwgMCkgKiBhQTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBiQSA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQSArIDJdIHwgMCkgKiBhQTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByQiA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQiArIDBdIHwgMCkgKiBhQjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnQiA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQiArIDFdIHwgMCkgKiBhQjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBiQiA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQiArIDJdIHwgMCkgKiBhQjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByQyA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQyArIDBdIHwgMCkgKiBhQztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnQyA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQyArIDFdIHwgMCkgKiBhQztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBiQyA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwQyArIDJdIHwgMCkgKiBhQztcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByRCA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwRCArIDBdIHwgMCkgKiBhRDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBnRCA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwRCArIDFdIHwgMCkgKiBhRDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBiRCA9IGJldHdlZW5aZXJvQW5kT25lKGluRGF0YVtwRCArIDJdIHwgMCkgKiBhRDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gckEgKiBhRmFjdG9yICsgckIgKiBiRmFjdG9yICsgckMgKiBjRmFjdG9yICsgckQgKiBkRmFjdG9yO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBnQSAqIGFGYWN0b3IgKyBnQiAqIGJGYWN0b3IgKyBnQyAqIGNGYWN0b3IgKyBnRCAqIGRGYWN0b3I7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IGJBICogYUZhY3RvciArIGJCICogYkZhY3RvciArIGJDICogY0ZhY3RvciArIGJEICogZEZhY3RvcjtcclxuICAgICAgICAgICAgICAgICAgICBmbG9hdFRvUkdCRShyLCBnLCBiLCBmYWNlRGF0YSwgb3V0UG9zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWNlUGl4ZWxzO1xyXG59XHJcblxyXG5mdW5jdGlvbiB0cmFuc2Zvcm1Ub0N1YmVGYWNlcyhpblBpeGVsczogSURhdGEsIGZhY2VQaXhBcnJheTogSURhdGFbXSwgb3B0aW9uczogVHJhbnNmb3JtT3B0aW9ucykge1xyXG4gICAgaWYgKGZhY2VQaXhBcnJheS5sZW5ndGggIT09IDYpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZhY2VQaXhBcnJheSBsZW5ndGggbXVzdCBiZSA2IScpO1xyXG4gICAgfVxyXG4gICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCA2OyArK2ZhY2UpIHtcclxuICAgICAgICB0cmFuc2Zvcm1TaW5nbGVGYWNlKGluUGl4ZWxzLCBmYWNlLCBmYWNlUGl4QXJyYXlbZmFjZV0sIG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhY2VQaXhBcnJheTtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVxdWlyZWN0VG9DdWJlbWFwRmFjZXMoaW1hZ2U6IFNoYXJwLCBmYWNlU2l6ZTogbnVtYmVyLCBvcHRpb25zPzogVHJhbnNmb3JtT3B0aW9ucyk6IFByb21pc2U8SURhdGFbXT4ge1xyXG4gICAgLy8gY29uc3QgaW5QaXhlbHMgPSBpbWFnZUdldFBpeGVscyhpbWFnZSk7XHJcblxyXG4gICAgY29uc3QgbWV0YSA9IGF3YWl0IGltYWdlLm1ldGFkYXRhKCk7XHJcbiAgICBjb25zdCBpbWFnZURhdGEgPSBhd2FpdCBpbWFnZS5yYXcoKS50b0J1ZmZlcigpO1xyXG4gICAgbGV0IGltYWdlRGF0YTQgPSBudWxsO1xyXG5cclxuICAgIGlmIChtZXRhLmNoYW5uZWxzID09PSAzKSB7XHJcbiAgICAgICAgY29uc3QgcGl4ZWxDb3VudCA9IChtZXRhLndpZHRoIHx8IDApICogKG1ldGEuaGVpZ2h0IHx8IDApO1xyXG4gICAgICAgIGltYWdlRGF0YTQgPSBuZXcgVWludDhBcnJheShwaXhlbENvdW50ICogNCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwaXhlbENvdW50OyArK2kpIHtcclxuICAgICAgICAgICAgaW1hZ2VEYXRhNFtpICogNCArIDBdID0gaW1hZ2VEYXRhW2kgKiAzICsgMF07XHJcbiAgICAgICAgICAgIGltYWdlRGF0YTRbaSAqIDQgKyAxXSA9IGltYWdlRGF0YVtpICogMyArIDFdO1xyXG4gICAgICAgICAgICBpbWFnZURhdGE0W2kgKiA0ICsgMl0gPSBpbWFnZURhdGFbaSAqIDMgKyAyXTtcclxuICAgICAgICAgICAgaW1hZ2VEYXRhNFtpICogNCArIDNdID0gMjU1O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpblBpeGVscyA9IHtcclxuICAgICAgICB3aWR0aDogbWV0YS53aWR0aCB8fCAwLFxyXG4gICAgICAgIGhlaWdodDogbWV0YS5oZWlnaHQgfHwgMCxcclxuICAgICAgICBkYXRhOiBpbWFnZURhdGE0ID8gbmV3IFVpbnQ4QXJyYXkoaW1hZ2VEYXRhNC5idWZmZXIpIDogbmV3IFVpbnQ4QXJyYXkoaW1hZ2VEYXRhLmJ1ZmZlciksXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGZhY2VzOiBJRGF0YVtdID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7ICsraSkge1xyXG4gICAgICAgIC8vIGNvbnN0IGMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuICAgICAgICAvLyBjLndpZHRoID0gZmFjZVNpemU7XHJcbiAgICAgICAgLy8gYy5oZWlnaHQgPSBmYWNlU2l6ZTtcclxuICAgICAgICBmYWNlcy5wdXNoKHtcclxuICAgICAgICAgICAgd2lkdGg6IGZhY2VTaXplLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IGZhY2VTaXplLFxyXG4gICAgICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheShmYWNlU2l6ZSAqIGZhY2VTaXplICogNCksXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFvcHRpb25zKSB7XHJcbiAgICAgICAgb3B0aW9ucyA9IERFRkFVTFRfT1BUSU9OUztcclxuICAgIH1cclxuXHJcbiAgICB0cmFuc2Zvcm1Ub0N1YmVGYWNlcyhpblBpeGVscywgZmFjZXMsIG9wdGlvbnMpO1xyXG4gICAgLy8gLmZvckVhY2goKGltYWdlRGF0YSwgaSkgPT4ge1xyXG4gICAgLy8gICAgIChmYWNlc1tpXS5nZXRDb250ZXh0KCcyZCcpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCkucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XHJcbiAgICAvLyB9KTtcclxuICAgIHJldHVybiBmYWNlcztcclxufVxyXG4iXX0=