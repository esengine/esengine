"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const asset_db_1 = __importDefault(require("./asset-db"));
const utils_1 = require("../utils");
const events_1 = __importDefault(require("events"));
const query_1 = __importDefault(require("./query"));
const operation_1 = __importDefault(require("./operation"));
const asset_handler_1 = __importDefault(require("./asset-handler"));
/**
 * 对外暴露一系列的资源查询、操作接口等
 * 对外暴露资源的一些变动广播消息、事件消息
 */
class AssetManager extends events_1.default {
    // --------- query ---------
    queryAssets = query_1.default.queryAssets.bind(query_1.default);
    queryAssetDependencies = query_1.default.queryAssetDependencies.bind(query_1.default);
    queryAssetUsers = query_1.default.queryAssetUsers.bind(query_1.default);
    queryAsset = query_1.default.queryAsset.bind(query_1.default);
    queryAssetInfo = query_1.default.queryAssetInfo.bind(query_1.default);
    queryAssetInfoByUUID = query_1.default.queryAssetInfoByUUID.bind(query_1.default);
    queryAssetInfos = query_1.default.queryAssetInfos.bind(query_1.default);
    querySortedPlugins = query_1.default.querySortedPlugins.bind(query_1.default);
    queryUUID = query_1.default.queryUUID.bind(query_1.default);
    queryPath = query_1.default.queryPath.bind(query_1.default);
    queryUrl = query_1.default.queryUrl.bind(query_1.default);
    generateAvailableURL = query_1.default.generateAvailableURL.bind(query_1.default);
    queryDBAssetInfo = query_1.default.queryDBAssetInfo.bind(query_1.default);
    encodeAsset = query_1.default.encodeAsset.bind(query_1.default);
    queryAssetProperty = query_1.default.queryAssetProperty.bind(query_1.default);
    queryAssetMeta = query_1.default.queryAssetMeta.bind(query_1.default);
    queryAssetMtime = query_1.default.queryAssetMtime.bind(query_1.default);
    // ---------- operation ---------
    importAsset = operation_1.default.importAsset.bind(operation_1.default);
    saveAssetMeta = operation_1.default.saveAssetMeta.bind(operation_1.default);
    saveAsset = operation_1.default.saveAsset.bind(operation_1.default);
    createAsset = operation_1.default.createAsset.bind(operation_1.default);
    refreshAsset = operation_1.default.refreshAsset.bind(operation_1.default);
    reimportAsset = operation_1.default.reimportAsset.bind(operation_1.default);
    renameAsset = operation_1.default.renameAsset.bind(operation_1.default);
    removeAsset = operation_1.default.removeAsset.bind(operation_1.default);
    moveAsset = operation_1.default.moveAsset.bind(operation_1.default);
    generateExportData = operation_1.default.generateExportData.bind(operation_1.default);
    outputExportData = operation_1.default.outputExportData.bind(operation_1.default);
    createAssetByType = operation_1.default.createAssetByType.bind(operation_1.default);
    updateUserData = operation_1.default.updateUserData.bind(operation_1.default);
    // ----------- assetHandlerManager ------------
    queryIconConfigMap = asset_handler_1.default.queryIconConfigMap.bind(asset_handler_1.default);
    queryAssetConfigMap = asset_handler_1.default.queryAssetConfigMap.bind(asset_handler_1.default);
    updateDefaultUserData = asset_handler_1.default.updateDefaultUserData.bind(asset_handler_1.default);
    getCreateMap = asset_handler_1.default.getCreateMap.bind(asset_handler_1.default);
    queryAssetUserDataConfig = asset_handler_1.default.queryUserDataConfig.bind(asset_handler_1.default);
    getEffectBinPath() {
        return asset_handler_1.default.getEffectBinPath();
    }
    ;
    url2uuid(url) {
        return (0, utils_1.url2uuid)(url);
    }
    url2path(url) {
        return (0, utils_1.url2path)(url);
    }
    path2url(url, dbName) {
        return asset_db_1.default.path2url(url, dbName);
    }
    // ------------- 实例化方法 ------------
    async init() {
        asset_db_1.default.on('db-created', this._onAssetDBCreated);
        asset_db_1.default.on('db-removed', this._onAssetDBRemoved);
    }
    destroyed() {
        asset_db_1.default.removeListener('db-created', this._onAssetDBCreated);
        asset_db_1.default.removeListener('db-removed', this._onAssetDBRemoved);
    }
    _onAssetDBCreated(db) {
        db.on('unresponsive', onUnResponsive);
        db.on('added', assetManager._onAssetAdded.bind(assetManager));
        db.on('changed', assetManager._onAssetChanged.bind(assetManager));
        db.on('deleted', assetManager._onAssetDeleted.bind(assetManager));
    }
    _onAssetDBRemoved(db) {
        db.removeListener('unresponsive', onUnResponsive);
        db.removeListener('added', assetManager._onAssetAdded.bind(assetManager));
        db.removeListener('changed', assetManager._onAssetChanged.bind(assetManager));
        db.removeListener('deleted', assetManager._onAssetDeleted.bind(assetManager));
    }
    async _onAssetAdded(asset) {
        if (asset_db_1.default.ready) {
            this.emit('asset-add', asset);
            console.log(`asset-add ${asset.url}`);
            return;
        }
    }
    async _onAssetChanged(asset) {
        if (asset_db_1.default.ready) {
            this.emit('asset-change', asset);
            console.log(`asset-change ${asset.url}`);
            return;
        }
    }
    async _onAssetDeleted(asset) {
        if (asset_db_1.default.ready) {
            // 暂时这样处理，需要调整整个 asset-db 流程才能合理化这段逻辑
            await asset_handler_1.default.destroyAsset(asset);
            this.emit('asset-delete', asset);
            console.log(`asset-delete ${asset.url}`);
            return;
        }
    }
}
const assetManager = new AssetManager();
// 类型断言，将实例转换为带类型约束的接口
const typedAssetManager = assetManager;
exports.default = typedAssetManager;
globalThis.assetManager = typedAssetManager;
// --------------- event handler -------------------
async function onUnResponsive(asset) {
    if (asset_db_1.default.ready) {
        // 当打开项目后，导入超时的时候，弹出弹窗
        console.error(`Resource import Timeout.\n  uuid: ${asset.uuid}\n  url: ${asset.url}`);
    }
    else {
        console.debug('import asset unresponsive');
        // 正在打开项目的时候，超时了，需要在窗口上显示超时
        // const current = asset._taskManager._execID - asset._taskManager._execThread;
        // Task.updateSyncTask(
        //     'import-asset',
        //     i18n.translation('asset-db.mask.loading'),
        //     `${queryUrl(asset.source)}\n(${current}/${asset._taskManager.total()})`
        // );
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29yZS9hc3NldHMvbWFuYWdlci9hc3NldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLDBEQUF3QztBQUN4QyxvQ0FBOEM7QUFDOUMsb0RBQWtDO0FBRWxDLG9EQUFpQztBQUNqQyw0REFBeUM7QUFDekMsb0VBQWtEO0FBRWxEOzs7R0FHRztBQUNILE1BQU0sWUFBYSxTQUFRLGdCQUFZO0lBQ25DLDRCQUE0QjtJQUM1QixXQUFXLEdBQUcsZUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBVSxDQUFDLENBQUM7SUFDdEQsc0JBQXNCLEdBQUcsZUFBVSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxlQUFVLENBQUMsQ0FBQztJQUM1RSxlQUFlLEdBQUcsZUFBVSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsZUFBVSxDQUFDLENBQUM7SUFDOUQsVUFBVSxHQUFHLGVBQVUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQVUsQ0FBQyxDQUFDO0lBQ3BELGNBQWMsR0FBRyxlQUFVLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxlQUFVLENBQUMsQ0FBQztJQUM1RCxvQkFBb0IsR0FBRyxlQUFVLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLGVBQVUsQ0FBQyxDQUFDO0lBQ3hFLGVBQWUsR0FBRyxlQUFVLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxlQUFVLENBQUMsQ0FBQztJQUM5RCxrQkFBa0IsR0FBRyxlQUFVLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGVBQVUsQ0FBQyxDQUFDO0lBQ3BFLFNBQVMsR0FBRyxlQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxlQUFVLENBQUMsQ0FBQztJQUNsRCxTQUFTLEdBQUcsZUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsZUFBVSxDQUFDLENBQUM7SUFDbEQsUUFBUSxHQUFHLGVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGVBQVUsQ0FBQyxDQUFDO0lBQ2hELG9CQUFvQixHQUFHLGVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsZUFBVSxDQUFDLENBQUM7SUFDeEUsZ0JBQWdCLEdBQUcsZUFBVSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxlQUFVLENBQUMsQ0FBQztJQUNoRSxXQUFXLEdBQUcsZUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBVSxDQUFDLENBQUM7SUFDdEQsa0JBQWtCLEdBQUcsZUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxlQUFVLENBQUMsQ0FBQztJQUNwRSxjQUFjLEdBQUcsZUFBVSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsZUFBVSxDQUFDLENBQUM7SUFDNUQsZUFBZSxHQUFHLGVBQVUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLGVBQVUsQ0FBQyxDQUFDO0lBQzlELGlDQUFpQztJQUNqQyxXQUFXLEdBQUcsbUJBQWMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUM5RCxhQUFhLEdBQUcsbUJBQWMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUNsRSxTQUFTLEdBQUcsbUJBQWMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUMxRCxXQUFXLEdBQUcsbUJBQWMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUM5RCxZQUFZLEdBQUcsbUJBQWMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUNoRSxhQUFhLEdBQUcsbUJBQWMsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUNsRSxXQUFXLEdBQUcsbUJBQWMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUM5RCxXQUFXLEdBQUcsbUJBQWMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUM5RCxTQUFTLEdBQUcsbUJBQWMsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUMxRCxrQkFBa0IsR0FBRyxtQkFBYyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxtQkFBYyxDQUFDLENBQUM7SUFDNUUsZ0JBQWdCLEdBQUcsbUJBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsbUJBQWMsQ0FBQyxDQUFDO0lBQ3hFLGlCQUFpQixHQUFHLG1CQUFjLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUMxRSxjQUFjLEdBQUcsbUJBQWMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLG1CQUFjLENBQUMsQ0FBQztJQUVwRSwrQ0FBK0M7SUFDL0Msa0JBQWtCLEdBQUcsdUJBQW1CLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLHVCQUFtQixDQUFDLENBQUM7SUFDdEYsbUJBQW1CLEdBQUcsdUJBQW1CLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLHVCQUFtQixDQUFDLENBQUM7SUFDeEYscUJBQXFCLEdBQUcsdUJBQW1CLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLHVCQUFtQixDQUFDLENBQUM7SUFDNUYsWUFBWSxHQUFHLHVCQUFtQixDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsdUJBQW1CLENBQUMsQ0FBQztJQUMxRSx3QkFBd0IsR0FBRyx1QkFBbUIsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsdUJBQW1CLENBQUMsQ0FBQztJQUM3RixnQkFBZ0I7UUFDWixPQUFPLHVCQUFtQixDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDbEQsQ0FBQztJQUFBLENBQUM7SUFFRixRQUFRLENBQUMsR0FBVztRQUNoQixPQUFPLElBQUEsZ0JBQVEsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBQ0QsUUFBUSxDQUFDLEdBQVc7UUFDaEIsT0FBTyxJQUFBLGdCQUFRLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNELFFBQVEsQ0FBQyxHQUFXLEVBQUUsTUFBZTtRQUNqQyxPQUFPLGtCQUFjLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNoRCxDQUFDO0lBRUQsbUNBQW1DO0lBQ25DLEtBQUssQ0FBQyxJQUFJO1FBQ04sa0JBQWMsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3hELGtCQUFjLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQsU0FBUztRQUNMLGtCQUFjLENBQUMsY0FBYyxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNwRSxrQkFBYyxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUVELGlCQUFpQixDQUFDLEVBQVc7UUFDekIsRUFBRSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDdEMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsWUFBWSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUM5RCxFQUFFLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ2xFLEVBQUUsQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUVELGlCQUFpQixDQUFDLEVBQVc7UUFDekIsRUFBRSxDQUFDLGNBQWMsQ0FBQyxjQUFjLEVBQUUsY0FBYyxDQUFDLENBQUM7UUFDbEQsRUFBRSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsWUFBWSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUMxRSxFQUFFLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQzlFLEVBQUUsQ0FBQyxjQUFjLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDbEYsQ0FBQztJQUVELEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBYTtRQUM3QixJQUFJLGtCQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3RDLE9BQU87UUFDWCxDQUFDO0lBQ0wsQ0FBQztJQUNELEtBQUssQ0FBQyxlQUFlLENBQUMsS0FBYTtRQUMvQixJQUFJLGtCQUFjLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDekMsT0FBTztRQUNYLENBQUM7SUFDTCxDQUFDO0lBQ0QsS0FBSyxDQUFDLGVBQWUsQ0FBQyxLQUFhO1FBQy9CLElBQUksa0JBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN2QixxQ0FBcUM7WUFDckMsTUFBTSx1QkFBbUIsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7WUFDekMsT0FBTztRQUNYLENBQUM7SUFDTCxDQUFDO0NBQ0o7QUFFRCxNQUFNLFlBQVksR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0FBNkR4QyxzQkFBc0I7QUFDdEIsTUFBTSxpQkFBaUIsR0FBRyxZQUFpQyxDQUFDO0FBRTVELGtCQUFlLGlCQUFpQixDQUFDO0FBQ2hDLFVBQWtCLENBQUMsWUFBWSxHQUFHLGlCQUFpQixDQUFDO0FBQ3JELG9EQUFvRDtBQUVwRCxLQUFLLFVBQVUsY0FBYyxDQUFDLEtBQW1CO0lBQzdDLElBQUksa0JBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2QixzQkFBc0I7UUFDdEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsS0FBSyxDQUFDLElBQUksWUFBWSxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMxRixDQUFDO1NBQU0sQ0FBQztRQUNKLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUMzQywyQkFBMkI7UUFDM0IsK0VBQStFO1FBQy9FLHVCQUF1QjtRQUN2QixzQkFBc0I7UUFDdEIsaURBQWlEO1FBQ2pELDhFQUE4RTtRQUM5RSxLQUFLO0lBQ1QsQ0FBQztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3NldERCLCBWaXJ0dWFsQXNzZXQgfSBmcm9tICdAY29jb3MvYXNzZXQtZGInO1xyXG5pbXBvcnQgYXNzZXREQk1hbmFnZXIgZnJvbSAnLi9hc3NldC1kYic7XHJcbmltcG9ydCB7IHVybDJwYXRoLCB1cmwydXVpZCB9IGZyb20gJy4uL3V0aWxzJztcclxuaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tICdldmVudHMnO1xyXG5pbXBvcnQgeyBBc3NldE1hbmFnZXJFdmVudHMsIElBc3NldCB9IGZyb20gJy4uL0B0eXBlcy9wcml2YXRlJztcclxuaW1wb3J0IGFzc2V0UXVlcnkgZnJvbSAnLi9xdWVyeSc7XHJcbmltcG9ydCBhc3NldE9wZXJhdGlvbiBmcm9tICcuL29wZXJhdGlvbic7XHJcbmltcG9ydCBhc3NldEhhbmRsZXJNYW5hZ2VyIGZyb20gJy4vYXNzZXQtaGFuZGxlcic7XHJcblxyXG4vKipcclxuICog5a+55aSW5pq06Zyy5LiA57O75YiX55qE6LWE5rqQ5p+l6K+i44CB5pON5L2c5o6l5Y+j562JXHJcbiAqIOWvueWkluaatOmcsui1hOa6kOeahOS4gOS6m+WPmOWKqOW5v+aSrea2iOaBr+OAgeS6i+S7tua2iOaBr1xyXG4gKi9cclxuY2xhc3MgQXNzZXRNYW5hZ2VyIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcclxuICAgIC8vIC0tLS0tLS0tLSBxdWVyeSAtLS0tLS0tLS1cclxuICAgIHF1ZXJ5QXNzZXRzID0gYXNzZXRRdWVyeS5xdWVyeUFzc2V0cy5iaW5kKGFzc2V0UXVlcnkpO1xyXG4gICAgcXVlcnlBc3NldERlcGVuZGVuY2llcyA9IGFzc2V0UXVlcnkucXVlcnlBc3NldERlcGVuZGVuY2llcy5iaW5kKGFzc2V0UXVlcnkpO1xyXG4gICAgcXVlcnlBc3NldFVzZXJzID0gYXNzZXRRdWVyeS5xdWVyeUFzc2V0VXNlcnMuYmluZChhc3NldFF1ZXJ5KTtcclxuICAgIHF1ZXJ5QXNzZXQgPSBhc3NldFF1ZXJ5LnF1ZXJ5QXNzZXQuYmluZChhc3NldFF1ZXJ5KTtcclxuICAgIHF1ZXJ5QXNzZXRJbmZvID0gYXNzZXRRdWVyeS5xdWVyeUFzc2V0SW5mby5iaW5kKGFzc2V0UXVlcnkpO1xyXG4gICAgcXVlcnlBc3NldEluZm9CeVVVSUQgPSBhc3NldFF1ZXJ5LnF1ZXJ5QXNzZXRJbmZvQnlVVUlELmJpbmQoYXNzZXRRdWVyeSk7XHJcbiAgICBxdWVyeUFzc2V0SW5mb3MgPSBhc3NldFF1ZXJ5LnF1ZXJ5QXNzZXRJbmZvcy5iaW5kKGFzc2V0UXVlcnkpO1xyXG4gICAgcXVlcnlTb3J0ZWRQbHVnaW5zID0gYXNzZXRRdWVyeS5xdWVyeVNvcnRlZFBsdWdpbnMuYmluZChhc3NldFF1ZXJ5KTtcclxuICAgIHF1ZXJ5VVVJRCA9IGFzc2V0UXVlcnkucXVlcnlVVUlELmJpbmQoYXNzZXRRdWVyeSk7XHJcbiAgICBxdWVyeVBhdGggPSBhc3NldFF1ZXJ5LnF1ZXJ5UGF0aC5iaW5kKGFzc2V0UXVlcnkpO1xyXG4gICAgcXVlcnlVcmwgPSBhc3NldFF1ZXJ5LnF1ZXJ5VXJsLmJpbmQoYXNzZXRRdWVyeSk7XHJcbiAgICBnZW5lcmF0ZUF2YWlsYWJsZVVSTCA9IGFzc2V0UXVlcnkuZ2VuZXJhdGVBdmFpbGFibGVVUkwuYmluZChhc3NldFF1ZXJ5KTtcclxuICAgIHF1ZXJ5REJBc3NldEluZm8gPSBhc3NldFF1ZXJ5LnF1ZXJ5REJBc3NldEluZm8uYmluZChhc3NldFF1ZXJ5KTtcclxuICAgIGVuY29kZUFzc2V0ID0gYXNzZXRRdWVyeS5lbmNvZGVBc3NldC5iaW5kKGFzc2V0UXVlcnkpO1xyXG4gICAgcXVlcnlBc3NldFByb3BlcnR5ID0gYXNzZXRRdWVyeS5xdWVyeUFzc2V0UHJvcGVydHkuYmluZChhc3NldFF1ZXJ5KTtcclxuICAgIHF1ZXJ5QXNzZXRNZXRhID0gYXNzZXRRdWVyeS5xdWVyeUFzc2V0TWV0YS5iaW5kKGFzc2V0UXVlcnkpO1xyXG4gICAgcXVlcnlBc3NldE10aW1lID0gYXNzZXRRdWVyeS5xdWVyeUFzc2V0TXRpbWUuYmluZChhc3NldFF1ZXJ5KTtcclxuICAgIC8vIC0tLS0tLS0tLS0gb3BlcmF0aW9uIC0tLS0tLS0tLVxyXG4gICAgaW1wb3J0QXNzZXQgPSBhc3NldE9wZXJhdGlvbi5pbXBvcnRBc3NldC5iaW5kKGFzc2V0T3BlcmF0aW9uKTtcclxuICAgIHNhdmVBc3NldE1ldGEgPSBhc3NldE9wZXJhdGlvbi5zYXZlQXNzZXRNZXRhLmJpbmQoYXNzZXRPcGVyYXRpb24pO1xyXG4gICAgc2F2ZUFzc2V0ID0gYXNzZXRPcGVyYXRpb24uc2F2ZUFzc2V0LmJpbmQoYXNzZXRPcGVyYXRpb24pO1xyXG4gICAgY3JlYXRlQXNzZXQgPSBhc3NldE9wZXJhdGlvbi5jcmVhdGVBc3NldC5iaW5kKGFzc2V0T3BlcmF0aW9uKTtcclxuICAgIHJlZnJlc2hBc3NldCA9IGFzc2V0T3BlcmF0aW9uLnJlZnJlc2hBc3NldC5iaW5kKGFzc2V0T3BlcmF0aW9uKTtcclxuICAgIHJlaW1wb3J0QXNzZXQgPSBhc3NldE9wZXJhdGlvbi5yZWltcG9ydEFzc2V0LmJpbmQoYXNzZXRPcGVyYXRpb24pO1xyXG4gICAgcmVuYW1lQXNzZXQgPSBhc3NldE9wZXJhdGlvbi5yZW5hbWVBc3NldC5iaW5kKGFzc2V0T3BlcmF0aW9uKTtcclxuICAgIHJlbW92ZUFzc2V0ID0gYXNzZXRPcGVyYXRpb24ucmVtb3ZlQXNzZXQuYmluZChhc3NldE9wZXJhdGlvbik7XHJcbiAgICBtb3ZlQXNzZXQgPSBhc3NldE9wZXJhdGlvbi5tb3ZlQXNzZXQuYmluZChhc3NldE9wZXJhdGlvbik7XHJcbiAgICBnZW5lcmF0ZUV4cG9ydERhdGEgPSBhc3NldE9wZXJhdGlvbi5nZW5lcmF0ZUV4cG9ydERhdGEuYmluZChhc3NldE9wZXJhdGlvbik7XHJcbiAgICBvdXRwdXRFeHBvcnREYXRhID0gYXNzZXRPcGVyYXRpb24ub3V0cHV0RXhwb3J0RGF0YS5iaW5kKGFzc2V0T3BlcmF0aW9uKTtcclxuICAgIGNyZWF0ZUFzc2V0QnlUeXBlID0gYXNzZXRPcGVyYXRpb24uY3JlYXRlQXNzZXRCeVR5cGUuYmluZChhc3NldE9wZXJhdGlvbik7XHJcbiAgICB1cGRhdGVVc2VyRGF0YSA9IGFzc2V0T3BlcmF0aW9uLnVwZGF0ZVVzZXJEYXRhLmJpbmQoYXNzZXRPcGVyYXRpb24pO1xyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tIGFzc2V0SGFuZGxlck1hbmFnZXIgLS0tLS0tLS0tLS0tXHJcbiAgICBxdWVyeUljb25Db25maWdNYXAgPSBhc3NldEhhbmRsZXJNYW5hZ2VyLnF1ZXJ5SWNvbkNvbmZpZ01hcC5iaW5kKGFzc2V0SGFuZGxlck1hbmFnZXIpO1xyXG4gICAgcXVlcnlBc3NldENvbmZpZ01hcCA9IGFzc2V0SGFuZGxlck1hbmFnZXIucXVlcnlBc3NldENvbmZpZ01hcC5iaW5kKGFzc2V0SGFuZGxlck1hbmFnZXIpO1xyXG4gICAgdXBkYXRlRGVmYXVsdFVzZXJEYXRhID0gYXNzZXRIYW5kbGVyTWFuYWdlci51cGRhdGVEZWZhdWx0VXNlckRhdGEuYmluZChhc3NldEhhbmRsZXJNYW5hZ2VyKTtcclxuICAgIGdldENyZWF0ZU1hcCA9IGFzc2V0SGFuZGxlck1hbmFnZXIuZ2V0Q3JlYXRlTWFwLmJpbmQoYXNzZXRIYW5kbGVyTWFuYWdlcik7XHJcbiAgICBxdWVyeUFzc2V0VXNlckRhdGFDb25maWcgPSBhc3NldEhhbmRsZXJNYW5hZ2VyLnF1ZXJ5VXNlckRhdGFDb25maWcuYmluZChhc3NldEhhbmRsZXJNYW5hZ2VyKTtcclxuICAgIGdldEVmZmVjdEJpblBhdGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIGFzc2V0SGFuZGxlck1hbmFnZXIuZ2V0RWZmZWN0QmluUGF0aCgpO1xyXG4gICAgfTtcclxuXHJcbiAgICB1cmwydXVpZCh1cmw6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiB1cmwydXVpZCh1cmwpO1xyXG4gICAgfVxyXG4gICAgdXJsMnBhdGgodXJsOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gdXJsMnBhdGgodXJsKTtcclxuICAgIH1cclxuICAgIHBhdGgydXJsKHVybDogc3RyaW5nLCBkYk5hbWU/OiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gYXNzZXREQk1hbmFnZXIucGF0aDJ1cmwodXJsLCBkYk5hbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIC0tLS0tLS0tLS0tLS0g5a6e5L6L5YyW5pa55rOVIC0tLS0tLS0tLS0tLVxyXG4gICAgYXN5bmMgaW5pdCgpIHtcclxuICAgICAgICBhc3NldERCTWFuYWdlci5vbignZGItY3JlYXRlZCcsIHRoaXMuX29uQXNzZXREQkNyZWF0ZWQpO1xyXG4gICAgICAgIGFzc2V0REJNYW5hZ2VyLm9uKCdkYi1yZW1vdmVkJywgdGhpcy5fb25Bc3NldERCUmVtb3ZlZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVzdHJveWVkKCkge1xyXG4gICAgICAgIGFzc2V0REJNYW5hZ2VyLnJlbW92ZUxpc3RlbmVyKCdkYi1jcmVhdGVkJywgdGhpcy5fb25Bc3NldERCQ3JlYXRlZCk7XHJcbiAgICAgICAgYXNzZXREQk1hbmFnZXIucmVtb3ZlTGlzdGVuZXIoJ2RiLXJlbW92ZWQnLCB0aGlzLl9vbkFzc2V0REJSZW1vdmVkKTtcclxuICAgIH1cclxuXHJcbiAgICBfb25Bc3NldERCQ3JlYXRlZChkYjogQXNzZXREQikge1xyXG4gICAgICAgIGRiLm9uKCd1bnJlc3BvbnNpdmUnLCBvblVuUmVzcG9uc2l2ZSk7XHJcbiAgICAgICAgZGIub24oJ2FkZGVkJywgYXNzZXRNYW5hZ2VyLl9vbkFzc2V0QWRkZWQuYmluZChhc3NldE1hbmFnZXIpKTtcclxuICAgICAgICBkYi5vbignY2hhbmdlZCcsIGFzc2V0TWFuYWdlci5fb25Bc3NldENoYW5nZWQuYmluZChhc3NldE1hbmFnZXIpKTtcclxuICAgICAgICBkYi5vbignZGVsZXRlZCcsIGFzc2V0TWFuYWdlci5fb25Bc3NldERlbGV0ZWQuYmluZChhc3NldE1hbmFnZXIpKTtcclxuICAgIH1cclxuXHJcbiAgICBfb25Bc3NldERCUmVtb3ZlZChkYjogQXNzZXREQikge1xyXG4gICAgICAgIGRiLnJlbW92ZUxpc3RlbmVyKCd1bnJlc3BvbnNpdmUnLCBvblVuUmVzcG9uc2l2ZSk7XHJcbiAgICAgICAgZGIucmVtb3ZlTGlzdGVuZXIoJ2FkZGVkJywgYXNzZXRNYW5hZ2VyLl9vbkFzc2V0QWRkZWQuYmluZChhc3NldE1hbmFnZXIpKTtcclxuICAgICAgICBkYi5yZW1vdmVMaXN0ZW5lcignY2hhbmdlZCcsIGFzc2V0TWFuYWdlci5fb25Bc3NldENoYW5nZWQuYmluZChhc3NldE1hbmFnZXIpKTtcclxuICAgICAgICBkYi5yZW1vdmVMaXN0ZW5lcignZGVsZXRlZCcsIGFzc2V0TWFuYWdlci5fb25Bc3NldERlbGV0ZWQuYmluZChhc3NldE1hbmFnZXIpKTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBfb25Bc3NldEFkZGVkKGFzc2V0OiBJQXNzZXQpIHtcclxuICAgICAgICBpZiAoYXNzZXREQk1hbmFnZXIucmVhZHkpIHtcclxuICAgICAgICAgICAgdGhpcy5lbWl0KCdhc3NldC1hZGQnLCBhc3NldCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBhc3NldC1hZGQgJHthc3NldC51cmx9YCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhc3luYyBfb25Bc3NldENoYW5nZWQoYXNzZXQ6IElBc3NldCkge1xyXG4gICAgICAgIGlmIChhc3NldERCTWFuYWdlci5yZWFkeSkge1xyXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2Fzc2V0LWNoYW5nZScsIGFzc2V0KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYGFzc2V0LWNoYW5nZSAke2Fzc2V0LnVybH1gKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFzeW5jIF9vbkFzc2V0RGVsZXRlZChhc3NldDogSUFzc2V0KSB7XHJcbiAgICAgICAgaWYgKGFzc2V0REJNYW5hZ2VyLnJlYWR5KSB7XHJcbiAgICAgICAgICAgIC8vIOaaguaXtui/meagt+WkhOeQhu+8jOmcgOimgeiwg+aVtOaVtOS4qiBhc3NldC1kYiDmtYHnqIvmiY3og73lkIjnkIbljJbov5nmrrXpgLvovpFcclxuICAgICAgICAgICAgYXdhaXQgYXNzZXRIYW5kbGVyTWFuYWdlci5kZXN0cm95QXNzZXQoYXNzZXQpO1xyXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2Fzc2V0LWRlbGV0ZScsIGFzc2V0KTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYGFzc2V0LWRlbGV0ZSAke2Fzc2V0LnVybH1gKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgYXNzZXRNYW5hZ2VyID0gbmV3IEFzc2V0TWFuYWdlcigpO1xyXG5cclxuLy8g5Yib5bu65bim5pyJ5LqL5Lu257G75Z6L57qm5p2f55qEIEFzc2V0TWFuYWdlciDnsbvlnotcclxuZXhwb3J0IGludGVyZmFjZSBUeXBlZEFzc2V0TWFuYWdlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcbiAgICAvLyDkuovku7bnm5HlkKzmlrnms5XvvIjluKbnsbvlnovnuqbmnZ/vvIlcclxuICAgIG9uPEsgZXh0ZW5kcyBrZXlvZiBBc3NldE1hbmFnZXJFdmVudHM+KGV2ZW50OiBLLCBsaXN0ZW5lcjogQXNzZXRNYW5hZ2VyRXZlbnRzW0tdKTogdGhpcztcclxuICAgIG9uY2U8SyBleHRlbmRzIGtleW9mIEFzc2V0TWFuYWdlckV2ZW50cz4oZXZlbnQ6IEssIGxpc3RlbmVyOiBBc3NldE1hbmFnZXJFdmVudHNbS10pOiB0aGlzO1xyXG4gICAgZW1pdDxLIGV4dGVuZHMga2V5b2YgQXNzZXRNYW5hZ2VyRXZlbnRzPihldmVudDogSywgLi4uYXJnczogUGFyYW1ldGVyczxBc3NldE1hbmFnZXJFdmVudHNbS10+KTogYm9vbGVhbjtcclxuICAgIHJlbW92ZUxpc3RlbmVyPEsgZXh0ZW5kcyBrZXlvZiBBc3NldE1hbmFnZXJFdmVudHM+KGV2ZW50OiBLLCBsaXN0ZW5lcjogQXNzZXRNYW5hZ2VyRXZlbnRzW0tdKTogdGhpcztcclxuICAgIHJlbW92ZUFsbExpc3RlbmVyczxLIGV4dGVuZHMga2V5b2YgQXNzZXRNYW5hZ2VyRXZlbnRzPihldmVudD86IEspOiB0aGlzO1xyXG4gICAgbGlzdGVuZXJzPEsgZXh0ZW5kcyBrZXlvZiBBc3NldE1hbmFnZXJFdmVudHM+KGV2ZW50OiBLKTogRnVuY3Rpb25bXTtcclxuICAgIGxpc3RlbmVyQ291bnQ8SyBleHRlbmRzIGtleW9mIEFzc2V0TWFuYWdlckV2ZW50cz4oZXZlbnQ6IEspOiBudW1iZXI7XHJcblxyXG4gICAgLy8g5Y6f5pyJ55qE5pa55rOVXHJcbiAgICBxdWVyeUFzc2V0czogdHlwZW9mIGFzc2V0UXVlcnkucXVlcnlBc3NldHM7XHJcbiAgICBxdWVyeUFzc2V0RGVwZW5kZW5jaWVzOiB0eXBlb2YgYXNzZXRRdWVyeS5xdWVyeUFzc2V0RGVwZW5kZW5jaWVzO1xyXG4gICAgcXVlcnlBc3NldFVzZXJzOiB0eXBlb2YgYXNzZXRRdWVyeS5xdWVyeUFzc2V0VXNlcnM7XHJcbiAgICBxdWVyeUFzc2V0OiB0eXBlb2YgYXNzZXRRdWVyeS5xdWVyeUFzc2V0O1xyXG4gICAgcXVlcnlBc3NldEluZm86IHR5cGVvZiBhc3NldFF1ZXJ5LnF1ZXJ5QXNzZXRJbmZvO1xyXG4gICAgcXVlcnlBc3NldEluZm9CeVVVSUQ6IHR5cGVvZiBhc3NldFF1ZXJ5LnF1ZXJ5QXNzZXRJbmZvQnlVVUlEO1xyXG4gICAgcXVlcnlBc3NldEluZm9zOiB0eXBlb2YgYXNzZXRRdWVyeS5xdWVyeUFzc2V0SW5mb3M7XHJcbiAgICBxdWVyeVNvcnRlZFBsdWdpbnM6IHR5cGVvZiBhc3NldFF1ZXJ5LnF1ZXJ5U29ydGVkUGx1Z2lucztcclxuICAgIHF1ZXJ5VVVJRDogdHlwZW9mIGFzc2V0UXVlcnkucXVlcnlVVUlEO1xyXG4gICAgcXVlcnlQYXRoOiB0eXBlb2YgYXNzZXRRdWVyeS5xdWVyeVBhdGg7XHJcbiAgICBxdWVyeVVybDogdHlwZW9mIGFzc2V0UXVlcnkucXVlcnlVcmw7XHJcbiAgICBnZW5lcmF0ZUF2YWlsYWJsZVVSTDogdHlwZW9mIGFzc2V0UXVlcnkuZ2VuZXJhdGVBdmFpbGFibGVVUkw7XHJcbiAgICBxdWVyeURCQXNzZXRJbmZvOiB0eXBlb2YgYXNzZXRRdWVyeS5xdWVyeURCQXNzZXRJbmZvO1xyXG4gICAgZW5jb2RlQXNzZXQ6IHR5cGVvZiBhc3NldFF1ZXJ5LmVuY29kZUFzc2V0O1xyXG4gICAgcXVlcnlBc3NldFByb3BlcnR5OiB0eXBlb2YgYXNzZXRRdWVyeS5xdWVyeUFzc2V0UHJvcGVydHk7XHJcbiAgICBxdWVyeUFzc2V0TWV0YTogdHlwZW9mIGFzc2V0UXVlcnkucXVlcnlBc3NldE1ldGE7XHJcbiAgICBxdWVyeUFzc2V0TXRpbWU6IHR5cGVvZiBhc3NldFF1ZXJ5LnF1ZXJ5QXNzZXRNdGltZTtcclxuXHJcbiAgICBpbXBvcnRBc3NldDogdHlwZW9mIGFzc2V0T3BlcmF0aW9uLmltcG9ydEFzc2V0O1xyXG4gICAgc2F2ZUFzc2V0TWV0YTogdHlwZW9mIGFzc2V0T3BlcmF0aW9uLnNhdmVBc3NldE1ldGE7XHJcbiAgICBzYXZlQXNzZXQ6IHR5cGVvZiBhc3NldE9wZXJhdGlvbi5zYXZlQXNzZXQ7XHJcbiAgICBjcmVhdGVBc3NldDogdHlwZW9mIGFzc2V0T3BlcmF0aW9uLmNyZWF0ZUFzc2V0O1xyXG4gICAgcmVmcmVzaEFzc2V0OiB0eXBlb2YgYXNzZXRPcGVyYXRpb24ucmVmcmVzaEFzc2V0O1xyXG4gICAgcmVpbXBvcnRBc3NldDogdHlwZW9mIGFzc2V0T3BlcmF0aW9uLnJlaW1wb3J0QXNzZXQ7XHJcbiAgICByZW5hbWVBc3NldDogdHlwZW9mIGFzc2V0T3BlcmF0aW9uLnJlbmFtZUFzc2V0O1xyXG4gICAgcmVtb3ZlQXNzZXQ6IHR5cGVvZiBhc3NldE9wZXJhdGlvbi5yZW1vdmVBc3NldDtcclxuICAgIG1vdmVBc3NldDogdHlwZW9mIGFzc2V0T3BlcmF0aW9uLm1vdmVBc3NldDtcclxuICAgIGdlbmVyYXRlRXhwb3J0RGF0YTogdHlwZW9mIGFzc2V0T3BlcmF0aW9uLmdlbmVyYXRlRXhwb3J0RGF0YTtcclxuICAgIG91dHB1dEV4cG9ydERhdGE6IHR5cGVvZiBhc3NldE9wZXJhdGlvbi5vdXRwdXRFeHBvcnREYXRhO1xyXG4gICAgY3JlYXRlQXNzZXRCeVR5cGU6IHR5cGVvZiBhc3NldE9wZXJhdGlvbi5jcmVhdGVBc3NldEJ5VHlwZTtcclxuICAgIHVwZGF0ZVVzZXJEYXRhOiB0eXBlb2YgYXNzZXRPcGVyYXRpb24udXBkYXRlVXNlckRhdGE7XHJcblxyXG4gICAgcXVlcnlJY29uQ29uZmlnTWFwOiB0eXBlb2YgYXNzZXRIYW5kbGVyTWFuYWdlci5xdWVyeUljb25Db25maWdNYXA7XHJcbiAgICBxdWVyeUFzc2V0Q29uZmlnTWFwOiB0eXBlb2YgYXNzZXRIYW5kbGVyTWFuYWdlci5xdWVyeUFzc2V0Q29uZmlnTWFwO1xyXG4gICAgdXBkYXRlRGVmYXVsdFVzZXJEYXRhOiB0eXBlb2YgYXNzZXRIYW5kbGVyTWFuYWdlci51cGRhdGVEZWZhdWx0VXNlckRhdGE7XHJcbiAgICBnZXRDcmVhdGVNYXA6IHR5cGVvZiBhc3NldEhhbmRsZXJNYW5hZ2VyLmdldENyZWF0ZU1hcDtcclxuICAgIHF1ZXJ5QXNzZXRVc2VyRGF0YUNvbmZpZzogdHlwZW9mIGFzc2V0SGFuZGxlck1hbmFnZXIucXVlcnlVc2VyRGF0YUNvbmZpZztcclxuICAgIGdldEVmZmVjdEJpblBhdGg6IHR5cGVvZiBhc3NldEhhbmRsZXJNYW5hZ2VyLmdldEVmZmVjdEJpblBhdGg7XHJcblxyXG4gICAgdXJsMnV1aWQodXJsOiBzdHJpbmcpOiBzdHJpbmc7XHJcbiAgICB1cmwycGF0aCh1cmw6IHN0cmluZyk6IHN0cmluZztcclxuICAgIHBhdGgydXJsKHVybDogc3RyaW5nLCBkYk5hbWU/OiBzdHJpbmcpOiBzdHJpbmc7XHJcblxyXG4gICAgaW5pdCgpOiBQcm9taXNlPHZvaWQ+O1xyXG4gICAgZGVzdHJveWVkKCk6IHZvaWQ7XHJcbn1cclxuXHJcbi8vIOexu+Wei+aWreiogO+8jOWwhuWunuS+i+i9rOaNouS4uuW4puexu+Wei+e6puadn+eahOaOpeWPo1xyXG5jb25zdCB0eXBlZEFzc2V0TWFuYWdlciA9IGFzc2V0TWFuYWdlciBhcyBUeXBlZEFzc2V0TWFuYWdlcjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHR5cGVkQXNzZXRNYW5hZ2VyO1xyXG4oZ2xvYmFsVGhpcyBhcyBhbnkpLmFzc2V0TWFuYWdlciA9IHR5cGVkQXNzZXRNYW5hZ2VyO1xyXG4vLyAtLS0tLS0tLS0tLS0tLS0gZXZlbnQgaGFuZGxlciAtLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG5hc3luYyBmdW5jdGlvbiBvblVuUmVzcG9uc2l2ZShhc3NldDogVmlydHVhbEFzc2V0KSB7XHJcbiAgICBpZiAoYXNzZXREQk1hbmFnZXIucmVhZHkpIHtcclxuICAgICAgICAvLyDlvZPmiZPlvIDpobnnm67lkI7vvIzlr7zlhaXotoXml7bnmoTml7blgJnvvIzlvLnlh7rlvLnnqpdcclxuICAgICAgICBjb25zb2xlLmVycm9yKGBSZXNvdXJjZSBpbXBvcnQgVGltZW91dC5cXG4gIHV1aWQ6ICR7YXNzZXQudXVpZH1cXG4gIHVybDogJHthc3NldC51cmx9YCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZGVidWcoJ2ltcG9ydCBhc3NldCB1bnJlc3BvbnNpdmUnKTtcclxuICAgICAgICAvLyDmraPlnKjmiZPlvIDpobnnm67nmoTml7blgJnvvIzotoXml7bkuobvvIzpnIDopoHlnKjnqpflj6PkuIrmmL7npLrotoXml7ZcclxuICAgICAgICAvLyBjb25zdCBjdXJyZW50ID0gYXNzZXQuX3Rhc2tNYW5hZ2VyLl9leGVjSUQgLSBhc3NldC5fdGFza01hbmFnZXIuX2V4ZWNUaHJlYWQ7XHJcbiAgICAgICAgLy8gVGFzay51cGRhdGVTeW5jVGFzayhcclxuICAgICAgICAvLyAgICAgJ2ltcG9ydC1hc3NldCcsXHJcbiAgICAgICAgLy8gICAgIGkxOG4udHJhbnNsYXRpb24oJ2Fzc2V0LWRiLm1hc2subG9hZGluZycpLFxyXG4gICAgICAgIC8vICAgICBgJHtxdWVyeVVybChhc3NldC5zb3VyY2UpfVxcbigke2N1cnJlbnR9LyR7YXNzZXQuX3Rhc2tNYW5hZ2VyLnRvdGFsKCl9KWBcclxuICAgICAgICAvLyApO1xyXG4gICAgfVxyXG59Il19