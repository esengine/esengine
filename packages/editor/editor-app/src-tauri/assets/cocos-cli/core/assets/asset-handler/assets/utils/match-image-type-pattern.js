"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.matchImageTypePattern = matchImageTypePattern;
const imageTypePatternTable = [
    {
        mimeType: 'image/png',
        pattern: [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a],
        mask: [0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff],
    },
    {
        mimeType: 'image/jpeg',
        pattern: [0xff, 0xd8, 0xff],
        mask: [0xff, 0xff, 0xff],
    },
];
function matchMimeTypePattern(input, pattern, mask, ignoredBytes) {
    // https://mimesniff.spec.whatwg.org/#pattern-matching-algorithm
    // asserts(pattern.length === mask.length);
    if (input.length < mask.length) {
        return false;
    }
    let s = 0;
    if (ignoredBytes) {
        for (; s < input.length; ++s) {
            if (!ignoredBytes.includes(input[s])) {
                break;
            }
        }
    }
    for (let p = 0; p < pattern.length; ++p, ++s) {
        if ((mask[p] & input[s]) !== pattern[p]) {
            return false;
        }
    }
    return true;
}
function matchImageTypePattern(input) {
    // https://mimesniff.spec.whatwg.org/#matching-an-image-type-pattern
    for (const { mimeType, pattern, mask, ignoredBytes } of imageTypePatternTable) {
        if (matchMimeTypePattern(input, pattern, mask, ignoredBytes)) {
            return mimeType;
        }
    }
    return;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0Y2gtaW1hZ2UtdHlwZS1wYXR0ZXJuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvcmUvYXNzZXRzL2Fzc2V0LWhhbmRsZXIvYXNzZXRzL3V0aWxzL21hdGNoLWltYWdlLXR5cGUtcGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQTRDQSxzREFRQztBQWhERCxNQUFNLHFCQUFxQixHQUt0QjtJQUNEO1FBQ0ksUUFBUSxFQUFFLFdBQVc7UUFDckIsT0FBTyxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUN6RCxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO0tBQ3pEO0lBQ0Q7UUFDSSxRQUFRLEVBQUUsWUFBWTtRQUN0QixPQUFPLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUMzQixJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztLQUMzQjtDQUNKLENBQUM7QUFFRixTQUFTLG9CQUFvQixDQUFDLEtBQVksRUFBRSxPQUFjLEVBQUUsSUFBVyxFQUFFLFlBQTJCO0lBQ2hHLGdFQUFnRTtJQUNoRSwyQ0FBMkM7SUFDM0MsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUM3QixPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBQ0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNmLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNuQyxNQUFNO1lBQ1YsQ0FBQztRQUNMLENBQUM7SUFDTCxDQUFDO0lBQ0QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3RDLE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUM7SUFDTCxDQUFDO0lBQ0QsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQztBQUVELFNBQWdCLHFCQUFxQixDQUFDLEtBQVk7SUFDOUMsb0VBQW9FO0lBQ3BFLEtBQUssTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxJQUFJLHFCQUFxQixFQUFFLENBQUM7UUFDNUUsSUFBSSxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsRUFBRSxDQUFDO1lBQzNELE9BQU8sUUFBUSxDQUFDO1FBQ3BCLENBQUM7SUFDTCxDQUFDO0lBQ0QsT0FBTztBQUNYLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJ0eXBlIEJ5dGVzID0gQXJyYXlMaWtlPG51bWJlcj47XHJcblxyXG50eXBlIElnbm9yZWRCeXRlcyA9IEJ5dGVzICYgeyBpbmNsdWRlcyhuOiBudW1iZXIpOiBib29sZWFuIH07XHJcblxyXG5jb25zdCBpbWFnZVR5cGVQYXR0ZXJuVGFibGU6IEFycmF5PHtcclxuICAgIG1pbWVUeXBlOiBzdHJpbmc7XHJcbiAgICBwYXR0ZXJuOiBCeXRlcztcclxuICAgIG1hc2s6IEJ5dGVzO1xyXG4gICAgaWdub3JlZEJ5dGVzPzogSWdub3JlZEJ5dGVzO1xyXG59PiA9IFtcclxuICAgIHtcclxuICAgICAgICBtaW1lVHlwZTogJ2ltYWdlL3BuZycsXHJcbiAgICAgICAgcGF0dGVybjogWzB4ODksIDB4NTAsIDB4NGUsIDB4NDcsIDB4MGQsIDB4MGEsIDB4MWEsIDB4MGFdLFxyXG4gICAgICAgIG1hc2s6IFsweGZmLCAweGZmLCAweGZmLCAweGZmLCAweGZmLCAweGZmLCAweGZmLCAweGZmXSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgICAgbWltZVR5cGU6ICdpbWFnZS9qcGVnJyxcclxuICAgICAgICBwYXR0ZXJuOiBbMHhmZiwgMHhkOCwgMHhmZl0sXHJcbiAgICAgICAgbWFzazogWzB4ZmYsIDB4ZmYsIDB4ZmZdLFxyXG4gICAgfSxcclxuXTtcclxuXHJcbmZ1bmN0aW9uIG1hdGNoTWltZVR5cGVQYXR0ZXJuKGlucHV0OiBCeXRlcywgcGF0dGVybjogQnl0ZXMsIG1hc2s6IEJ5dGVzLCBpZ25vcmVkQnl0ZXM/OiBJZ25vcmVkQnl0ZXMpIHtcclxuICAgIC8vIGh0dHBzOi8vbWltZXNuaWZmLnNwZWMud2hhdHdnLm9yZy8jcGF0dGVybi1tYXRjaGluZy1hbGdvcml0aG1cclxuICAgIC8vIGFzc2VydHMocGF0dGVybi5sZW5ndGggPT09IG1hc2subGVuZ3RoKTtcclxuICAgIGlmIChpbnB1dC5sZW5ndGggPCBtYXNrLmxlbmd0aCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGxldCBzID0gMDtcclxuICAgIGlmIChpZ25vcmVkQnl0ZXMpIHtcclxuICAgICAgICBmb3IgKDsgcyA8IGlucHV0Lmxlbmd0aDsgKytzKSB7XHJcbiAgICAgICAgICAgIGlmICghaWdub3JlZEJ5dGVzLmluY2x1ZGVzKGlucHV0W3NdKSkge1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGxldCBwID0gMDsgcCA8IHBhdHRlcm4ubGVuZ3RoOyArK3AsICsrcykge1xyXG4gICAgICAgIGlmICgobWFza1twXSAmIGlucHV0W3NdKSAhPT0gcGF0dGVybltwXSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtYXRjaEltYWdlVHlwZVBhdHRlcm4oaW5wdXQ6IEJ5dGVzKSB7XHJcbiAgICAvLyBodHRwczovL21pbWVzbmlmZi5zcGVjLndoYXR3Zy5vcmcvI21hdGNoaW5nLWFuLWltYWdlLXR5cGUtcGF0dGVyblxyXG4gICAgZm9yIChjb25zdCB7IG1pbWVUeXBlLCBwYXR0ZXJuLCBtYXNrLCBpZ25vcmVkQnl0ZXMgfSBvZiBpbWFnZVR5cGVQYXR0ZXJuVGFibGUpIHtcclxuICAgICAgICBpZiAobWF0Y2hNaW1lVHlwZVBhdHRlcm4oaW5wdXQsIHBhdHRlcm4sIG1hc2ssIGlnbm9yZWRCeXRlcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG1pbWVUeXBlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybjtcclxufVxyXG4iXX0=