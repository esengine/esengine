'use strict';
const ps = require('path');
const fs = require('fs-extra');
const fsJetpack = require('fs-jetpack');
const options = {
    engineRoot: '',
    shouldThrow: false,
    noSource: false,
    stripSpaces: false,
    noOutput: false,
    essentialOnly: false,
    keepNewlines: false,
    filesOrDirs: [],
};
const argc = process.argv.length;
for (let i = 2; i < argc; i++) {
    const arg = process.argv[i];
    if (arg === '--engine' && i < argc - 1) {
        options.engineRoot = ps.resolve(process.argv[++i]);
    }
    else if (arg === '--throw') {
        options.shouldThrow = true;
    }
    else if (arg === '--no-source') {
        options.noSource = true;
    }
    else if (arg === '--strip-spaces') {
        options.stripSpaces = true;
    }
    else if (arg === '--no-output') {
        options.noOutput = true;
    }
    else if (arg === '--essential-only') {
        options.essentialOnly = true;
    }
    else if (arg.startsWith('--keep-newlines')) {
        options.keepNewlines = arg.length > 15 ? arg.substring(16) : '';
    }
    else {
        options.filesOrDirs.push(arg);
    }
}
const cacheFile = ps.join(__dirname, 'engine_root_cache.txt');
if (options.engineRoot && fs.existsSync(options.engineRoot)) {
    fs.writeFileSync(cacheFile, options.engineRoot);
}
else {
    if (fs.existsSync(cacheFile)) {
        options.engineRoot = fs.readFileSync(cacheFile, 'utf8');
    }
    if (!options.engineRoot) {
        throw new Error('Engine root is not set');
    }
}
// polyfill some dirty globals
Object.assign(global, {
    Manager: { AssetInfo: { engine: options.engineRoot } },
    cc: {},
    CC_EDITOR: false,
    CC_DEV: false,
    CC_TEST: false,
});
const { default: preload } = require('cc/preload');
(async () => {
    await preload({
        root: options.engineRoot,
        editorExtensions: false,
        requiredModules: ['cc/editor/offline-mappings'],
    });
    main();
})().catch((err) => {
    console.error(err);
});
function main() {
    const shdcLib = require(ps.join(__dirname, './index'));
    shdcLib.options.throwOnWarning = shdcLib.options.throwOnError = options.shouldThrow;
    shdcLib.options.noSource = options.noSource;
    shdcLib.options.skipParserTest = true;
    const closure = { dir: '' };
    const chunksDir = { dir: ps.join(options.engineRoot, 'editor/assets/chunks') };
    shdcLib.options.chunkSearchFn = (names) => {
        const res = { name: undefined, content: undefined };
        for (let i = 0; i < names.length; i++) {
            // user input path first
            const name = names[i];
            let file = ps.resolve(closure.dir, name + '.chunk');
            if (!fs.existsSync(file)) {
                file = ps.resolve(chunksDir.dir, name + '.chunk');
                if (!fs.existsSync(file)) {
                    continue;
                }
            }
            res.name = name;
            res.content = fs.readFileSync(file, { encoding: 'utf-8' });
            break;
        }
        return res;
    };
    const addChunks = (dir) => {
        const files = fsJetpack.find(dir, { matching: '*.chunk', recursive: false });
        for (let i = 0; i < files.length; ++i) {
            const name = ps.basename(files[i], '.chunk');
            const content = fs.readFileSync(files[i], { encoding: 'utf8' });
            shdcLib.addChunk(name, content);
        }
    };
    addChunks(ps.join(options.engineRoot, 'editor/assets/chunks'));
    const indent = (str, num) => str.replace(/\n/g, '\n' + ' '.repeat(num));
    const stringify = (o) => {
        return JSON.stringify(o)
            .replace(/([,{]|":)/g, '$1 ')
            .replace(/([}])/g, ' $1');
    };
    const stringifyArray = (arr, stringifyObj = stringify) => {
        let code = '';
        if (!arr.length) {
            return '[]';
        }
        for (const obj of arr) {
            code += `  ${indent(stringifyObj(obj), 2)},\n`;
        }
        return `[\n${code.slice(0, -2)}\n]`;
    };
    const stringifySource = (() => {
        const indentRE = /\s*?\n\s*/g;
        const spacesRE = /[\s\n]+/g, identifierRE = /\w/;
        const replacer = (m, ofs, str) => (!ofs || !identifierRE.test(str[ofs - 1]) || !identifierRE.test(str[ofs + m.length]) ? '' : ' ');
        const stringifyCode = (src, path) => {
            if (options.stripSpaces) {
                src = src.replace(spacesRE, replacer);
            }
            if (options.essentialOnly) {
                src = src.replace(indentRE, '\n');
            }
            return path.includes(options.keepNewlines) ? `\`${src}\`` : `"${src.replace(/\n/g, '\\n')}"`;
        };
        return (src, path) => {
            let code = '{\n';
            code += `  "vert": ${indent(stringifyCode(src.vert, path + '.vert'), 4)},\n`;
            code += `  "frag": ${indent(stringifyCode(src.frag, path + '.frag'), 4)},\n`;
            code += '}';
            return code;
        };
    })();
    const stringifyEffect = (() => {
        const stringifyBlock = (u) => `{"name": "${u.name}", "defines": ${stringify(u.defines)}, "binding": ${u.binding}, ` +
            (u.descriptorType ? '"descriptorType": ' + u.descriptorType + ', ' : '') +
            `"stageFlags": ${u.stageFlags}, "members": ${stringifyArray(u.members)}}`;
        const stringifyShader = (shader) => {
            let code = '';
            const { name, hash, glsl4, glsl3, glsl1, builtins, defines, blocks, samplerTextures, buffers, images, textures, samplers, subpassInputs, attributes, varyings, } = shader;
            code += '{\n';
            code += `  "name": "${name}",\n`;
            code += `  "hash": ${hash},\n`;
            if (glsl4) {
                code += `  "glsl4": ${indent(stringifySource(glsl4, 'glsl4'), 2)},\n`;
            }
            if (glsl3) {
                code += `  "glsl3": ${indent(stringifySource(glsl3, 'glsl3'), 2)},\n`;
            }
            if (glsl1) {
                code += `  "glsl1": ${indent(stringifySource(glsl1, 'glsl1'), 2)},\n`;
            }
            if (varyings) {
                code += `  "varyings": ${indent(stringifyArray(varyings), 2)},\n`;
            }
            code += '  "builtins": {\n';
            code += `    "statistics": ${stringify(builtins.statistics)},\n`;
            code += `    "globals": ${stringify(builtins.globals)},\n`;
            code += `    "locals": ${stringify(builtins.locals)}\n`;
            code += '  },\n';
            code += `  "defines": ${indent(stringifyArray(defines), 2)},\n`;
            code += `  "attributes": ${indent(stringifyArray(attributes), 2)},\n`;
            code += `  "blocks": ${indent(stringifyArray(blocks, stringifyBlock), 2)},\n`;
            code += `  "samplerTextures": ${indent(stringifyArray(samplerTextures), 2)},\n`;
            code += `  "buffers": ${indent(stringifyArray(buffers), 2)},\n`;
            code += `  "images": ${indent(stringifyArray(images), 2)},\n`;
            code += `  "textures": ${indent(stringifyArray(textures), 2)},\n`;
            code += `  "samplers": ${indent(stringifyArray(samplers), 2)},\n`;
            code += `  "subpassInputs": ${indent(stringifyArray(subpassInputs), 2)}\n`;
            code += '}';
            return code;
        };
        return (effect) => {
            if (options.essentialOnly) {
                shdcLib.stripEditorSupport(effect);
            }
            let code = '';
            code += '{\n';
            code += `  "name": "${effect.name}",\n`;
            code += effect._uuid ? `  "_uuid": "${effect._uuid}",\n` : '';
            code += `  "techniques": ${indent(stringifyArray(effect.techniques), 2)},\n`;
            if (!options.essentialOnly) {
                code += `  "dependencies": ${indent(stringifyArray(effect.dependencies), 2)},\n`;
                if (effect.editor) {
                    code += `  "editor": ${indent(stringify(effect.editor), 2)},\n`;
                }
            }
            code += `  "shaders": ${indent(stringifyArray(effect.shaders, stringifyShader), 2)}\n`;
            code += '}';
            return code;
        };
    })();
    const addEssential = (() => {
        // empty array will keep all techs
        const essentialList = {
            'pipeline/planar-shadow': { techs: [] },
            'pipeline/skybox': { techs: [] },
            'pipeline/deferred-lighting': { techs: [] },
            'pipeline/bloom': { techs: [] },
            'pipeline/post-process': { techs: [] },
            'util/profiler': { techs: [] },
            'util/splash-screen': { techs: [] },
            'builtin-standard': { techs: [0] },
            'builtin-unlit': { techs: [0] },
            'builtin-sprite': { techs: [] },
            'builtin-particle': { techs: [0] },
            'builtin-particle-gpu': { techs: [0] },
            'builtin-particle-trail': { techs: [0] },
            'builtin-billboard': { techs: [0] },
            'builtin-terrain': { techs: [0] },
            'builtin-graphics': { techs: [] },
            'builtin-clear-stencil': { techs: [] },
            'builtin-spine': { techs: [0] },
            'builtin-occlusion-query': { techs: [0] },
            'builtin-geometry-renderer': { techs: [] },
            'builtin-debug-renderer': { techs: [0] },
        };
        return (essentials, name, effect /* , path */) => {
            const info = essentialList[name];
            if (info !== undefined) {
                const partial = Object.assign({}, effect);
                if (info.techs.length) {
                    partial.techniques = info.techs.reduce((acc, cur) => (acc.push(partial.techniques[cur]), acc), []);
                    partial.shaders = partial.shaders.filter((s) => partial.techniques.some((tech) => tech.passes.some((p) => p.program === s.name)));
                }
                partial.shaders = partial.shaders.map((s) => {
                    const ns = Object.assign({}, s);
                    return ns;
                });
                partial.techniques = partial.techniques.map((t) => {
                    const nt = Object.assign({}, t);
                    nt.passes = nt.passes.map((p) => {
                        const np = Object.assign({}, p);
                        return np;
                    });
                    return nt;
                });
                essentials.push(partial);
            }
        };
    })();
    const buildEffect = (name, content) => {
        let effect = null;
        if (options.shouldThrow) {
            try {
                effect = shdcLib.buildEffect(name, content);
            }
            catch (e) {
                console.log(e);
            }
        }
        else {
            effect = shdcLib.buildEffect(name, content);
        }
        return effect;
    };
    const output = (path, content) => {
        if (options.noOutput) {
            return;
        }
        fs.ensureDirSync(ps.dirname(path));
        fs.writeFileSync(path, content, { encoding: 'utf8' });
        console.log(path + ' saved.');
    };
    // build specified files or directories
    if (options.filesOrDirs.length) {
        const getFileSystemInfo = (file) => {
            try {
                return fs.lstatSync(file);
            }
            catch (e) {
                console.error(file, 'does not exist!');
            }
            return null;
        };
        const compile = (file) => {
            const name = ps.basename(file, '.effect');
            const content = fs.readFileSync(file, { encoding: 'utf8' });
            closure.dir = ps.dirname(file);
            const effect = buildEffect(name, content);
            if (!effect) {
                return;
            }
            output(ps.join(ps.dirname(file), `${name}.ts`), '/* eslint-disable */\n' + `export const effect = ${stringifyEffect(effect)};\n`);
        };
        for (let i = 0; i < options.filesOrDirs.length; i++) {
            const file = options.filesOrDirs[i];
            const stats = getFileSystemInfo(file);
            if (!stats) {
                continue;
            }
            if (stats.isDirectory()) {
                addChunks(file);
                fsJetpack.find(file, { matching: '*.effect', recursive: false }).forEach((f) => compile(f));
            }
            else {
                addChunks(ps.dirname(file)); // this won't work if dir is something like "D:\"
                compile(file);
            }
        }
        process.exit();
    }
    const target = ps.join(options.engineRoot, 'editor/assets');
    const files = fsJetpack.find(target, { matching: '**/*.effect' });
    const debugDir = ps.join(options.engineRoot, 'bin/effects.ts');
    const essentialPath = ps.join(options.engineRoot, 'test/fixtures/builtin-effects.ts');
    const shaderPath = ps.join(options.engineRoot, 'test/fixtures/builtin-glsl4.ts');
    const all = [], essentials = [];
    for (let i = 0; i < files.length; ++i) {
        const path = ps.relative(ps.join(target, 'effects'), ps.dirname(files[i])).replace(/\\/g, '/');
        const name = path + (path.length ? '/' : '') + ps.basename(files[i], '.effect');
        const content = fs.readFileSync(files[i], { encoding: 'utf8' });
        const effect = buildEffect(name, content);
        if (!effect) {
            continue;
        }
        all.push(effect);
        addEssential(essentials, name, effect, files[i]);
    }
    output(debugDir, `\nexport const effects = ${stringifyArray(all, stringifyEffect)};\n`);
    // need to separate shader source outputs for engine module clipping to work
    options.essentialOnly = true;
    const effectShaders = essentials.map(({ shaders }) => shaders.map((shader) => {
        const s = shader['glsl4'] || null;
        delete shader['glsl4'];
        return s;
    }));
    /* eslint-disable-next-line */
    const stringifyStrippedSource = (shaders) => stringifyArray(shaders, (src) => stringifySource(src, version));
    output(shaderPath, '/* eslint-disable */\n' + `export const glsl4 = ${stringifyArray(effectShaders, stringifyStrippedSource)};\n`);
    output(essentialPath, '/* eslint-disable */\n// absolute essential effects\n' +
        `export const effects = ${stringifyArray(essentials, stringifyEffect)};\n`);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29yZS9hc3NldHMvZWZmZWN0LWNvbXBpbGVyL2J1aWxkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUViLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDL0IsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBRXhDLE1BQU0sT0FBTyxHQUFHO0lBQ1osVUFBVSxFQUFFLEVBQUU7SUFDZCxXQUFXLEVBQUUsS0FBSztJQUNsQixRQUFRLEVBQUUsS0FBSztJQUNmLFdBQVcsRUFBRSxLQUFLO0lBQ2xCLFFBQVEsRUFBRSxLQUFLO0lBQ2YsYUFBYSxFQUFFLEtBQUs7SUFDcEIsWUFBWSxFQUFFLEtBQUs7SUFDbkIsV0FBVyxFQUFFLEVBQUU7Q0FDbEIsQ0FBQztBQUNGLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQ2pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUM1QixNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVCLElBQUksR0FBRyxLQUFLLFVBQVUsSUFBSSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQ3JDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDO1NBQU0sSUFBSSxHQUFHLEtBQUssU0FBUyxFQUFFLENBQUM7UUFDM0IsT0FBTyxDQUFDLFdBQVcsR0FBRyxJQUFJ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RSxDQUNqRCxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUU7UUFDbkIsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksQ0FBQztRQUNsQyxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN2QixPQUFPLENBQUMsQ0FBQztJQUNiLENBQUMsQ0FBQyxDQUNMLENBQUM7SUFDRiw4QkFBOEI7SUFDOUIsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQzdHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsd0JBQXdCLEdBQUcsd0JBQXdCLGNBQWMsQ0FBQyxhQUFhLEVBQUUsdUJBQXVCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkksTUFBTSxDQUNGLGFBQWEsRUFDYix1REFBdUQ7UUFDdkQsMEJBQTBCLGNBQWMsQ0FBQyxVQUFVLEVBQUUsZUFBZSxDQUFDLEtBQUssQ0FDN0UsQ0FBQztBQUNOLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XHJcblxyXG5jb25zdCBwcyA9IHJlcXVpcmUoJ3BhdGgnKTtcclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcy1leHRyYScpO1xyXG5jb25zdCBmc0pldHBhY2sgPSByZXF1aXJlKCdmcy1qZXRwYWNrJyk7XHJcblxyXG5jb25zdCBvcHRpb25zID0ge1xyXG4gICAgZW5naW5lUm9vdDogJycsXHJcbiAgICBzaG91bGRUaHJvdzogZmFsc2UsXHJcbiAgICBub1NvdXJjZTogZmFsc2UsXHJcbiAgICBzdHJpcFNwYWNlczogZmFsc2UsXHJcbiAgICBub091dHB1dDogZmFsc2UsXHJcbiAgICBlc3NlbnRpYWxPbmx5OiBmYWxzZSxcclxuICAgIGtlZXBOZXdsaW5lczogZmFsc2UsXHJcbiAgICBmaWxlc09yRGlyczogW10sXHJcbn07XHJcbmNvbnN0IGFyZ2MgPSBwcm9jZXNzLmFyZ3YubGVuZ3RoO1xyXG5mb3IgKGxldCBpID0gMjsgaSA8IGFyZ2M7IGkrKykge1xyXG4gICAgY29uc3QgYXJnID0gcHJvY2Vzcy5hcmd2W2ldO1xyXG4gICAgaWYgKGFyZyA9PT0gJy0tZW5naW5lJyAmJiBpIDwgYXJnYyAtIDEpIHtcclxuICAgICAgICBvcHRpb25zLmVuZ2luZVJvb3QgPSBwcy5yZXNvbHZlKHByb2Nlc3MuYXJndlsrK2ldKTtcclxuICAgIH0gZWxzZSBpZiAoYXJnID09PSAnLS10aHJvdycpIHtcclxuICAgICAgICBvcHRpb25zLnNob3VsZFRocm93ID0gdHJ1ZTtcclxuICAgIH0gZWxzZSBpZiAoYXJnID09PSAnLS1uby1zb3VyY2UnKSB7XHJcbiAgICAgICAgb3B0aW9ucy5ub1NvdXJjZSA9IHRydWU7XHJcbiAgICB9IGVsc2UgaWYgKGFyZyA9PT0gJy0tc3RyaXAtc3BhY2VzJykge1xyXG4gICAgICAgIG9wdGlvbnMuc3RyaXBTcGFjZXMgPSB0cnVlO1xyXG4gICAgfSBlbHNlIGlmIChhcmcgPT09ICctLW5vLW91dHB1dCcpIHtcclxuICAgICAgICBvcHRpb25zLm5vT3V0cHV0ID0gdHJ1ZTtcclxuICAgIH0gZWxzZSBpZiAoYXJnID09PSAnLS1lc3NlbnRpYWwtb25seScpIHtcclxuICAgICAgICBvcHRpb25zLmVzc2VudGlhbE9ubHkgPSB0cnVlO1xyXG4gICAgfSBlbHNlIGlmIChhcmcuc3RhcnRzV2l0aCgnLS1rZWVwLW5ld2xpbmVzJykpIHtcclxuICAgICAgICBvcHRpb25zLmtlZXBOZXdsaW5lcyA9IGFyZy5sZW5ndGggPiAxNSA/IGFyZy5zdWJzdHJpbmcoMTYpIDogJyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIG9wdGlvbnMuZmlsZXNPckRpcnMucHVzaChhcmcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBjYWNoZUZpbGUgPSBwcy5qb2luKF9fZGlybmFtZSwgJ2VuZ2luZV9yb290X2NhY2hlLnR4dCcpO1xyXG5pZiAob3B0aW9ucy5lbmdpbmVSb290ICYmIGZzLmV4aXN0c1N5bmMob3B0aW9ucy5lbmdpbmVSb290KSkge1xyXG4gICAgZnMud3JpdGVGaWxlU3luYyhjYWNoZUZpbGUsIG9wdGlvbnMuZW5naW5lUm9vdCk7XHJcbn0gZWxzZSB7XHJcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhjYWNoZUZpbGUpKSB7XHJcbiAgICAgICAgb3B0aW9ucy5lbmdpbmVSb290ID0gZnMucmVhZEZpbGVTeW5jKGNhY2hlRmlsZSwgJ3V0ZjgnKTtcclxuICAgIH1cclxuICAgIGlmICghb3B0aW9ucy5lbmdpbmVSb290KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbmdpbmUgcm9vdCBpcyBub3Qgc2V0Jyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIHBvbHlmaWxsIHNvbWUgZGlydHkgZ2xvYmFsc1xyXG5PYmplY3QuYXNzaWduKGdsb2JhbCwge1xyXG4gICAgTWFuYWdlcjogeyBBc3NldEluZm86IHsgZW5naW5lOiBvcHRpb25zLmVuZ2luZVJvb3QgfSB9LFxyXG4gICAgY2M6IHt9LFxyXG4gICAgQ0NfRURJVE9SOiBmYWxzZSxcclxuICAgIENDX0RFVjogZmFsc2UsXHJcbiAgICBDQ19URVNUOiBmYWxzZSxcclxufSk7XHJcblxyXG5jb25zdCB7IGRlZmF1bHQ6IHByZWxvYWQgfSA9IHJlcXVpcmUoJ2NjL3ByZWxvYWQnKTtcclxuKGFzeW5jICgpID0+IHtcclxuICAgIGF3YWl0IHByZWxvYWQoe1xyXG4gICAgICAgIHJvb3Q6IG9wdGlvbnMuZW5naW5lUm9vdCxcclxuICAgICAgICBlZGl0b3JFeHRlbnNpb25zOiBmYWxzZSxcclxuICAgICAgICByZXF1aXJlZE1vZHVsZXM6IFsnY2MvZWRpdG9yL29mZmxpbmUtbWFwcGluZ3MnXSxcclxuICAgIH0pO1xyXG5cclxuICAgIG1haW4oKTtcclxufSkoKS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gbWFpbigpIHtcclxuICAgIGNvbnN0IHNoZGNMaWIgPSByZXF1aXJlKHBzLmpvaW4oX19kaXJuYW1lLCAnLi9pbmRleCcpKTtcclxuICAgIHNoZGNMaWIub3B0aW9ucy50aHJvd09uV2FybmluZyA9IHNoZGNMaWIub3B0aW9ucy50aHJvd09uRXJyb3IgPSBvcHRpb25zLnNob3VsZFRocm93O1xyXG4gICAgc2hkY0xpYi5vcHRpb25zLm5vU291cmNlID0gb3B0aW9ucy5ub1NvdXJjZTtcclxuICAgIHNoZGNMaWIub3B0aW9ucy5za2lwUGFyc2VyVGVzdCA9IHRydWU7XHJcbiAgICBjb25zdCBjbG9zdXJlID0geyBkaXI6ICcnIH07XHJcbiAgICBjb25zdCBjaHVua3NEaXIgPSB7IGRpcjogcHMuam9pbihvcHRpb25zLmVuZ2luZVJvb3QsICdlZGl0b3IvYXNzZXRzL2NodW5rcycpIH07XHJcbiAgICBzaGRjTGliLm9wdGlvbnMuY2h1bmtTZWFyY2hGbiA9IChuYW1lcykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlcyA9IHsgbmFtZTogdW5kZWZpbmVkLCBjb250ZW50OiB1bmRlZmluZWQgfTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIC8vIHVzZXIgaW5wdXQgcGF0aCBmaXJzdFxyXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gbmFtZXNbaV07XHJcbiAgICAgICAgICAgIGxldCBmaWxlID0gcHMucmVzb2x2ZShjbG9zdXJlLmRpciwgbmFtZSArICcuY2h1bmsnKTtcclxuICAgICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGZpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICBmaWxlID0gcHMucmVzb2x2ZShjaHVua3NEaXIuZGlyLCBuYW1lICsgJy5jaHVuaycpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGZpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgICAgICByZXMuY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlcztcclxuICAgIH07XHJcbiAgICBjb25zdCBhZGRDaHVua3MgPSAoZGlyKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZmlsZXMgPSBmc0pldHBhY2suZmluZChkaXIsIHsgbWF0Y2hpbmc6ICcqLmNodW5rJywgcmVjdXJzaXZlOiBmYWxzZSB9KTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBwcy5iYXNlbmFtZShmaWxlc1tpXSwgJy5jaHVuaycpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVzW2ldLCB7IGVuY29kaW5nOiAndXRmOCcgfSk7XHJcbiAgICAgICAgICAgIHNoZGNMaWIuYWRkQ2h1bmsobmFtZSwgY29udGVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGFkZENodW5rcyhwcy5qb2luKG9wdGlvbnMuZW5naW5lUm9vdCwgJ2VkaXRvci9hc3NldHMvY2h1bmtzJykpO1xyXG5cclxuICAgIGNvbnN0IGluZGVudCA9IChzdHIsIG51bSkgPT4gc3RyLnJlcGxhY2UoL1xcbi9nLCAnXFxuJyArICcgJy5yZXBlYXQobnVtKSk7XHJcbiAgICBjb25zdCBzdHJpbmdpZnkgPSAobykgPT4ge1xyXG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShvKVxyXG4gICAgICAgICAgICAucmVwbGFjZSgvKFsse118XCI6KS9nLCAnJDEgJylcclxuICAgICAgICAgICAgLnJlcGxhY2UoLyhbfV0pL2csICcgJDEnKTtcclxuICAgIH07XHJcbiAgICBjb25zdCBzdHJpbmdpZnlBcnJheSA9IChhcnIsIHN0cmluZ2lmeU9iaiA9IHN0cmluZ2lmeSkgPT4ge1xyXG4gICAgICAgIGxldCBjb2RlID0gJyc7XHJcbiAgICAgICAgaWYgKCFhcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnW10nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGNvbnN0IG9iaiBvZiBhcnIpIHtcclxuICAgICAgICAgICAgY29kZSArPSBgICAke2luZGVudChzdHJpbmdpZnlPYmoob2JqKSwgMil9LFxcbmA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBgW1xcbiR7Y29kZS5zbGljZSgwLCAtMil9XFxuXWA7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHN0cmluZ2lmeVNvdXJjZSA9ICgoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW5kZW50UkUgPSAvXFxzKj9cXG5cXHMqL2c7XHJcbiAgICAgICAgY29uc3Qgc3BhY2VzUkUgPSAvW1xcc1xcbl0rL2csXHJcbiAgICAgICAgICAgIGlkZW50aWZpZXJSRSA9IC9cXHcvO1xyXG4gICAgICAgIGNvbnN0IHJlcGxhY2VyID0gKFxyXG4gICAgICAgICAgICBtLFxyXG4gICAgICAgICAgICBvZnMsXHJcbiAgICAgICAgICAgIHN0ciwgLy8gcmVwbGFjZSB0aG9zZSBmb2xsb3dpbmcgb3IgZm9sbG93ZWQgYnkgYSBub24taWRlbnRpZmllclxyXG4gICAgICAgICkgPT4gKCFvZnMgfHwgIWlkZW50aWZpZXJSRS50ZXN0KHN0cltvZnMgLSAxXSkgfHwgIWlkZW50aWZpZXJSRS50ZXN0KHN0cltvZnMgKyBtLmxlbmd0aF0pID8gJycgOiAnICcpO1xyXG4gICAgICAgIGNvbnN0IHN0cmluZ2lmeUNvZGUgPSAoc3JjLCBwYXRoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnN0cmlwU3BhY2VzKSB7XHJcbiAgICAgICAgICAgICAgICBzcmMgPSBzcmMucmVwbGFjZShzcGFjZXNSRSwgcmVwbGFjZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmVzc2VudGlhbE9ubHkpIHtcclxuICAgICAgICAgICAgICAgIHNyYyA9IHNyYy5yZXBsYWNlKGluZGVudFJFLCAnXFxuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHBhdGguaW5jbHVkZXMob3B0aW9ucy5rZWVwTmV3bGluZXMpID8gYFxcYCR7c3JjfVxcYGAgOiBgXCIke3NyYy5yZXBsYWNlKC9cXG4vZywgJ1xcXFxuJyl9XCJgO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIChzcmMsIHBhdGgpID0+IHtcclxuICAgICAgICAgICAgbGV0IGNvZGUgPSAne1xcbic7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gYCAgXCJ2ZXJ0XCI6ICR7aW5kZW50KHN0cmluZ2lmeUNvZGUoc3JjLnZlcnQsIHBhdGggKyAnLnZlcnQnKSwgNCl9LFxcbmA7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gYCAgXCJmcmFnXCI6ICR7aW5kZW50KHN0cmluZ2lmeUNvZGUoc3JjLmZyYWcsIHBhdGggKyAnLmZyYWcnKSwgNCl9LFxcbmA7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gJ30nO1xyXG4gICAgICAgICAgICByZXR1cm4gY29kZTtcclxuICAgICAgICB9O1xyXG4gICAgfSkoKTtcclxuXHJcbiAgICBjb25zdCBzdHJpbmdpZnlFZmZlY3QgPSAoKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHN0cmluZ2lmeUJsb2NrID0gKHUpID0+XHJcbiAgICAgICAgICAgIGB7XCJuYW1lXCI6IFwiJHt1Lm5hbWV9XCIsIFwiZGVmaW5lc1wiOiAke3N0cmluZ2lmeSh1LmRlZmluZXMpfSwgXCJiaW5kaW5nXCI6ICR7dS5iaW5kaW5nfSwgYCArXHJcbiAgICAgICAgICAgICh1LmRlc2NyaXB0b3JUeXBlID8gJ1wiZGVzY3JpcHRvclR5cGVcIjogJyArIHUuZGVzY3JpcHRvclR5cGUgKyAnLCAnIDogJycpICtcclxuICAgICAgICAgICAgYFwic3RhZ2VGbGFnc1wiOiAke3Uuc3RhZ2VGbGFnc30sIFwibWVtYmVyc1wiOiAke3N0cmluZ2lmeUFycmF5KHUubWVtYmVycyl9fWA7XHJcbiAgICAgICAgY29uc3Qgc3RyaW5naWZ5U2hhZGVyID0gKHNoYWRlcikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgY29kZSA9ICcnO1xyXG4gICAgICAgICAgICBjb25zdCB7XHJcbiAgICAgICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICAgICAgaGFzaCxcclxuICAgICAgICAgICAgICAgIGdsc2w0LFxyXG4gICAgICAgICAgICAgICAgZ2xzbDMsXHJcbiAgICAgICAgICAgICAgICBnbHNsMSxcclxuICAgICAgICAgICAgICAgIGJ1aWx0aW5zLFxyXG4gICAgICAgICAgICAgICAgZGVmaW5lcyxcclxuICAgICAgICAgICAgICAgIGJsb2NrcyxcclxuICAgICAgICAgICAgICAgIHNhbXBsZXJUZXh0dXJlcyxcclxuICAgICAgICAgICAgICAgIGJ1ZmZlcnMsXHJcbiAgICAgICAgICAgICAgICBpbWFnZXMsXHJcbiAgICAgICAgICAgICAgICB0ZXh0dXJlcyxcclxuICAgICAgICAgICAgICAgIHNhbXBsZXJzLFxyXG4gICAgICAgICAgICAgICAgc3VicGFzc0lucHV0cyxcclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMsXHJcbiAgICAgICAgICAgICAgICB2YXJ5aW5ncyxcclxuICAgICAgICAgICAgfSA9IHNoYWRlcjtcclxuXHJcbiAgICAgICAgICAgIGNvZGUgKz0gJ3tcXG4nO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwibmFtZVwiOiBcIiR7bmFtZX1cIixcXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwiaGFzaFwiOiAke2hhc2h9LFxcbmA7XHJcbiAgICAgICAgICAgIGlmIChnbHNsNCkge1xyXG4gICAgICAgICAgICAgICAgY29kZSArPSBgICBcImdsc2w0XCI6ICR7aW5kZW50KHN0cmluZ2lmeVNvdXJjZShnbHNsNCwgJ2dsc2w0JyksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChnbHNsMykge1xyXG4gICAgICAgICAgICAgICAgY29kZSArPSBgICBcImdsc2wzXCI6ICR7aW5kZW50KHN0cmluZ2lmeVNvdXJjZShnbHNsMywgJ2dsc2wzJyksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChnbHNsMSkge1xyXG4gICAgICAgICAgICAgICAgY29kZSArPSBgICBcImdsc2wxXCI6ICR7aW5kZW50KHN0cmluZ2lmeVNvdXJjZShnbHNsMSwgJ2dsc2wxJyksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh2YXJ5aW5ncykge1xyXG4gICAgICAgICAgICAgICAgY29kZSArPSBgICBcInZhcnlpbmdzXCI6ICR7aW5kZW50KHN0cmluZ2lmeUFycmF5KHZhcnlpbmdzKSwgMil9LFxcbmA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29kZSArPSAnICBcImJ1aWx0aW5zXCI6IHtcXG4nO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgICAgXCJzdGF0aXN0aWNzXCI6ICR7c3RyaW5naWZ5KGJ1aWx0aW5zLnN0YXRpc3RpY3MpfSxcXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgICAgXCJnbG9iYWxzXCI6ICR7c3RyaW5naWZ5KGJ1aWx0aW5zLmdsb2JhbHMpfSxcXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgICAgXCJsb2NhbHNcIjogJHtzdHJpbmdpZnkoYnVpbHRpbnMubG9jYWxzKX1cXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9ICcgIH0sXFxuJztcclxuICAgICAgICAgICAgY29kZSArPSBgICBcImRlZmluZXNcIjogJHtpbmRlbnQoc3RyaW5naWZ5QXJyYXkoZGVmaW5lcyksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwiYXR0cmlidXRlc1wiOiAke2luZGVudChzdHJpbmdpZnlBcnJheShhdHRyaWJ1dGVzKSwgMil9LFxcbmA7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gYCAgXCJibG9ja3NcIjogJHtpbmRlbnQoc3RyaW5naWZ5QXJyYXkoYmxvY2tzLCBzdHJpbmdpZnlCbG9jayksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwic2FtcGxlclRleHR1cmVzXCI6ICR7aW5kZW50KHN0cmluZ2lmeUFycmF5KHNhbXBsZXJUZXh0dXJlcyksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwiYnVmZmVyc1wiOiAke2luZGVudChzdHJpbmdpZnlBcnJheShidWZmZXJzKSwgMil9LFxcbmA7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gYCAgXCJpbWFnZXNcIjogJHtpbmRlbnQoc3RyaW5naWZ5QXJyYXkoaW1hZ2VzKSwgMil9LFxcbmA7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gYCAgXCJ0ZXh0dXJlc1wiOiAke2luZGVudChzdHJpbmdpZnlBcnJheSh0ZXh0dXJlcyksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwic2FtcGxlcnNcIjogJHtpbmRlbnQoc3RyaW5naWZ5QXJyYXkoc2FtcGxlcnMpLCAyKX0sXFxuYDtcclxuICAgICAgICAgICAgY29kZSArPSBgICBcInN1YnBhc3NJbnB1dHNcIjogJHtpbmRlbnQoc3RyaW5naWZ5QXJyYXkoc3VicGFzc0lucHV0cyksIDIpfVxcbmA7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gJ30nO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNvZGU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gKGVmZmVjdCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAob3B0aW9ucy5lc3NlbnRpYWxPbmx5KSB7XHJcbiAgICAgICAgICAgICAgICBzaGRjTGliLnN0cmlwRWRpdG9yU3VwcG9ydChlZmZlY3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBjb2RlID0gJyc7XHJcbiAgICAgICAgICAgIGNvZGUgKz0gJ3tcXG4nO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwibmFtZVwiOiBcIiR7ZWZmZWN0Lm5hbWV9XCIsXFxuYDtcclxuICAgICAgICAgICAgY29kZSArPSBlZmZlY3QuX3V1aWQgPyBgICBcIl91dWlkXCI6IFwiJHtlZmZlY3QuX3V1aWR9XCIsXFxuYCA6ICcnO1xyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwidGVjaG5pcXVlc1wiOiAke2luZGVudChzdHJpbmdpZnlBcnJheShlZmZlY3QudGVjaG5pcXVlcyksIDIpfSxcXG5gO1xyXG4gICAgICAgICAgICBpZiAoIW9wdGlvbnMuZXNzZW50aWFsT25seSkge1xyXG4gICAgICAgICAgICAgICAgY29kZSArPSBgICBcImRlcGVuZGVuY2llc1wiOiAke2luZGVudChzdHJpbmdpZnlBcnJheShlZmZlY3QuZGVwZW5kZW5jaWVzKSwgMil9LFxcbmA7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWZmZWN0LmVkaXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvZGUgKz0gYCAgXCJlZGl0b3JcIjogJHtpbmRlbnQoc3RyaW5naWZ5KGVmZmVjdC5lZGl0b3IpLCAyKX0sXFxuYDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb2RlICs9IGAgIFwic2hhZGVyc1wiOiAke2luZGVudChzdHJpbmdpZnlBcnJheShlZmZlY3Quc2hhZGVycywgc3RyaW5naWZ5U2hhZGVyKSwgMil9XFxuYDtcclxuICAgICAgICAgICAgY29kZSArPSAnfSc7XHJcbiAgICAgICAgICAgIHJldHVybiBjb2RlO1xyXG4gICAgICAgIH07XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGNvbnN0IGFkZEVzc2VudGlhbCA9ICgoKSA9PiB7XHJcbiAgICAgICAgLy8gZW1wdHkgYXJyYXkgd2lsbCBrZWVwIGFsbCB0ZWNoc1xyXG4gICAgICAgIGNvbnN0IGVzc2VudGlhbExpc3QgPSB7XHJcbiAgICAgICAgICAgICdwaXBlbGluZS9wbGFuYXItc2hhZG93JzogeyB0ZWNoczogW10gfSxcclxuICAgICAgICAgICAgJ3BpcGVsaW5lL3NreWJveCc6IHsgdGVjaHM6IFtdIH0sXHJcbiAgICAgICAgICAgICdwaXBlbGluZS9kZWZlcnJlZC1saWdodGluZyc6IHsgdGVjaHM6IFtdIH0sXHJcbiAgICAgICAgICAgICdwaXBlbGluZS9ibG9vbSc6IHsgdGVjaHM6IFtdIH0sXHJcbiAgICAgICAgICAgICdwaXBlbGluZS9wb3N0LXByb2Nlc3MnOiB7IHRlY2hzOiBbXSB9LFxyXG4gICAgICAgICAgICAndXRpbC9wcm9maWxlcic6IHsgdGVjaHM6IFtdIH0sXHJcbiAgICAgICAgICAgICd1dGlsL3NwbGFzaC1zY3JlZW4nOiB7IHRlY2hzOiBbXSB9LFxyXG4gICAgICAgICAgICAnYnVpbHRpbi1zdGFuZGFyZCc6IHsgdGVjaHM6IFswXSB9LFxyXG4gICAgICAgICAgICAnYnVpbHRpbi11bmxpdCc6IHsgdGVjaHM6IFswXSB9LFxyXG4gICAgICAgICAgICAnYnVpbHRpbi1zcHJpdGUnOiB7IHRlY2hzOiBbXSB9LFxyXG4gICAgICAgICAgICAnYnVpbHRpbi1wYXJ0aWNsZSc6IHsgdGVjaHM6IFswXSB9LFxyXG4gICAgICAgICAgICAnYnVpbHRpbi1wYXJ0aWNsZS1ncHUnOiB7IHRlY2hzOiBbMF0gfSxcclxuICAgICAgICAgICAgJ2J1aWx0aW4tcGFydGljbGUtdHJhaWwnOiB7IHRlY2hzOiBbMF0gfSxcclxuICAgICAgICAgICAgJ2J1aWx0aW4tYmlsbGJvYXJkJzogeyB0ZWNoczogWzBdIH0sXHJcbiAgICAgICAgICAgICdidWlsdGluLXRlcnJhaW4nOiB7IHRlY2hzOiBbMF0gfSxcclxuICAgICAgICAgICAgJ2J1aWx0aW4tZ3JhcGhpY3MnOiB7IHRlY2hzOiBbXSB9LFxyXG4gICAgICAgICAgICAnYnVpbHRpbi1jbGVhci1zdGVuY2lsJzogeyB0ZWNoczogW10gfSxcclxuICAgICAgICAgICAgJ2J1aWx0aW4tc3BpbmUnOiB7IHRlY2hzOiBbMF0gfSxcclxuICAgICAgICAgICAgJ2J1aWx0aW4tb2NjbHVzaW9uLXF1ZXJ5JzogeyB0ZWNoczogWzBdIH0sXHJcbiAgICAgICAgICAgICdidWlsdGluLWdlb21ldHJ5LXJlbmRlcmVyJzogeyB0ZWNoczogW10gfSxcclxuICAgICAgICAgICAgJ2J1aWx0aW4tZGVidWctcmVuZGVyZXInOiB7IHRlY2hzOiBbMF0gfSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiAoZXNzZW50aWFscywgbmFtZSwgZWZmZWN0IC8qICwgcGF0aCAqLykgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBpbmZvID0gZXNzZW50aWFsTGlzdFtuYW1lXTtcclxuICAgICAgICAgICAgaWYgKGluZm8gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFydGlhbCA9IE9iamVjdC5hc3NpZ24oe30sIGVmZmVjdCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5mby50ZWNocy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0aWFsLnRlY2huaXF1ZXMgPSBpbmZvLnRlY2hzLnJlZHVjZSgoYWNjLCBjdXIpID0+IChhY2MucHVzaChwYXJ0aWFsLnRlY2huaXF1ZXNbY3VyXSksIGFjYyksIFtdKTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0aWFsLnNoYWRlcnMgPSBwYXJ0aWFsLnNoYWRlcnMuZmlsdGVyKChzKSA9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWFsLnRlY2huaXF1ZXMuc29tZSgodGVjaCkgPT4gdGVjaC5wYXNzZXMuc29tZSgocCkgPT4gcC5wcm9ncmFtID09PSBzLm5hbWUpKSxcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcGFydGlhbC5zaGFkZXJzID0gcGFydGlhbC5zaGFkZXJzLm1hcCgocykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5zID0gT2JqZWN0LmFzc2lnbih7fSwgcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5zO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWFsLnRlY2huaXF1ZXMgPSBwYXJ0aWFsLnRlY2huaXF1ZXMubWFwKCh0KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbnQgPSBPYmplY3QuYXNzaWduKHt9LCB0KTtcclxuICAgICAgICAgICAgICAgICAgICBudC5wYXNzZXMgPSBudC5wYXNzZXMubWFwKChwKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5wID0gT2JqZWN0LmFzc2lnbih7fSwgcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBucDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnQ7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGVzc2VudGlhbHMucHVzaChwYXJ0aWFsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KSgpO1xyXG5cclxuICAgIGNvbnN0IGJ1aWxkRWZmZWN0ID0gKG5hbWUsIGNvbnRlbnQpID0+IHtcclxuICAgICAgICBsZXQgZWZmZWN0ID0gbnVsbDtcclxuICAgICAgICBpZiAob3B0aW9ucy5zaG91bGRUaHJvdykge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgZWZmZWN0ID0gc2hkY0xpYi5idWlsZEVmZmVjdChuYW1lLCBjb250ZW50KTtcclxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBlZmZlY3QgPSBzaGRjTGliLmJ1aWxkRWZmZWN0KG5hbWUsIGNvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZWZmZWN0O1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBvdXRwdXQgPSAocGF0aCwgY29udGVudCkgPT4ge1xyXG4gICAgICAgIGlmIChvcHRpb25zLm5vT3V0cHV0KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnMuZW5zdXJlRGlyU3luYyhwcy5kaXJuYW1lKHBhdGgpKTtcclxuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHBhdGgsIGNvbnRlbnQsIHsgZW5jb2Rpbmc6ICd1dGY4JyB9KTtcclxuICAgICAgICBjb25zb2xlLmxvZyhwYXRoICsgJyBzYXZlZC4nKTtcclxuICAgIH07XHJcblxyXG4gICAgLy8gYnVpbGQgc3BlY2lmaWVkIGZpbGVzIG9yIGRpcmVjdG9yaWVzXHJcbiAgICBpZiAob3B0aW9ucy5maWxlc09yRGlycy5sZW5ndGgpIHtcclxuICAgICAgICBjb25zdCBnZXRGaWxlU3lzdGVtSW5mbyA9IChmaWxlKSA9PiB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZnMubHN0YXRTeW5jKGZpbGUpO1xyXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGZpbGUsICdkb2VzIG5vdCBleGlzdCEnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnN0IGNvbXBpbGUgPSAoZmlsZSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBuYW1lID0gcHMuYmFzZW5hbWUoZmlsZSwgJy5lZmZlY3QnKTtcclxuICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlLCB7IGVuY29kaW5nOiAndXRmOCcgfSk7XHJcbiAgICAgICAgICAgIGNsb3N1cmUuZGlyID0gcHMuZGlybmFtZShmaWxlKTtcclxuICAgICAgICAgICAgY29uc3QgZWZmZWN0ID0gYnVpbGRFZmZlY3QobmFtZSwgY29udGVudCk7XHJcbiAgICAgICAgICAgIGlmICghZWZmZWN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3V0cHV0KFxyXG4gICAgICAgICAgICAgICAgcHMuam9pbihwcy5kaXJuYW1lKGZpbGUpLCBgJHtuYW1lfS50c2ApLFxyXG4gICAgICAgICAgICAgICAgJy8qIGVzbGludC1kaXNhYmxlICovXFxuJyArIGBleHBvcnQgY29uc3QgZWZmZWN0ID0gJHtzdHJpbmdpZnlFZmZlY3QoZWZmZWN0KX07XFxuYCxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3B0aW9ucy5maWxlc09yRGlycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBmaWxlID0gb3B0aW9ucy5maWxlc09yRGlyc1tpXTtcclxuICAgICAgICAgICAgY29uc3Qgc3RhdHMgPSBnZXRGaWxlU3lzdGVtSW5mbyhmaWxlKTtcclxuICAgICAgICAgICAgaWYgKCFzdGF0cykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHN0YXRzLmlzRGlyZWN0b3J5KCkpIHtcclxuICAgICAgICAgICAgICAgIGFkZENodW5rcyhmaWxlKTtcclxuICAgICAgICAgICAgICAgIGZzSmV0cGFjay5maW5kKGZpbGUsIHsgbWF0Y2hpbmc6ICcqLmVmZmVjdCcsIHJlY3Vyc2l2ZTogZmFsc2UgfSkuZm9yRWFjaCgoZikgPT4gY29tcGlsZShmKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhZGRDaHVua3MocHMuZGlybmFtZShmaWxlKSk7IC8vIHRoaXMgd29uJ3Qgd29yayBpZiBkaXIgaXMgc29tZXRoaW5nIGxpa2UgXCJEOlxcXCJcclxuICAgICAgICAgICAgICAgIGNvbXBpbGUoZmlsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvY2Vzcy5leGl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGFyZ2V0ID0gcHMuam9pbihvcHRpb25zLmVuZ2luZVJvb3QsICdlZGl0b3IvYXNzZXRzJyk7XHJcbiAgICBjb25zdCBmaWxlcyA9IGZzSmV0cGFjay5maW5kKHRhcmdldCwgeyBtYXRjaGluZzogJyoqLyouZWZmZWN0JyB9KTtcclxuICAgIGNvbnN0IGRlYnVnRGlyID0gcHMuam9pbihvcHRpb25zLmVuZ2luZVJvb3QsICdiaW4vZWZmZWN0cy50cycpO1xyXG4gICAgY29uc3QgZXNzZW50aWFsUGF0aCA9IHBzLmpvaW4ob3B0aW9ucy5lbmdpbmVSb290LCAndGVzdC9maXh0dXJlcy9idWlsdGluLWVmZmVjdHMudHMnKTtcclxuICAgIGNvbnN0IHNoYWRlclBhdGggPSBwcy5qb2luKG9wdGlvbnMuZW5naW5lUm9vdCwgJ3Rlc3QvZml4dHVyZXMvYnVpbHRpbi1nbHNsNC50cycpO1xyXG5cclxuICAgIGNvbnN0IGFsbCA9IFtdLFxyXG4gICAgICAgIGVzc2VudGlhbHMgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICBjb25zdCBwYXRoID0gcHMucmVsYXRpdmUocHMuam9pbih0YXJnZXQsICdlZmZlY3RzJyksIHBzLmRpcm5hbWUoZmlsZXNbaV0pKS5yZXBsYWNlKC9cXFxcL2csICcvJyk7XHJcbiAgICAgICAgY29uc3QgbmFtZSA9IHBhdGggKyAocGF0aC5sZW5ndGggPyAnLycgOiAnJykgKyBwcy5iYXNlbmFtZShmaWxlc1tpXSwgJy5lZmZlY3QnKTtcclxuICAgICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVzW2ldLCB7IGVuY29kaW5nOiAndXRmOCcgfSk7XHJcbiAgICAgICAgY29uc3QgZWZmZWN0ID0gYnVpbGRFZmZlY3QobmFtZSwgY29udGVudCk7XHJcbiAgICAgICAgaWYgKCFlZmZlY3QpIHtcclxuICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFsbC5wdXNoKGVmZmVjdCk7XHJcbiAgICAgICAgYWRkRXNzZW50aWFsKGVzc2VudGlhbHMsIG5hbWUsIGVmZmVjdCwgZmlsZXNbaV0pO1xyXG4gICAgfVxyXG5cclxuICAgIG91dHB1dChkZWJ1Z0RpciwgYFxcbmV4cG9ydCBjb25zdCBlZmZlY3RzID0gJHtzdHJpbmdpZnlBcnJheShhbGwsIHN0cmluZ2lmeUVmZmVjdCl9O1xcbmApO1xyXG5cclxuICAgIC8vIG5lZWQgdG8gc2VwYXJhdGUgc2hhZGVyIHNvdXJjZSBvdXRwdXRzIGZvciBlbmdpbmUgbW9kdWxlIGNsaXBwaW5nIHRvIHdvcmtcclxuICAgIG9wdGlvbnMuZXNzZW50aWFsT25seSA9IHRydWU7XHJcbiAgICBjb25zdCBlZmZlY3RTaGFkZXJzID0gZXNzZW50aWFscy5tYXAoKHsgc2hhZGVycyB9KSA9PlxyXG4gICAgICAgIHNoYWRlcnMubWFwKChzaGFkZXIpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcyA9IHNoYWRlclsnZ2xzbDQnXSB8fCBudWxsO1xyXG4gICAgICAgICAgICBkZWxldGUgc2hhZGVyWydnbHNsNCddO1xyXG4gICAgICAgICAgICByZXR1cm4gcztcclxuICAgICAgICB9KSxcclxuICAgICk7XHJcbiAgICAvKiBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgKi9cclxuICAgIGNvbnN0IHN0cmluZ2lmeVN0cmlwcGVkU291cmNlID0gKHNoYWRlcnMpID0+IHN0cmluZ2lmeUFycmF5KHNoYWRlcnMsIChzcmMpID0+IHN0cmluZ2lmeVNvdXJjZShzcmMsIHZlcnNpb24pKTtcclxuICAgIG91dHB1dChzaGFkZXJQYXRoLCAnLyogZXNsaW50LWRpc2FibGUgKi9cXG4nICsgYGV4cG9ydCBjb25zdCBnbHNsNCA9ICR7c3RyaW5naWZ5QXJyYXkoZWZmZWN0U2hhZGVycywgc3RyaW5naWZ5U3RyaXBwZWRTb3VyY2UpfTtcXG5gKTtcclxuICAgIG91dHB1dChcclxuICAgICAgICBlc3NlbnRpYWxQYXRoLFxyXG4gICAgICAgICcvKiBlc2xpbnQtZGlzYWJsZSAqL1xcbi8vIGFic29sdXRlIGVzc2VudGlhbCBlZmZlY3RzXFxuJyArXHJcbiAgICAgICAgYGV4cG9ydCBjb25zdCBlZmZlY3RzID0gJHtzdHJpbmdpZnlBcnJheShlc3NlbnRpYWxzLCBzdHJpbmdpZnlFZmZlY3QpfTtcXG5gLFxyXG4gICAgKTtcclxufVxyXG4iXX0=