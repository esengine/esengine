'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.checkPackageNameValidity = checkPackageNameValidity;
exports.checkIsEmpty = checkIsEmpty;
exports.checkAndroidAPILevels = checkAndroidAPILevels;
exports.generateAndroidOptions = generateAndroidOptions;
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const os_1 = require("os");
/**
 * 检查 android 包名的合法性
 * @param packageName
 */
function checkPackageNameValidity(packageName) {
    // refer: https://developer.android.com/studio/build/application-id.html
    return /^[a-zA-Z]\w*(\.[a-zA-Z]\w*)+$/.test(packageName);
}
/**
 * 检查是否为空
 */
function checkIsEmpty(value) {
    if (value === null || value === undefined || value === '') {
        return true;
    }
    return false;
}
/**
 * 检查 API Level 要求，最低 18，开启延迟渲染管线后最低要求 21，开启 Instance APP 后最低 23
 * @param value
 * @param options
 * @returns
 */
async function checkAndroidAPILevels(value, options) {
    const res = {
        newValue: value,
        error: '',
        level: 'error',
    };
    if (checkIsEmpty(value)) {
        res.error = 'API Level cannot be empty';
    }
    if (isNaN(value)) {
        res.error = 'API Level must be a number';
        return res;
    }
    const APIVersion = value;
    if (options.packages.android.androidInstant && APIVersion < 23) {
        res.error = 'When Android Instant App is enabled, the minimum API Level required is 23.';
        res.newValue = 23;
        return res;
    }
    if (options.packages.native?.JobSystem === 'tbb' && APIVersion < 21) {
        res.error = 'When TBB is enabled, the minimum API Level required is 21.';
        res.newValue = 21;
        return res;
    }
    // const renderPipeline = await Editor.Profile.getProject('project', 'general.renderPipeline');
    const renderPipeline = options.renderPipeline;
    // 延迟渲染管线
    if (renderPipeline === '5d45ba66-829a-46d3-948e-2ed3fa7ee421' && APIVersion < 21) {
        res.error = 'When Deferred Render Pipeline is enabled, the minimum API Level required is 21.';
        res.newValue = 21;
        return res;
    }
    if (APIVersion < 19) {
        res.error = 'The minimum API Level required is 19.';
        res.newValue = 19;
        return res;
    }
    return res;
}
/**
 * 生成 Android 选项，包括 SDK、NDK、Java 路径等
 */
async function generateAndroidOptions(options) {
    const android = options.packages.android;
    android.orientation = android.orientation || {
        landscapeRight: true,
        landscapeLeft: true,
        portrait: false,
        upsideDown: false,
    };
    // 查询 Android SDK、NDK、Java Home 路径
    // 注意：这里需要根据实际的 Editor.Message API 来获取，在 CLI 环境中可能需要不同的方式
    // const androidSDKInfo = await Editor.Message.request('program', 'query-program-info', 'androidSDK');
    // const androidNDKInfo = await Editor.Message.request('program', 'query-program-info', 'androidNDK');
    // const javaHome = await Editor.Message.request('program', 'query-program-info', 'javaHome');
    // 临时处理：如果路径未设置，尝试从环境变量获取
    if (!android.sdkPath) {
        android.sdkPath = process.env.ANDROID_HOME || process.env.ANDROID_SDK_ROOT || '';
        // 尝试默认路径 (Windows)
        if (!android.sdkPath && process.platform === 'win32') {
            const localAppData = process.env.LOCALAPPDATA;
            if (localAppData) {
                const defaultSdkPath = (0, path_1.join)(localAppData, 'Android', 'Sdk');
                if ((0, fs_extra_1.existsSync)(defaultSdkPath)) {
                    android.sdkPath = defaultSdkPath;
                    console.log(`[Android] Auto-detected SDK at: ${android.sdkPath}`);
                }
            }
        }
        // 尝试默认路径 (Mac)
        if (!android.sdkPath && process.platform === 'darwin') {
            const home = process.env.HOME;
            if (home) {
                const defaultSdkPath = (0, path_1.join)(home, 'Library', 'Android', 'sdk');
                if ((0, fs_extra_1.existsSync)(defaultSdkPath)) {
                    android.sdkPath = defaultSdkPath;
                    console.log(`[Android] Auto-detected SDK at: ${android.sdkPath}`);
                }
            }
        }
    }
    if (android.sdkPath && !process.env.ANDROID_HOME) {
        console.log(`[Android] Using SDK at: ${android.sdkPath}`);
    }
    if (!android.ndkPath) {
        android.ndkPath = process.env.ANDROID_NDK_HOME || process.env.NDK_ROOT || '';
        // 如果有了 SDK 路径但没有 NDK 路径，尝试在 SDK/ndk 下查找
        if (!android.ndkPath && android.sdkPath) {
            const ndkBase = (0, path_1.join)(android.sdkPath, 'ndk');
            if ((0, fs_extra_1.existsSync)(ndkBase)) {
                const dirs = (0, fs_extra_1.readdirSync)(ndkBase);
                if (dirs.length > 0) {
                    // 优先选择版本 28，其次 23，最后是其他版本
                    const priorityVersions = ['28', '23'];
                    let selectedVersion;
                    // 先按优先级搜索
                    for (const priorityVersion of priorityVersions) {
                        const versionDir = dirs.find(dir => {
                            const dirPath = (0, path_1.join)(ndkBase, dir);
                            return (0, fs_extra_1.statSync)(dirPath).isDirectory() && dir.startsWith(priorityVersion + '.');
                        });
                        if (versionDir) {
                            selectedVersion = versionDir;
                            console.log(`[Android] Found NDK version ${priorityVersion} at: ${(0, path_1.join)(ndkBase, selectedVersion)}`);
                            break;
                        }
                    }
                    // 如果优先级版本都没找到，选择其他版本（排序获取最新的）
                    if (!selectedVersion) {
                        const otherVersionDirs = dirs.filter(dir => {
                            const dirPath = (0, path_1.join)(ndkBase, dir);
                            return (0, fs_extra_1.statSync)(dirPath).isDirectory()
                                && !priorityVersions.some(pv => dir.startsWith(pv + '.'))
                                && /^\d+\./.test(dir); // 版本号格式：数字.xxx
                        });
                        if (otherVersionDirs.length > 0) {
                            otherVersionDirs.sort();
                            selectedVersion = otherVersionDirs[otherVersionDirs.length - 1];
                            console.log(`[Android] Found NDK version ${selectedVersion} at: ${(0, path_1.join)(ndkBase, selectedVersion)}`);
                        }
                    }
                    if (selectedVersion) {
                        android.ndkPath = (0, path_1.join)(ndkBase, selectedVersion);
                        console.log(`[Android] Auto-detected NDK at: ${android.ndkPath}`);
                    }
                }
            }
        }
    }
    if (android.ndkPath && !process.env.ANDROID_NDK_HOME) {
        console.log(`[Android] Using NDK at: ${android.ndkPath}`);
    }
    android.sdkPath = android.sdkPath || '';
    android.ndkPath = android.ndkPath || '';
    android.javaHome = android.javaHome || process.env.JAVA_HOME || '';
    android.javaPath = '';
    if (android.javaHome) {
        try {
            const st = (0, fs_extra_1.statSync)(android.javaHome);
            if (st.isFile()) {
                android.javaPath = android.javaHome;
                android.javaHome = (0, path_1.normalize)((0, path_1.join)((0, path_1.dirname)(android.javaPath), '..'));
            }
            else if (st.isDirectory()) {
                const javaFileName = (0, os_1.platform)() === 'win32' ? 'java.exe' : 'java';
                const pathToJava = (0, path_1.join)(android.javaHome, 'bin', javaFileName);
                if (!(0, fs_extra_1.existsSync)(pathToJava)) {
                    console.error(`Java executable not found at ${android.javaHome}/bin`);
                }
                else {
                    android.javaPath = pathToJava;
                }
            }
        }
        catch (e) {
            console.error(e);
        }
    }
    if (android.keystorePath) {
        // 在 CLI 环境中，路径处理可能需要调整
        // android.keystorePath = Editor.UI.__protected__.File.resolveToRaw(android.keystorePath);
    }
    return android;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY29yZS9idWlsZGVyL3BsYXRmb3Jtcy9hbmRyb2lkL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFZYiw0REFHQztBQUtELG9DQUtDO0FBUUQsc0RBdUNDO0FBS0Qsd0RBc0lDO0FBak5ELHVDQUE2RDtBQUM3RCwrQkFBZ0Q7QUFDaEQsMkJBQThCO0FBSTlCOzs7R0FHRztBQUNILFNBQWdCLHdCQUF3QixDQUFDLFdBQW1CO0lBQ3hELHdFQUF3RTtJQUN4RSxPQUFPLCtCQUErQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUM3RCxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixZQUFZLENBQUMsS0FBVTtJQUNuQyxJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssRUFBRSxFQUFFLENBQUM7UUFDeEQsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2pCLENBQUM7QUFFRDs7Ozs7R0FLRztBQUNJLEtBQUssVUFBVSxxQkFBcUIsQ0FBQyxLQUFhLEVBQUUsT0FBcUM7SUFDNUYsTUFBTSxHQUFHLEdBQXFCO1FBQzFCLFFBQVEsRUFBRSxLQUFLO1FBQ2YsS0FBSyxFQUFFLEVBQUU7UUFDVCxLQUFLLEVBQUUsT0FBTztLQUNqQixDQUFDO0lBQ0YsSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUN0QixHQUFHLENBQUMsS0FBSyxHQUFHLDJCQUEyQixDQUFDO0lBQzVDLENBQUM7SUFDRCxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQ2YsR0FBRyxDQUFDLEtBQUssR0FBRyw0QkFBNEIsQ0FBQztRQUN6QyxPQUFPLEdBQUcsQ0FBQztJQUNmLENBQUM7SUFDRCxNQUFNLFVBQVUsR0FB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QUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5cclxuaW1wb3J0IHsgZXhpc3RzU3luYywgc3RhdFN5bmMsIHJlYWRkaXJTeW5jIH0gZnJvbSAnZnMtZXh0cmEnO1xyXG5pbXBvcnQgeyBkaXJuYW1lLCBqb2luLCBub3JtYWxpemUgfSBmcm9tICdwYXRoJztcclxuaW1wb3J0IHsgcGxhdGZvcm0gfSBmcm9tICdvcyc7XHJcbmltcG9ydCB7IElBbmRyb2lkSW50ZXJuYWxCdWlsZE9wdGlvbnMgfSBmcm9tICcuL3R5cGUnO1xyXG5pbXBvcnQgeyBCdWlsZENoZWNrUmVzdWx0IH0gZnJvbSAnLi4vLi4vQHR5cGVzL3Byb3RlY3RlZCc7XHJcblxyXG4vKipcclxuICog5qOA5p+lIGFuZHJvaWQg5YyF5ZCN55qE5ZCI5rOV5oCnXHJcbiAqIEBwYXJhbSBwYWNrYWdlTmFtZVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrUGFja2FnZU5hbWVWYWxpZGl0eShwYWNrYWdlTmFtZTogc3RyaW5nKSB7XHJcbiAgICAvLyByZWZlcjogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vc3R1ZGlvL2J1aWxkL2FwcGxpY2F0aW9uLWlkLmh0bWxcclxuICAgIHJldHVybiAvXlthLXpBLVpdXFx3KihcXC5bYS16QS1aXVxcdyopKyQvLnRlc3QocGFja2FnZU5hbWUpO1xyXG59XHJcblxyXG4vKipcclxuICog5qOA5p+l5piv5ZCm5Li656m6XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tJc0VtcHR5KHZhbHVlOiBhbnkpIHtcclxuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAnJykge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG4vKipcclxuICog5qOA5p+lIEFQSSBMZXZlbCDopoHmsYLvvIzmnIDkvY4gMTjvvIzlvIDlkK/lu7bov5/muLLmn5PnrqHnur/lkI7mnIDkvY7opoHmsYIgMjHvvIzlvIDlkK8gSW5zdGFuY2UgQVBQIOWQjuacgOS9jiAyM1xyXG4gKiBAcGFyYW0gdmFsdWVcclxuICogQHBhcmFtIG9wdGlvbnNcclxuICogQHJldHVybnNcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0FuZHJvaWRBUElMZXZlbHModmFsdWU6IG51bWJlciwgb3B0aW9uczogSUFuZHJvaWRJbnRlcm5hbEJ1aWxkT3B0aW9ucyk6IFByb21pc2U8QnVpbGRDaGVja1Jlc3VsdD4ge1xyXG4gICAgY29uc3QgcmVzOiBCdWlsZENoZWNrUmVzdWx0ID0ge1xyXG4gICAgICAgIG5ld1ZhbHVlOiB2YWx1ZSxcclxuICAgICAgICBlcnJvcjogJycsXHJcbiAgICAgICAgbGV2ZWw6ICdlcnJvcicsXHJcbiAgICB9O1xyXG4gICAgaWYgKGNoZWNrSXNFbXB0eSh2YWx1ZSkpIHtcclxuICAgICAgICByZXMuZXJyb3IgPSAnQVBJIExldmVsIGNhbm5vdCBiZSBlbXB0eSc7XHJcbiAgICB9XHJcbiAgICBpZiAoaXNOYU4odmFsdWUpKSB7XHJcbiAgICAgICAgcmVzLmVycm9yID0gJ0FQSSBMZXZlbCBtdXN0IGJlIGEgbnVtYmVyJztcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgfVxyXG4gICAgY29uc3QgQVBJVmVyc2lvbiA9IHZhbHVlO1xyXG4gICAgaWYgKG9wdGlvbnMucGFja2FnZXMuYW5kcm9pZC5hbmRyb2lkSW5zdGFudCAmJiBBUElWZXJzaW9uIDwgMjMpIHtcclxuICAgICAgICByZXMuZXJyb3IgPSAnV2hlbiBBbmRyb2lkIEluc3RhbnQgQXBwIGlzIGVuYWJsZWQsIHRoZSBtaW5pbXVtIEFQSSBMZXZlbCByZXF1aXJlZCBpcyAyMy4nO1xyXG4gICAgICAgIHJlcy5uZXdWYWx1ZSA9IDIzO1xyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICB9XHJcbiAgICBpZiAoKG9wdGlvbnMucGFja2FnZXMgYXMgYW55KS5uYXRpdmU/LkpvYlN5c3RlbSA9PT0gJ3RiYicgJiYgQVBJVmVyc2lvbiA8IDIxKSB7XHJcbiAgICAgICAgcmVzLmVycm9yID0gJ1doZW4gVEJCIGlzIGVuYWJsZWQsIHRoZSBtaW5pbXVtIEFQSSBMZXZlbCByZXF1aXJlZCBpcyAyMS4nO1xyXG4gICAgICAgIHJlcy5uZXdWYWx1ZSA9IDIxO1xyXG4gICAgICAgIHJldHVybiByZXM7XHJcbiAgICB9XHJcbiAgICAvLyBjb25zdCByZW5kZXJQaXBlbGluZSA9IGF3YWl0IEVkaXRvci5Qcm9maWxlLmdldFByb2plY3QoJ3Byb2plY3QnLCAnZ2VuZXJhbC5yZW5kZXJQaXBlbGluZScpO1xyXG4gICAgY29uc3QgcmVuZGVyUGlwZWxpbmUgPSBvcHRpb25zLnJlbmRlclBpcGVsaW5lO1xyXG4gICAgLy8g5bu26L+f5riy5p+T566h57q/XHJcbiAgICBpZiAocmVuZGVyUGlwZWxpbmUgPT09ICc1ZDQ1YmE2Ni04MjlhLTQ2ZDMtOTQ4ZS0yZWQzZmE3ZWU0MjEnICYmIEFQSVZlcnNpb24gPCAyMSkge1xyXG4gICAgICAgIHJlcy5lcnJvciA9ICdXaGVuIERlZmVycmVkIFJlbmRlciBQaXBlbGluZSBpcyBlbmFibGVkLCB0aGUgbWluaW11bSBBUEkgTGV2ZWwgcmVxdWlyZWQgaXMgMjEuJztcclxuICAgICAgICByZXMubmV3VmFsdWUgPSAyMTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgfVxyXG4gICAgaWYgKEFQSVZlcnNpb24gPCAxOSkge1xyXG4gICAgICAgIHJlcy5lcnJvciA9ICdUaGUgbWluaW11bSBBUEkgTGV2ZWwgcmVxdWlyZWQgaXMgMTkuJztcclxuICAgICAgICByZXMubmV3VmFsdWUgPSAxOTtcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDnlJ/miJAgQW5kcm9pZCDpgInpobnvvIzljIXmi6wgU0RL44CBTkRL44CBSmF2YSDot6/lvoTnrYlcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUFuZHJvaWRPcHRpb25zKG9wdGlvbnM6IElBbmRyb2lkSW50ZXJuYWxCdWlsZE9wdGlvbnMpIHtcclxuICAgIGNvbnN0IGFuZHJvaWQgPSBvcHRpb25zLnBhY2thZ2VzLmFuZHJvaWQ7XHJcbiAgICBhbmRyb2lkLm9yaWVudGF0aW9uID0gYW5kcm9pZC5vcmllbnRhdGlvbiB8fCB7XHJcbiAgICAgICAgbGFuZHNjYXBlUmlnaHQ6IHRydWUsXHJcbiAgICAgICAgbGFuZHNjYXBlTGVmdDogdHJ1ZSxcclxuICAgICAgICBwb3J0cmFpdDogZmFsc2UsXHJcbiAgICAgICAgdXBzaWRlRG93bjogZmFsc2UsXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIOafpeivoiBBbmRyb2lkIFNES+OAgU5ES+OAgUphdmEgSG9tZSDot6/lvoRcclxuICAgIC8vIOazqOaEj++8mui/memHjOmcgOimgeagueaNruWunumZheeahCBFZGl0b3IuTWVzc2FnZSBBUEkg5p2l6I635Y+W77yM5ZyoIENMSSDnjq/looPkuK3lj6/og73pnIDopoHkuI3lkIznmoTmlrnlvI9cclxuICAgIC8vIGNvbnN0IGFuZHJvaWRTREtJbmZvID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgncHJvZ3JhbScsICdxdWVyeS1wcm9ncmFtLWluZm8nLCAnYW5kcm9pZFNESycpO1xyXG4gICAgLy8gY29uc3QgYW5kcm9pZE5ES0luZm8gPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdwcm9ncmFtJywgJ3F1ZXJ5LXByb2dyYW0taW5mbycsICdhbmRyb2lkTkRLJyk7XHJcbiAgICAvLyBjb25zdCBqYXZhSG9tZSA9IGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ3Byb2dyYW0nLCAncXVlcnktcHJvZ3JhbS1pbmZvJywgJ2phdmFIb21lJyk7XHJcbiAgICBcclxuICAgIC8vIOS4tOaXtuWkhOeQhu+8muWmguaenOi3r+W+hOacquiuvue9ru+8jOWwneivleS7jueOr+Wig+WPmOmHj+iOt+WPllxyXG4gICAgaWYgKCFhbmRyb2lkLnNka1BhdGgpIHtcclxuICAgICAgICBhbmRyb2lkLnNka1BhdGggPSBwcm9jZXNzLmVudi5BTkRST0lEX0hPTUUgfHwgcHJvY2Vzcy5lbnYuQU5EUk9JRF9TREtfUk9PVCB8fCAnJztcclxuICAgICAgICBcclxuICAgICAgICAvLyDlsJ3or5Xpu5jorqTot6/lvoQgKFdpbmRvd3MpXHJcbiAgICAgICAgaWYgKCFhbmRyb2lkLnNka1BhdGggJiYgcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJykge1xyXG4gICAgICAgICAgICBjb25zdCBsb2NhbEFwcERhdGEgPSBwcm9jZXNzLmVudi5MT0NBTEFQUERBVEE7XHJcbiAgICAgICAgICAgIGlmIChsb2NhbEFwcERhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRTZGtQYXRoID0gam9pbihsb2NhbEFwcERhdGEsICdBbmRyb2lkJywgJ1NkaycpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4aXN0c1N5bmMoZGVmYXVsdFNka1BhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5kcm9pZC5zZGtQYXRoID0gZGVmYXVsdFNka1BhdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtBbmRyb2lkXSBBdXRvLWRldGVjdGVkIFNESyBhdDogJHthbmRyb2lkLnNka1BhdGh9YCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8g5bCd6K+V6buY6K6k6Lev5b6EIChNYWMpXHJcbiAgICAgICAgaWYgKCFhbmRyb2lkLnNka1BhdGggJiYgcHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ2RhcndpbicpIHtcclxuICAgICAgICAgICAgY29uc3QgaG9tZSA9IHByb2Nlc3MuZW52LkhPTUU7XHJcbiAgICAgICAgICAgIGlmIChob21lKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkZWZhdWx0U2RrUGF0aCA9IGpvaW4oaG9tZSwgJ0xpYnJhcnknLCAnQW5kcm9pZCcsICdzZGsnKTtcclxuICAgICAgICAgICAgICAgIGlmIChleGlzdHNTeW5jKGRlZmF1bHRTZGtQYXRoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZHJvaWQuc2RrUGF0aCA9IGRlZmF1bHRTZGtQYXRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQW5kcm9pZF0gQXV0by1kZXRlY3RlZCBTREsgYXQ6ICR7YW5kcm9pZC5zZGtQYXRofWApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoYW5kcm9pZC5zZGtQYXRoICYmICFwcm9jZXNzLmVudi5BTkRST0lEX0hPTUUpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgW0FuZHJvaWRdIFVzaW5nIFNESyBhdDogJHthbmRyb2lkLnNka1BhdGh9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFhbmRyb2lkLm5ka1BhdGgpIHtcclxuICAgICAgICBhbmRyb2lkLm5ka1BhdGggPSBwcm9jZXNzLmVudi5BTkRST0lEX05ES19IT01FIHx8IHByb2Nlc3MuZW52Lk5ES19ST09UIHx8ICcnO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIOWmguaenOacieS6hiBTREsg6Lev5b6E5L2G5rKh5pyJIE5ESyDot6/lvoTvvIzlsJ3or5XlnKggU0RLL25kayDkuIvmn6Xmib5cclxuICAgICAgICBpZiAoIWFuZHJvaWQubmRrUGF0aCAmJiBhbmRyb2lkLnNka1BhdGgpIHtcclxuICAgICAgICAgICAgIGNvbnN0IG5ka0Jhc2UgPSBqb2luKGFuZHJvaWQuc2RrUGF0aCwgJ25kaycpO1xyXG4gICAgICAgICAgICAgaWYgKGV4aXN0c1N5bmMobmRrQmFzZSkpIHtcclxuICAgICAgICAgICAgICAgICBjb25zdCBkaXJzID0gcmVhZGRpclN5bmMobmRrQmFzZSk7XHJcbiAgICAgICAgICAgICAgICAgaWYgKGRpcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAvLyDkvJjlhYjpgInmi6nniYjmnKwgMjjvvIzlhbbmrKEgMjPvvIzmnIDlkI7mmK/lhbbku5bniYjmnKxcclxuICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpb3JpdHlWZXJzaW9ucyA9IFsnMjgnLCAnMjMnXTtcclxuICAgICAgICAgICAgICAgICAgICAgbGV0IHNlbGVjdGVkVmVyc2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgLy8g5YWI5oyJ5LyY5YWI57qn5pCc57SiXHJcbiAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcHJpb3JpdHlWZXJzaW9uIG9mIHByaW9yaXR5VmVyc2lvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZlcnNpb25EaXIgPSBkaXJzLmZpbmQoZGlyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJQYXRoID0gam9pbihuZGtCYXNlLCBkaXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0U3luYyhkaXJQYXRoKS5pc0RpcmVjdG9yeSgpICYmIGRpci5zdGFydHNXaXRoKHByaW9yaXR5VmVyc2lvbiArICcuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZlcnNpb25EaXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZlcnNpb24gPSB2ZXJzaW9uRGlyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQW5kcm9pZF0gRm91bmQgTkRLIHZlcnNpb24gJHtwcmlvcml0eVZlcnNpb259IGF0OiAke2pvaW4obmRrQmFzZSwgc2VsZWN0ZWRWZXJzaW9uKX1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5LyY5YWI57qn54mI5pys6YO95rKh5om+5Yiw77yM6YCJ5oup5YW25LuW54mI5pys77yI5o6S5bqP6I635Y+W5pyA5paw55qE77yJXHJcbiAgICAgICAgICAgICAgICAgICAgIGlmICghc2VsZWN0ZWRWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdGhlclZlcnNpb25EaXJzID0gZGlycy5maWx0ZXIoZGlyID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXJQYXRoID0gam9pbihuZGtCYXNlLCBkaXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0U3luYyhkaXJQYXRoKS5pc0RpcmVjdG9yeSgpIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAhcHJpb3JpdHlWZXJzaW9ucy5zb21lKHB2ID0+IGRpci5zdGFydHNXaXRoKHB2ICsgJy4nKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgL15cXGQrXFwuLy50ZXN0KGRpcik7IC8vIOeJiOacrOWPt+agvOW8j++8muaVsOWtly54eHhcclxuICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJWZXJzaW9uRGlycy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXJWZXJzaW9uRGlycy5zb3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRWZXJzaW9uID0gb3RoZXJWZXJzaW9uRGlyc1tvdGhlclZlcnNpb25EaXJzLmxlbmd0aCAtIDFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbQW5kcm9pZF0gRm91bmQgTkRLIHZlcnNpb24gJHtzZWxlY3RlZFZlcnNpb259IGF0OiAke2pvaW4obmRrQmFzZSwgc2VsZWN0ZWRWZXJzaW9uKX1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkVmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgYW5kcm9pZC5uZGtQYXRoID0gam9pbihuZGtCYXNlLCBzZWxlY3RlZFZlcnNpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFtBbmRyb2lkXSBBdXRvLWRldGVjdGVkIE5ESyBhdDogJHthbmRyb2lkLm5ka1BhdGh9YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoYW5kcm9pZC5uZGtQYXRoICYmICFwcm9jZXNzLmVudi5BTkRST0lEX05ES19IT01FKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYFtBbmRyb2lkXSBVc2luZyBOREsgYXQ6ICR7YW5kcm9pZC5uZGtQYXRofWApO1xyXG4gICAgfVxyXG5cclxuICAgIGFuZHJvaWQuc2RrUGF0aCA9IGFuZHJvaWQuc2RrUGF0aCB8fCAnJztcclxuICAgIGFuZHJvaWQubmRrUGF0aCA9IGFuZHJvaWQubmRrUGF0aCB8fCAnJztcclxuICAgIGFuZHJvaWQuamF2YUhvbWUgPSBhbmRyb2lkLmphdmFIb21lIHx8IHByb2Nlc3MuZW52LkpBVkFfSE9NRSB8fCAnJztcclxuICAgIGFuZHJvaWQuamF2YVBhdGggPSAnJztcclxuXHJcbiAgICBpZiAoYW5kcm9pZC5qYXZhSG9tZSkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0ID0gc3RhdFN5bmMoYW5kcm9pZC5qYXZhSG9tZSk7XHJcbiAgICAgICAgICAgIGlmIChzdC5pc0ZpbGUoKSkge1xyXG4gICAgICAgICAgICAgICAgYW5kcm9pZC5qYXZhUGF0aCA9IGFuZHJvaWQuamF2YUhvbWU7XHJcbiAgICAgICAgICAgICAgICBhbmRyb2lkLmphdmFIb21lID0gbm9ybWFsaXplKGpvaW4oZGlybmFtZShhbmRyb2lkLmphdmFQYXRoKSwgJy4uJykpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0LmlzRGlyZWN0b3J5KCkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGphdmFGaWxlTmFtZSA9IHBsYXRmb3JtKCkgPT09ICd3aW4zMicgPyAnamF2YS5leGUnIDogJ2phdmEnO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGF0aFRvSmF2YSA9IGpvaW4oYW5kcm9pZC5qYXZhSG9tZSwgJ2JpbicsIGphdmFGaWxlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWV4aXN0c1N5bmMocGF0aFRvSmF2YSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBKYXZhIGV4ZWN1dGFibGUgbm90IGZvdW5kIGF0ICR7YW5kcm9pZC5qYXZhSG9tZX0vYmluYCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZHJvaWQuamF2YVBhdGggPSBwYXRoVG9KYXZhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoYW5kcm9pZC5rZXlzdG9yZVBhdGgpIHtcclxuICAgICAgICAvLyDlnKggQ0xJIOeOr+Wig+S4re+8jOi3r+W+hOWkhOeQhuWPr+iDvemcgOimgeiwg+aVtFxyXG4gICAgICAgIC8vIGFuZHJvaWQua2V5c3RvcmVQYXRoID0gRWRpdG9yLlVJLl9fcHJvdGVjdGVkX18uRmlsZS5yZXNvbHZlVG9SYXcoYW5kcm9pZC5rZXlzdG9yZVBhdGgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBhbmRyb2lkO1xyXG59XHJcblxyXG4iXX0=