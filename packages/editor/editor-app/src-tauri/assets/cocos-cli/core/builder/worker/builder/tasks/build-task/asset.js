'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.title = void 0;
exports.handle = handle;
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const utils_1 = __importDefault(require("../../../../../base/utils"));
const assets_1 = require("../../../../../assets");
exports.title = 'Build Assets';
async function handle(options, result, cache) {
    this.updateProcess('Build bundles...');
    await this.bundleManager.buildAsset();
    // 生成 effect.bin
    if (options.includeModules.includes('custom-pipeline')) {
        const effectBin = await assets_1.assetManager.getEffectBinPath();
        result.paths.effectBin = (0, path_1.join)((0, path_1.dirname)(result.paths.settings), 'effect.bin');
        await (0, fs_extra_1.copyFile)(effectBin, result.paths.effectBin);
        options.md5CacheOptions.excludes.push(utils_1.default.Path.relative(result.paths.dir, result.paths.effectBin));
    }
    // 输出 bundle 文件夹内容
    await this.bundleManager.outputBundle();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvY29yZS9idWlsZGVyL3dvcmtlci9idWlsZGVyL3Rhc2tzL2J1aWxkLXRhc2svYXNzZXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7Ozs7QUFhYix3QkFhQztBQXhCRCx1Q0FBb0M7QUFDcEMsK0JBQXFDO0FBSXJDLHNFQUE4QztBQUU5QyxrREFBcUQ7QUFFeEMsUUFBQSxLQUFLLEdBQUcsY0FBYyxDQUFDO0FBRTdCLEtBQUssVUFBVSxNQUFNLENBQWlCLE9BQThCLEVBQUUsTUFBMkIsRUFBRSxLQUF3QjtJQUM5SCxJQUFJLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDdkMsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3RDLGdCQUFnQjtJQUNoQixJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQztRQUNyRCxNQUFNLFNBQVMsR0FBRyxNQUFNLHFCQUFZLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN4RCxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFBLFdBQUksRUFBQyxJQUFBLGNBQU8sRUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQzVFLE1BQU0sSUFBQSxtQkFBUSxFQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2xELE9BQU8sQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxlQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDekcsQ0FBQztJQUVELGtCQUFrQjtJQUNsQixNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDNUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmltcG9ydCB7IGNvcHlGaWxlIH0gZnJvbSAnZnMtZXh0cmEnO1xyXG5pbXBvcnQgeyBkaXJuYW1lLCBqb2luIH0gZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7IEJ1aWxkZXJBc3NldENhY2hlIH0gZnJvbSAnLi4vLi4vbWFuYWdlci9hc3NldCc7XHJcbmltcG9ydCB7IEludGVybmFsQnVpbGRSZXN1bHQgfSBmcm9tICcuLi8uLi9tYW5hZ2VyL2J1aWxkLXJlc3VsdCc7XHJcbmltcG9ydCB7IElCdWlsZGVyLCBJSW50ZXJuYWxCdWlsZE9wdGlvbnMgfSBmcm9tICcuLi8uLi8uLi8uLi9AdHlwZXMvcHJvdGVjdGVkJztcclxuaW1wb3J0IHV0aWxzIGZyb20gJy4uLy4uLy4uLy4uLy4uL2Jhc2UvdXRpbHMnO1xyXG5pbXBvcnQgYnVpbGRlckNvbmZpZyBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZS9idWlsZGVyLWNvbmZpZyc7XHJcbmltcG9ydCB7IGFzc2V0TWFuYWdlciB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2Fzc2V0cyc7XHJcblxyXG5leHBvcnQgY29uc3QgdGl0bGUgPSAnQnVpbGQgQXNzZXRzJztcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGUodGhpczogSUJ1aWxkZXIsIG9wdGlvbnM6IElJbnRlcm5hbEJ1aWxkT3B0aW9ucywgcmVzdWx0OiBJbnRlcm5hbEJ1aWxkUmVzdWx0LCBjYWNoZTogQnVpbGRlckFzc2V0Q2FjaGUpIHtcclxuICAgIHRoaXMudXBkYXRlUHJvY2VzcygnQnVpbGQgYnVuZGxlcy4uLicpO1xyXG4gICAgYXdhaXQgdGhpcy5idW5kbGVNYW5hZ2VyLmJ1aWxkQXNzZXQoKTtcclxuICAgIC8vIOeUn+aIkCBlZmZlY3QuYmluXHJcbiAgICBpZiAob3B0aW9ucy5pbmNsdWRlTW9kdWxlcy5pbmNsdWRlcygnY3VzdG9tLXBpcGVsaW5lJykpIHtcclxuICAgICAgICBjb25zdCBlZmZlY3RCaW4gPSBhd2FpdCBhc3NldE1hbmFnZXIuZ2V0RWZmZWN0QmluUGF0aCgpO1xyXG4gICAgICAgIHJlc3VsdC5wYXRocy5lZmZlY3RCaW4gPSBqb2luKGRpcm5hbWUocmVzdWx0LnBhdGhzLnNldHRpbmdzKSwgJ2VmZmVjdC5iaW4nKTtcclxuICAgICAgICBhd2FpdCBjb3B5RmlsZShlZmZlY3RCaW4sIHJlc3VsdC5wYXRocy5lZmZlY3RCaW4pO1xyXG4gICAgICAgIG9wdGlvbnMubWQ1Q2FjaGVPcHRpb25zLmV4Y2x1ZGVzLnB1c2godXRpbHMuUGF0aC5yZWxhdGl2ZShyZXN1bHQucGF0aHMuZGlyLCByZXN1bHQucGF0aHMuZWZmZWN0QmluKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g6L6T5Ye6IGJ1bmRsZSDmlofku7blpLnlhoXlrrlcclxuICAgIGF3YWl0IHRoaXMuYnVuZGxlTWFuYWdlci5vdXRwdXRCdW5kbGUoKTtcclxufVxyXG4iXX0=